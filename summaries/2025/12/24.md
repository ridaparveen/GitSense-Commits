# Activity Summary for 12/24/2025

## 10:37:33 AM
The code changes primarily affect two files: `src\pages\shipment\tracking-stepper.tsx` and `src\SelectCustomer.tsx`.

### File-Specific Updates:

**`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\pages\shipment\tracking-stepper.tsx`**

*   **Early Changes (12/23/2025, 2:31:01 PM - 2:40:01 PM)**: A series of minor, rapid adjustments, often involving commenting out and then uncommenting styling properties (`s.wrapper`, `s.root`, `s.vehicleBox`, `s.lineWrapper`, `s.infoRow`) or icon dimensions (`width`, `height` for `TrainSVGIcon`, `TruckSVGIcon`). There were also slight `minWidth` adjustments for `iconRow` and `infoRow`, indicating layout fine-tuning or responsive design attempts.
*   **Debugging with Hardcoded Dates (12/23/2025, 2:45:11 PM - 4:36:53 PM)**: Multiple timestamps show the introduction and subsequent removal/modification of hardcoded dates (e.g., `'2025-04-29'`, `'2023-12-31'`) and temporary labels (e.g., "ETA:123", "ETA@@:") within the `formatDate` calls and `polToPodcompletedValidation` function. This suggests extensive debugging of date-related logic and display.
*   **Major Refactoring Attempt and Reversion (12/23/2025, 4:45:54 PM - 4:46:20 PM)**: A significant refactoring effort was made to simplify the `TrackingStepper` component by removing the `getTrackingDetails` helper and constructing the timeline directly within the main component. This also involved renaming internal icon variables and changing the `useEffect` dependency for progress calculation. This refactor was almost immediately reverted, indicating it was either exploratory or not ready for integration.
*   **Evolved Tracking Logic (12/23/2025, 3:39:02 PM onwards)**:
    *   The `polToPodcompletedValidation` function was completely rewritten to handle different completion criteria based on `trackingInfo.atd` (if shipment has departed) and `trackingInfo.t49_shipment_added` status.
    *   The core `getTrackingDetails` logic was extensively modified to dynamically build the tracking timeline based on `inland_rail_move` property. It now explicitly handles "no rail" (truck) and "rail move" scenarios, including details for intermediate stops like "Rail Destination" and "Consignee Location".
    *   Introduction of `path1`, `path2`, `path3` boolean flags to control progress logic and icons.
    *   Introduction of `icon_text` property in timeline items, though its usage in rendering is not fully apparent in the provided snippets.
*   **Icon Library and Dynamic Styling (12/23/2025, 6:03:01 PM - 7:47:06 PM)**:
    *   Shifted from using `@iconify/react` for `TruckSVGIcon` to `react-icons/fa6` (`FaShip`) and `react-icons/md` (`MdDirectionsRailway` for `Railway` icon), and introduced `FaAnchor` for `Terminal` icon.
    *   Implemented dynamic positioning for the vehicle icon along the progress line (`s.vehicleBox` with `left: \`calc(${item.percentage}% - 12px)\` `).
*   **`console.log` for Debugging**: Several `console.log` statements were added, particularly for `trackingInfo` and `getTravelProgress`, suggesting active debugging throughout the development.

**`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\pages\shipment\shipment-details-page.tsx`**

*   **Integration of `TrackingStepper` (12/23/2025, 2:37:36 PM)**: The `TrackingStepper` component (from the other file) was integrated into the `ShipmentDetailsPage`, indicating a new feature to display shipment progress.
*   **Minor Layout Adjustments (12/23/2025, 2:37:50 PM - 2:38:05 PM)**: The `TrackingStepper` component was briefly moved within the page's JSX layout, and then reverted, suggesting minor UI positioning experiments.
*   **Debugging (`console.log`)**: Multiple `console.log` statements were added to inspect `shipmentDeatils`, `isLoading`, `isFetching`, and `isSuccess` states, indicating active debugging of data fetching and component rendering.

**`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\SelectCustomer.tsx`**

*   **Initial State and Frontend Pagination (12/23/2025, 8:37:09 PM)**: The `SelectCustomerPanel` component was initially designed to fetch all customer options once (`fetchAllCustomers`) and then perform filtering and pagination on the client-side.
*   **Transition to Backend Pagination and Search (12/23/2025, 8:49:11 PM - 8:57:59 PM)**: A significant architectural shift occurred. The component was refactored to implement server-side pagination and search.
    *   A new `fetchCustomers` function was introduced to make API calls with `pageNo` and `keyword` parameters, updating `allOptions` (now representing the current page's data) and `total` (total items from API).
    *   The `useEffect` hook now triggers `fetchCustomers(1)` when the panel opens.
    *   `handlePageChange` and `handleSearchChange` are updated to call `fetchCustomers` with the relevant page number and search keyword, indicating that search and pagination are now handled by the backend API.
*   **Code Clarity (12/24/2025, 10:32:22 AM - 10:36:12 AM)**: Minor updates to add comments clarifying the shift from frontend to backend pagination logic. No functional changes in these very late timestamps.

### Timestamps of Significant Changes:

*   **12/23/2025, 3:39:02 PM**: Major rewrite of `polToPodcompletedValidation` and `getTrackingDetails` in `tracking-stepper.tsx`, introducing complex conditional logic for shipment progress.
*   **12/23/2025, 4:45:54 PM**: First attempt at a major refactor of `TrackingStepper`'s rendering logic (later reverted).
*   **12/23/2025, 6:03:01 PM - 6:07:21 PM**: Introduction of `react-icons` for some vehicle icons in `tracking-stepper.tsx`, replacing `@iconify/react` for those specific elements.
*   **12/23/2025, 6:20:04 PM**: Implementation of dynamic vehicle icon positioning along the progress line in `tracking-stepper.tsx`.
*   **12/23/2025, 8:49:11 PM**: Significant overhaul of `SelectCustomer.tsx` to switch from client-side to server-side pagination and search for customer options.

### Patterns and Recurring Elements:

*   **Iterative Development and Debugging**: A strong pattern of small, sequential changes, often followed by reverts (commenting/uncommenting sections, temporary hardcoded values, `console.log` statements), indicates an active, iterative development process with frequent debugging.
*   **Refactoring Efforts**: Both files show attempts at refactoring core logic (`getTrackingDetails` in `tracking-stepper.tsx` and pagination in `SelectCustomer.tsx`). While one refactor was reverted, the other (pagination) was successfully implemented, suggesting ongoing code improvement.
*   **UI/UX Enhancements**: Changes related to icon styles, layout adjustments, and dynamic icon positioning point towards continuous refinement of the user interface and experience for tracking shipments and selecting customers.
*   **Backend Integration**: The shift in `SelectCustomer.tsx` to backend-driven pagination and search signifies a move towards more scalable and efficient data handling, reducing client-side processing for large datasets.

## 1:49:14 PM
The `ShipmentTrackingScreen.jsx` file, last updated on **12/23/2025, 10:08:25 AM**, details a React component for displaying comprehensive shipment tracking information. This screen dynamically fetches shipment and vessel tracking data based on `mblno` and `fileno` from URL parameters. It features a layout divided into a main content area and a sidebar, utilizing Material-UI components for structuring. Key elements include a map for tracking, a `TrackingStepper` for status visualization, `CardField` components to display core shipment details (e.g., File No, BL, Supplier, MBL No), and an expandable "More Details" section to reveal additional information like Customer Ref No, Commodity, Consignee, Service, Piece count, and Weight. The screen also incorporates `TrackingInfoContainer` and `MilestonesContainer` for further details. A loading state is managed with a `Loader` component.

The `App.js` file, last updated on **12/24/2025, 10:36:54 AM**, serves as the central routing configuration for the application. It defines an extensive set of routes for various modules, including authentication, user management, dashboards, packing lists, service invoices, PO orders, OTM BOLs, customer/party/agent code management, planboards, detention, commercial invoices, ALC, container reports, report scheduling, and multiple tracking functionalities (FCL, LCL, Rail, Air, Trucking). A predominant pattern across this file is the widespread implementation of role-based access control using `ProtectedRoute` and `AuthGuard` components, alongside a `UserRoleEnum` to restrict access to specific routes based on the user's role (e.g., ADMIN, CUSTOMER, AGENT, SPR_CUSTOMER). Many features are structured with a primary view screen and a corresponding form screen for data entry or modification. The application also uses `ThemeProvider` for consistent styling and `Toaster` for notifications.

**Patterns or Recurring Elements:**

*   **Role-based Access Control:** A strong emphasis on security is evident through the extensive use of `ProtectedRoute` and `UserRoleEnum` to manage user permissions for nearly all application routes.
*   **Modularity and Form-Based Interactions:** The application structure frequently involves dedicated screens for viewing lists of items and separate form screens for creating or editing those items across various modules.
*   **Dashboard and Tracking Focus:** Both files highlight a significant focus on displaying and managing dashboards and detailed tracking information, with specific routes for various tracking modes (shipment, FCL, LCL, Rail, Air).
*   **Material-UI (MUI) Integration:** The consistent use of `@mui/material` components in `ShipmentTrackingScreen.jsx` and the presence of `ThemeProvider` in `App.js` indicate a unified Material-UI design system.
*   **Modern Data Handling:** The use of RTK Query hooks in `ShipmentTrackingScreen.jsx` suggests a modern approach to API interaction and state management.

## 1:49:20 PM
The provided log details code changes primarily focused on enhancing the analytics and reporting capabilities of the `t360-backend-v2` project, along with expanding API routes. The changes occurred between December 18, 2025, and December 24, 2025.

**File-specific Updates:**

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-backend-v2\src\services\analytics\customerAutosearchOptions.ts`**
    *   **12/18/2025, 3:54:52 PM:** The `getAllCustomerOptions` function was initially implemented. It supported fetching distinct customer names (`account_name`) for the `CUSTOMER` role from `mtr_tracking_data` with optional pagination, and distinct agent names (`cname`) for the `AGENT` role from `agent_po_account_master` with a limit of 10. Results were formatted as `{ value, label }` pairs.
    *   **12/23/2025, 8:50:22 PM:** The logic for the `CUSTOMER` role was revised. The `countQuery` for pagination was changed from `COUNT(DISTINCT account_name)` to a more robust subquery `SELECT COUNT(*) FROM (SELECT 1 FROM mtr_tracking_data GROUP BY account_name) t`, and the data query also incorporated `GROUP BY account_name` and `ORDER BY account_name`.
    *   **12/23/2025, 8:58:22 PM:** A major refactor of `getAllCustomerOptions` occurred. The previous implementations were commented out and a new version was introduced. This version added a `search` query parameter, enabling filtering by name (case-insensitive `ILIKE`) for both `AGENT` (`cname`) and `CUSTOMER` (`account_name`) roles. The pagination logic for `CUSTOMER` was further refined to apply the search filter to both the total count and the data retrieval.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-backend-v2\src\common\constants\Paths.ts`**
    *   **12/18/2025, 3:55:32 PM:** Several new API base paths and their sub-endpoints were added to the `Paths` constant. These include:
        *   `Audit` (`/audit` with `Get`)
        *   `Planbaord` (`/planboard` with `Get`)
        *   `Company` (`/company`)
        *   `CustomerOptions` (`/getCustomerOptions`)
        *   `Menu` (`/menus` with `GetUserMenus`)
        *   `CO2Emission` (`/co2emission` with `Get`)
    This indicates a significant expansion of the application's exposed functionalities.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-backend-v2\src\routes\index.ts`**
    *   **12/18/2025, 3:56:44 PM:** This file was updated to integrate the newly defined paths and their corresponding service functions or routers into the main `apiRouter`. Specifically, routes for `PlanbaordRoutes`, `MenuRoutes`, `Co2EmissionRoutes`, `getAllCustomerOptions`, and `getAllAudit` were added, mirroring the additions in `Paths.ts`.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-backend-v2\src\common\util\export.query.ts`**
    *   **12/19/2025, 7:53:25 AM:** A `getMonthValue` helper function was added to convert stacked month strings (e.g., "Jan") to numeric values. The primary change was the introduction of the `bookingQuery` function. This large function dynamically generates complex SQL queries for various "booking" related reports (e.g., "Booking Date to Actual Departure", "Booking Date to POD Arrival"). It uses `reportName` as a key to retrieve specific query snippets, applies `CompanyName` filters, and includes extensive conditional logic for date range filtering (by month, week, quarter) and grouping for stacked bar charts, often categorizing `day_diff` into week-based ranges. It frequently joins `mtr_tracking_data` with `agent_booking_entry` on `mblno` and filters out invalid date values.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-backend-v2\src\services\analytics\analyticsExportService.ts`**
    *   **12/24/2025, 1:13:00 PM:** The `getExportData` function was introduced, acting as the main entry point for exporting analytics data. It processes various query parameters (e.g., `fromDate`, `toDate`, `reportName`, `columns`, `mblwise`, `booking`). It retrieves user and company information, dynamically generates SQL queries using `bookingQuery` or `nonBookingQuery` (the latter not detailed in this log but implied), and handles default date ranges. For "booking" reports, it includes logic for `mblWiseQuery` to select distinct records based on `mblno` or container details. A specific filter for "mblwise TEU" reports handles duplicate container entries. Finally, it applies `dateFilterOnExport` and `replaceColumnHandler` to the data, with `replaceColumnHandler` notably standardizing "LONG BEACH" to "LOS ANGELES" in `pod` and `place_of_delivery` fields.

**Patterns and Recurring Elements:**

*   **Analytics and Reporting Focus:** The most prominent pattern is the extensive development within the `analytics` domain, covering data retrieval for auto-suggest, dynamic SQL generation for complex reports, and a dedicated service for exporting this data.
*   **Dynamic Query Generation:** The `export.query.ts` and `analyticsExportService.ts` files heavily rely on dynamically constructing SQL queries based on user-selected report names and filters, indicating a flexible reporting architecture.
*   **Date and Time Manipulation:** Frequent use of `EXTRACT` in SQL, explicit date range filtering, and handling of placeholder/invalid date values (`'0001-01-01 00:00:00 BC'`) are common in the reporting queries.
*   **Role-Based Data Access:** The `customerAutosearchOptions.ts` file clearly segregates data fetching logic based on user roles (`AGENT` vs. `CUSTOMER`).
*   **Structured API Design:** The updates to `Paths.ts` and `index.ts` demonstrate a consistent approach to defining new API endpoints and integrating them into the backend, expanding the application's feature set.
*   **Pagination and Search:** The evolution of `customerAutosearchOptions.ts` highlights an iterative refinement process to implement robust pagination and search functionalities for data selection.
*   **Consistent Error Handling:** All service functions utilize `logger.error` and return `res.status(500).json({ error: "Internal server error" })` for unhandled exceptions.
*   **Timestamp Proximity:** All changes occurred within a short, concentrated period (December 18-24, 2025), suggesting active and rapid development on these specific features.

## 2:49:14 PM
The `ShipmentTrackingScreen.jsx` file, last modified on December 23, 2025, at 10:08:25 AM, was updated to provide a detailed view for shipment tracking. This component is responsible for fetching and displaying comprehensive shipment and vessel data, including a visual map, a tracking stepper, and organized shipment information. It leverages Material-UI components for its layout and custom components like `MapTrackingContainer`, `TrackingStepper`, `TrackingInfoContainer`, and `MilestonesContainer`. Key shipment details such as file number, BL, supplier, MBL, customer reference, commodity, consignee, service, piece count, and weight are presented, with a toggleable "More Details" section for additional information.

The `App.js` file, significantly updated on December 24, 2025, at 10:36:54 AM, primarily focuses on expanding the application's routing and implementing robust access control. This update integrated numerous new pages and functionalities, demonstrating a substantial growth in the application's feature set. New routes were added for various tracking types (FCL, LCL, Rail, Air, Trucking, and the general `ShipmentTrackingScreen`), multiple dashboards (e.g., `ISFDashboardScreen`, `Dashboard7501Screen`), booking enhancements (including HBL and ISF forms), and master data management (City, Port, Customer, Agent).

A dominant pattern observed across these changes, especially in `App.js`, is the extensive use of role-based access control. Almost all routes are protected by `ProtectedRoute` or `AuthGuard`, specifying multiple `UserRoleEnum` values (such as ADMIN, CUSTOMER, AGENT, SPR_CUSTOMER), indicating a strong emphasis on security and granular user permissions. Recurring elements include numerous `*/form` routes, suggesting a multitude of screens dedicated to data entry and editing across different modules. The "Extend" suffix in component names like `AgentBookingFormScreenExtend` and `BookingDashbaordScreenExtend` points to an iterative development approach where existing features are enhanced or replaced with more comprehensive versions. The overall content highlights the development of a large, modular application with distinct sections for booking, tracking, analytics, user management, and various administrative functions.

## 2:49:20 PM
The initial set of changes, occurring between 12/18/2025, 3:54:52 PM and 12/18/2025, 3:56:44 PM, introduced new features and endpoints:

*   **`src\services\analytics\customerAutosearchOptions.ts` (12/18/2025, 3:54:52 PM):** A new service function `getAllCustomerOptions` was added. This function dynamically fetches distinct customer or agent names (cname/account\_name) from `agent_po_account_master` or `mtr_tracking_data` tables, respectively, based on the `role` query parameter. It supports basic pagination for the `CUSTOMER` role, returning data with `value` and `label` fields.
*   **`src\common\constants\Paths.ts` (12/18/2025, 3:55:32 PM):** This file was updated to define new API paths. Notably, `CustomerOptions.Base: "/getCustomerOptions"`, `Menu.Base: "/menus"`, `CO2Emission.Base: "/co2emission"`, and `Audit.Get: "/audit"` were added.
*   **`src\routes\index.ts` (12/18/2025, 3:56:44 PM):** The main API router was updated to integrate the newly defined paths and services. It now registers routes for `MenuRoutes`, `Co2EmissionRoutes`, `getAllCustomerOptions` (for `Paths.CustomerOptions.Base`), and `getAllAudit` (for `Paths.Audit.Get`).

On **12/19/2025, 7:53:25 AM**, the file `src\common\util\export.query.ts` was updated. This change introduced a `getMonthValue` helper function and a comprehensive `bookingQuery` function. The `bookingQuery` function is responsible for generating complex, dynamic SQL queries for various analytics reports related to booking, departure, and arrival dates. It calculates date differences, applies conditional filtering based on `stackedExport`, `displayBy` (month, week, quarter), and `stackedGroup`, and handles specific report names like "Booking Date to Actual Departure" or "Booking Date to POD Arrival."

Significant updates to the `customerAutosearchOptions.ts` file occurred on **12/23/2025**:

*   **12/23/2025, 8:50:22 PM:** The pagination logic for the `CUSTOMER` role in `getAllCustomerOptions` was refactored. The `countQuery` was updated to use a subquery (`SELECT 1 FROM mtr_tracking_data GROUP BY account_name`) to more accurately count distinct `account_name` entries for pagination totals. The `sqlQuery` also incorporated `GROUP BY account_name` and `ORDER BY account_name` for fetching paginated data.
*   **12/23/2025, 8:58:22 PM:** A complete rewrite of the `getAllCustomerOptions` function introduced a crucial `search` functionality. This version added a `search` query parameter, allowing users to filter both `AGENT` and `CUSTOMER` results using an `ILIKE` clause in the SQL queries. The new implementation dynamically builds `WHERE` clauses to include this search filter in both counting and data retrieval queries, significantly enhancing the autosearch capabilities.

Further analytics-related changes occurred on **12/24/2025** in the `src\services\analytics\analyticsExportService.ts` file:

*   **12/24/2025, 1:13:00 PM:** The `getExportData` function was introduced, designed to handle the export of various analytics reports. It processes a wide range of query parameters (e.g., `fromDate`, `toDate`, `reportName`, `columns`), determines the relevant company and user context, and then utilizes `bookingQuery` or `nonBookingQuery` (from `export.query.ts`) to construct the appropriate SQL for data retrieval. It includes specific logic for handling "MBLwise TEU" reports and introduces a `replaceColumnHandler` to standardize "LONG BEACH" to "LOS ANGELES" for POD/delivery locations.
*   **12/24/2025, 1:58:20 PM:** A minor update to `analyticsExportService.ts` occurred, primarily involving a commented-out `console.log` statement, indicating minor debugging adjustments without changing the core logic.

Finally, on **12/24/2025, 2:14:49 PM**, a substantial change was made to `src\services\shipmentService.ts`. This involved the introduction of a new `SqlQueryBuilder` class. This builder dynamically constructs SQL queries for shipments, supporting both "ocean" and "air" transport modes. It incorporates complex filtering based on user roles (Admin, Customer, FrontOffice, Agent), general filters (POL, POD, shipment ID, container number, company name), and specific "card filters" (e.g., pending departure, in transit). The builder applies distinct conditions for ocean and air shipments, handles date ranges, and supports `ShipmentStatus` and `AirShipmentStatus` enums for status-based filtering, representing a significant architectural improvement for managing shipment data queries.

**Patterns and Recurring Elements:**

*   **Analytics and Reporting Focus:** A recurring theme is the enhancement of analytics and reporting features, with services dedicated to customer autosearch, dynamic SQL generation for reports, and data export.
*   **Dynamic SQL Query Construction:** Multiple files (`export.query.ts`, `customerAutosearchOptions.ts`, `shipmentService.ts`) demonstrate sophisticated logic for building SQL queries programmatically, often using parameterized queries and conditional clauses based on user input and system state.
*   **Role-Based Logic:** User roles (ADMIN, CUSTOMER, AGENT, FRONTOFFICE) are consistently used to apply different business logic and data access rules across various services.
*   **Pagination and Filtering:** Pagination for large datasets and comprehensive filtering capabilities (by date, status, search terms, locations) are common requirements addressed in these updates.
*   **Data Transformation:** Results from database queries are frequently transformed or mapped into a more user-friendly format (e.g., `value`/`label` pairs, column name replacements).
*   **Error Handling and Logging:** Robust `try...catch` blocks and detailed `logger.info`/`logger.error` statements are used throughout the codebase for monitoring and stability.