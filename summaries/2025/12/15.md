# Activity Summary for 12/15/2025

## 2:27:12 PM
**File: `c:\Users\ridap\OneDrive\Documents\T360_Api\t360-backend\src\controllers\analytics\query\booking.query.ts`**
Across all timestamps (12/15/2025, from 10:20:53 AM to 11:52:02 AM), the provided code snippets for this file are identical. The file defines an asynchronous function `bookingQueryBuilder` that constructs SQL queries based on the `type` of booking analytics requested. It dynamically sets `customizer` properties (e.g., `dateRange`, `calType`, `dateColumns`, `booking`, `mblwise`, `calColumnConfig`, `chartType`) and builds complex PostgreSQL queries for different report types, including "BookingDatetoActualDeparture", "BookingDatetoActualDepartureMblWise", and stacked bar chart variations ("BookingDatetoActualDepartureStackedBar", "BookingDatetoActualDepartureMblWiseStackedBar"). These queries typically join `mtr_tracking_data` and `agent_booking_entry` tables, filter by `CompanyName`, date ranges, and calculate day differences between booking and actual departure dates, often aggregating results and calculating percentages or categorizing delays into time buckets (e.g., "Less than 1 week", "1 - 2 weeks"). No specific code changes are visible within the provided log entries for this file.

**File: `c:\Users\ridap\OneDrive\Documents\T360_Api\t360-backend\src\controllers\analytics\query\export.query.ts`**
This file, defining `bookingQuery` to provide SQL snippets for various reports, saw several updates:
*   **12/15/2025, 12:01:30 PM:** The initial version of the `bookingQuery` function, including a `getMonthValue` helper, provided SQL WHERE clause snippets for reports like "Booking Date to Actual Departure", "Carrier On-time delivery By carrier", "Average Transit time By lane", and other booking-related metrics. The "Average Transit time By lane" query's WHERE clause was initially relatively simple, checking for non-null `t49_eta`, `t49_vessel_actualarrived_date`, `vessel_actualarrived_date`, and `scac_code`.
*   **12/15/2025, 12:19:23 PM:** The "Average Transit time By lane" query underwent a significant expansion. Its `WHERE` clause was updated to include more elaborate conditions for different transportation legs (SEA, RAIL, TRUCK), using `COALESCE` for actual departure/arrival dates and explicit checks for `inland_rail_move` to conditionally include rail and truck leg requirements.
*   **12/15/2025, 2:05:36 PM:** Minor refinement to the "Average Transit time By lane" query's RAIL leg conditions, specifically adding `m.rail_ata IS NOT NULL` as a separate check within the conditional block for rail.
*   **12/15/2025, 2:14:07 PM:** The "Average Transit time By lane" query's `WHERE` clause was further restructured for readability with comments delineating "SEA (mandatory)", "RAIL (only if inland)", and "TRUCK (optional but safe)" sections. The logical conditions within these sections were also slightly adjusted.
*   **12/15/2025, 2:23:42 PM:** The most substantial change to "Average Transit time By lane" occurred, modifying the overall logical structure of its `WHERE` clause. Instead of a series of `AND` conditions implying all legs must exist or be accounted for, the query was updated to use `OR` conditions for the primary legs. This means a record is now included if conditions for *any one* of the SEA, RAIL, or TRUCK legs are met, significantly broadening the data included in this report.
*   **12/15/2025, 2:23:52 PM:** No visible changes were present in this log entry compared to the previous one.

**File: `c:\Users\ridap\OneDrive\Documents\T360_Api\t360-backend\src\utils\analytics.ts`**
This utility file, containing functions for analytics and data export, was updated multiple times:
*   **12/15/2025, 12:10:06 PM:** This timestamp shows the initial structure with functions like `defaultDateRange`, `replaceValueInQuery`, `getUserObject`, `getFilterQueryByDisplayValue`, `getExcelSelectedColumns`, `isValidDate`, `dateFilterOnExport`, and `EXCEL_EXPORT_COLUMNS`. The `dateFilterOnExport` function included a list of `dateKeys` for date validation and formatting.
*   **12/15/2025, 12:12:54 PM:** The `dateKeys` array within `dateFilterOnExport` was expanded to include several new fields relevant to rail and vessel tracking: `"rail_ata"`, `"rail_etd"`, `"t49_raildeparted_date"`, `"vessel_actualarrived_date"`, `"vessel_actualdeparted_date"`, `"inland_rail_move"`, `"rail_destination"`, and `"rail_departed_pod"`, and `"booking_status"`. This indicates an effort to standardize date handling for more tracking-related fields.
*   **12/15/2025, 12:24:57 PM:** The `otherColumns` template literal within the `getExcelSelectedColumns` function was updated to include `m.rail_ata`, making this column available for selection in non-booking reports.
*   **12/15/2025, 1:57:33 PM:** A correction was made to the `dateKeys` array in `dateFilterOnExport`, removing `"rail_destination"` and `"booking_status"`. This suggests these fields were incorrectly identified as date fields in a previous update, and this change rectifies that error.

**File: `c:\Users\ridap\OneDrive\Documents\T360_Api\t360-backend\src\controllers\analytics\core.export.controller.ts`**
This controller handles export data requests and uses functions from the `query` and `utils` files:
*   **12/15/2025, 2:02:29 PM:** The controller's `getExportData` function was updated to log `columns` and `savingColumnsVal`. It also included `console.log` statements for `mainQuery::booking` and `filteredData` for debugging. A `replaceColumnHandler` function was introduced to standardize 'LONG BEACH' to 'LOS ANGELES' in `pod` and `place_of_delivery` fields.
*   **12/15/2025, 2:08:57 PM:** An additional `console.log("excelExportData",excelExportData)` was added to specifically log the raw data from the database query before filtering, likely for debugging purposes.
*   **12/15/2025, 2:09:40 PM:** The `console.log` for `excelExportData` was changed to `console.log("excelExportData",excelExportData.rows)`, focusing the debug output on the data rows specifically.

**Patterns and Recurring Elements:**
*   **Analytics and Reporting Focus:** All changes are centered around the analytics and reporting features of the application, particularly related to generating and exporting data based on various booking and tracking metrics.
*   **Dynamic SQL Query Building:** A recurring pattern is the dynamic construction of SQL queries based on user-provided parameters (e.g., `reportName`, `type`, `displayBy`, `fromDate`, `toDate`, `CompanyName`). This allows for flexible reporting.
*   **Date Handling Refinements:** There's a consistent effort to manage and standardize date fields. This is evident in the `dateFilterOnExport` function, which repeatedly saw its `dateKeys` array modified for accuracy and completeness, and the `defaultDateRange` function.
*   **Data Normalization/Transformation:** The introduction of `replaceColumnHandler` in `core.export.controller.ts` and the `replaceValueInQuery` utility function highlights a pattern of standardizing data values for consistency in reports (e.g., 'LONG BEACH' to 'LOS ANGELES').
*   **Debugging and Logging:** The frequent addition of `logger.info` and `console.log` statements suggests active development and debugging of the analytics and export functionalities.
*   **Evolution of Specific Report Logic:** The "Average Transit time By lane" report's query (`export.query.ts`) underwent significant iterative changes, indicating complex business logic requirements and continuous refinement of how transit time is calculated and filtered across different transportation legs.
*   **Identical Code Across Timestamps:** For `booking.query.ts`, multiple logs show identical content, implying that either no changes occurred in the visible parts of the file during those timestamps, or changes were made in non-logged sections.

## 2:28:25 PM
The file `c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\config\analytics.js` underwent two updates on December 15, 2025.

**First update (12/15/2025, 12:03:26 PM):**
This update established the initial configuration for analytics reports and data exports. It defines:
*   `DEFAULT_ANALYTICS_ENDPOINTS`: A list of report configurations for CBM (Cubic Meters) and TEU (Twenty-foot Equivalent Units) analytics, grouped by various logistical dimensions such as Ocean Freight Carrier (SCAC), Port of Loading (POL), Port of Discharge (POD), Supplier (Shipper), and Country of Origin.
*   `EXCEL_EXPORT_COLUMNS`: A comprehensive array specifying columns for Excel data exports. This includes detailed shipping and logistics information such as file numbers, account names, parties involved (shipper, consignee), MBL/BL numbers, container details, weight (KGS) and volume (CBM), commodity descriptions, PO numbers, reference numbers, port details, type of move, carrier (SCAC), vessel/voyage, and a multitude of dates (original and live/actual ETD, ETA, discharge, availability, delivery, return, completion dates).
*   `CargoReadyToETD10Days`: A smaller set of columns tailored for reports related to cargo readiness and estimated time of departure.
*   `ANALYTICS_REPORT_HEADER`: A large object mapping various analytics report names to their respective column headers. These reports cover CBM, TEU, KGS, and Transit Time, frequently categorized as "Container Wise" or "MBL Wise". Additionally, it includes headers for Chassis-related reports focusing on event timings like pickup, delivery, discharge, outgate, and gate-in, as well as container tracking by carrier and port.

**Second update (12/15/2025, 1:59:05 PM):**
This was a minor but significant refinement to the data export capabilities. A new column, `{ key: "rail_ata", name: "Rail ATA" }`, was added to the `EXCEL_EXPORT_COLUMNS` array, indicating an enhancement to track "Rail Actual Time of Arrival" in exported data.

**Patterns and Recurring Elements:**
*   **Core Metrics:** `CBM`, `TEU`, and `KGS` are consistently used as primary metrics across various analytics reports.
*   **Report Categorization:** Reports are frequently divided into "Container Wise" and "MBL Wise" (Master Bill of Lading Wise), suggesting two levels of detail or aggregation for tracking shipments.
*   **Grouping Dimensions:** Common grouping columns for analytics reports include `scac_code`, `pol`, `pod`, `shipper`, `country_of_origin`, `shipment_type`, `place_of_delivery`, and `trucker`.
*   **Live Tracking Data:** The presence of `t49_` prefixed keys (e.g., `t49_vessel_actualdeparted_date`, `t49_eta`) indicates an integration with a system providing real-time or updated live tracking information for logistics events.
*   **Comprehensive Data Export:** The extensive list of `EXCEL_EXPORT_COLUMNS` highlights a requirement for detailed and thorough data exports for various aspects of the shipping and logistics process.
*   **Operational Efficiency Focus:** The inclusion of Transit Time reports and various Chassis-related metrics (e.g., "Chassis Pick-Up Date vs Final Delivery", "Containers Outgated but Not Returned") suggests a strong emphasis on monitoring and optimizing operational efficiency and identifying potential delays.

## 3:27:23 PM
The file `c:\Users\ridap\OneDrive\Documents\T360_Api\t360-backend\src\controllers\analytics\query\booking.query.ts` shows consistent content across all timestamps from 12/15/2025, 10:20:53 AM to 12/15/2025, 3:20:24 PM. This file defines the `bookingQueryBuilder` function, which is responsible for constructing dynamic PostgreSQL queries for various booking-related analytics reports. The queries calculate day differences between booking dates and actual departure dates, often categorizing these differences into weekly ranges for stacked bar charts. The `customizer` object is used to configure report parameters such as date ranges, calculation types, and chart types.

In the file `c:\Users\ridap\OneDrive\Documents\T360_Api\t360-backend\src\controllers\analytics\query\export.query.ts`, notable changes occurred on 12/15/2025:
- **12/15/2025, 12:19:23 PM**: The SQL query snippet for "Average Transit time By lane" was significantly updated to include more robust conditional logic. It now checks for the existence of 'SEA', 'RAIL', and 'TRUCK' legs independently, making the query more flexible by not mandating all segments for data retrieval.
- **12/15/2025, 2:14:07 PM**: Further refinements were applied to the "Average Transit time By lane" query. The conditions for data existence in SEA, RAIL, and TRUCK legs were re-arranged using `OR` logic, allowing the report to run if at least one of these primary transit legs has valid data. `m.rail_ata IS NOT NULL` was specifically added to the RAIL leg condition.
- **12/15/2025, 3:16:55 PM**: The "Custom Booking" query was modified to ensure `m.mblno` is not empty or null. A new, seemingly redundant, query entry for "Booking Date to Actual Departure (MBL Wise)" was introduced.
- **12/15/2025, 3:17:37 PM**: The "Custom Booking" query was again adjusted. It now filters by `LOWER(account_name) = '${CompanyName}'` instead of `LOWER(a.customer)` and uses `a.created_at` as the date field for filtering instead of `a.bookingdate`.

For the utility file `c:\Users\ridap\OneDrive\Documents\T360_Api\t360-backend\src\utils\analytics.ts`:
- **12/15/2025, 12:12:54 PM**: The `dateKeys` array within the `dateFilterOnExport` function was expanded to include a wider range of date-related fields such as `rail_ata`, `rail_etd`, `t49_raildeparted_date`, `vessel_actualarrived_date`, `vessel_actualdeparted_date`, `inland_rail_move`, `rail_destination`, `rail_departed_pod`, and `booking_status`. This indicates an intent to apply consistent date filtering and formatting to more fields during data export.
- **12/15/2025, 2:24:57 PM**: The `getExcelSelectedColumns` function was updated to include `m.rail_ata` in the `otherColumns` string, making this specific column available for export in various reports.
- **12/15/2025, 2:32:58 PM**: The `booking_status` key was removed from the `dateKeys` array in `dateFilterOnExport`, slightly reverting a previous change.

The file `c:\Users\ridap\OneDrive\Documents\T360_Api\t360-backend\src\controllers\analytics\core.export.controller.ts` also saw activity on 12/15/2025:
- **12/15/2025, 2:02:29 PM**: The `getExportData` function, handling analytics data export, was present. It uses `columnsQuery` (instead of the commented-out `getExcelSelectedColumns`) for dynamic column selection and integrates `bookingQuery` or `nonBookingQuery` based on report type. It includes specific post-processing logic for "TEU MBLwise" reports to manage container duplicates and a `replaceColumnHandler` to standardize port names by converting 'LONG BEACH' to 'LOS ANGELES' in `pod` and `place_of_delivery` fields.
- **12/15/2025, 2:08:57 PM** and **12/15/2025, 2:09:40 PM**: Minor debugging `console.log` statements were added and then refined to display the `excelExportData` and `excelExportData.rows` respectively, to aid in monitoring query results.

**Patterns and Recurring Elements:**
All changes observed occurred on 12/15/2025, indicating a concentrated development effort on analytics and reporting features. A consistent pattern involves the dynamic generation and refinement of PostgreSQL queries, often utilizing conditional logic and date-based calculations (e.g., `EXTRACT(DAY FROM...)`, `DATE_TRUNC`) to support various report types and groupings (month, week, quarter). The code frequently uses a `customizer` object to pass report-specific configurations. Efforts toward data standardization are evident through functions like `replaceColumnHandler` which normalizes port names and `dateFilterOnExport` which handles date formatting across numerous fields for improved data quality in reports.

## 3:28:19 PM
The file `c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\config\analytics.js` was updated twice on December 15, 2025.

The first update occurred at 12:03:26 PM, defining several analytics-related configurations:
*   `DEFAULT_ANALYTICS_ENDPOINTS`: A list of predefined analytics report URLs, primarily for CBM and TEU metrics grouped by various shipping attributes like carrier, port, country, and supplier.
*   `EXCEL_EXPORT_COLUMNS`: A comprehensive list of column definitions for Excel exports, including shipment details, container information, weights, dimensions, and various date/tracking milestones (e.g., departure, arrival, discharge, delivery dates).
*   `CargoReadyToETD10Days`: A smaller set of columns, likely for a specific report focusing on cargo readiness and departure.
*   `ANALYTICS_REPORT_HEADER`: A large object mapping report names to their corresponding column headers. This includes detailed breakdowns for CBM, TEU, KGS, and Transit Time reports, with both container-wise and MBL-wise variations. It also includes reports related to chassis usage and container movement timelines.

A subsequent update to the same file was recorded at 1:59:05 PM on the same day. The primary change introduced in this update was the addition of a new column `{ key: "rail_ata", name: "Rail ATA" }` to the `EXCEL_EXPORT_COLUMNS` array. Other sections like `DEFAULT_ANALYTICS_ENDPOINTS`, `CargoReadyToETD10Days`, and `ANALYTICS_REPORT_HEADER` remained consistent in the provided log snippets.

The recurring patterns in the content indicate a robust analytics and reporting system focused on freight logistics. Data is consistently categorized by CBM, TEU, and KGS, and can be analyzed based on various criteria such as SCAC code, port (POL/POD), supplier, country of origin/discharge, and shipment type. There's a strong emphasis on tracking different stages of a shipment, from departure to delivery and container return, with many columns dedicated to various date stamps and live tracking information (e.g., `t49_` prefixes). The reports often distinguish between "Container Wise" and "MBL Wise" (Master Bill of Lading Wise) data aggregation.