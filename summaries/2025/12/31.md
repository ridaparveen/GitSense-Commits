# Activity Summary for 12/31/2025

## 9:40:28 AM
`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-backend\src\controllers\analytics\transit.controller.ts` (Timestamp: 12/30/2025, 9:54:51 AM)
This file defines the `getTransitReports` function, responsible for generating transit-related analytics reports. It extracts various parameters from the request query, such as grouping columns, date ranges, mbl-wise filtering, view options, and report names. If date ranges are not provided, it defaults to a predefined range. The controller dynamically builds a SQL query using `transitQueryBuilder` based on user-specific details (company name, user ID) and the `mblwiseCondition`, which adjusts the `SELECT`, `CONDITION`, and `GROUP BY` clauses for either `mblno` or `voyage`. The generated query is then executed against the database, and the results are returned with an HTTP 200 status. Error handling is implemented to catch and log issues, responding with a 500 status in case of server errors.

`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-backend\src\controllers\code.controller.ts` (Timestamp: 12/30/2025, 10:23:43 AM)
This file handles customer-related operations, including retrieving and creating customer records.
The `getAllCustomer` function fetches customer details with pagination and dynamic search/sorting capabilities. It queries `PO_AccountMaster_Customer_Master`, dynamically identifies table columns for search, and then constructs SQL queries to retrieve customer data and count total records. For each customer, it also fetches related shipper mapping (`account_master_shipper_MAP`), document upload details (`document_upload_details`), and customer mapping (`Account_Master_Customer_MAP`), combining them into a comprehensive JSON response.
The `createCustomer` function manages the creation or modification of customer records. It supports file uploads and extracts numerous customer details from the request body. It begins a database transaction and first checks if a customer with the given `acode` already exists. If so, it updates the record by deleting and re-inserting into `PO_AccountMaster_Customer_Master` and associated tables (`agent_po_account_master_type`, `Account_Master_Shipper_MAP`, `account_master_pic`). Otherwise, it generates a new account code using `getAccountCode` and inserts a new record. It also handles specific customer types and processes a `mapping` array to insert data into `Account_Master_Shipper_MAP`, resolving `polcode`, `shippercode`, and `agentcode` from other master tables. The provided snippet ends during the processing of shipper mapping.

`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-backend\src\controllers\booking.controller.ts` (Timestamps: 12/30/2025, 6:06:10 PM; 12/30/2025, 6:08:27 PM; 12/30/2025, 6:10:47 PM)
All three timestamps for this file contain identical code snippets, indicating no functional changes were introduced between these saves. The file focuses on auditing booking-related data changes.
It defines `auditDoUpdates`, a helper function designed to track specific updates to Delivery Order (DO) numbers, DO dates, booking dates, and booking numbers within `agent_booking_entry`. This function compares old and new values and only logs changes using `insertAudit` if actual differences are detected. Upon detecting changes, it sets the `booking_status` to `CONFIRMED`.
The `auditBookingChanges` function provides a more comprehensive auditing mechanism for an entire booking ID across several related tables. It logs changes for:
*   `agent_booking_entry` (main booking details).
*   `agent_booking_linked_po` (linked purchase orders), distinguishing between added, removed, and modified POs, and logging summary details for additions/removals using `simpleAudit` and field-level changes for modifications using `insertAudit`.
*   `agent_booking_vessel` (vessel details), similarly tracking additions and removals with summary details for vessel, voyage, line, and dates.
The provided snippet for `auditBookingChanges` ends during the auditing of `agent_booking_vessel`, implying further logic to handle modifications or other booking-related lists. Both auditing functions extensively use `logger.info` to record audit activities.

**Patterns and Recurring Elements:**
*   **Future Timestamps:** All timestamps are dated 12/30/2025, suggesting a future development timeline or placeholder dates.
*   **Database Interaction:** A consistent pattern of direct database interaction is observed, with frequent imports and usage of `query`, `insertQuery`, and `updateQuery` functions. Raw SQL queries are embedded within the controller logic.
*   **Audit Logging:** There's a strong emphasis on detailed audit logging across the booking controller, employing `simpleAudit` for summary changes (additions/removals) and `insertAudit` for granular, field-level tracking of modifications. `logger.info` is widely used to trace audit progress.
*   **Utility Functions:** Several common utility functions (e.g., `AppDateFormate`, `getAccountCode`, `getAccountSubCode`, `chkStr`, `sanitizeString`) are imported and utilized across different controllers for tasks like date formatting, ID generation, and data sanitization.
*   **Error Handling:** All controllers demonstrate robust error handling using `try...catch` blocks, logging errors with `logger.error`, and returning a 500 status with an error message in case of exceptions.
*   **Request/Response Handling:** The use of `AuthenticatedRequest` and `Response` from `express` is standard across all controllers for handling web requests.
*   **Modular Structure:** The codebase appears well-structured, separating concerns into controllers, requests, configuration, and utility modules.

## 3:16:34 PM
The development log details changes across several frontend files, primarily focusing on booking confirmation, file upload functionality, and menu configuration.

**File-Specific Summaries:**

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\pages\booking\AgentBookingConfirmation.jsx`**
    *   **Timestamps:** This file saw continuous updates on 12/30/2025 from 12:44:39 PM to 7:00:45 PM, and minor re-saves on 12/31/2025 morning.
    *   **Key Changes:**
        *   The `UploadFile` component was imported.
        *   Several Material-UI icon imports were either added (`FileDownload`) or removed (e.g., `Divider`, `IconButton`, `CloudDownload`, `Download`, `Folder`, `HourglassBottom`, `HourglassBottomTwoTone`).
        *   New icon imports `FiDownload` (from `react-icons/fi`) and `FaHourglass` (from `react-icons/fa`) were added.
        *   A `CardField` component import was removed.
        *   Multiple `console.log` statements (e.g., `console.log("kkkkggggg", confirmData);`, `console.log("pldata====",plData);`) were added or adjusted, suggesting active debugging and data inspection during development.
        *   No significant functional logic changes were introduced within the core `AgentBookingConfirmation` component itself, but its imports were modified to reflect changes in other components.

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\components\common\UploadFile.jsx`**
    *   **Timestamps:** Significant changes occurred on 12/30/2025 from 12:50:28 PM to 6:44:51 PM.
    *   **Key Changes:**
        *   Underwent a major refactor from a basic drag-and-drop zone using `Paper` and `CloudUploadIcon` to a more structured UI.
        *   The new UI incorporates `Grid`, `Stack`, `IconButton`, and `ThemeButton` for a dedicated drag-and-drop area and a separate button to "Choose File".
        *   The `useDropzone` hook was configured with `noClick: true`, redirecting file selection to a button click.
        *   The display of the selected file was enhanced to include an `InsertDriveFile` icon and a `CustomDeleteIcon` for removal.
        *   Styling (`borderColor`, `backgroundColor`, font colors) for the drag-and-drop area and file display elements was frequently adjusted and refined.
        *   Temporary TypeScript type annotations (`interface UploadFileProps`, `React.FC<UploadFileProps>`) were briefly added and then reverted, indicating an experimental phase.

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\components\common\Cards\CardField.jsx`**
    *   **Timestamps:** Minor changes on 12/30/2025 from 6:04:29 PM to 6:04:49 PM.
    *   **Key Changes:** Insignificant formatting changes within the `titleStyle` object, no functional impact.

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\components\screen\booking\form\BookingFormExtend.jsx`**
    *   **Timestamps:** This file was saved multiple times on 12/30/2025 at 7:02:17 PM and on 12/31/2025 between 9:46:51 AM and 9:49:49 AM.
    *   **Key Changes:** No substantial functional or structural changes were introduced, primarily re-saves.

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\components\core\admin-drawer-elements.jsx`**
    *   **Timestamps:** Minor changes on 12/31/2025 from 10:18:20 AM to 10:18:37 AM.
    *   **Key Changes:** A temporary debug string `kkk` was removed from the `ExpandableListItems` component.

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\config\menu.js`**
    *   **Timestamps:** Changes on 12/31/2025 from 10:19:11 AM to 11:32:04 AM.
    *   **Key Changes:**
        *   The `AnalyticsOutlined` icon import and its corresponding `analyticsIcon` mapping were temporarily commented out and then restored.
        *   The label for the "Analytics" menu item was briefly changed to "Analytics123" and then reverted, suggesting minor iterations or tests on the navigation structure.

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\components\screen\code\customer\CustomerMapping.jsx`**
    *   **Timestamps:** Frequent updates on 12/31/2025 from 1:03:59 PM to 1:14:18 PM.
    *   **Key Changes:**
        *   Introduced `loading` state to manage the loading indicator for the `AppAutocomplete` component.
        *   Refactored the customer data fetching logic, moving it into a `useCallback` hook and utilizing a `search` state triggered by a `useEffect` for debounced API calls.
        *   Corrected the mapping of API response data to `label` and `value` for the `AppAutocomplete` component.
        *   The `updateRow` function was revised to correctly modify specific entries in the `customer_mapping` array.
        *   An explicit `onInputChange` prop was added to `AppAutocomplete` to handle search input.
        *   A `console.log` was added for debugging the API response.
        *   The `role: "CUSTOMER"` parameter was removed from the `getCustomerOptions` API call.

**Patterns and Recurring Elements:**

*   **Iterative UI Refinement:** The `UploadFile.jsx` component shows a clear pattern of iterative development, with continuous updates to its structure, styling, and integration of new icons. This indicates a focus on improving the user experience and visual design of file uploads.
*   **API Integration and State Management:** The changes in `CustomerMapping.jsx` demonstrate a pattern of refining data fetching, state management (`loading`, `search`), and how API responses are processed and integrated into form components. The use of `useCallback` and `useEffect` suggests adherence to React best practices for performance and data consistency.
*   **Debugging and Code Cleanup:** The presence and subsequent removal or adjustment of `console.log` statements and temporary strings (like `kkk`) across multiple files highlight an active debugging process and a commitment to keeping the codebase clean.
*   **Modular Component Design:** The frequent changes to common components like `UploadFile` and `CardField`, and their subsequent import/removal in pages like `AgentBookingConfirmation.jsx`, indicate a modular component-based architecture.
*   **Timestamp Clustering:** Changes often occur in quick succession within a short timeframe for a single file (e.g., `UploadFile.jsx`, `CustomerMapping.jsx`), suggesting focused development sessions on specific features or components.

## 3:16:39 PM
The provided log details changes across three controller files: `transit.controller.ts`, `code.controller.ts`, and `booking.controller.ts`, all occurring in late December 2025.

**File-Specific Updates:**

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-backend\src\controllers\analytics\transit.controller.ts`**
    *   **Timestamp: 12/30/2025, 9:54:51 AM**
    *   This file introduces the `getTransitReports` asynchronous function. It's designed to fetch analytics data based on various query parameters such as `group_by_column`, `fromDate`, `toDate`, `mblwise`, `viewBy`, `type`, and `reportName`.
    *   It dynamically determines date ranges if not provided and retrieves user-specific details (`companyname`, `user_id`) using `getUserObject`.
    *   A significant part of its logic is the `mblwiseCondition` which modifies the SQL `SELECT` and `GROUP BY` clauses based on whether `mblwise` is true, affecting how transit reports are aggregated (by MBL number or voyage).
    *   The core query is constructed using `transitQueryBuilder` and executed against the database, with results sent back as a 200 OK response. Error handling is included.

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-backend\src\controllers\code.controller.ts`**
    *   **Timestamp: 12/30/2025, 10:23:43 AM**
    *   This initial version defines two main functions:
        *   `getAllCustomer`: Retrieves paginated and sortable customer data from `PO_AccountMaster_Customer_Master`. It dynamically builds search conditions, fetches associated shipper mappings (`account_master_shipper_MAP`), document upload details (`document_upload_details`), and customer mappings (`Account_Master_Customer_MAP`), then aggregates this information.
        *   `createCustomer`: Handles the creation or modification of customer records. It supports file uploads, sanitizes input (`cname`), manages database transactions, and either generates a new account code (`uacode`) or uses an existing one for updates. It includes logic to delete old related records upon modification and handles insertion into `PO_AccountMaster_Customer_Master`, `agent_po_account_master_type` (for customer types), and `Account_Master_Shipper_MAP` (after looking up related codes).
    *   **Timestamp: 12/31/2025, 12:42:28 PM**
    *   A change was introduced in the `getAllCustomer` function. The query `SELECT customer_map FROM Account_Master_Customer_MAP` was modified to `SELECT DISTINICT customer_map FROM Account_Master_Customer_MAP`, attempting to fetch distinct customer mappings, but it introduced a typographical error (`DISTINICT` instead of `DISTINCT`).
    *   **Timestamp: 12/31/2025, 12:42:44 PM**
    *   This timestamp reflects a quick fix to the previous change. The typo `DISTINICT` in the `customerQuery` within `getAllCustomer` was corrected to `DISTINCT`, ensuring proper fetching of unique customer mappings.
    *   **Timestamps: 12/31/2025, 12:55:12 PM & 12/31/2025, 12:55:45 PM**
    *   No functional changes were observed in the provided code snippets for these timestamps, suggesting minor non-substantive saves or unrelated edits beyond the scope of the log.

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-backend\src\controllers\booking.controller.ts`**
    *   **Timestamps: 12/30/2025, 6:06:10 PM; 12/30/2025, 6:08:27 PM; 12/30/2025, 6:10:47 PM**
    *   This file introduces comprehensive auditing functionalities for booking operations. Two key functions are defined:
        *   `auditDoUpdates`: A helper function that tracks changes in Delivery Order (DO) related fields (`do_number`, `do_date`, `bookingdate`, `bookingno`) within the `agent_booking_entry` table. It performs field-level comparison and logs only actual changes, setting the `booking_status` to `CONFIRMED` if any updates occur.
        *   `auditBookingChanges`: This function orchestrates the auditing process across multiple booking-related tables based on a `payload`. It audits the main `agent_booking_entry` and then proceeds to track additions, removals, and modifications in `agent_booking_linked_po` and `agent_booking_vessel` lists. It utilizes `simpleAudit` for summary logging of row-level changes (added/removed) and `insertAudit` for detailed field-level change tracking.
    *   The content remains identical across all three timestamps for this file, indicating that these were either re-saves without functional changes or the changes were in parts of the file not included in the log snippet.

**Patterns and Recurring Elements:**

*   **Database Interaction**: All controllers heavily interact with a PostgreSQL database, using a custom `query` utility for executing SQL statements (SELECT, INSERT, DELETE) and `insertQuery`/`updateQuery` (though not explicitly shown in action for all files). Transaction management (`BEGIN`) is observed in `createCustomer`.
*   **Utility Functions**: There's a strong reliance on a set of common utility functions for various tasks:
    *   Data formatting and sanitation (`chkStr`, `AppDateFormate`, `cname.replace`).
    *   Account code generation (`getAccountCode`, `getAccountSubCode`).
    *   Analytics-specific logic (`defaultDateRange`, `getUserObject`, `transitQueryBuilder`).
*   **Logging**: `logger.info` and `logger.error` are used extensively throughout the code for debugging, tracing execution flow, and error reporting. `console.log` is also present for immediate feedback during development.
*   **Request/Response Handling**: All controller functions follow a consistent pattern of accepting `AuthenticatedRequest` and `Response` objects from `express`, processing request parameters (`req.query`, `req.body`), interacting with the database, and sending JSON responses with appropriate HTTP status codes (200 for success, 500 for server errors, 400 for bad requests related to file uploads).
*   **Auditing Module**: The `booking.controller.ts` demonstrates a robust, table-driven auditing mechanism using `AuditModule` with `simpleAudit` and `insertAudit` functions to capture changes with granular detail.
*   **Future-Dated Timestamps**: All provided timestamps are in late December 2025.

## 4:16:31 PM
The provided logs show a series of modifications across three frontend JavaScript files: `AgentBookingConfirmation.jsx`, `UploadFile.jsx`, `CardField.jsx`, `BookingFormExtend.jsx`, `admin-drawer-elements.jsx`, and `menu.js`.

### File-Specific Updates:

1.  **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\pages\booking\AgentBookingConfirmation.jsx`**
    *   **Timestamps:** Multiple changes occurred on 12/30/2025 between 12:44:39 PM and 6:57:15 PM.
    *   **Summary of Changes:**
        *   **Initial state (12:44:39 PM - 12:46:30 PM):** The file remained largely consistent, indicating a stable implementation of the `AgentBookingConfirmation` component. This component is responsible for handling booking confirmations, including file uploads (DO document), managing selected/deselected packing lists (`selectedPl`, `deselectedPl`), pagination and sorting of PL data, and generating/uploading XML to OTM. It uses Formik for form management and Yup for validation (`bookingConfirmationValidation`). Redux Toolkit Query (`useGetBookingConfirmQuery`, `useFetchBookingPlListQuery`, `useUpdateDoMutation`, `useCreateBookingXmlMutation`, `useUploadBookingXmlMutation`) is heavily used for data fetching and mutations. Responsive design is supported via `useMediaQuery`. Toast notifications (`react-hot-toast`) and custom alert modals (`PopupAlert`, `WarningToast`) are implemented for user feedback.
        *   **Integration of `UploadFile` (12:50:52 PM - 1:05:44 PM):** The `UploadFile` component was imported and likely integrated into the UI to handle file selection.
        *   **Minor console log additions (6:01:08 PM, 6:17:41 PM, etc.):** Throughout the later timestamps, additional `console.log` statements (e.g., `console.log("kkkkggggg",confirmData);`) were added, possibly for debugging purposes.
        *   **Icon Imports (6:31:28 PM - 6:51:16 PM):** New icons such as `HourglassBottomTwoTone` were imported. React-icons (`FiDownload`, `FaHourglass`) were also added, replacing or augmenting MUI icons for some functionalities.
        *   **Removal of `CardField` import (7:00:20 PM):** The import for `CardField` was removed from this file.

2.  **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\components\common\UploadFile.jsx`**
    *   **Timestamps:** Significant activity on 12/30/2025 between 12:50:28 PM and 6:44:51 PM.
    *   **Summary of Changes:**
        *   **Initial implementation (12:50:28 PM):** Started as a simple dropzone component using `react-dropzone` and MUI `Paper`, `Typography`, `CloudUploadIcon`. It managed a single `file` state and called `onFileSelected` callback.
        *   **UI/Layout Refactor (12:52:45 PM - 1:03:35 PM):** The component underwent a major UI overhaul.
            *   Replaced `Paper` with `Box` and `Grid` for a more structured layout.
            *   Introduced "Upload Shipping Order" title.
            *   Changed the drag-and-drop area to a `Box` with dashed borders, including "Drag & Drop File(s) to Upload" text and a "Choose File" button.
            *   Added a section to display the selected file with a `FolderCopy` icon (later `InsertDriveFile`) and a `Delete` icon. This section was initially commented out for mapping (`{files.map((file) => (`)).
            *   Changed the `Button` to `ThemeButton`.
            *   Adjusted styling (`backgroundColor`, `padding`, `margin-top` for the file list).
        *   **TypeScript Integration (6:36:03 PM):** Added TypeScript interfaces (`UploadFileProps`) and type annotations (`React.FC<UploadFileProps>`, `File | null`, `File[]`).
        *   **Dropzone Configuration Update (6:36:03 PM):** Added `noClick: true` to `useDropzone` options, indicating that file selection will be triggered explicitly by the "Choose File" button and not by clicking the drag-and-drop area directly.
        *   **Refinement of File Display and Removal (6:36:03 PM - 6:44:51 PM):**
            *   The file display section was uncommented and actively shows the `file.name` if a file is selected.
            *   A `handleRemove` function was introduced to clear the selected file.
            *   Styling for the `Delete` icon (`padding`, `color`) and `Typography` color for messages was adjusted multiple times.
            *   The `FolderCopy` icon was replaced with `InsertDriveFile`.
            *   A `CustomDeleteIcon` (imported from `../../assets/svg`) was introduced and used for the delete button, suggesting a custom SVG icon implementation.

3.  **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\components\common\Cards\CardField.jsx`**
    *   **Timestamps:** Minor changes on 12/30/2025 at 6:04:29 PM and 6:04:49 PM.
    *   **Summary of Changes:** The updates involve stylistic adjustments to the `Typography` component within the `CardField`. Specifically, the spread order of `sx` props was changed: `sx={{...styles.text,...styles.titleStyle,...titleStyle,}}` became `sx={{...styles.text,...styles.titleStyle,...titleStyle}}`, removing a trailing comma. The functional logic of the component remains the same.

4.  **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\components\screen\booking\form\BookingFormExtend.jsx`**
    *   **Timestamps:** Minor changes on 12/30/2025 at 7:02:17 PM and 12/31/2025 between 9:46:51 AM and 9:49:49 AM.
    *   **Summary of Changes:**
        *   **Redundant import removal (7:02:17 PM):** The `Divider` and `CardField` imports were removed, indicating they are no longer used directly in this component.
        *   **Console Log Cleanup (12/31/2025, several timestamps):** Repeated `console.log` statements, particularly for `confirmData` and `pldata`, were removed from the top level of the component's render, suggesting a cleanup of debugging output.

5.  **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\components\core\admin-drawer-elements.jsx`**
    *   **Timestamps:** Two consecutive changes on 12/31/2025 at 10:18:20 AM and 10:18:37 AM.
    *   **Summary of Changes:** A typo was corrected in the `ExpandableListItems` component within the `AdminMenuContent`, changing `key={item.label}kkk` to `key={item.label}`.

6.  **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\config\menu.js`**
    *   **Timestamps:** Multiple changes on 12/31/2025 between 10:19:11 AM and 11:32:04 AM.
    *   **Summary of Changes:**
        *   **Icon import and mapping (10:19:11 AM):** The `AnalyticsOutlined` icon was imported and mapped under `iconsMap`.
        *   **Analytics menu item removal (10:19:11 AM - 10:19:29 AM):** The "Analytics" menu item was commented out from the `staticMenuItems` configuration, then uncommented and re-added (12/31/2025, 10:20:25 AM).
        *   **Label change (11:31:19 AM - 11:31:58 AM):** The label for the "Analytics" menu item was temporarily changed to "Analytics123" and then reverted back to "Analytics".

7.  **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\components\screen\code\customer\CustomerMapping.jsx`**
    *   **Timestamps:** Multiple changes on 12/31/2025 between 1:03:59 PM and 1:13:56 PM.
    *   **Summary of Changes:**
        *   **Initial implementation (1:03:59 PM):** The component was designed to manage a list of customer mappings, allowing users to add or delete rows, and select a customer using an `AppAutocomplete`. It included commented-out code for fetching customer options.
        *   **Loading state and `fetchCustomers` refinement (1:04:38 PM - 1:07:02 PM):**
            *   A `loading` state was introduced.
            *   The `handleOptionChange` callback was replaced with a `fetchCustomers` function using `ApiManager.getCustomerOptions`, with `setLoading` states.
            *   `ITEMS_PER_PAGE` constant was introduced.
            *   The mapping of `customer_name` and `customer_map` to `label` and `value` for `AppAutocomplete` options was clarified.
            *   The `AppAutocomplete`'s `onInputChange` prop was added to update the `search` state, triggering the `useEffect` for fetching.
        *   **Correction to `AppAutocomplete` onChange (1:09:40 PM - 1:10:53 PM):** The `handleOptionChange` prop for `AppAutocomplete` was explicitly set, and the `onChange` handler for `updateRow` was corrected to correctly modify the `customer` field in the formik values.
        *   **Minor logging and attribute correction (1:12:47 PM - 1:13:56 PM):** A temporary typo (`item.`) was corrected to `item.label` in the `formatted` options, and a `console.log` was added to inspect `res?.data`. The `role: "CUSTOMER"` filter in `getCustomerOptions` was temporarily commented out, then restored.

### Patterns and Recurring Elements:

*   **React Frontend Development:** All changes are within a React frontend application, utilizing Material-UI (MUI) components for UI, Formik for form management, and Redux for state management.
*   **Component-Based Architecture:** The logs show changes to distinct components (`AgentBookingConfirmation`, `UploadFile`, `CardField`, `BookingFormExtend`, `CustomerMapping`, `admin-drawer-elements`) and configuration files (`menu.js`).
*   **Form Management:** Formik is consistently used for handling form state, initial values, validation schemas, and submission logic across `AgentBookingConfirmation` and `BookingFormExtend`.
*   **API Interaction:** RTK Query (`useMutation`, `useQuery`) from Redux Toolkit and a custom `ApiManager` are extensively used for asynchronous data operations (fetching booking details, packing lists, creating/uploading XML, saving bookings, fetching customer options).
*   **User Feedback:** `react-hot-toast` is heavily used for success, loading, and error notifications. Custom `PopupAlert` and `WarningToast` components provide additional alert mechanisms, particularly for handling validation or API-generated warnings.
*   **Responsive Design:** `useMediaQuery` from MUI is employed in `AgentBookingConfirmation` to adapt page size based on screen dimensions, indicating a focus on responsive UI.
*   **Debugging via `console.log`:** Numerous `console.log` statements are present across files, often added and sometimes removed, suggesting active debugging during development.
*   **Incremental Development:** The timestamps show a continuous iterative process with small, focused changes, often involving UI refinements, debugging, and minor functional adjustments.
*   **Menu/Navigation Configuration:** The `menu.js` file demonstrates a structured approach to defining application navigation and associating menu items with Material-UI icons. The `admin-drawer-elements.jsx` consumes this configuration to render the navigation.
*   **Code Quality & Best Practices:** The introduction of TypeScript interfaces and the `React.memo` HOC (in `UploadFile` and `CustomerMapping`) suggests an effort to improve code maintainability and performance. Explicit `noClick: true` in `useDropzone` indicates careful handling of user interaction.

## 4:16:33 PM
The provided code change log details development in an API backend, primarily focusing on analytics, customer master data management, and booking auditing. The changes are distributed across three controller files, all timestamped in late December 2025.

**File-Specific Updates:**

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-backend\src\controllers\analytics\transit.controller.ts` (Latest Timestamp: 12/30/2025, 9:54:51 AM)**
    This file contains the `getTransitReports` function, responsible for generating transit analytics. It dynamically constructs SQL queries based on various request parameters such as `group_by_column`, `fromDate`, `toDate`, `mblwise`, `viewBy`, `type`, and `reportName`. It includes logic to handle default date ranges and customizes queries for either `mblno` or `voyage` grouping. The function retrieves user and company information to build context-specific queries and returns the analytical data.

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-backend\src\controllers\code.controller.ts` (Latest Timestamp: 12/31/2025, 12:55:45 PM)**
    This controller manages customer master data.
    *   The `getAllCustomer` function retrieves a paginated list of customers, supporting dynamic sorting and search based on query parameters. For each customer, it also fetches associated shipper mappings, document upload details, and customer mappings. A minor change was introduced around `12/31/2025, 12:42:44 PM` to add `DISTINCT` to the `customer_map` query, ensuring unique customer mappings are returned.
    *   The `createCustomer` function handles the creation or modification of customer records. It supports file uploads, sanitizes customer names, and manages database transactions. It checks for existing customers; if found, it deletes old related records before re-inserting, effectively acting as an update. New customers are assigned an `acode` using a utility function. It also processes customer types (`ctypelist`) and complex mapping data (`mapping`), retrieving associated codes (e.g., `polcode`, `shippercode`, `agentcode`) from other master tables before inserting them into `Account_Master_Shipper_MAP`.

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-backend\src\controllers\booking.controller.ts` (Latest Timestamp: 12/30/2025, 6:10:47 PM)**
    This file is dedicated to auditing booking-related changes.
    *   The `auditDoUpdates` helper function tracks specific changes to Delivery Order (DO) fields such as `do_number`, `do_date`, `bookingdate`, and `bookingno`. It compares old and new values and logs only the fields that have actually changed to the `agent_booking_entry` table, setting `booking_status` to `CONFIRMED` if any updates occur.
    *   The `auditBookingChanges` function provides a comprehensive auditing mechanism across multiple booking-related tables, including `agent_booking_entry`, `agent_booking_linked_po`, and `agent_booking_vessel`. It logs additions and removals of linked POs and vessels with summary details, and also tracks field-level modifications within existing entries using both `simpleAudit` (for row changes) and `insertAudit` (for detailed field changes). The content across the three logged timestamps for this file is identical, suggesting no functional changes were committed between these specific snapshots.

**Patterns and Recurring Elements:**

*   **Robust Auditing:** A significant pattern is the implementation of detailed auditing, particularly in the `booking.controller.ts`, which tracks field-level changes and logs additions/removals with summaries across several related tables.
*   **Database Centric Operations:** All controllers heavily rely on direct database interactions, using `query`, `insertQuery`, and `updateQuery` functions for fetching and manipulating data. SQL queries are often constructed dynamically.
*   **Utility Functions:** There's a consistent use of helper functions for common tasks like date formatting (`AppDateFormate`), string sanitization (`chkStr`), and generating unique identifiers (`getAccountCode`, `getAccountSubCode`).
*   **Error Handling and Logging:** All functions include `try...catch` blocks for error management, logging errors using `logger.error` and sending `500 Internal Server Error` responses. `logger.info` is frequently used for operational insights and debugging.
*   **Express.js Integration:** The controllers are built using Express.js, handling `AuthenticatedRequest` and `Response` objects, indicating an authenticated API endpoint architecture.
*   **Future Timestamps:** All changes are timestamped in December 2025, which might indicate a planned development schedule or a forward-looking versioning system.

## 5:16:30 PM
This log summarizes recent code changes across several files, primarily focusing on frontend components and API integrations. The timestamp for all changes is between December 30th and December 31st, 2025.

**File-Specific Updates:**

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\pages\booking\AgentBookingConfirmation.jsx` (23 changes, 12/30/2025 12:51:39 PM - 12/31/2025 9:49:15 AM):**
    *   Initial changes involve minor code reorganization and adding imports for `AddVesselForm` and `ScacCodeForm`.
    *   Extensive logging (`console.log`) statements were added throughout the component, particularly for `confirmData` and `plData`, and within form submission logic to track user actions, selected/deselected Packing Lists (PLs), file selection, and payload preparation.
    *   Updates to icon imports: `HourglassBottomTwoTone` was added, `FileDownload` was added, and later `FiDownload` and `FaHourglass` were imported from `react-icons/fi` and `react-icons/fa` respectively, replacing some MUI icons.
    *   A `CardField` component was imported and then removed from the component's imports in later changes.
    *   Minor adjustments to comments, whitespace, and console logs (`console.log("kkkkggggg", confirmData);`).
    *   A `WarningToast` component is used within the `onSubmit` logic to display warnings during booking saving, throwing a custom error if warnings exist to trigger an `alertConfig` popup.
    *   The `formik` `onSubmit` logic also includes conditions to check for missing `agent_booking_id` and vessel list requirements, triggering `toast.error` or `setAlertConfig` for user feedback.
    *   Console logs were used to debug error handling, checking `err.status`, `err.data`, and `err.message`.

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\components\common\UploadFile.jsx` (22 changes, 12/30/2025 12:52:45 PM - 12/31/2025 7:02:52 PM):**
    *   This component underwent significant refactoring and styling adjustments for its drag-and-drop file upload functionality.
    *   Early changes include replacing MUI `Button` with `ThemeButton`, and `FolderIcon` with `FolderCopy` and then `InsertDriveFile`.
    *   Styling adjustments were made to the drag-and-drop area, including `backgroundColor` changes from `#fafafa` to `#FFFFFF` and responsive `margin-top` values (`mt={10}`, `mt={5}`).
    *   The file input was initially hidden and triggered by a label, then updated to use `useDropzone`'s `open` function with `noClick: true` for the `ThemeButton`.
    *   The display of the selected file was refined, moving from a generic placeholder (`{file.name}` commented out) to dynamically displaying `file.name`.
    *   The delete icon for the uploaded file changed from MUI `Delete` to `CustomDeleteIcon` imported from `../../assets/svg`, and its styling was updated (`color="error"`).
    *   Type annotations (`interface UploadFileProps`, `React.FC<UploadFileProps>`, `File | null`) were temporarily added, then removed, suggesting a brief exploration of TypeScript or an accidental inclusion.
    *   The drag-and-drop area's `borderColor` and `backgroundColor` now dynamically change based on `isDragActive`.
    *   Text within the drag-and-drop area was updated to be more descriptive, changing from "Drag & Drop File(s) to Upload" to dynamically show "Drop file here" when active.
    *   The `justifyContent` for the "Choose File" button was explicitly set to `center`.

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\components\common\Cards\CardField.jsx` (2 changes, 12/30/2025 6:04:29 PM - 12/30/2025 6:04:49 PM):**
    *   Minor adjustment in typography styles application for the `title`. The spread operator for `titleStyle` was moved inside the `sx` prop object.

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\components\screen\booking\form\BookingFormExtend.jsx` (4 changes, 12/30/2025 7:02:17 PM - 12/31/2025 9:49:49 AM):**
    *   Minor, mostly cosmetic changes. A commented out line `// nav("/app/booking");` was observed, and a console log for `resp.warnings` was added, then removed in subsequent updates, indicating debugging. The core logic for saving booking data, handling warnings, and navigation remains consistent.

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\components\core\admin-drawer-elements.jsx` (2 changes, 12/31/2025 10:18:20 AM - 12/31/2025 10:18:37 AM):**
    *   A debugging console log `console.log("Admin Item:", item.label, "Sub-items:", item.items);` was added inside the `AdminMenuContent` component.
    *   A debugging `kkk` was added to an `ExpandableListItems` component, then removed.

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\config\menu.js` (4 changes, 12/31/2025 10:19:11 AM - 12/31/2025 11:32:04 AM):**
    *   An `AnalyticsOutlined` icon was uncommented and added back to `iconsMap` and `staticMenuItems` under the "Other" section. It was initially commented out, then partially uncommented in one log entry (still commented in `iconsMap`), and finally fully restored. This indicates a decision to re-enable or re-add the "Analytics" menu item.

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\components\screen\code\customer\CustomerMapping.jsx` (8 changes, 12/31/2025 1:03:59 PM - 12/31/2025 4:45:16 PM):**
    *   Significant refactoring of customer option fetching. Initially, it used `ApiManager.getCommonOptions`, then `ApiManager.getCustomerOptions` with `role`, `pagination`, `search`, and `perPage` parameters.
    *   Later changes simplified the `fetchCustomers` call to `ApiManager.getCustomerOptions(keyword)` and adjusted how options are mapped (`item.customer_name` to `item.label`, `item.customer_map` to `item.value`).
    *   The `onInputChange` prop of `AppAutocomplete` was explicitly set to `(val) => handleOptionChange(val)`, aligning with a search trigger mechanism.
    *   A console log `console.log(res?.data, "ytem");` was added for debugging the `getCustomerOptions` response, which later changed to `console.log(res, "hhhh====");`.
    *   The `role: "CUSTOMER"` and `pagination: false, perPage: ITEMS_PER_PAGE` parameters were removed from the `getCustomerOptions` call within `fetchCustomers`.
    *   The `name="search"` prop was added to `AppAutocomplete`.

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\services\Endpoints.js` (3 changes, 12/31/2025 4:26:13 PM - 12/31/2025 4:47:19 PM):**
    *   The `GET_CUSTOMER_OPTIONS` endpoint definition was changed multiple times.
        *   Initially: `(query, search) => /getCustomerOptions?name=${query?.name}&search=${search}&page=${query?.page}&perPage=${query?.perPage}`.
        *   Simplified to: `(search = "") => /getAutoComplete/getCustomerOptions${search ? `?search=${encodeURIComponent(search)}` : ""}`.
        *   Further refined to use `name` parameter for search: `(search = "") => /getAutoComplete/getCustomerOptions${ search ? `?name=${encodeURIComponent(search)}` : "" }`.

**Patterns and Recurring Elements:**

*   **Debugging with `console.log`:** Frequent use of `console.log` statements is present across multiple files, often to inspect data, function calls, or error objects, indicating active debugging during development.
*   **MUI Component Usage:** Consistent use of Material-UI (`@mui/material`) components like `Box`, `Grid`, `Typography`, `IconButton`, `Stack`, `Button`, `Dialog`, `Tooltip`, etc., for UI construction.
*   **State Management with React Hooks:** Extensive use of `useState`, `useEffect`, and `useCallback` hooks for managing component state and side effects.
*   **Form Management with Formik:** `useFormik` is consistently used for handling form state, validation, and submission, particularly in `AgentBookingConfirmation.jsx` and `BookingFormExtend.jsx`.
*   **Redux Toolkit Query (RTKQ) for API Interaction:** `useSelector` and RTKQ mutations (`useCreateBookingXmlMutation`, `useUploadBookingXmlMutation`, `useUpdateDoMutation`, `useSaveBookingMutation`, `useFetchBookingPlListQuery`, `useGetBookingConfirmQuery`) are prominent, demonstrating a structured approach to data fetching and modification.
*   **Error and Warning Handling:** A recurring pattern of using `react-hot-toast` for success/error messages and `PopupAlert`/`WarningToast` for displaying detailed errors or warnings to the user. This often includes `try-catch` blocks and specific checks for different error structures (custom warnings vs. RTK Query errors).
*   **File Upload Functionality:** A dedicated `UploadFile` component (which itself saw numerous internal changes) is integrated into `AgentBookingConfirmation.jsx`, highlighting a requirement for file uploads in the booking process.
*   **Menu Configuration:** The `menu.js` file consistently defines navigation structures (`menuItems`, `staticMenuItems`) using labels, paths, and `iconKey` for mapping to MUI icons, demonstrating a centralized approach to application navigation.
*   **API Endpoint Management:** The `Endpoints.js` file centralizes API endpoint definitions, and `ApiManager.js` acts as a wrapper for making API calls using these endpoints. This promotes maintainability and consistency in API interactions.
*   **Code Cleanup/Refinement:** Several commits involve removing commented-out code, unused imports, or temporary debugging statements, suggesting a process of iterative development and cleanup. This is particularly noticeable in `UploadFile.jsx` and `CustomerMapping.jsx`.

## 5:16:47 PM
The codebase saw significant development focused on analytics, customer management, booking audits, and auto-complete features.

### File-Specific Updates:

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-backend\src\controllers\analytics\transit.controller.ts`** (12/30/2025, 9:54:51 AM): This file was updated to handle dynamic transit report generation. It now extracts various parameters from the request query, determines default date ranges, fetches user and company details, and dynamically constructs a main SQL query using `transitQueryBuilder`. The query building logic (`mblwiseCondition`) allows grouping results either by MBL number or voyage based on the request. Results are then returned along with customizer settings.

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-backend\src\controllers\code.controller.ts`** (Significant changes on 12/30/2025, 10:23:43 AM, and 12/31/2025, 12:42:28 PM, 12:42:44 PM):
    *   **`getAllCustomer` Function:** Implemented customer retrieval with pagination and dynamic ordering. It constructs search conditions based on query parameters matching database columns. The function aggregates comprehensive customer data, including shipper mappings, document upload details, and customer mappings from several tables (`PO_AccountMaster_Customer_Master`, `account_master_shipper_MAP`, `document_upload_details`, `Account_Master_Customer_MAP`).
    *   **`createCustomer` Function:** Supports both creating new customers and modifying existing ones. It processes various customer details from the request body, sanitizes the customer name (`cname`), and manages database transactions. If a customer `acode` already exists, it triggers a 'Modify' mode, deleting previous related records before re-insertion. Otherwise, a new `acode` is generated. It inserts data into `PO_AccountMaster_Customer_Master`, `agent_po_account_master_type`, and `Account_Master_Shipper_MAP`, resolving related codes (like `polcode`, `shippercode`, `agentcode`) from other master tables. File uploads are integrated using an `upload` middleware.
    *   **Typo Correction:** A minor but critical correction was made to the `customerQuery` in `getAllCustomer`, changing `DISTINICT` to `DISTINCT` on 12/31/2025 (observed at 12:42:28 PM and corrected by 12:42:44 PM). Subsequent saves of this file (12/31/2025, 12:55:12 PM, 12:55:45 PM, 4:22:27 PM) show no further functional changes.

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-backend\src\controllers\booking.controller.ts`** (Significant changes on 12/30/2025, 6:06:10 PM): This file introduced robust auditing mechanisms for booking data.
    *   **`auditDoUpdates`:** A helper function to track field-level changes for Delivery Order (DO) related fields (`do_number`, `do_date`, `bookingdate`, `bookingno`). It compares old and new values, formats dates, and only logs actual modifications, marking the booking status as `CONFIRMED`.
    *   **`auditBookingChanges`:** This orchestrates a comprehensive audit across multiple booking-related tables. It logs changes to the main `agent_booking_entry` table and specifically tracks additions, removals, and updates to `agent_booking_linked_po` and `agent_booking_vessel` records, logging detailed summaries for each action. Consecutive entries for this file (12/30/2025, 6:08:27 PM, 6:10:47 PM) appear to be re-saves without functional modifications.

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-backend\src\routes\get_auto_complete.route.ts`** (12/31/2025, 4:26:54 PM): A new route file was created to manage auto-complete functionalities. It defines two GET endpoints (`/` and `/getCustomerOptions`), both routing to the `getAll` method of a new `get_auto_complete.controller` (implied, as the controller `getCustomerOptions.ts` is shown next).

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-backend\src\controllers\getCustomerOptions.ts`** (12/31/2025, 4:31:18 PM): A new controller file was added to fetch customer options for auto-completion. The active `getAllCustomerOptions` function retrieves distinct `account_name` values from `mtr_tracking_data`, supporting a case-insensitive search filter and limiting results to 10. Notably, the file contains extensive commented-out code indicating a previous or alternative, more complex implementation involving role-based logic and pagination that is no longer active.

### Timestamps of Significant Changes:

*   **12/30/2025, 9:54:51 AM:** Initial development of dynamic transit report generation.
*   **12/30/2025, 10:23:43 AM:** Major implementation for customer management, including creation, retrieval, and multi-table data handling.
*   **12/30/2025, 6:06:10 PM:** Introduction of detailed auditing logic for the booking module.
*   **12/31/2025, 12:42:28 PM - 12:42:44 PM:** Correction of a specific SQL query typo in the customer controller.
*   **12/31/2025, 4:26:54 PM - 4:31:18 PM:** Implementation of new auto-complete routes and a dedicated controller for fetching customer options.

### Patterns and Recurring Elements:

*   **Database Interactions:** The logs consistently show direct interaction with a PostgreSQL database using `query`, `insertQuery`, and `updateQuery` functions imported from `../../config/database`. SQL queries are often constructed dynamically.
*   **Request and Response Handling:** All controllers utilize standard `express` patterns with `AuthenticatedRequest` and `Response` objects, indicating authenticated API endpoints.
*   **Utility Functions:** A strong reliance on shared utility functions is evident, such as `chkStr` for data sanitization/validation, `AppDateFormate` for date formatting, and `getAccountCode`/`getAccountSubCode` for generating unique identifiers.
*   **Logging:** `logger.info` and `logger.error` are extensively used across controllers for debugging, tracing execution flow, and error reporting, highlighting a focus on observability.
*   **Auditing:** A new pattern of comprehensive auditing is introduced in the booking module, leveraging `simpleAudit` and `insertAudit` to track detailed changes, including additions, removals, and field-level modifications across related database tables.
*   **Dynamic Query Generation:** Seen in `transit.controller.ts` with `transitQueryBuilder` and in `code.controller.ts` where search and order clauses are dynamically added to SQL queries based on request parameters.
*   **Data Transformation:** Raw database rows are frequently mapped and transformed into more structured JSON objects before being sent as API responses.

## 6:16:46 PM
The recent code changes span across several frontend components and API configurations, primarily focusing on file upload functionality, booking confirmations, customer mapping, and navigation menu adjustments.

### File-Specific Updates:

1.  **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\components\common\UploadFile.jsx`**
    *   **Initial Setup and Incremental Refinements (12/30/2025, 12:59:55 PM - 1:03:35 PM)**: The `UploadFile` component began with basic drag-and-drop capabilities using `react-dropzone` and Material-UI elements. Early changes involved minor layout adjustments (e.g., `mt` prop for Grid), commenting out styling for file display (borders), and using placeholder text like "kkkk" before settling on a file name example ("Lorem spum.pdf"). The `FolderCopy` icon was initially used for displaying files.
    *   **Major Refactor and Enhanced Functionality (12/30/2025, 6:36:03 PM)**: This was a significant update. The component was refactored to use TypeScript, and the `useDropzone` hook was configured with `noClick: true` to enable explicit file selection via a custom button. Dynamic styling based on `isDragActive` was introduced, and a `handleRemove` function was added for clearing selected files. The `FolderCopy` icon was replaced with `InsertDriveFile`.
    *   **Styling and Icon Adjustments (12/30/2025, 6:36:55 PM - 6:44:51 PM)**: Subsequent changes focused on styling, including centering the "Choose File" button, refining drag-and-drop area text, and eventually replacing the default `Delete` icon with a `CustomDeleteIcon` imported from `../../assets/svg`. Color properties for text and icons were also adjusted for visual consistency.

2.  **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\pages\booking\AgentBookingConfirmation.jsx`**
    *   **File Upload Integration (12/30/2025, 1:05:44 PM)**: This timestamp marks the integration of the `UploadFile` component into `AgentBookingConfirmation`. A `selectedFile` state and an `onFileSelected` handler were added to manage the uploaded document, which is then appended to a `FormData` object for API submission.
    *   **Minor Changes and Cleanup (12/30/2025, 6:01:08 PM - 7:00:45 PM)**: Numerous entries show minor, often non-functional changes such as adding or adjusting `console.log` statements (likely for debugging). Significant import cleanup occurred at **12/30/2025, 7:00:20 PM**, where several unused Material-UI icons (like `CloudDownload`, `Delete`, `Folder`) and the `CardField` component were removed, streamlining the component's dependencies. New icons (`FiDownload`, `FaHourglass`) from `react-icons` were imported for potential future use.

3.  **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\components\common\Cards\CardField.jsx`**
    *   **Initial Implementation and Styling Fix (12/30/2025, 6:04:29 PM - 6:04:49 PM)**: This component was introduced to display formatted data with a title, subtitle, and optional icon/tooltip. An immediate minor styling adjustment was made to the `titleStyle` by removing `lineHeight` and `letterSpacing` properties.

4.  **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\components\screen\booking\form\BookingFormExtend.jsx`**
    *   **Form Logic and Navigation (12/30/2025, 7:02:17 PM)**: An `action` state was introduced to control post-submission navigation (e.g., "save_and_next" vs. direct navigation). Enhanced validation logic was added to check for required fields like vessel and booking numbers when the form is in "edit" mode, providing more specific error messages to the user via a `PopupAlert`.
    *   **Repeated Saves (12/31/2025, 9:46:51 AM - 9:49:49 AM)**: Multiple identical entries indicate continuous saves without functional changes.

5.  **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\components\core\admin-drawer-elements.jsx`**
    *   **Typo Introduction and Fix (12/31/2025, 10:18:20 AM - 10:18:37 AM)**: A syntax error (`kkk`) was introduced in the `ExpandableListItems` key and immediately corrected in the subsequent commit.

6.  **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\config\menu.js`**
    *   **Analytics Menu Item Toggling (12/31/2025, 10:19:11 AM - 11:32:04 AM)**: This file saw repeated changes regarding the "Analytics" menu item. It was initially introduced with its icon, then commented out, re-enabled, had its label temporarily changed to "Analytics123", and then reverted back to "Analytics". This suggests active development and decision-making around menu structure.

7.  **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\components\screen\code\customer\CustomerMapping.jsx`**
    *   **Autocomplete Integration and API Interaction (12/31/2025, 1:03:59 PM - 1:14:18 PM)**: This component manages dynamic customer mapping. Early changes focused on setting up `AppAutocomplete` with loading state and defining `fetchCustomers` with pagination and role parameters. A significant refactor at **12/31/2025, 1:07:02 PM** streamlined `fetchCustomers` and updated how the autocomplete's input triggers the search. Later changes involved correcting `updateRow` logic, fixing a temporary syntax error (`item.`) in option mapping, and adjusting debug console logs. A key change at **12/31/2025, 1:14:18 PM** removed the `role: "CUSTOMER"` parameter from the `getCustomerOptions` API call. Further minor layout adjustments for `AppAutocomplete` were made at **12/31/2025, 6:09:15 PM** and **12/31/2025, 6:09:49 PM** (margin-bottom).

8.  **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\services\Endpoints.js`**
    *   **`GET_CUSTOMER_OPTIONS` Endpoint Evolution (12/31/2025, 4:26:13 PM - 5:53:43 PM)**: The definition of the `GET_CUSTOMER_OPTIONS` endpoint underwent rapid iterations. It initially expected an object `query` with `name`, `page`, `perPage`, and `search`. This was simplified to just `search` (**4:35:55 PM**), then briefly changed to use `name` as the query parameter for `search` (**4:47:19 PM**), experienced a syntax error in URL construction (**5:44:03 PM**), and was finally corrected back to using `search` as the query parameter (**5:53:43 PM**).

9.  **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\services\ApiManager.js`**
    *   **`getCustomerOptions` Alignment (12/31/2025, 4:39:07 PM - 5:45:38 PM)**: Changes in `ApiManager.js` consistently mirrored the evolving `GET_CUSTOMER_OPTIONS` endpoint definition in `Endpoints.js`, adapting its parameter signature to match.

### Patterns and Recurring Elements:

*   **Iterative UI Refinement**: The `UploadFile` component shows a clear pattern of initial implementation, followed by a significant refactor (TypeScript, advanced `useDropzone` features), and then several rounds of minor stylistic adjustments and icon changes. This suggests a focus on both functionality and user experience.
*   **API Endpoint and Call Adjustments**: The `getCustomerOptions` API endpoint and its corresponding call in `ApiManager.js` and `CustomerMapping.jsx` underwent frequent modifications. This highlights an active debugging and refinement cycle for API integration, especially concerning parameter handling and URL construction.
*   **Debugging via `console.log`**: Many commits, especially in `AgentBookingConfirmation.jsx` and `CustomerMapping.jsx`, include additions or modifications to `console.log` statements, indicating active debugging during development.
*   **Menu Structure Experimentation**: The `menu.js` file shows experimentation or ongoing decisions regarding the "Analytics" menu item, including its visibility and label.
*   **Minor Fixes and Saves**: Several commits across different files are either immediate fixes for typos (e.g., `admin-drawer-elements.jsx`) or appear to be simple saves without substantive functional changes, common in active development environments.

## 6:16:53 PM
This log details several significant code changes across different controller and route files, primarily focusing on analytics, booking, and customer data management, alongside routing refactorings.

**File-Specific Updates:**

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-backend\src\controllers\analytics\transit.controller.ts` (Timestamp: 12/30/2025, 9:54:51 AM):**
    *   This file received an update to its `getTransitReports` function. It now dynamically generates transit analytics reports based on user, date ranges (`fromDate`, `toDate`), grouping column, MBL-wise or voyage-wise data, report type, and name.
    *   It utilizes `defaultDateRange`, `getUserObject` and `transitQueryBuilder` utilities to construct flexible PostgreSQL queries.
    *   Error logging using `logger.error` has been implemented for query execution.

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-backend\src\controllers\code.controller.ts`:**
    *   **Timestamp: 12/30/2025, 10:23:43 AM:**
        *   Introduced `getAllCustomer` and `createCustomer` functions.
        *   `getAllCustomer` retrieves comprehensive customer data, including shipper and document details, with support for pagination, sorting, and dynamic search filters. It combines data from multiple tables (`PO_AccountMaster_Customer_Master`, `account_master_shipper_MAP`, `document_upload_details`, `Account_Master_Customer_MAP`).
        *   `createCustomer` handles the creation or modification of customer records. It supports file uploads, sanitizes customer names, and manages database transactions. For existing customers, it performs a delete-and-reinsert operation for related records. It also integrates `getAccountCode` and `getAccountSubCode` for generating unique identifiers.
    *   **Timestamp: 12/31/2025, 12:42:28 PM to 4:22:27 PM:**
        *   Multiple entries show identical code, with the only notable change being a typo correction in the `customerQuery` within `getAllCustomer` from `DISTINICT` to `DISTINCT`. These repeated entries likely represent re-saves or minor non-functional changes.

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-backend\src\controllers\booking.controller.ts`:**
    *   **Timestamp: 12/30/2025, 6:06:10 PM to 6:10:47 PM:**
        *   Introduced robust auditing functionalities: `auditDoUpdates` and `auditBookingChanges`.
        *   `auditDoUpdates` meticulously tracks changes to Delivery Order (DO) details (`do_number`, `do_date`, `bookingdate`, `bookingno`) for specific bookings, logging only changed fields and marking the booking status as `CONFIRMED`.
        *   `auditBookingChanges` provides a more comprehensive auditing for various booking-related tables (`agent_booking_entry`, `agent_booking_linked_po`, `agent_booking_vessel`). It logs additions, removals, and detailed field-level updates within these lists.
        *   Similar to `code.controller.ts`, subsequent entries on the same day show identical content, indicating re-saves without functional changes.

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-backend\src\controllers\getCustomerOptions.ts`:**
    *   **Timestamp: 12/31/2025, 4:31:18 PM:**
        *   A new controller function `getAllCustomerOptions` was introduced. It fetches distinct `account_name` values from `mtr_tracking_data` for autocomplete suggestions, supporting search queries and limiting results to 10.
        *   Notably, it contains a substantial amount of commented-out code, hinting at previous or alternative implementations for customer/agent role-based data fetching and pagination.
    *   **Timestamp: 12/31/2025, 5:59:39 PM:**
        *   Added a `console.log` statement for debugging the `search` variable.
    *   **Timestamp: 12/31/2025, 6:03:37 PM:**
        *   The SQL query was enhanced to `TRIM` whitespace from `account_name` and explicitly filter for `account_name IS NOT NULL`, improving data quality and search accuracy.
    *   **Timestamp: 12/31/2025, 6:04:44 PM:**
        *   Another `console.log` statement was added for debugging `req.query.search`.

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-backend\src\routes\get_auto_complete.route.ts`:**
    *   **Timestamp: 12/31/2025, 4:26:54 PM:**
        *   Initially defined `/getCustomerOptions` to use `getAutoComplete.getAll`.
    *   **Timestamp: 12/31/2025, 5:51:49 PM:**
        *   Updated `/getCustomerOptions` to use the newly created `getAllCustomerOptions` controller from `../controllers/getCustomerOptions`.
    *   **Timestamp: 12/31/2025, 5:53:21 PM:**
        *   The `/getCustomerOptions` route was removed from this file, leaving only the root `/` route.

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-backend\src\routes\getCustomerOptions.ts` (This file was later renamed/moved):**
    *   **Timestamp: 12/31/2025, 5:53:12 PM:**
        *   A new route file was created, importing `getAllCustomerOptions` and defining a route `router.get("/getCustomerOptions", getAllCustomerOptions);`. This indicates a refactoring to dedicate a route file for customer options.
    *   **Timestamp: 12/31/2025, 5:53:28 PM:**
        *   The route path within this file was changed from `/getCustomerOptions` to `/`, implying it's intended to be mounted at a specific path (e.g., `/getCustomerOptions`) in the main application.

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-backend\src\routes\getCustomerOptionsRoute.ts`:**
    *   **Timestamp: 12/31/2025, 6:05:22 PM:**
        *   This file appears to be a rename or move of the `routes/getCustomerOptions.ts` file, containing the `router.get("/", getAllCustomerOptions)` definition. This indicates a focus on clearer file naming conventions for routes.

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-backend\src\index.ts`:**
    *   **Timestamp: 12/31/2025, 5:51:25 PM:**
        *   The main application entry point, configured with numerous routes and middleware. It initially had a commented-out line for `/getCustomerOptions`.
    *   **Timestamp: 12/31/2025, 5:52:45 PM:**
        *   The commented-out `app.use("/getCustomerOptions", GetAutoComplete)` line was uncommented, activating this route.
    *   **Timestamp: 12/31/2025, 6:06:23 PM:**
        *   The route for `/getCustomerOptions` was updated to import and use the new `GetCustomerOptionsRoute` (from `routes/getCustomerOptionsRoute.ts`) instead of the general `GetAutoComplete` router, reflecting the routing refactoring.

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-backend\src\utils\BMQuery.ts` (Timestamp: 12/31/2025, 5:57:43 PM):**
    *   Introduced the `BMQuery` class, a utility for generating SQL queries to fetch various business partner types (Buyer, Seller, Importer, Notify, ShipTo, Shipper, CSL, Consolidator, Manufacturer, Consignee, BondHolder, CustomBroker).
    *   Each method constructs a `SELECT DISTINCT ON (am.cname)` query, joining `agent_po_account_master` and `agent_po_account_master_type` tables, using case-insensitive `ILIKE` for keyword matching.
    *   This class standardizes and centralizes the logic for retrieving business partner data for autocomplete or lookup purposes.

**Patterns and Recurring Elements:**

1.  **Auditing and Logging:** There is a strong emphasis on detailed auditing for critical operations (like bookings) and extensive logging (`logger.info`, `logger.error`, `console.log`) across controllers for monitoring and debugging.
2.  **Customer/Account Management Focus:** A significant portion of the changes revolves around creating, managing, and querying customer and account information, including specialized autocomplete functions and comprehensive detail retrieval.
3.  **Database Interaction:** All major functional changes involve database queries (`query` function) and transactional operations (`query('BEGIN')`). Queries are often dynamic, using parameters and conditional logic.
4.  **Modularization and Refactoring:** The progression of changes for `getCustomerOptions` (creating a new controller, a dedicated route file, and then renaming the route file) clearly indicates a continuous effort towards better code organization, separation of concerns, and more descriptive naming conventions.
5.  **Data Quality:** Improvements like `TRIM` and `IS NOT NULL` in SQL queries, and `chkStr` in data processing, show attention to data cleanliness and robustness.
6.  **Utility Functions:** The use of helper functions (`defaultDateRange`, `getUserObject`, `transitQueryBuilder`, `AppDateFormate`, `getAccountCode`, `getAccountSubCode`, `chkStr`, `BMQuery`) is prevalent for abstracting common logic and improving code reusability.