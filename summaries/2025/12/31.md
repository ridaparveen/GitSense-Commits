# Activity Summary for 12/31/2025

## 9:40:28 AM
`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-backend\src\controllers\analytics\transit.controller.ts` (Timestamp: 12/30/2025, 9:54:51 AM)
This file defines the `getTransitReports` function, responsible for generating transit-related analytics reports. It extracts various parameters from the request query, such as grouping columns, date ranges, mbl-wise filtering, view options, and report names. If date ranges are not provided, it defaults to a predefined range. The controller dynamically builds a SQL query using `transitQueryBuilder` based on user-specific details (company name, user ID) and the `mblwiseCondition`, which adjusts the `SELECT`, `CONDITION`, and `GROUP BY` clauses for either `mblno` or `voyage`. The generated query is then executed against the database, and the results are returned with an HTTP 200 status. Error handling is implemented to catch and log issues, responding with a 500 status in case of server errors.

`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-backend\src\controllers\code.controller.ts` (Timestamp: 12/30/2025, 10:23:43 AM)
This file handles customer-related operations, including retrieving and creating customer records.
The `getAllCustomer` function fetches customer details with pagination and dynamic search/sorting capabilities. It queries `PO_AccountMaster_Customer_Master`, dynamically identifies table columns for search, and then constructs SQL queries to retrieve customer data and count total records. For each customer, it also fetches related shipper mapping (`account_master_shipper_MAP`), document upload details (`document_upload_details`), and customer mapping (`Account_Master_Customer_MAP`), combining them into a comprehensive JSON response.
The `createCustomer` function manages the creation or modification of customer records. It supports file uploads and extracts numerous customer details from the request body. It begins a database transaction and first checks if a customer with the given `acode` already exists. If so, it updates the record by deleting and re-inserting into `PO_AccountMaster_Customer_Master` and associated tables (`agent_po_account_master_type`, `Account_Master_Shipper_MAP`, `account_master_pic`). Otherwise, it generates a new account code using `getAccountCode` and inserts a new record. It also handles specific customer types and processes a `mapping` array to insert data into `Account_Master_Shipper_MAP`, resolving `polcode`, `shippercode`, and `agentcode` from other master tables. The provided snippet ends during the processing of shipper mapping.

`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-backend\src\controllers\booking.controller.ts` (Timestamps: 12/30/2025, 6:06:10 PM; 12/30/2025, 6:08:27 PM; 12/30/2025, 6:10:47 PM)
All three timestamps for this file contain identical code snippets, indicating no functional changes were introduced between these saves. The file focuses on auditing booking-related data changes.
It defines `auditDoUpdates`, a helper function designed to track specific updates to Delivery Order (DO) numbers, DO dates, booking dates, and booking numbers within `agent_booking_entry`. This function compares old and new values and only logs changes using `insertAudit` if actual differences are detected. Upon detecting changes, it sets the `booking_status` to `CONFIRMED`.
The `auditBookingChanges` function provides a more comprehensive auditing mechanism for an entire booking ID across several related tables. It logs changes for:
*   `agent_booking_entry` (main booking details).
*   `agent_booking_linked_po` (linked purchase orders), distinguishing between added, removed, and modified POs, and logging summary details for additions/removals using `simpleAudit` and field-level changes for modifications using `insertAudit`.
*   `agent_booking_vessel` (vessel details), similarly tracking additions and removals with summary details for vessel, voyage, line, and dates.
The provided snippet for `auditBookingChanges` ends during the auditing of `agent_booking_vessel`, implying further logic to handle modifications or other booking-related lists. Both auditing functions extensively use `logger.info` to record audit activities.

**Patterns and Recurring Elements:**
*   **Future Timestamps:** All timestamps are dated 12/30/2025, suggesting a future development timeline or placeholder dates.
*   **Database Interaction:** A consistent pattern of direct database interaction is observed, with frequent imports and usage of `query`, `insertQuery`, and `updateQuery` functions. Raw SQL queries are embedded within the controller logic.
*   **Audit Logging:** There's a strong emphasis on detailed audit logging across the booking controller, employing `simpleAudit` for summary changes (additions/removals) and `insertAudit` for granular, field-level tracking of modifications. `logger.info` is widely used to trace audit progress.
*   **Utility Functions:** Several common utility functions (e.g., `AppDateFormate`, `getAccountCode`, `getAccountSubCode`, `chkStr`, `sanitizeString`) are imported and utilized across different controllers for tasks like date formatting, ID generation, and data sanitization.
*   **Error Handling:** All controllers demonstrate robust error handling using `try...catch` blocks, logging errors with `logger.error`, and returning a 500 status with an error message in case of exceptions.
*   **Request/Response Handling:** The use of `AuthenticatedRequest` and `Response` from `express` is standard across all controllers for handling web requests.
*   **Modular Structure:** The codebase appears well-structured, separating concerns into controllers, requests, configuration, and utility modules.