# Activity Summary for 12/22/2025

## 9:39:38 AM
The `src/services/Endpoints.ts` file was updated on 12/18/2025, 3:57:49 PM, to include new API endpoints. Key additions are `ANALYTICS_EXPORT` which supports a wide range of query parameters for analytics data export, and `CUSTOMER_OPTION` for fetching customer details. The `USER_SETTINGS` endpoint was commented out.

Correspondingly, `src/services/ApiManager.ts` was modified on 12/18/2025, 3:58:46 PM, to add static methods for `analyticsExport` and `getCustomerOptions`, aligning with the new endpoints. The `getDateFormat` method was also commented out.

The `src/SelectCustomer.tsx` component underwent several significant changes:
*   **12/18/2025, 3:59:25 PM:** An initial version of a `SelectCustomerPanel` was introduced. This React component provided a customer selection UI with search and pagination capabilities, using `ApiManager.getCustomerOptions` for data retrieval and `lodash.debounce` for backend search optimization. It integrated with Redux to dispatch `setSelectedCustomer`.
*   **12/18/2025, 3:59:56 PM:** A minor debugging change was made, adding a `console.log` statement to inspect the customer options response.
*   **12/18/2025, 4:05:50 PM:** The data fetching strategy for `src/SelectCustomer.tsx` was refactored. The `fetchOptions` function no longer handled search queries, instead focusing on paginated retrieval. Search functionality was moved to client-side filtering of the fetched options, and `debounce` was removed from `fetchOptions`.
*   **12/18/2025, 4:11:15 PM:** A major architectural change to `src/SelectCustomer.tsx` was implemented. A new `fetchAllCustomers` function was introduced to fetch *all* customer options from the API in a paginated loop when the panel first opens. Subsequent search and pagination operations became entirely client-side, processing the `allOptions` array. The `CustomerOption` value type was explicitly set to `string`.
*   **12/19/2025, 7:59:44 AM:** A minor code cleanup in `src/SelectCustomer.tsx` saw the `fetchAllCustomers` function changed from a `useCallback` memoized function to a regular `async` function, without altering its core logic.

A new component, `src/components/screen/analytics/SelectCustomerPanel.tsx`, was introduced on 12/18/2025, 4:01:26 PM. This separate customer selection panel, intended for an analytics screen, used Material-UI components (Popover, TextField, List, Pagination) for its interface. It also leveraged `ApiManager.getCustomerOptions` with a debounced backend search and pagination, and dispatched selected customer data to an `analytics-slice` in Redux. This file remained unchanged in a subsequent log entry on 12/19/2025, 8:00:08 AM.

**Patterns and Recurring Elements:**
*   **API Standardization:** Consistent use of `ApiManager` and `Endpoints` across the frontend for accessing backend services.
*   **Customer Selection Feature Duplication & Refinement:** Two distinct UI implementations for customer selection (`src/SelectCustomer.tsx` and `src/components/screen/analytics/SelectCustomerPanel.tsx`) indicate a common requirement, but with different UI frameworks (custom/Tailwind vs. Material-UI).
*   **Evolution of Search/Pagination Logic:** The `src/SelectCustomer.tsx` component specifically demonstrates a progression from server-side debounced search/pagination to a more efficient client-side search/pagination after an initial bulk fetch of all data. This pattern suggests an emphasis on improving user experience by reducing API calls for frequent search interactions.
*   **Redux for State Management:** Both customer selection components integrate with Redux, highlighting a centralized state management approach for application data.
*   **Development Pace:** The concentration of changes on 12/18/2025 suggests a focused development effort, with a minor follow-up the next day.

## 3:27:17 PM
The provided log details recent code changes primarily focused on enhancing analytics and reporting features, alongside the addition of a new customer autosearch functionality.

On **12/18/2025, 3:54:52 PM**, the file `src/services/analytics/customerAutosearchOptions.ts` was updated. This introduces a new service, `getAllCustomerOptions`, designed to fetch distinct customer or agent names for autosearch fields. It dynamically queries `agent_po_account_master` for "AGENT" roles and `mtr_tracking_data` for "CUSTOMER" roles, with pagination support for the latter. The results are formatted as `{ value, label }` pairs.

Shortly after, on **12/18/2025, 3:55:32 PM**, the `src/common/constants/Paths.ts` file was modified. A new base path `CustomerOptions: { Base: "/getCustomerOptions" }` was added. This new path aligns directly with the `getAllCustomerOptions` service, enabling its exposure via the API. Additionally, several other modules like `Audit`, `Planboard`, `Company`, `Menu`, and `CO2Emission` appear to have their paths defined or expanded, indicating broader API development.

The central routing file, `src/routes/index.ts`, was updated on **12/18/2025, 3:56:44 PM**. This change integrates the newly defined `getAllCustomerOptions` service by importing it and attaching it to the `Paths.CustomerOptions.Base` endpoint. It also includes the integration of `PlanbaordRoutes`, `MenuRoutes`, `Co2EmissionRoutes`, and a direct route for `getAllAudit`, further expanding the API's available endpoints. The close proximity of timestamps for these three files (within minutes) suggests a unified effort to implement and expose the customer autosearch feature.

A more substantial update occurred on **12/19/2025, 7:53:25 AM**, affecting `src/common/util/export.query.ts`. This file, responsible for generating export-ready SQL queries for reports, saw significant expansion. A new helper function, `getMonthValue`, was added to normalize month inputs (e.g., "Jan" to 1). The `bookingQuery` function was extensively updated to include numerous new SQL query templates related to booking-to-departure and booking-to-arrival timings. These new report types, such as "Booking Date to Actual Departure" and "Booking Date to POD Arrival" (with variations for "Stacked Bar" and "MBL Wise"), involve complex joins between `mtr_tracking_data` and `agent_booking_entry` tables. The queries dynamically filter and group data based on parameters like `CompanyName`, `stackedMonth`, `startWeek`, `endWeek`, `quarter`, `stackedGroup`, `stackedExport`, and `displayBy`. A recurring pattern in these new queries is the calculation of `day_diff` between various date fields and sophisticated conditional logic to categorize these differences into weekly buckets, especially for stacked bar reports.

In summary, the changes indicate active development in two main areas:
1.  **Customer Autosearch Feature:** A new service and corresponding API route were implemented to fetch customer/agent options dynamically, supporting role-based logic and pagination.
2.  **Advanced Reporting & Analytics:** The reporting capabilities were significantly enhanced with a host of new, dynamic SQL queries focused on tracking and analyzing booking lifecycle timings, including support for detailed stacked bar charts and various temporal aggregations (month, week, quarter).

The timestamps suggest a release or sprint that first focused on immediate API additions for UI features (autosearch) and then moved into more complex data processing and reporting functionalities.

## 7:02:47 PM
The provided log details a series of code changes primarily focused on expanding the application's analytics, reporting, and search functionalities. These updates occurred in a concentrated period between December 18th and 19th, 2025.

**File-Specific Updates:**

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-backend-v2\src\services\analytics\customerAutosearchOptions.ts` (Timestamp: 12/18/2025, 3:54:52 PM)**
    *   A new service function, `getAllCustomerOptions`, was introduced.
    *   This function fetches distinct customer or agent names for autosearch dropdowns, based on the `role` query parameter (either "AGENT" or "CUSTOMER").
    *   It queries `agent_po_account_master` for agents and `mtr_tracking_data` for customers.
    *   Pagination support is included for customer-role searches, allowing control over `page` and `perPage`.
    *   Results are formatted as `value`/`label` pairs, and error handling with logging is implemented.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-backend-v2\src\common\constants\Paths.ts` (Timestamp: 12/18/2025, 3:55:32 PM)**
    *   This file, defining API endpoint paths, saw a significant expansion.
    *   New base paths were added for `CustomerOptions` (`/getCustomerOptions`), `Menu` (`/menus`), and `CO2Emission` (`/co2emission`).
    *   An `Audit` path (`/audit`) was also introduced.
    *   Specific sub-paths like `GetUserMenus` for `Menu` and `Get` for `CO2Emission` were defined, indicating new features related to user interface menus and carbon emission tracking.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-backend-v2\src\routes\index.ts` (Timestamp: 12/18/2025, 3:56:44 PM)**
    *   The main API router was updated to integrate the newly defined services and routes.
    *   It now uses the `getAllCustomerOptions` service for the `CustomerOptions.Base` path.
    *   New route modules `MenuRoutes` and `Co2EmissionRoutes` were imported and linked to their respective base paths.
    *   The `getAllAudit` service was integrated for the `Audit.Get` path.
    *   These changes collectively enable access to the new customer search, menu management, CO2 emission tracking, and audit functionalities via the API.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-backend-v2\src\common\util\export.query.ts` (Timestamp: 12/19/2025, 7:53:25 AM)**
    *   This file, responsible for generating exportable SQL queries, underwent a substantial update.
    *   A helper function `getMonthValue` was added to convert month names (e.g., "Jan") into numerical values.
    *   The `bookingQuery` function was expanded with numerous complex SQL query definitions, categorized by report name (e.g., "Booking Date to Actual Departure", "Booking Date to POD Arrival").
    *   These queries heavily utilize `INNER JOIN` between `mtr_tracking_data` and `agent_booking_entry` on `mblno`.
    *   Extensive filtering logic was added to support `CompanyName`, `stackedExport` conditions, `displayBy` (month, week, quarter), and `stackedGroup` for various reporting dimensions.
    *   Date handling in queries is prominent, including `EXTRACT(DAY FROM ...)` for calculating date differences and `DATE_PART('day', ...)` for categorizing these differences into time ranges like 'Less than 1 week', '1 - 2 weeks', etc., for stacked bar reports.

**Patterns and Recurring Elements:**

*   **Analytics and Reporting Focus:** There's a strong emphasis on enhancing analytics and reporting capabilities. This is evident from the new `customerAutosearchOptions` service (likely for analytics dashboards), the expansion of `Analytics` paths in `Paths.ts`, and the comprehensive SQL query generation in `export.query.ts` for detailed booking reports.
*   **Database Interaction and Data Models:** All changes involve direct or indirect interaction with the database, primarily querying `mtr_tracking_data`, `agent_po_account_master`, and `agent_booking_entry` tables.
*   **API Expansion:** The addition of several new API endpoints (`CustomerOptions`, `Menu`, `CO2Emission`, `Audit`) signifies a significant expansion of the application's features.
*   **Date and Time Handling:** The `export.query.ts` file demonstrates sophisticated handling of dates and times in SQL queries, including comparisons, extractions, and calculations of differences, crucial for reporting.
*   **Role-Based Logic:** The `customerAutosearchOptions.ts` service explicitly uses a `role` parameter to tailor data retrieval, suggesting role-based access or display for certain data.
*   **Modular Design:** The integration of new services and route modules in `index.ts` indicates a modular approach to adding new features.