# Activity Summary for 12/4/2025

## 6:45:10 AM
The series of code changes on **12/2/2025** between 8:47 PM and 9:30 PM reflects active development on a React-Redux application, primarily focusing on product data fetching, display, and associated styling.

### File-Specific Updates:

*   **`c:\Users\ridap\Downloads\react-redux\src\redux\productSlice.js`**
    *   **Initial Setup (8:47 PM):** A `productSlice` was created using `@reduxjs/toolkit`, including an `initialState` for `items`, `status`, and `error`. An asynchronous thunk, `fetchProduct`, was defined to fetch products from `https://dummyjson.com/products`. The `extraReducers` were set up to handle the `fetchProduct` action, though initially with a typo (`fullfilled`).
    *   **Minor Adjustments (8:48 PM - 8:50 PM):** `fetchProduct` was explicitly exported, and the `extraReducers` were updated to correctly import and use `isFulfilled` from `@reduxjs/toolkit` to manage the fulfilled state of the async operation.
    *   **Major Refinement (8:52 PM):** The `fetchProduct` thunk was significantly refactored to directly use `createAsyncThunk` with a more specific action type (`"products/fetchProduct"`). The `initialState.status` was changed from `undefined` to `"idle"`. Crucially, the `extraReducers` were expanded to handle the full lifecycle of the `fetchProduct` thunk: `pending` (setting status to "loading"), `fulfilled` (setting status to "succeeded" and populating `items`), and `rejected` (setting status to "failed" and capturing the error message). This standardized the async state management.

*   **`c:\Users\ridap\Downloads\react-redux\src\redux\store.js`**
    *   **Initialization (8:47 PM):** The Redux store was configured using `configureStore`, combining `CartReducer` and `ProductReducer`. The initial import for `productSlice` was slightly incomplete.
    *   **Minor Correction (8:49 PM):** The import statement for `productSlice` was completed with a semicolon, ensuring correct module import.

*   **`c:\Users\ridap\Downloads\react-redux\src\Product.jsx`**
    *   **Component Creation (8:49 PM):** A `Product` component was introduced, using `useDispatch` to trigger actions. It included `useEffect` to dispatch `fetchProduct` once on mount. Initially, it rendered a single hardcoded product card with placeholder details ("Wire Less Mouse", fixed image, fixed price). `AddToCart` and `removeCartItem` functions were present but not fully integrated with dynamic data.
    *   **State Integration (8:53 PM - 8:54 PM):** `useSelector` was imported to access the Redux state. The `productSelector` was initially set to the entire state and then refined to specifically select `state.products.items`, indicating preparation to display fetched product data.
    *   **Dynamic Rendering (8:58 PM - 9:01 PM):** The component was modified to dynamically render multiple product cards by mapping over `productSelector.items`. There were initial syntax adjustments for the `map` function to correctly return JSX, and the cart buttons were temporarily commented out.
    *   **Data Binding & Functionality Restore (9:23 PM - 9:26 PM):** The product card elements (image source, title, brand, price, rating) were updated to display actual data from the fetched `item` objects (`item.thumbnail`, `item.brand`, `item.title`, `item.price`, `item.rating`). The cart buttons (`AddToCart`, `removeCartItem`) were uncommented, restoring their functionality.
    *   **Refinement (9:30 PM):** A `key={item.id}` prop was added to the mapped product cards, which is a best practice for rendering lists in React for performance and stability.

*   **`c:\Users\ridap\Downloads\react-redux\src\App.css`**
    *   **Initial Styling (9:24 PM):** Basic global styles were defined (`*`), along with styles for a header, navigation, cart elements, and a `.product-card`. The `.product-card` initially used `display: flex;`.
    *   **Layout Adjustments (9:25 PM):** The `display` property of `.product-card` was iteratively changed from `flex` to `block`, then to `inline-block`, likely experimenting with layout. Padding for `.product-card` was also increased from `15px` to `25px`.
    *   **Grid Layout Implementation (9:27 PM - 9:29 PM):** A new `.grid` class was introduced with `display: grid;`. This was then enhanced with responsive grid-template-columns (`repeat(auto-fit, minmax(220px))`, then `repeat(auto-fit, minmax(220px, 1fr))`) to arrange product cards. Finally, `display: inline-block;` was commented out from `.product-card`, allowing the new grid container to manage its layout.

### Patterns and Recurring Elements:

*   **Redux Toolkit for State Management:** The development consistently uses Redux Toolkit features like `createAsyncThunk`, `createSlice`, and `configureStore` for managing application state and asynchronous operations.
*   **Asynchronous Data Fetching:** A core recurring theme is the fetching of product data from `https://dummyjson.com/products` and integrating it into the application. This involves defining thunks, handling loading/success/error states, and displaying the fetched data in the UI.
*   **Component-Driven Development:** Changes in `Product.jsx` demonstrate a typical component development lifecycle: starting with a static placeholder, then connecting it to global state, iterating on data display, and finally refining the rendering with dynamic data and best practices (like `key` props).
*   **Iterative Styling:** The CSS changes show an iterative process of defining and refining styles for layout and appearance, particularly for the product cards and their container, moving towards a responsive grid.
*   **Rapid Development Cycle:** All timestamps fall within a condensed timeframe on December 2, 2025, indicating a focused and rapid development session, with incremental updates leading to functional and stylistic improvements.

## 6:45:12 AM
The provided log primarily details changes across two controller files and one route file, focusing on booking and House Bill of Lading (HBL) functionalities.

**File-specific Updates:**

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-backend\src\controllers\booking.controller.ts`**
    *   **12/3/2025, 12:06:34 PM**: This entry shows the initial significant version of the `saveBooking` function. It handles both adding new agent bookings and updating existing ones. For updates, it first deletes existing related entries (cargo, container, vessel, POs, linked POs) from various tables before re-inserting the updated data. It retrieves `oldData` to preserve certain booking details like `booking_status` and `do_number`. The function then inserts data into `agent_booking_entry` and associated tables (`agent_booking_Cargolist`, `agent_booking_vessel`, `agent_booking_container_pre`, `agent_booking_po`, `agent_booking_linked_po`). It also updates `dso_order` for linked POs. An incomplete `saveMaster` function is also present, which validates `account_type` against a predefined list.
    *   **Subsequent timestamps (e.g., 12/3/2025, 12:09:31 PM through 12/3/2025, 12:15:30 PM)**: The code content for this file remains identical across these multiple saves, indicating no functional changes were introduced in these specific revisions after the initial development.

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-backend\src\controllers\hblEntry.controller.ts`**
    *   **12/3/2025, 2:04:59 PM**: This is the first entry showing content for this file, introducing `createHblMasterBooking` and `updateHblMasterBooking` functions.
        *   `createHblMasterBooking`: This function is responsible for creating a new HBL master booking. It constructs a payload with extensive details including shipper, consignee, notify parties, cargo description, container details, and routing. It retrieves a `bookingSerialId` from `agent_booking_entry` and then inserts data into `hbl_master`, `agent_booking_vessel`, and `agent_booking_hbl`. It also conditionally inserts related lists (routing, containers, basic POs) into their respective tables (`agent_booking_routing`, `agent_booking_container`, `agent_booking_po`). Audit logging (`simpleAudit`) is integrated for new HBL creations.
        *   `updateHblMasterBooking`: This function updates an existing HBL master booking identified by `hbl_master_id`. It performs a large SQL `UPDATE` query on `hbl_master` with numerous fields and then updates `agent_booking_vessel` and `agent_booking_hbl`. Detailed audit logging (`insertAudit`) is implemented for the `hbl_master` table, filtering the payload to only include relevant fields defined in `auditConfigObj`.
    *   **Subsequent timestamps (e.g., 12/3/2025, 2:05:48 PM through 12/3/2025, 4:16:10 PM)**: Similar to the booking controller, the code content for `hblEntry.controller.ts` is identical across these numerous timestamps, suggesting no further functional modifications were saved to the file within this period after its initial comprehensive implementation.

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-backend\src\routes\hblEntry.route.ts`**
    *   **12/3/2025, 2:36:19 PM**: This entry defines the API routes for HBL entry operations. It includes routes for:
        *   `GET /`: `fetchHblFormDetails`
        *   `GET /get-hbl`: `getHbl`
        *   `POST /create`: `createHblMasterBooking`
        *   `POST /update`: `updateHblMasterBooking`
        *   `DELETE /delete`: `deleteHblForm` (protected by `authMiddleware`)
        *   `GET /get-po-details`: `fetchPoDetails`

**Patterns and Recurring Elements:**

*   **Frequent Saves with Identical Content**: A noticeable pattern is the high frequency of saves for both `booking.controller.ts` and `hblEntry.controller.ts` where the code content remains exactly the same over several consecutive timestamps. This could indicate routine saves during development without actual code changes, or changes too minor (e.g., whitespace) to be captured as diffs in this log format.
*   **Database Transaction Management**: Both controllers employ explicit `await query('BEGIN')` and `await query('COMMIT')`/`await query('ROLLBACK')` blocks, indicating a strong emphasis on maintaining data integrity through transactions for complex multi-table operations.
*   **Data Sanitization**: The `sanitizeString` and `sanitizeIntString` utility functions are consistently used across both controllers for inputs received via `req.body`, highlighting a practice of data validation and sanitization. `AppDateFormate` is also consistently used for date formatting.
*   **Audit Logging**: The `hblEntry.controller.ts` explicitly implements audit logging (`simpleAudit` and `insertAudit`), suggesting that tracking changes to HBL master records is a critical requirement.
*   **Role-Based Location Determination**: Both `saveBooking` and HBL functions determine `locationByRole` based on `req.user.role` (AGENT or ADMIN), indicating a consistent approach to handling user context and permissions.
*   **Modular Database Operations**: The use of `insertMany`, `insertQuery`, `query`, and `updateQuery` from a shared `../config/database` module is a recurring pattern for all database interactions.
*   **Complex Data Structures**: Both booking and HBL payloads involve nested lists (e.g., `cargoList`, `vesselList`, `inventoryList`, `basicPoList`, `linkedPoList` for bookings; `routingList`, `containerList`, `basicPoList` for HBLs), which are processed through `insertMany` operations.

## 8:25:50 AM
The provided log details changes to two controller files and one route file, all timestamped for December 3, 2025, indicating a focused development period on that date.

**File-specific Updates:**

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-backend\src\controllers\booking.controller.ts` (12/3/2025, 12:06:34 PM - 12:15:30 PM):**
    This file contains logic for saving booking information. The `saveBooking` asynchronous function handles both creation and updates of agent bookings. For updates, it first deletes existing related records (cargo, containers, vessels, basic POs, linked POs) based on `agent_booking_id` and then re-inserts new data. New bookings are assigned a generated `agent_booking_id`. The function extensively uses utility functions for sanitization (`sanitizeString`, `sanitizeIntString`) and date formatting (`AppDateFormate`). It interacts with multiple database tables including `agent_booking_entry`, `agent_booking_cargolist`, `agent_booking_container_pre`, `agent_booking_vessel`, `agent_booking_po`, and `agent_booking_linked_po`. It also updates `dso_order` for linked POs.
    A `saveMaster` function is also present, which validates `account_type` against a predefined set of `BookingAtypeEnum` values.
    Across the multiple entries for this file, the code content remains identical, suggesting that the log captured snapshots of the same state or very minor, uncaptured changes over that timestamp range.

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-backend\src\controllers\hblEntry.controller.ts` (12/3/2025, 2:04:59 PM - 4:16:10 PM):**
    This file manages the creation and updating of House Bill of Lading (HBL) master bookings.
    The `createHblMasterBooking` function inserts new HBL master data, associating it with an existing `agent_booking_entry` via `booking_serial_id`. It saves HBL details, vessel/voyage information, routing lists, container lists, and basic PO lists into respective `hbl_master`, `agent_booking_vessel`, `agent_booking_hbl`, `agent_booking_routing`, `agent_booking_container`, and `agent_booking_po` tables. This function also includes an audit log entry for new HBL creations.
    The `updateHblMasterBooking` function performs extensive updates on the `hbl_master`, `agent_booking_vessel`, and `agent_booking_hbl` tables based on a `hbl_master_id`. It also incorporates a more detailed audit logging mechanism using `auditConfigObj` to filter and record changes specifically for `hbl_master` fields.
    Similar to the `booking.controller.ts`, the code content for `hblEntry.controller.ts` is identical across all provided log entries for this file, indicating no further changes were recorded within these timestamps for the visible code.

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-backend\src\routes\hblEntry.route.ts` (12/3/2025, 2:36:19 PM):**
    This file defines the API routes related to HBL entry. It exposes endpoints for:
    *   `GET /`: `fetchHblFormDetails`
    *   `GET /get-hbl`: `getHbl`
    *   `POST /create`: `createHblMasterBooking`
    *   `POST /update`: `updateHblMasterBooking`
    *   `DELETE /delete`: `deleteHblForm` (protected by `authMiddleware`)
    *   `GET /get-po-details`: `fetchPoDetails`
    This file appears once in the log, representing its state at that specific timestamp.

**Patterns and Recurring Elements:**

*   **Consistent Timestamp:** All listed changes occurred on 12/3/2025, primarily around midday for booking operations and throughout the afternoon for HBL entry, suggesting focused development on these features.
*   **Database Interaction:** Both controller files heavily utilize a custom database abstraction layer (`query`, `insertMany`, `insertQuery`, `updateQuery`) and implement transactional patterns (`BEGIN`, `COMMIT`, `ROLLBACK`) for data integrity.
*   **Input Sanitization and Formatting:** There's a strong pattern of using `sanitizeString`, `sanitizeIntString`, and `AppDateFormate` utilities to clean and format incoming request data before database operations, crucial for security and data consistency.
*   **Role-Based Location Determination:** Both controllers derive a `locationByRole` variable based on the authenticated user's role (`AGENT` vs. `ADMIN`) for setting location-specific data.
*   **Audit Logging:** The `hblEntry.controller.ts` explicitly implements audit logging, using `simpleAudit` and `insertAudit` modules, indicating a requirement to track changes to HBL data.
*   **Modular Code Structure:** The code is organized into controller and route files, with utility functions (`getAgentBookingCode`, `AppDateFormate`, `sanitizeString`, etc.) imported from separate modules, promoting reusability and maintainability.
*   **Error Handling:** Both controllers wrap their main logic in `try...catch` blocks to handle potential errors, logging them and sending a 500 "Internal Server Error" response.
*   **Code Duplication:** The identical nature of the logs for `booking.controller.ts` and `hblEntry.controller.ts` across multiple timestamps suggests either no changes were committed or detected in those intervals, or the logs only capture snippets that are not affected by potential minor changes.
*   **Data Structure Handling:** Both controllers manage complex data structures (`cargoList`, `vesselList`, `inventoryList`, `basicPoList`, `linkedPoList`, `routingList`, `containerList`) from the request body, often iterating and mapping them for bulk insertion into related tables.

## 9:25:46 AM
The provided log details a series of changes made to a React-Redux application within a short timeframe on 12/2/2025, focusing on product listing functionality.

**File-Specific Updates:**

*   **`c:\Users\ridap\Downloads\react-redux\src\redux\productSlice.js`**
    *   **Initial Setup (8:47 PM - 8:50 PM):** This file was initially set up to define a `productSlice` using `@reduxjs/toolkit`. It included an `initialState` for `items`, `status`, and `error`. An asynchronous thunk, `fetchProduct`, was defined (initially with an incorrect syntax of a function returning `createAsyncThunk`) to fetch product data from `https://dummyjson.com/products`. The `extraReducers` were intended to handle the `fullfilled` (later `isFulfilled`) state of this thunk.
    *   **Major Refactor (8:52:13 PM):** A significant update correctly redefined `fetchProduct` directly as an `export const createAsyncThunk`. The thunk action type was refined to `"products/fetchProduct"`. The `initialState.status` default was set to `"idle"`. Crucially, the `extraReducers` were refactored to properly handle the lifecycle of the async thunk, including `fetchProduct.pending`, `fetchProduct.fulfilled`, and `fetchProduct.rejected` cases, enabling robust loading, success, and error state management.

*   **`c:\Users\ridap\Downloads\react-redux\src\redux\store.js`**
    *   **Initial Configuration (8:47:42 PM - 8:49:57 PM):** This file consistently configures the Redux store, combining `CartReducer` (from `./slice`) and `ProductReducer` (from `./productSlice`) into the main reducer. The changes were minor, primarily formatting.

*   **`c:\Users\ridap\Downloads\react-redux\src\Product.jsx`**
    *   **Initial Component and Data Fetching (8:49:08 PM):** The `Product` functional component was created, using `useDispatch` and `useEffect` to dispatch `fetchProduct` once on component mount. It initially rendered a single, static product card with hardcoded details and placeholder "Add to Cart" and "Remove Cart" buttons.
    *   **Redux State Integration (8:53:35 PM - 8:54:01 PM):** `useSelector` was introduced to read the Redux state, first logging the entire state, then specifically selecting `state.products.items`.
    *   **Dynamic Product Rendering (8:58:41 PM - 9:01:27 PM):** The component transitioned from a static display to dynamically rendering multiple product cards by mapping over `productSelector` (the fetched items). Initial attempts to map lacked a `return` statement, which was corrected. The add/remove cart buttons were temporarily commented out.
    *   **Displaying Dynamic Data (9:23:15 PM - 9:26:51 PM):** Product card details were progressively made dynamic: `item.brand` was displayed, `item.rating` was integrated, `item.price` replaced a static price, and `item.thumbnail` was used for images. The add/remove cart buttons were re-enabled. Eventually, `item.title` was also added to the product display.
    *   **List Key Addition (9:30:38 PM):** A `key={item.id}` prop was added to the mapped product cards, addressing a common React warning for lists.

*   **`c:\Users\ridap\Downloads\react-redux\src\App.css`**
    *   **Base Styling (9:24:48 PM):** Comprehensive CSS was added for header, navigation, cart, and product cards, including basic flexbox for product cards.
    *   **Product Card Layout Adjustments (9:25:04 PM - 9:25:33 PM):** The `display` property of `.product-card` was iteratively changed from `flex` to `block` and then to `inline-block`. Padding for `.product-card` was increased from `15px` to `25px`.
    *   **Grid Layout Implementation (9:27:40 PM - 9:29:28 PM):** A `.grid` class was introduced and evolved to use CSS Grid for laying out product cards. It started with `display: grid;`, then specified `grid-template-columns` using `repeat(auto-fit, minmax(220px))`, further refined to `minmax(220px, 1fr)`. The `display: inline-block;` for `.product-card` was commented out, indicating the grid system took over layout control.

**Timestamps of Significant Changes:**

*   **12/2/2025, 8:52:13 PM:** Critical refactor of `productSlice.js` to correctly define and manage the `createAsyncThunk` lifecycle.
*   **12/2/2025, 8:58:41 PM:** `Product.jsx` begins dynamically rendering multiple product cards using a `map` function.
*   **12/2/2025, 9:23:15 PM - 9:26:51 PM:** `Product.jsx` progressively integrates dynamic data (brand, rating, price, title, thumbnail) from the fetched products into the UI.
*   **12/2/2025, 9:27:40 PM - 9:29:18 PM:** `App.css` implements and refines a responsive CSS Grid layout for the product display.

**Patterns and Recurring Elements:**

*   **Redux Toolkit for State Management:** Consistent use of `createAsyncThunk` for asynchronous operations and `createSlice` for defining state and reducers, demonstrating a modern Redux approach.
*   **React Hooks for Component Logic:** `useDispatch`, `useSelector`, and `useEffect` are fundamental to the `Product.jsx` component, handling data fetching and state access.
*   **Iterative Development:** The log shows a clear pattern of incremental development and refinement:
    *   First, setting up Redux store and slices.
    *   Then, creating a React component to interact with Redux.
    *   Next, moving from static UI to dynamic rendering based on fetched data.
    *   Finally, adding detailed data display and refining layout with CSS.
*   **API Integration:** The application consistently fetches product data from `https://dummyjson.com/products`.
*   **Product Card Component:** A "product-card" UI element is a central feature, undergoing continuous enhancements in both its React JSX structure and CSS styling.
*   **Styling Refinements:** CSS changes frequently adjust layout properties (`display`, `grid-template-columns`) and spacing (`padding`) to achieve the desired visual presentation of product cards.

## 9:25:53 AM
The changes primarily involve modifications to several React components within the `t360-frontend` application, specifically related to booking and House Bill of Lading (HBL) forms, as well as updates to the Redux Toolkit Query API for HBL operations.

### File-Specific Updates:

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\components\screen\booking\hbl\HblPoForm.jsx`**:
    *   **Timestamp:** Multiple changes between 12/3/2025, 12:25:57 PM and 12/3/2025, 3:49:19 PM.
    *   **Updates:**
        *   Initial changes renamed the default export function from `PODetailsExtend` to `HblPODetails`.
        *   The `formik` prop was consistently changed to `values` in the function signature and its usage throughout the component (e.g., `formik.values.client_name` became `values.client_name` and then `formik={values}` was passed to sub-components).
        *   A `console.log` statement for `values` was added for debugging (`"values===90"` and `"values===901234"`).
        *   **Significant Change (12/3/2025, 3:25:22 PM):** The `BasicPoExtend` component within `TabPanel value="1"` was replaced with `BasicPoForHbl`. This indicates a new, HBL-specific basic PO form component was introduced.
        *   **Significant Change (12/3/2025, 3:49:19 PM):** The `useEffect` dependency for setting `tabValue` was changed from `values.client_name` to `values.basicPoList`, and the condition to set `tabValue` to '2' (Linked PO) was updated to check `values.basicPoList?.[0]?.customer === 'SP RICHARDS COMPANY'`. This suggests that the logic for displaying basic or linked POs now depends on the customer name found in the first item of the `basicPoList`.

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\components\screen\booking\form\sub-components\BasicPoExtend.jsx`**:
    *   **Timestamp:** 12/3/2025, 12:33:44 PM and 12/3/2025, 3:24:24 PM.
    *   **Updates:** This file appears to have been copied or served as a base for `BasicPoForHbl.jsx`. The content remains largely the same, but the `formik` prop in the `BasicPoExtend` function was consistently used, and Redux actions (`addList`, `removeList`, `updateList`) were dispatched to manage a `basicPoList` in the Redux store. There's an `ApiManager.getCommonOptions` call for fetching supplier options.

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\components\screen\booking\hbl\HBLform.jsx`**:
    *   **Timestamp:** Numerous changes between 12/3/2025, 12:26:33 PM and 12/3/2025, 2:53:46 PM (with multiple intermediate console.logs and minor logic adjustments).
    *   **Updates:**
        *   Initial addition of the `HBLForm` component, integrating various sub-forms and Redux state management.
        *   The `agent_booking_id` in `initialValues` saw multiple small adjustments to its fallback logic for `formAction === "copy"` or `formAction === "add"`.
        *   **Significant Change (12/3/2025, 2:37:43 PM):** Introduction of `useFetchHblBookingFormDetailsQuery` from `agentBookingApi` to fetch `poDetails` based on `serial_id` for "edit" actions, but this was quickly changed.
        *   **Significant Change (12/3/2025, 2:40:01 PM):** `useFetchPoFormDetailsQuery` was introduced to fetch `poDetails` using `location.state?.agent_booking_id`, replacing the previous query for `HblBookingFormDetails`. The `skipToken` from `@reduxjs/toolkit/query` was imported and used.
        *   **Significant Change (12/3/2025, 2:42:38 PM):** The `basicPoList` in `initialValues` was updated to prioritize `poDetails?.data?.basicPoList` if available, otherwise falling back to `initialValues?.basicPoList`, and if neither exists, using an empty array.
        *   **Significant Change (12/3/2025, 2:49:44 PM):** The `basicPoList` initialization logic was further refined, removing a redundant fallback to `poDetails.data.basicPoList` at the end of the conditional chain.
        *   **Significant Change (12/3/2025, 4:56:44 PM):** `linkedPoList` was added to the `initialValues`, also prioritizing `poDetails?.data?.linkedPoList` or falling back to an empty array.

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\components\screen\booking\hbl\HBLListDetails.jsx`**:
    *   **Timestamp:** 12/3/2025, 1:43:57 PM and 12/3/2025, 1:54:42 PM.
    *   **Updates:**
        *   The "Add HBL" button's `onClick` handler was modified. Initially, when navigating to `/app/booking/hbl_form`, it passed `formAction: "copy"`.
        *   **Significant Change (12/3/2025, 1:54:42 PM):** The "Add HBL" button's `formAction` was changed to `"add"`, indicating a shift to explicitly create a new HBL instead of copying one by default when navigating from the list.

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\components\screen\booking\hbl\HblHeaderForms.jsx`**:
    *   **Timestamp:** 12/3/2025, 1:42:46 PM to 12/3/2025, 1:51:28 PM.
    *   **Updates:** A minor change in the `InputBox` component for "Agent Booking #" on `12/3/2025, 1:51:28 PM` where `onChange={onChange}` was corrected to `onChange={handleChange}`. Other changes were consistent console logs and structural elements.

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\store\api\agentBookingApi.js`**:
    *   **Timestamp:** 12/3/2025, 2:38:52 PM.
    *   **Updates:**
        *   A new tag type `"hbl"` was added.
        *   Three new endpoints related to HBL were added:
            *   `saveHblBooking`: a mutation for creating HBL entries, invalidating the `"hbl"` tag.
            *   `fetchHblBookingFormDetails`: a query to get HBL form details, providing the `"hbl"` tag. (This was later changed to `fetchPoFormDetails` in `HBLForm.jsx`).
            *   `fetchPoFormDetails`: a new query to fetch PO details specifically for HBL entries, also providing the `"hbl"` tag. This endpoint was integrated into `HBLForm.jsx` shortly after its creation.
            *   `updateHblBooking`: a mutation for updating HBL entries, invalidating the `"hbl"` tag.
            *   `deleteHblBooking`: a mutation for deleting HBL entries, also invalidating the `"hbl"` tag.
        *   The exported hooks were updated to include the newly added HBL-related mutations and queries.

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\components\screen\booking\hbl\BasicPoForHbl.jsx`**:
    *   **Timestamp:** 12/3/2025, 3:25:02 PM to 12/3/2025, 3:37:58 PM.
    *   **Updates:** This new component was introduced. It appears to be a specialized version of `BasicPoExtend` for HBL forms.
    *   Initially, it included Redux actions (`addList`, `removeList`, `updateList`) and `ApiManager` calls, mirroring `BasicPoExtend.jsx`.
    *   **Significant Change (12/3/2025, 3:27:50 PM):** The `addRow` and `deleteRow` functionality, along with their corresponding `IconButton` elements, were commented out, removing the ability to dynamically add/remove PO rows directly from this component. All `onChange` handlers for input fields were also commented out, making the form fields read-only or managed externally.
    *   **Significant Change (12/3/2025, 3:29:13 PM):** The component started mapping `formik?.basicPoList` directly for rendering the rows instead of `selector` (which was `state.agentBookingForm.basicPoList`). This implies the data for basic POs is now passed directly via props from `HblPoForm.jsx` rather than being managed by `BasicPoForHbl` via Redux `useSelector`.
    *   Minor layout adjustments (e.g., `lg={1}` to `lg={1} md={6} sm={8}` for PO No field).

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\components\screen\booking\form_extend\CargoFormExtend.jsx`**:
    *   **Timestamp:** Multiple logs between 12/3/2025, 4:58:45 PM and 12/3/2025, 5:12:12 PM.
    *   **Updates:** No functional changes were observed in these logs; they appear to be identical saves, possibly due to formatting or minor unnoticed changes. The component manages a list of cargo items with add/edit/delete functionality using Redux actions and a modal form.

### Patterns and Recurring Elements:

*   **Refactoring to Props-Based Data Flow:** A strong pattern is the shift from components directly selecting data from the Redux store (e.g., `BasicPoExtend`'s `selector`) to receiving data via props (e.g., `BasicPoForHbl` now mapping `formik?.basicPoList`). This suggests a move towards more controlled data flow, where a parent component (`HBLForm`) fetches and manages the overall form state (including `basicPoList` and `linkedPoList`) and passes relevant slices down to child components.
*   **Redux Toolkit Query Integration:** The `agentBookingApi.js` file shows consistent use of `createApi`, `fetchBaseQuery`, `builder.mutation`, and `builder.query` for API interactions, along with `invalidatesTags` and `providesTags` for cache management. The `skipToken` is also utilized to conditionally execute queries.
*   **Form Management with Formik:** `Formik` is extensively used across `HBLForm.jsx` for managing form state, validation, and submission, with `enableReinitialize` being a key prop.
*   **UI Components:** Consistent use of Material-UI components like `Grid`, `Stack`, `Box`, `Card`, `TabContext`, `TabList`, `TabPanel`, `InputBox`, `SelectBox`, `AppDatePicker`, `AppAutocomplete`, `ThemeTabs`, and custom buttons/icons (`CustomDeleteIcon`, `CustomEditIcon`, `AddCircleOutlined`).
*   **Keyboard Shortcuts:** `useKeyboardShortcut` hook is consistently applied in `HBLForm.jsx` for various actions (edit/view/add party, save, focus party tab), indicating an emphasis on keyboard navigability.
*   **Debugging Console Logs:** Frequent `console.log` statements with descriptive strings (e.g., `"values===890"`, `"locatioppppp"`, `"poDetails===890"`, `"hkkllll90000"`) are present across multiple files, indicating active development and debugging.
*   **Error Handling and User Feedback:** Toast notifications (`react-hot-toast`) and an `alertConfig` state for displaying error popups are consistently used after API calls to inform the user about the success or failure of operations.
*   **Party Management:** The `HBLForm.jsx` contains dedicated sections for "HBL Parties" with buttons to "Edit Party", "View Parties", and "Add New Parties", along with Redux dispatches (`setIsfTab`, `setCurrentTabPartyCode`, `setPartyType`) for party-related state management.

## 11:56:28 AM
The log details changes across several JavaScript files within a `t360-frontend` project, primarily related to booking forms, especially for House Bill of Lading (HBL) and Purchase Order (PO) details.

### File-Specific Updates:

#### `c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\components\screen\booking\hbl\HblPoForm.jsx`
*   **12/3/2025, 12:25:57 PM:** The component `PODetailsExtend` is introduced. It manages two tabs: "Basic PO" and "Linked PO", with the active tab defaulting to "1" (Basic PO) unless `formik.values.client_name` is 'SP RICHARDS COMPANY', in which case it switches to "2" (Linked PO).
*   **12/3/2025, 12:26:15 PM:** The component name is changed from `PODetailsExtend` to `HblPODetails`. The functionality remains the same.
*   **12/3/2025, 12:27:09 PM:** The `HblPODetails` component's prop `formik` is renamed to `values`. The `BasicPoExtend` and `LinkPoExtend` components now receive `values` directly as their `formik` prop.
*   **12/3/2025, 1:01:38 PM:** A `console.log` statement is added to `HblPODetails` to debug `values`.
*   **12/3/2025, 3:23:41 PM:** Another `console.log` statement is added to `HblPODetails` (`values===901234`).
*   **12/3/2025, 3:25:22 PM:** The `BasicPoExtend` component within `TabPanel` value "1" is replaced with a new component, `BasicPoForHbl`, indicating a specialization of the basic PO form for HBL.
*   **12/3/2025, 3:49:19 PM:** The `useEffect` dependency for tab switching in `HblPODetails` is updated from `values.client_name` to `values.basicPoList`. The logic now checks `values.basicPoList?.[0]?.customer` to determine if the client is 'SP RICHARDS COMPANY', then switches tabs accordingly. This suggests a change in how the client name is stored or accessed for this functionality.

#### `c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\components\screen\booking\hbl\HBLform.jsx`
*   **12/3/2025, 12:26:33 PM:** This is a substantial update for the `HBLForm` component. It involves:
    *   Importing `HblPODetails` and other HBL-specific forms (`HblContainerDetailsForm`, `HblRoutingForm`, `HblHeaderForms`, `ConsigneeFormForHbl`).
    *   Integrating Redux hooks (`useDispatch`, `useSelector`) for managing routing, container, and basic PO lists.
    *   Introducing `useSaveHblBookingMutation` and `useUpdateHblBookingMutation` for API interactions, signifying new save/update functionality for HBL bookings.
    *   Implementing `handleSave` logic which processes form values, transforms them into a payload, and dispatches either save or update mutations based on `formAction`. It includes error handling and navigation on success.
    *   Adding keyboard shortcuts (`ctrl+u`, `ctrl+d`, `ctrl+a`, `ctrl+s`, `ctrl+p`) for various form actions (Edit Party, View Parties, Add New Party, Save, Focus Party Ref).
    *   Updating `Formik`'s `initialValues` to include many HBL-specific fields, handling cases for "copy" actions, and setting default values.
    *   Refining the `ThemeTabs`' `onChange` handler to dispatch Redux actions (`setIsfTab`, `setCurrentTabPartyCode`, `setPartyType`) for party-related tabs.
*   **12/3/2025, 1:38:27 PM:** No significant functional changes; likely reformatting or minor console log adjustments.
*   **12/3/2025, 1:39:29 PM:** Modified the `agent_booking_id` initial value logic within `Formik` to handle `formAction === "copy" && formAction === "add"` more specifically.
*   **12/3/2025, 1:39:38 PM:** Further adjustment to the `agent_booking_id` initial value logic: `formAction === "copy" || formAction === "add"`.
*   **12/3/2025, 1:41:10 PM:** Minor update to `agent_booking_id` initial value logic: `initialValues?.agent_booking_id || location.state.agent_booking_id ? initialValues?.agent_booking_id || location.state.agent_booking_id : ""`.
*   **12/3/2025, 1:41:58 PM:** Simplified `agent_booking_id` initial value to `initialValues?.agent_booking_id || location.state?.agent_booking_id || ""`.
*   **12/3/2025, 1:46:11 PM:** Changed `enableReinitialize` condition in `Formik` from `formAction !== "add"` to `formAction == "add"`. This change likely affects when the form reinitializes with new `initialValues`.
*   **12/3/2025, 1:46:25 PM:** Reverted `enableReinitialize` condition in `Formik` back to `formAction !== "add"`.
*   **12/3/2025, 1:46:51 PM:** Removed the `HblPODetails` import. This likely means the `HblPODetails` component is no longer directly rendered in `HBLForm`, but perhaps in one of its sub-components or a different tab.
*   **12/3/2025, 1:47:04 PM:** Re-added the `HblPODetails` import, indicating it is still used.
*   **12/3/2025, 1:47:28 PM:** Added a `console.log` for `values` within the `Formik` render prop.
*   **12/3/2025, 1:50:15 PM:** Minor cosmetic changes, likely just re-saving the file.
*   **12/3/2025, 1:53:39 PM:** The `booking_no` initial value logic within `Formik` is adjusted to prioritize `location.state?.agent_booking_id` for "copy" actions, otherwise falling back to `initialValues?.agent_booking_id`.
*   **12/3/2025, 1:54:00 PM:** The `booking_no` initial value logic is refined to handle cases where `formAction` is "copy".
*   **12/3/2025, 1:55:33 PM:** Further refinement of `booking_no` initial value logic, specifically for "copy" action.
*   **12/3/2025, 1:55:49 PM:** More small adjustments to the `booking_no` initial value.
*   **12/3/2025, 2:37:43 PM:** Introduced `useFetchHblBookingFormDetailsQuery` and `skipToken` from RTK Query, suggesting a new API call to fetch HBL booking form details conditionally based on `isEdit` and `state?.serial_id`. The fetched `poDetails` are logged.
*   **12/3/2025, 2:40:01 PM:** Changed `useFetchHblBookingFormDetailsQuery` to `useFetchPoFormDetailsQuery` and updated its parameter to `location.state?.agent_booking_id`.
*   **12/3/2025, 2:42:38 PM:** The `basicPoList` initial value within `Formik` is updated to conditionally use `poDetails?.data?.basicPoList` if available, otherwise `initialValues?.basicPoList`.
*   **12/3/2025, 2:42:43 PM:** No significant functional change.
*   **12/3/2025, 2:45:01 PM:** Refined `basicPoList` initial value logic to handle cases where `poDetails.data.basicPoList` or `initialValues.basicPoList` might be empty, ensuring an empty array as a fallback.
*   **12/3/2025, 2:47:05 PM:** No significant functional change.
*   **12/3/2025, 2:47:49 PM:** No significant functional change.
*   **12/3/2025, 2:49:21 PM:** Corrected `poDetails` destructuring from `const { data: poDetails, ... }` to `const { poDetails, ... }` to directly access `poDetails` from the query result.
*   **12/3/2025, 2:49:44 PM:** Commented out the `basicPoList` initialization logic, effectively removing it. This suggests a temporary or reconsidered change in how `basicPoList` is sourced.
*   **12/3/2025, 2:52:22 PM:** Reinstated the `basicPoList` initialization logic, similar to before but without the `initialValues` fallback.
*   **12/3/2025, 2:53:46 PM:** Refined the `basicPoList` initial value logic to prioritize `poDetails?.data?.basicPoList` and then `initialValues?.basicPoList`.
*   **12/3/2025, 4:56:44 PM:** Added `linkedPoList:poDetails?.data?.linkedPoList || []` to the initial values, suggesting that linked PO details are now being fetched and managed.

#### `c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\components\screen\booking\hbl\HblHeaderForms.jsx`
*   **12/3/2025, 1:42:46 PM:** The `HblHeaderForms` component is introduced.
    *   It imports `AddVesselForm` and adds an "Add Vessel" button with a `ctrl+x` shortcut to open a modal.
    *   It defines options for `transportaion_mode` and `move_type`.
    *   Includes a `useEffect` hook to fetch `clientOptions` using `ApiManager.getAutocomplete("booking_customer")`.
    *   `handleOptionChange` is implemented to fetch options for fields like `vessel`, `por`, `pol`, `pod`, `fpd`.
    *   The form renders various input fields, date pickers, select boxes, and autocompletes for HBL details (e.g., Booking #, HBL No, Ports, Vessel, Voyage).
*   **12/3/2025, 1:51:14 PM:** Changed `onChange` to `handleChange` for `booking_no` InputBox.
*   **12/3/2025, 1:51:28 PM:** Reverted `handleChange` back to `onchange` for `booking_no` InputBox (likely a typo or test).

#### `c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\components\screen\booking\hbl\HBLListDetails.jsx`
*   **12/3/2025, 1:43:57 PM:** This file defines the `HblListDetails` component for displaying a list of HBLs.
    *   It uses `useGetHblDashboardQuery` to fetch HBL data.
    *   Includes functionality to delete an HBL using `useDeleteHblBookingMutation`.
    *   Renders a `ThemedGrid` to display HBL data with custom columns (`HBL_COLUMNS`).
    *   Provides buttons for "HBL Audit" (opening a drawer) and "Add HBL" (navigating to the HBL form).
    *   Manages pagination state using Redux (`setPagination`).
*   **12/3/2025, 1:54:42 PM:** Changed the `formAction` from "copy" to "add" when navigating to the HBL form for adding a new HBL.

#### `c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\store\api\agentBookingApi.js`
*   **12/3/2025, 2:38:52 PM:** A new endpoint `fetchPoFormDetails` is added to the `agentBookingApi` using `builder.query`. This endpoint fetches PO details for HBL entries, specifically `url: /hblEntry/get-po-details`. It `providesTags` for `hbl`. This directly relates to the changes in `HBLform.jsx` where `useFetchPoFormDetailsQuery` was introduced.

#### `c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\components\screen\booking\form\sub-components\BasicPoExtend.jsx`
*   **12/3/2025, 12:33:44 PM:** This component manages a list of basic PO items, allowing users to add, delete, and update rows.
    *   Uses Redux (`useDispatch`, `useSelector`) to interact with `basicPoList` in the `agentBookingForm` slice.
    *   Fields include PO No, PO Date, No of Packages, Total Qty, Total Weight, Weight Unit, Total Volume, and Supplier Name.
    *   Supplier name uses `AppAutocompleteExtend` and fetches options via `ApiManager.getCommonOptions("booking-shipper")`.
    *   Includes `AddCircleOutlined` and `CustomDeleteIcon` for row manipulation.
*   **12/3/2025, 3:24:24 PM:** No functional changes, likely reformatting or re-saving.

#### `c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\components\screen\booking\hbl\BasicPoForHbl.jsx`
*   **12/3/2025, 3:25:02 PM:** This new file is created, seemingly a duplicate of `BasicPoExtend.jsx`. It includes Redux logic for adding, removing, and updating `basicPoList` items.
*   **12/3/2025, 3:27:29 PM:** Most `onChange` and `handleOptionChange` props are commented out or removed, suggesting this component is currently intended for display/read-only purposes rather than direct editing within its own scope, relying on data passed via `formik`. The `IconButton` for add/delete rows is also commented out.
*   **12/3/2025, 3:27:50 PM:** No functional changes.
*   **12/3/2025, 3:28:41 PM:** Added a `console.log` for `formik` props.
*   **12/3/2025, 3:29:13 PM:** The component now maps over `formik?.basicPoList` instead of the Redux `selector` directly for rendering rows. This aligns with the `HblPoForm.jsx` change of passing `values` as `formik` prop.
*   **12/3/2025, 3:30:11 PM:** Added optional chaining (`?.`) to `formik?.basicPoList?.map`.
*   **12/3/2025, 3:37:22 PM:** Adjusted grid item `lg` values for "PO No" (from 1 to 6), implying a layout change.
*   **12/3/2025, 3:37:58 PM:** Removed `IconButton` imports (`CustomDeleteIcon`, `AddCircleOutlined`) as the buttons themselves were commented out.

#### `c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\components\screen\booking\form_extend\CargoFormExtend.jsx`
*   **12/3/2025, 4:58:45 PM:** This component manages cargo details in a table.
    *   Uses `AppTable` to display data.
    *   Integrates Redux for `cargoList` management (`addList`, `updateList`, `removeList`).
    *   Includes `ThemedModalExtend` for adding/editing cargo items via `AddCargoFormExtend`.
    *   Table columns include actions for editing and deleting cargo items.
*   **12/3/2025, 4:59:42 PM - 12/4/2025, 11:24:37 AM:** Multiple timestamps show no functional changes, likely just re-saving the file.

### Patterns and Recurring Elements:

1.  **Redux for State Management:** All major components (`HblPoForm`, `HBLForm`, `BasicPoExtend`, `BasicPoForHbl`, `CargoFormExtend`, `HBLListDetails`) heavily rely on Redux (`useDispatch`, `useSelector`) for managing application state, particularly lists of POs, containers, routing, and cargo.
2.  **Formik for Form Handling:** `HBLForm` uses `Formik` for managing form state, validation (`HBLvalidationSchema`), and submission.
3.  **API Integration with RTK Query:** The `agentBookingApi.js` file and its usage in `HBLForm` and `HBLListDetails` demonstrate the use of RTK Query for efficient data fetching, caching, and mutation (e.g., `useSaveHblBookingMutation`, `useUpdateHblBookingMutation`, `useDeleteHblBookingMutation`, `useFetchPoFormDetailsQuery`).
4.  **Conditional Rendering/Logic:**
    *   Tab switching based on `client_name` or `basicPoList[0].customer` in `HblPoForm.jsx`.
    *   Conditional fetching of `poDetails` using `skipToken` in `HBLForm.jsx`.
    *   Conditional `enableReinitialize` in `Formik` based on `formAction` in `HBLForm.jsx`.
    *   Conditional rendering of `ThemedModal` for adding/editing in `CargoFormExtend`.
5.  **Reusable UI Components:** Consistent use of custom common UI components like `InputBox`, `SelectBox`, `AppDatePicker`, `AppAutocomplete`, `ThemeTabs`, `ThemeButton`, `OutlinedButton`, `ThemedModal`, `AppTable`, `ScreenToolbar`, `ThemedBreadcrumb`, `ReusableRightDrawer`.
6.  **Keyboard Shortcuts:** `HBLForm` implements keyboard shortcuts for common actions, improving user experience.
7.  **Console Logging:** Frequent use of `console.log` for debugging, especially to inspect `values`, `poDetails`, and `location` state, indicates ongoing development and debugging.
8.  **Form Data Structure:** Many fields are recovered by splitting strings (e.g., `value.split("~")[0]`) for combined ID/Name fields, suggesting a pattern for handling linked data.
9.  **Date Formatting/Handling:** `AppDatePicker` is used across forms, suggesting standardized date input.
10. **Error Handling and Toasts:** `toast.success` and `toast.error` (from `react-hot-toast`) are used for user feedback, and `ValidationErrorsPopup` for displaying form validation errors. `setAlertConfig` is used for more general error alerts.

### Overall Narrative:
The changes indicate active development on a booking system's frontend, focusing on the HBL (House Bill of Lading) module. Key themes include:

*   **Refinement of HBL forms:** Improvements in how PO details are handled within HBLs, including fetching existing PO data and potentially specializing basic PO entry for HBL.
*   **Enhanced state management:** Deeper integration of Redux for managing complex form data like lists of POs and cargo, and RTK Query for efficient data fetching and mutation.
*   **Improved user experience:** Addition of keyboard shortcuts and a more dynamic tab switching mechanism.
*   **Modularity:** Creation of specialized sub-components like `BasicPoForHbl` from a more generic `BasicPoExtend`.
*   **Debugging and Stability:** Frequent `console.log` statements suggest an iterative development process involving active debugging, especially around form initialization and data loading from API.
*   **Backend integration:** New API endpoints were added and utilized for fetching PO details associated with HBLs.

## 3:04:15 PM
The provided code changes primarily revolve around forms and state management within a frontend application, specifically related to "House Bill of Lading" (HBL) and Purchase Order (PO) details in a booking system. The application utilizes React with Material-UI components, Formik for form handling, Redux Toolkit for state management, and RTK Query for API interactions.

**File-Specific Updates:**

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\components\screen\booking\hbl\HblPoForm.jsx`**
    *   **Initial (12/3/2025, 12:25:57 PM - 12:26:15 PM):** A component `PODetailsExtend` (later renamed to `HblPODetails`) was created to manage two tabs: "Basic PO" and "Linked PO". It dynamically switches to the "Linked PO" tab (`tabValue='2'`) if the client name is 'SP RICHARDS COMPANY', otherwise defaults to "Basic PO" (`tabValue='1'`).
    *   **Prop Refactoring (12/3/2025, 12:27:09 PM):** The component's main prop was changed from `formik` to `values`, influencing how data is accessed internally.
    *   **Debugging & Component Change (12/3/2025, 1:01:38 PM - 3:25:22 PM):** Minor `console.log` statements were added for debugging. More significantly, the "Basic PO" tab's content component was changed from `BasicPoExtend` to a newly introduced `BasicPoForHbl`.
    *   **Conditional Logic Update (12/3/2025, 3:49:19 PM):** The logic for switching tabs was updated to check the `customer` property of the first item in `values.basicPoList` (e.g., `values.basicPoList?.[0]?.customer`) instead of `values.client_name`. This suggests a shift in where the client information relevant to the PO tab logic is stored.

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\components\screen\booking\hbl\HBLform.jsx`**
    *   **Core Form Development (12/3/2025, 12:26:33 PM):** This is a comprehensive form for HBL entries, integrating various sub-forms (container details, routing, header forms, and PO details). It handles saving and updating HBL bookings using RTK Query, manages party-related actions (edit, view, add new), and includes several keyboard shortcuts for enhanced usability. `initialValues` are extensively defined, pulling data from `initialValues` props and `location.state`.
    *   **Agent Booking ID Handling (12/3/2025, 1:39:29 PM - 1:55:49 PM):** Multiple refinements were made to how `agent_booking_id` and `booking_no` are initialized within `Formik`'s `initialValues`. This involved various conditional checks based on `formAction` (e.g., "copy", "add", "edit") and fallback logic between `initialValues`, `location.state`, and API response data. The final visible change (1:55:49 PM) settled on a complex conditional logic for `booking_no` considering `formAction === "copy"`, `initialValues?.agent_booking_id`, and `location.state?.agent_booking_id`.
    *   **PO Data Integration (12/3/2025, 2:37:43 PM - 4:56:44 PM):**
        *   The form was updated to fetch PO details using `useFetchPoFormDetailsQuery` based on `location.state?.agent_booking_id` (12/3/2025, 2:40:01 PM).
        *   `basicPoList` initialization within `initialValues` was significantly modified to prioritize `poDetails?.data?.basicPoList` from the API, falling back to `initialValues?.basicPoList` if API data is unavailable or empty (multiple refinements between 2:42:38 PM and 2:53:46 PM).
        *   Finally, `linkedPoList` was also added to `initialValues`, sourcing data from `poDetails?.data?.linkedPoList` (12/3/2025, 4:56:44 PM).
    *   **Debugging (12/3/2025, 1:47:28 PM):** A `console.log` for debugging `values` was added within the Formik render prop.

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\store\api\agentBookingApi.js`**
    *   **HBL API Endpoints (12/3/2025, 2:38:52 PM):** New RTK Query endpoints were added for HBL-specific operations:
        *   `fetchPoFormDetails`: Query to get PO details, tagged with "hbl".
        *   `getHblDashboard`: Query to fetch HBL dashboard data, tagged with "HBL".
        *   `updateHblBooking`: Mutation to update HBL bookings, invalidates "hbl" tag.
        *   `deleteHblBooking`: Mutation to delete HBL records.

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\components\screen\booking\hbl\HBLListDetails.jsx`**
    *   **Add HBL Action (12/3/2025, 1:54:42 PM):** The "Add HBL" button's functionality was changed to pass `formAction: "add"` (for creating a new HBL) instead of `formAction: "copy"` (for duplicating an existing HBL). This is a crucial change in user workflow.

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\components\screen\booking\hbl\HblHeaderForms.jsx`**
    *   **Form Field Update (12/3/2025, 1:51:14 PM - 1:51:28 PM):** A minor adjustment and subsequent reversion in how the `onChange` handler for the "Agent Booking #" input box was assigned, indicating fine-tuning of form input interaction.

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\components\screen\booking\form\sub-components\BasicPoExtend.jsx`**
    *   **Prop Change (12/3/2025, 3:24:24 PM):** The component `BasicPoExtend` had its `values` prop renamed to `formik`.

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\components\screen\booking\hbl\BasicPoForHbl.jsx`**
    *   **New Component & Functionality Shift (12/3/2025, 3:25:02 PM):** This component was created, initially as a copy of `BasicPoExtend`.
    *   **Read-Only Transformation (12/3/2025, 3:27:29 PM - 3:37:58 PM):** Its functionality was quickly altered to become a purely display-oriented component. All `onChange` handlers for input fields and all `IconButton`s for adding/deleting rows were commented out or removed, making it read-only. The list data source shifted from Redux state (`selector`) to directly using `formik?.basicPoList` from its props. Grid item sizing was adjusted for responsiveness.

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\components\screen\booking\form_extend\CargoFormExtend.jsx`**
    *   **No Functional Changes (12/3/2025, 4:58:45 PM - 12/4/2025, 11:58:20 AM):** This component, responsible for managing cargo details with add/edit/delete functionality via a modal, remained functionally unchanged across multiple timestamps. All changes were minor saving operations without altering the code structure or logic.

**Patterns and Recurring Elements:**

*   **Focus on HBL and PO Forms:** A clear pattern is the continuous development and refinement of HBL and Purchase Order related forms.
*   **State Management with Redux/RTK Query:** The application heavily relies on Redux for local state (`agentBookingForm` slice for lists like `basicPoList`, `routingList`, `containerList`) and RTK Query for fetching and mutating data from an API (`useSaveHblBookingMutation`, `useUpdateHblBookingMutation`, `useFetchPoFormDetailsQuery`, `useGetHblDashboardQuery`, `useDeleteHblBookingMutation`).
*   **Formik for Form Handling:** Formik is consistently used across complex forms (`HBLForm`) to manage form state, validation, and submission.
*   **Dynamic UI based on Data:** Components like `HblPoForm` demonstrate dynamic tab switching based on client data (`client_name` or `basicPoList[0].customer`).
*   **Component Specialization:** The creation of `BasicPoForHbl` and its subsequent transformation into a read-only component suggests a pattern of creating specialized components for specific data presentation needs within a larger form.
*   **Debugging with `console.log`:** Numerous `console.log` statements with descriptive strings like "values===90", "locatioppppp", "poDetails===890", "kkkkkk89900" indicate active debugging and monitoring of data flow during development.
*   **Keyboard Shortcuts:** `HBLForm` implements several keyboard shortcuts (`ctrl+u`, `ctrl+d`, `ctrl+a`, `ctrl+s`, `ctrl+p`) for common actions, suggesting a focus on efficiency for frequent users.
*   **Initial Value Complexity:** The `initialValues` object in `HBLForm` is particularly complex, pulling data from various sources (`initialValues` prop, `location.state`, and API fetched data like `poDetails?.data`). This complexity reflects handling different form actions (add, edit, copy) and ensuring data persistence and pre-population.

## 4:04:00 PM
The provided log details code changes across several TypeScript files within a `t360-backend` project, primarily focusing on booking and HBL (House Bill of Lading) management, and analytics query generation. A recurring pattern observed is that for many files, the code content remains identical across multiple consecutive timestamps, suggesting repeated saves without functional code alterations.

### File-Specific Updates:

1.  **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-backend\src\controllers\booking.controller.ts`**
    *   **Timestamps:** Multiple entries between 12/3/2025, 12:06:34 PM and 12/3/2025, 12:15:30 PM.
    *   **Key Changes:** This file contains the `saveBooking` and `saveMaster` functions.
        *   `saveBooking`: Handles the creation and updating of agent bookings. It fetches old booking data, constructs a payload from the request body, and conditionally generates a new `booking_id` or uses an existing one. For updates, it deletes associated cargo, container, vessel, PO, and linked PO records before re-inserting them. It also updates `dso_order` for linked POs. Data sanitization (`sanitizeString`, `sanitizeIntString`) and date formatting (`AppDateFormate`) are consistently applied.
        *   `saveMaster`: Validates the `account_type` against a predefined `BookingAtypeEnum` list, returning an error for invalid types.
    *   **Observations:** The content across all timestamps for this file is identical, indicating no functional changes were introduced during these saves.

2.  **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-backend\src\controllers\hblEntry.controller.ts`**
    *   **Timestamps:** Numerous entries between 12/3/2025, 2:04:59 PM and 12/3/2025, 4:16:10 PM.
    *   **Key Changes:** This file defines `createHblMasterBooking` and `updateHblMasterBooking` functions.
        *   `createHblMasterBooking`: Creates a new HBL master entry, linking it to an existing `agent_booking_entry`. It inserts data into `hbl_master`, `agent_booking_vessel`, `agent_booking_hbl`, `agent_booking_routing`, `agent_booking_container`, and `agent_booking_po` tables. It includes audit logging for new HBL creations.
        *   `updateHblMasterBooking`: Updates existing HBL master details, vessel/voyage information, and HBL specific data. It requires a `serial_id` for the update. Audit logging is also integrated for `hbl_master` updates.
    *   **Observations:** Similar to `booking.controller.ts`, the code content for `hblEntry.controller.ts` is identical across all its recorded timestamps, suggesting repeated saving without functional changes.

3.  **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-backend\src\routes\hblEntry.route.ts`**
    *   **Timestamp:** 12/3/2025, 2:36:19 PM.
    *   **Key Changes:** This file defines the API routes for HBL entry. It includes routes for fetching HBL form details (`/`), getting specific HBL records (`/get-hbl`), creating (`/create`), updating (`/update`), deleting (`/delete`), and fetching PO details (`/get-po-details`). The delete route is protected by `authMiddleware`.
    *   **Observations:** This file appears only once, indicating its structure remained consistent throughout the log period.

4.  **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-backend\src\controllers\analytics\query\booking.query.ts`**
    *   **Timestamps:** Multiple entries between 12/4/2025, 11:59:53 AM and 12/4/2025, 3:35:27 PM.
    *   **Key Changes:** The `bookingQueryBuilder` function constructs complex SQL queries for various booking-related analytics reports, such as "Booking Date to Actual Departure" (container-wise, MBL-wise, and stacked bar versions). These queries join `mtr_tracking_data` and `agent_booking_entry` tables, filter by `account_name` and date ranges, and perform date difference calculations (`EXTRACT(DAY FROM ... - ...)`) to determine durations. They handle `NULL` or '0001-01-01 00:00:00 BC' date values.
    *   **Observations:** All recorded states for this file are identical, implying no actual code changes.

5.  **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-backend\src\controllers\analytics\others.controller.ts`**
    *   **Timestamp:** 12/4/2025, 12:02:39 PM.
    *   **Key Changes:** The `getTableDataReports` function acts as a central handler for various analytics reports. It dynamically builds SQL queries by dispatching to specific query builders (`chassisQueryBuilder`, `bookingQueryBuilder`, `containerQueryBuilder`, `departureQueryBuilder`, `generalQueryBuilder`) based on the `type` parameter in the request. It retrieves `CompanyName` and `user_id` from the authenticated request and constructs a `customizer` object to configure report display.
    *   **Observations:** This file appears only once.

6.  **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-backend\src\controllers\analytics\query\export.query.ts`**
    *   **Timestamps:** Two entries at 12/4/2025, 3:39:54 PM and 12/4/2025, 3:40:05 PM.
    *   **Key Changes:** Contains a `getMonthValue` helper function for converting month names/numbers to numeric month values, and a `bookingQuery` object that stores SQL query fragments specifically tailored for exporting data for various booking-related reports. These queries include conditional logic based on `stackedExport`, `displayBy` (month, week, quarter), and `stackedGroup` to refine the output for export.
    *   **Observations:** The content is identical across both timestamps, indicating no actual code changes.

### General Patterns and Recurring Elements:

*   **Frequent Saves:** The most prominent pattern is the repeated saving of files within short periods (minutes to a few hours) without any actual functional code changes shown in the diff. This could be due to IDE auto-saves, minor non-functional changes (like whitespace), or an artifact of the logging mechanism.
*   **Database Interactions:** All controller and query builder files heavily rely on database operations (`insertMany`, `insertQuery`, `query`, `updateQuery`). Transaction management using `BEGIN`, `COMMIT`, and `ROLLBACK` is present, though `COMMIT`/`ROLLBACK` are commented out in `booking.controller.ts`.
*   **Data Sanitization and Formatting:** Functions like `sanitizeString`, `sanitizeIntString`, and `AppDateFormate` are widely used to ensure data consistency and prevent potential injection issues before interacting with the database.
*   **Role-Based Logic:** User roles (`req.user.role`) are used to determine user location or company name, especially for agent-specific data, implying a multi-role system.
*   **Analytics Focus:** A significant portion of the changes revolves around creating and managing complex SQL queries for various analytics reports related to booking and tracking data, focusing on calculating time differences between different stages of a shipment.
*   **Error Handling:** `try...catch` blocks are consistently used in asynchronous functions to handle errors, typically rolling back database transactions and returning a 500 "Internal Server Error" response.
*   **Logger Usage:** `logger.info` and `logger.error` are used throughout the controllers and query builders for debugging and operational monitoring.
*   **Common Table Expressions (CTEs):** SQL queries in analytics often use `WITH t AS (...)` to structure complex queries, particularly for calculating averages and percentages, and for categorizing data into groups like "Less than 1 week", "1 - 2 weeks", etc.
*   **Date Handling in Queries:** SQL queries frequently cast strings to `::timestamp` and use `EXTRACT(DAY FROM ...)` to calculate day differences. They also contain explicit checks for invalid date values like `!= '0001-01-01 00:00:00 BC'` and `IS NOT NULL`.
*   **MBL (Master Bill of Lading) Focus:** Many analytics reports and query segments specifically focus on `mblno` (Master Bill of Lading Number) for grouping and filtering data.

## 4:04:06 PM
The following is a summary of the code changes:

### File-specific Updates:

**c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\components\screen\booking\hbl\HblPoForm.jsx**
*   **12/3/2025, 12:25:57 PM:** The component `PODetailsExtend` is defined, handling tab switching between "Basic PO" and "Linked PO" based on `formik.values.client_name`. If `client_name` is 'SP RICHARDS COMPANY', it defaults to "Linked PO" (tab 2), otherwise to "Basic PO" (tab 1).
*   **12/3/2025, 12:26:15 PM:** The component name is changed from `PODetailsExtend` to `HblPODetails`. The functionality remains identical.
*   **12/3/2025, 12:27:09 PM:** The `formik` prop is renamed to `values` in the `HblPODetails` component signature and its usage within the `useEffect` and props passed to `BasicPoExtend` and `LinkPoExtend`. The logic remains the same.
*   **12/3/2025, 1:01:38 PM:** A `console.log(values, "values===90");` statement is added at the beginning of the `HblPODetails` component for debugging purposes.
*   **12/3/2025, 3:23:41 PM:** The debugging log message is updated to `console.log(values, "values===901234");`.
*   **12/3/2025, 3:25:22 PM:** The `BasicPoExtend` component import and usage within `TabPanel value="1"` is replaced with `BasicPoForHbl`. This indicates a refactoring to use a specialized PO component for HBLs.
*   **12/3/2025, 3:49:19 PM:** The `useEffect` dependency for setting `tabValue` is changed from `values.client_name` to `values.basicPoList`. The logic now checks the `customer` property of the first item in `values.basicPoList` to determine the initial tab ('SP RICHARDS COMPANY' for "Linked PO", otherwise "Basic PO").

**c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\components\screen\booking\hbl\HBLform.jsx**
*   **12/3/2025, 12:26:33 PM:** A substantial update to the `HBLForm` component. Key changes include:
    *   Added `useSaveHblBookingMutation` and `useUpdateHblBookingMutation` from `agentBookingApi` for API interactions.
    *   Initial form values are expanded to include various booking details like `ship_name`, `notify_name`, `cnee_name`, `pol`, `pod`, `por`, `fpd`, `hbldate`, `hblno`, `vessel`, `voyage`, `marks`, `description`, `blno`, `booking_no_line`, `transportaion_mode`, `booking_no`, `bookingdate`, and `client_name`.
    *   The `handleSave` function is implemented to prepare a payload by recovering values from combined strings (e.g., "name~code") and then calling either `saveBooking` or `updateHblBooking` based on `location.state.formAction`.
    *   Error handling for API responses (status 400 or 500) is added with an `alertConfig` state.
    *   Success navigation is added to redirect to `/app/booking/hbl_form_screen` with updated `agent_booking_id` and `serial_id`.
    *   Several `useKeyboardShortcut` hooks are implemented for common actions like 'Edit Party' (`ctrl+u`), 'View Parties' (`ctrl+d`), 'Add New Parties' (`ctrl+a`), 'Save' (`ctrl+s`), and 'Focus Party' (`ctrl+p`).
    *   The `ThemeTabs` component for "HBL Parties" now dispatches Redux actions (`setIsfTab`, `setCurrentTabPartyCode`, `setPartyType`) when changing tabs to manage party-related state.
*   **12/3/2025, 1:38:27 PM:** Minor adjustment to initial values: `agent_booking_id` for "copy" action is explicitly set to an empty string. `location.state.agent_booking_id` is added as a fallback for `agent_booking_id`.
*   **12/3/2025, 1:39:29 PM:** The `agent_booking_id` initial value logic is updated for "copy" and "add" actions to ensure it's empty in those cases. Specifically, `formAction === "copy" && formAction === "add"` is used, which logically simplifies to `false`.
*   **12/3/2025, 1:39:38 PM:** The `agent_booking_id` initial value logic is corrected to `formAction === "copy" || formAction === "add" ? ""` which ensures it's empty for both "copy" and "add" form actions.
*   **12/3/2025, 1:41:10 PM:** The `booking_no` initial value for "copy" action is now `initialValues?.agent_booking_id || location.state.agent_booking_id`. The previous `initialValues?.agent_booking_id ? initialValues?.agent_booking_id : ""` was removed.
*   **12/3/2025, 1:41:58 PM:** The `booking_no` initial value is further refined to `formAction === "copy" || formAction === "add" ? "" : initialValues?.agent_booking_id || location.state?.agent_booking_id || ""`. This ensures it's empty for 'copy'/'add' and otherwise tries to get it from `initialValues` or `location.state`.
*   **12/3/2025, 1:46:11 PM:** The `enableReinitialize` prop for `Formik` is changed from `formAction !== "add"` to `formAction == "add"`. This likely intends to reinitialize the form only when adding a new HBL.
*   **12/3/2025, 1:46:25 PM:** The `enableReinitialize` prop is reverted to `formAction !== "add"`.
*   **12/3/2025, 1:46:51 PM:** The import `HblPODetails` is removed from the component.
*   **12/3/2025, 1:47:04 PM:** The import `HblPODetails` is re-added. This suggests an accidental deletion and subsequent restoration.
*   **12/3/2025, 1:47:28 PM:** A `console.log(values, "hkkllll90000");` is added inside the `Formik` render prop for debugging `values`.
*   **12/3/2025, 1:50:15 PM:** The `booking_no` initial value logic is updated again. It now explicitly sets `booking_no` to `""` for `formAction === "copy"`, and otherwise defaults to `initialValues?.agent_booking_id || location.state?.agent_booking_id || ""`.
*   **12/3/2025, 1:52:49 PM:** The `booking_no` initial value logic is slightly modified for the "copy" action to be `location.state?.agent_booking_id` if copying, otherwise the existing logic.
*   **12/3/2025, 1:53:39 PM:** A console log for `poDetails` is added, and the `basicPoList` initial value logic is updated to prioritize `poDetails?.data?.basicPoList` if available, then `initialValues?.basicPoList`, and lastly `poDetails?.data?.basicPoList` again (a potential redundancy).
*   **12/3/2025, 1:54:00 PM:** The `booking_no` initial value logic is simplified for "copy" action to only check `location.state?.agent_booking_id`.
*   **12/3/2025, 1:55:33 PM:** The `booking_no` initial value logic is again adjusted for "copy" action to directly use `location.state?.agent_booking_id` and then use `initialValues?.agent_booking_id` as the primary fallback.
*   **12/3/2025, 1:55:49 PM:** Reverted `booking_no` initial value logic for `formAction === "copy"` to be empty string. The conditional for non-copy forms is `initialValues?.agent_booking_id ? initialValues?.agent_booking_id : location.state?.agent_booking_id`.
*   **12/3/2025, 2:37:43 PM:** The `useFetchHblBookingFormDetailsQuery` hook is introduced, conditionally fetching data based on `isEdit` and `state?.serial_id`, using `skipToken` when not in edit mode. This hook is used to retrieve `poDetails`.
*   **12/3/2025, 2:40:01 PM:** The `useFetchHblBookingFormDetailsQuery` is replaced with `useFetchPoFormDetailsQuery`, and it now conditionally fetches `poDetails` based on `location.state?.agent_booking_id`. `skipToken` is used when `agent_booking_id` is not available. A `console.log(poDetails,"poDetails===890");` is added.
*   **12/3/2025, 2:42:38 PM:** The `basicPoList` initial value logic is updated to include a third fallback to `poDetails.data.basicPoList` when both `poDetails?.data?.basicPoList?.length` and `initialValues?.basicPoList?.length` are falsey. This ensures `basicPoList` is populated if `poDetails` provides data, even if empty, or falls back to `initialValues`.
*   **12/3/2025, 2:42:43 PM:** No functional changes, likely a re-save.
*   **12/3/2025, 2:45:01 PM:** The `basicPoList` initial value logic is refined to use `poDetails.data.basicPoList` if it has elements, otherwise `initialValues.basicPoList` if it has elements, and finally an empty array `[]` as a default. This removes the redundant `poDetails.data.basicPoList` as a third fallback.
*   **12/3/2025, 2:47:05 PM:** The `basicPoList` initial value logic is updated again. It now checks if `poDetails.data.basicPoList` has length, then if `initialValues.basicPoList` has length. If neither, it defaults to `[]`. This is essentially the same as the prior change but explicitly uses `> 0` for length checks.
*   **12/3/2025, 2:47:49 PM:** The `basicPoList` initial value logic is slightly modified to include `poDetails.data.basicPoList` as a final fallback if both `poDetails?.data?.basicPoList?.length > 0` and `initialValues?.basicPoList?.length > 0` are false. This appears to be a minor rearrangement without significant functional change from the prior step.
*   **12/3/2025, 2:49:21 PM:** The `poDetails` destructuring is corrected from `{ data: poDetails, ...}` to `{ poDetails, ...}`. The `basicPoList` initial value logic is reverted to a previous state: `poDetails?.data?.basicPoList?.length > 0 ? poDetails.data.basicPoList : initialValues?.basicPoList?.length > 0 ? initialValues.basicPoList : poDetails.data.basicPoList`. This reintroduces the potential issue of `poDetails.data.basicPoList` being used even if empty, if `initialValues.basicPoList` is also empty.
*   **12/3/2025, 2:49:44 PM:** The `basicPoList` initial value logic is commented out (`// basicPoList: ...`) within `initialValues`. This means `basicPoList` will now default to `initialValues?.basicPoList?.length ? initialValues.basicPoList : []` (if `initialValues` provides it) and potentially lose the fetched `poDetails.data.basicPoList` data unless handled elsewhere.
*   **12/3/2025, 2:52:22 PM:** The `basicPoList` initial value logic is reverted to include `poDetails?.data?.basicPoList` as the primary source if available and has length, then `initialValues?.basicPoList` if it has length, and finally `poDetails?.data?.basicPoList` as a fallback (similar to 2:42:38 PM).
*   **12/3/2025, 2:53:46 PM:** The `basicPoList` initial value is further refined: `poDetails?.data?.basicPoList?.length || initialValues?.basicPoList?.length ? poDetails?.data?.basicPoList || initialValues.basicPoList : poDetails?.data?.basicPoList`. This prioritizes `poDetails.data.basicPoList` if it has length OR `initialValues.basicPoList` has length. If neither, it defaults to `poDetails.data.basicPoList` (which could be an empty array if the API returns an empty list).
*   **12/3/2025, 4:56:44 PM:** The `linkedPoList` is added to the `initialValues` for the `Formik` component, fetching its value from `poDetails?.data?.linkedPoList || []`. This indicates the form now supports linked PO details fetched from the API.

**c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\components\screen\booking\hbl\HBLListDetails.jsx**
*   **12/3/2025, 1:43:57 PM:**
    *   Adds `useDeleteHblBookingMutation` for deleting HBLs.
    *   Implements `handleDelete` function with a confirmation and calls `deleteHblForm` mutation on confirmation, followed by `refetch` on success.
    *   Updates `COLUMNS_GRID` to include `handleDelete` function.
    *   The "Add HBL" button's `onClick` navigates to `/app/booking/hbl_form` with `formAction: "copy"`.
*   **12/3/2025, 1:54:42 PM:** The "Add HBL" button's `onClick` is changed to navigate with `formAction: "add"` instead of "copy".

**c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\components\screen\booking\hbl\HblHeaderForms.jsx**
*   **12/3/2025, 1:42:46 PM:**
    *   Adds a "Add Vessel" button in the `CardHeader` that opens a `ThemedModal` with `AddVesselForm`.
    *   Implements `useKeyboardShortcut` for `ctrl+x` to open the "Add Vessel" modal.
    *   The `onChange` handler for `InputBox` with `id="booking_no"` is changed to `onChange={onChange}` from `onChange={handleChange}`.
*   **12/3/2025, 1:51:14 PM:** The `onChange` handler for `InputBox` with `id="booking_no"` is reverted to `onChange={handleChange}`.
*   **12/3/2025, 1:51:28 PM:** The `onChange` handler for `InputBox` with `id="booking_no"` is changed to `onChange={onchange}` (lowercase 'c'). This appears to be a typo.

**c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\components\screen\booking\form\sub-components\BasicPoExtend.jsx**
*   **12/3/2025, 12:33:44 PM:** Initial creation of `BasicPoExtend` component, responsible for rendering and managing a list of basic PO details. It includes functionalities to add, delete, and update rows, handles autocomplete for 'Supplier Name' by calling `ApiManager.getCommonOptions`, and uses Redux (`useDispatch`, `useSelector`) to manage the `basicPoList` state.
*   **12/3/2025, 3:24:24 PM:** No functional changes, likely a re-save.

**c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\store\api\agentBookingApi.js**
*   **12/3/2025, 2:38:52 PM:** Significant additions to the `agentBookingApi` endpoints:
    *   `saveHblBooking`: Mutation to create HBL entries (`/hblEntry/create`). Invalidates `hbl` tag.
    *   `fetchHblBookingFormDetails`: Query to fetch HBL details (`/hblEntry`). Provides `hbl` tag.
    *   `fetchPoFormDetails`: Query to fetch PO details (`/hblEntry/get-po-details`). Provides `hbl` tag.
    *   `getHblDashboard`: Query to fetch HBL dashboard data (`/hblEntry/get-hbl`). Provides `HBL` tag.
    *   `updateHblBooking`: Mutation to update HBL entries (`/hblEntry/update`). Invalidates `hbl` tag.
    *   `deleteHblBooking`: Mutation to delete HBL entries (`/hblEntry/delete`). Invalidates `hbl` tag.
    *   The `HBL` tag is introduced.

**c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\components\screen\booking\hbl\BasicPoForHbl.jsx**
*   **12/3/2025, 3:25:02 PM:** Initial creation of `BasicPoForHbl`, largely copied from `BasicPoExtend`. It also uses Redux to manage `basicPoList` and includes add/remove/update row functionalities. It has local `options` state for supplier autocomplete.
*   **12/3/2025, 3:27:29 PM:** Most `onChange` and `handleOptionChange` props for input and autocomplete fields are commented out, effectively disabling user input and dynamic updates for individual PO fields. The delete/add row buttons are also commented out. The grid item `lg` for 'PO No' is changed from 1 to 6.
*   **12/3/2025, 3:27:50 PM:** The delete/add row `IconButton`s and their wrapping `Grid` item are fully commented out. This means the component is now primarily for displaying `basicPoList` without modification options.
*   **12/3/2025, 3:28:41 PM:** A `console.log(formik, "kkkkkk89900");` is added at the start of the component for debugging.
*   **12/3/2025, 3:29:13 PM:** The `map` function now iterates over `formik?.basicPoList` instead of the Redux `selector` (`state.agentBookingForm.basicPoList`). This means the component directly uses the `basicPoList` passed via props (`formik`) for rendering, rather than the global Redux state for list items.
*   **12/3/2025, 3:30:11 PM:** The map iteration is changed to `formik?.basicPoList?.map` to handle potential null/undefined `basicPoList` gracefully.
*   **12/3/2025, 3:37:22 PM:** The `lg` grid item size for "PO No" is changed from 6 to 1.
*   **12/3/2025, 3:37:58 PM:** The imports for `CustomDeleteIcon` and `AddCircleOutlined` are removed, reinforcing that add/delete functionality is no longer present in this component.

**c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\components\screen\booking\form_extend\CargoFormExtend.jsx**
*   **12/3/2025, 4:58:45 PM - 12/4/2025, 3:21:14 PM:** Multiple log entries show no functional code changes. This component (`CargoFormExtend`) appears stable during this period, managing a list of cargo details with add, edit, and delete functionalities via a modal and Redux state (`cargoList`). It renders an `AppTable` and uses `ThemedModalExtend` for editing/adding cargo.

### Patterns and Recurring Elements:
*   **Redux State Management:** `useDispatch` and `useSelector` are extensively used across multiple components (`HblPoForm.jsx`, `HBLform.jsx`, `BasicPoExtend.jsx`, `HBLListDetails.jsx`, `BasicPoForHbl.jsx`, `CargoFormExtend.jsx`, `agentBookingApi.js`) for managing application state, particularly lists like `routingList`, `containerList`, `basicPoList`, `cargoList`, and for dispatching actions to update them.
*   **Formik for Form Handling:** `Formik` is a recurring pattern in `HBLform.jsx` for managing complex form state, validation (`validationSchema`), and submission.
*   **MUI Components:** Heavy reliance on Material-UI components (`Box`, `Grid`, `Tab`, `Stack`, `Card`, `CardContent`, `CardHeader`, `Typography`, `IconButton`, `Accordion`) for UI layout and styling. `@mui/lab` components (`TabContext`, `TabList`, `TabPanel`) are used for tabbed interfaces.
*   **Custom Reusable Components:** Frequent use of custom components like `InputBoxExtend`, `AppDatePickerExtend`, `SelectBoxExtend`, `AppAutocompleteExtend`, `ThemeTabs`, `OutlinedButton`, `ThemeButton`, `ThemedModal`, `ThemedModalExtend`, `AppTable`, `ScreenToolbar`, `ThemedBreadcrumb`, `CustomDeleteIcon`, `CustomEditIcon` suggesting a well-structured component library.
*   **API Interactions (RTK Query):** The `agentBookingApi.js` file demonstrates the use of `@reduxjs/toolkit/query/react` (RTK Query) for defining API endpoints (`builder.query`, `builder.mutation`), managing data fetching, caching, and invalidation (`providesTags`, `invalidatesTags`).
*   **URL Parameter Handling:** `URLSearchParams` is used to construct query strings for API calls, especially in `agentBookingApi.js` and `HBLListDetails.jsx`.
*   **Debugging Statements:** `console.log` statements with descriptive messages (e.g., "values===90", "locatioppppp", "poDetails===890", "kkkkkk89900") are frequently added for debugging, indicating active development and troubleshooting.
*   **Keyboard Shortcuts:** `useKeyboardShortcut` hook is used in `HBLform.jsx` and `HblHeaderForms.jsx` to implement accessibility and efficiency features for users.
*   **Data Transformation:** The `recoverValue` function (e.g., `value.split("~")[i]`) is used in `HBLform.jsx` to parse combined string values, suggesting a pattern for handling data with concatenated identifiers.
*   **Conditional Rendering/Logic:** Extensive use of conditional rendering and logic (e.g., `if(values.client_name === 'SP RICHARDS COMPANY')`, `formAction === "edit"`, `location.state?.agent_booking_id ? ... : skipToken`) to adapt UI and data flow based on different states and prop values.
*   **PO List Management:** There's a clear pattern of managing "Basic PO" and "Linked PO" details, with `basicPoList` being a central piece of data handled by Redux and passed through components. There's a shift towards using a dedicated `BasicPoForHbl` component which seems to be a display-only version of a PO form.

## 5:32:27 PM
The provided log details changes across multiple JavaScript files within a `t360-frontend` project, primarily related to booking and HBL (House Bill of Lading) forms.

**File-Specific Updates:**

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\components\screen\booking\hbl\HblPoForm.jsx`**
    *   **Timestamp Range:** 12/3/2025, 12:25:57 PM to 12/3/2025, 3:49:19 PM
    *   **Key Changes:**
        *   Initial commits show the component `PODetailsExtend` (later renamed `HblPODetails`) handling two tabs: "Basic PO" and "Linked PO".
        *   The component automatically switches to the "Linked PO" tab (`tabValue='2'`) if `formik.values.client_name` is `'SP RICHARDS COMPANY'`, otherwise defaults to "Basic PO" (`'1'`).
        *   A refactor occurred around 12:27:09 PM, changing the `formik` prop to `values` in `HblPODetails` and passing `values` directly to `BasicPoExtend` and `LinkPoExtend`.
        *   Around 1:01:38 PM, a `console.log(values, "values===90");` was added for debugging.
        *   A significant change at 3:25:22 PM involved importing `BasicPoForHbl` and using it in `TabPanel` for "Basic PO", replacing the original `BasicPoExtend`.
        *   The logic for setting `tabValue` was updated at 3:49:19 PM to check `values.basicPoList?.[0]?.customer` instead of `values.client_name` for "SP RICHARDS COMPANY". This suggests `client_name` might have moved or is derived from the `basicPoList` in the context of PO details.

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\components\screen\booking\hbl\HBLform.jsx`**
    *   **Timestamp Range:** 12/3/2025, 12:26:33 PM to 12/3/2025, 4:56:44 PM
    *   **Key Changes:**
        *   This file represents the main HBL (House Bill of Lading) form, utilizing `Formik` for form management.
        *   It imports `HblPODetails` and other sub-components (`HblContainerDetailsForm`, `HblRoutingForm`, `HblHeaderForms`).
        *   Extensive `initialValues` setup for various fields like shipment details, party names, addresses, and booking information.
        *   The `handleSave` function serializes form `values` into a `payload`, extracting codes from combined name~code strings (e.g., `ship_name` to `ship_name` and `ship_code`). It also includes `routingList`, `containerList`, and `basicPoList` from Redux state.
        *   Logic for `saveBooking` and `updateHblBooking` mutations is present, handling success and error states with toasts and navigation.
        *   Includes keyboard shortcuts for "Edit Party", "View Parties", "Add New Parties", "Save", and focusing on "Party".
        *   Numerous small modifications to `initialValues` expressions, specifically around `agent_booking_id` for "copy" and "add" form actions (e.g., 1:39:29 PM, 1:41:10 PM, 1:46:11 PM, 1:53:39 PM). These changes indicate refinement in how new/copied HBLs inherit or generate booking IDs.
        *   At 2:37:43 PM, `useFetchHblBookingFormDetailsQuery` was added (though later changed to `useFetchPoFormDetailsQuery`) to fetch `poDetails`, demonstrating an effort to pre-populate or manage PO details separately.
        *   Around 2:42:38 PM, the `basicPoList` initialization in `initialValues` was modified to conditionally prioritize `poDetails.data.basicPoList` if available, otherwise falling back to `initialValues.basicPoList`. Similar logic was applied for `linkedPoList` at 4:56:44 PM.
        *   The import for `HblPODetails` was briefly removed at 1:46:51 PM and then re-added, likely indicating a temporary testing or refactoring step.

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\components\screen\booking\form\sub-components\BasicPoExtend.jsx`**
    *   **Timestamp Range:** 12/3/2025, 12:33:44 PM to 12/3/2025, 3:24:24 PM
    *   **Key Changes:**
        *   This component manages a list of "Basic PO" items, allowing adding, updating, and deleting rows using Redux actions (`addList`, `removeList`, `updateList`).
        *   Each row consists of fields like PO No, PO Date, No of Packages, Qty, Weight, Weight Unit, Volume, and Supplier Name.
        *   It uses `AppAutocompleteExtend` for supplier selection with dynamic options fetched via `ApiManager.getCommonOptions`.
        *   The component was entirely moved/renamed to `BasicPoForHbl.jsx` at 3:25:02 PM, with its content becoming the base for the new file. This suggests a specialization of the component for HBL forms.

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\components\screen\booking\hbl\HblHeaderForms.jsx`**
    *   **Timestamp Range:** 12/3/2025, 1:42:46 PM to 12/3/2025, 1:51:28 PM
    *   **Key Changes:**
        *   This component renders the header section of the HBL form, including fields for Transportation Mode, Agent Booking #, Booking Date, Client Name, MBOL/HBL numbers, dates, description, ports (POR, POL, POD, FPD), Marks & Numbers, Vessel Name, Voyage Number, and Shipment Type.
        *   It fetches client options from an API on mount.
        *   Includes functionality to add a new vessel via a modal, triggered by a button or a keyboard shortcut (`ctrl+x`).
        *   A minor change at 1:51:28 PM changed `onChange` for `booking_no` to `onchange`, which is likely a typo.

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\components\screen\booking\hbl\HBLListDetails.jsx`**
    *   **Timestamp Range:** 12/3/2025, 1:43:57 PM to 12/3/2025, 1:54:42 PM
    *   **Key Changes:**
        *   This component displays a list of HBL bookings in a grid format.
        *   It fetches HBL data using `useGetHblDashboardQuery`.
        *   Provides functionality to delete an HBL entry (`handleDelete`) and navigate to the HBL form for copying.
        *   At 1:54:42 PM, the `formAction` for navigating to the HBL form was explicitly changed from `"copy"` to `"add"`, indicating a shift in how new HBLs are initiated from the list view (i.e., new entry rather than copy existing).

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\store\api\agentBookingApi.js`**
    *   **Timestamp:** 12/3/2025, 2:38:52 PM
    *   **Key Changes:**
        *   This file defines the Redux Toolkit Query API endpoints for agent bookings.
        *   A new `fetchPoFormDetails` endpoint was added, specifically to fetch PO details for HBL entries, which is used by `HBLForm` to pre-populate the `basicPoList`. This confirms the previous observation in `HBLform.jsx` regarding PO data fetching.

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\components\screen\booking\hbl\BasicPoForHbl.jsx`**
    *   **Timestamp Range:** 12/3/2025, 3:25:02 PM to 12/3/2025, 3:37:58 PM
    *   **Key Changes:**
        *   This file was created as a specialized version of `BasicPoExtend`.
        *   Around 3:27:29 PM, all `onChange` and `handleOptionChange` callbacks for input fields within the mapped `Grid` items were commented out. This effectively made the form fields read-only or temporarily disabled direct editing through this component.
        *   The add/delete row `IconButton`s were commented out at 3:27:50 PM, further suggesting a temporary read-only view or a change in how PO list modifications are handled (perhaps moved to a different component or controlled externally).
        *   The component now iterates over `formik?.basicPoList` instead of the Redux `selector` directly, indicating that the `basicPoList` data is expected to come directly from the `formik` object (which is passed as `values` from `HblPODetails`), not from a separate Redux selector within this component for rendering.
        *   Grid item `lg` sizing changed from `lg={1}` to `lg={1}` (no functional change but was part of a series of spacing adjustments).

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\components\screen\booking\form_extend\CargoFormExtend.jsx`**
    *   **Timestamp Range:** 12/3/2025, 4:58:45 PM to 12/4/2025, 3:21:14 PM
    *   **Key Changes:**
        *   This component manages a cargo list within a booking form, displaying data in an `AppTable`.
        *   It provides functionality to add, edit, and delete cargo items via a modal (`AddCargoFormExtend`).
        *   No significant functional changes observed across the multiple entries, mostly timestamp updates indicating continued work or minor saves. The structure and logic for managing the cargo list (Redux actions, modal handling) remained consistent.

**Patterns and Recurring Elements:**

1.  **Redux for State Management:** `react-redux` (using `useDispatch`, `useSelector`) is consistently used across `HBLform.jsx`, `HblPoForm.jsx`, `BasicPoExtend.jsx`, and `CargoFormExtend.jsx` for managing application state, particularly lists like `routingList`, `containerList`, `basicPoList`, and `cargoList`.
2.  **Formik for Form Handling:** `Formik` is extensively used in `HBLform.jsx` for managing form state, validation (`HBLvalidationSchema`), and submission.
3.  **MUI Components:** The `@mui/material` and `@mui/lab` libraries are heavily utilized for UI components such as `Grid`, `Box`, `Stack`, `Card`, `TabContext`, `TabList`, `TabPanel`, `IconButton`, `Accordion`, `Typography`, `CircularProgress`, and various custom input components (e.g., `InputBoxExtend`, `SelectBoxExtend`, `AppDatePickerExtend`, `AppAutocompleteExtend`).
4.  **API Integration with RTK Query:** The `agentBookingApi.js` file demonstrates the use of Redux Toolkit Query for declarative data fetching and caching, with `useSaveHblBookingMutation`, `useUpdateHblBookingMutation`, `useFetchPoFormDetailsQuery`, `useGetHblDashboardQuery`, and `useDeleteHblBookingMutation` being prominent. `skipToken` is used to prevent queries from running conditionally.
5.  **Debugging `console.log` Statements:** Frequent `console.log` statements with distinct markers (e.g., "values===90", "locatioppppp", "poDetails===890", "kkkkkk89900", "hkkllll90000") are present across multiple files, indicating active development and debugging.
6.  **`initialValues` Initialization Logic:** In `HBLform.jsx`, `initialValues` are often set with complex conditional logic (`initialValues?.field || defaultValue`) to ensure data consistency, especially when copying or adding new entries. There's also a pattern of prioritizing fetched data (`poDetails?.data?.basicPoList`) over initial props for lists.
7.  **Keyboard Shortcuts:** The `useKeyboardShortcut` hook is used in `HBLform.jsx` and `HblHeaderForms.jsx` for improved user experience, providing quick access to common actions like adding a vessel or managing parties.
8.  **Form Action (`formAction` prop):** The `formAction` prop (e.g., "add", "edit", "copy") is consistently passed and used to conditionally render UI elements or modify component behavior.

**Overall Narrative:**

The changes depict an ongoing development process for a booking system's frontend, focusing on HBL (House Bill of Lading) management. Key areas of work include:
*   Refining the HBL PO (Purchase Order) details form, including a switch to a specialized `BasicPoForHbl` component and dynamic tab selection based on client name.
*   Enhancing the main HBL form to better handle initial data loading, especially for PO details fetched from a dedicated API endpoint.
*   Adjusting the logic for how booking IDs are handled during "copy" and "add" operations in the HBL form.
*   Standardizing the API interactions using RTK Query for HBL creation, updates, and data retrieval.
*   Maintaining a robust cargo management sub-form with add, edit, and delete functionalities.
*   Minor UI adjustments and consistent debugging efforts throughout the components.

## 5:32:38 PM
The provided log details code changes across several files, primarily focusing on booking and House Bill of Lading (HBL) management, and an analytics query system.

**File-Specific Updates:**

1.  **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-backend\src\controllers\booking.controller.ts`**
    *   **Timestamps:** Multiple entries from 12/3/2025, 12:06:34 PM to 12/3/2025, 12:15:30 PM.
    *   **Key Functionality:** This controller handles `saveBooking` and `saveMaster` operations.
        *   `saveBooking`: Manages the creation and updating of agent bookings. It first determines if it's an update (existing `agent_booking_id`) or an add (new `booking_id` generated). For updates, it deletes related records (cargo, containers, vessels, purchase orders, linked purchase orders) before re-inserting the new data. Data is saved into tables like `agent_booking_entry`, `agent_booking_cargolist`, `agent_booking_container_pre`, `agent_booking_vessel`, `agent_booking_po`, and `agent_booking_linked_po`. It also updates `remain_packs` in the `dso_order` table for linked POs. User roles (AGENT vs ADMIN) influence the `location` field.
        *   `saveMaster`: Validates `account_type` against a predefined enum and processes master account data.
    *   **Observation:** The code content is identical across all logged timestamps for this file, suggesting no functional changes were introduced during this period.

2.  **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-backend\src\controllers\hblEntry.controller.ts`**
    *   **Timestamps:** Multiple entries from 12/3/2025, 2:04:59 PM to 12/3/2025, 4:16:10 PM.
    *   **Key Functionality:** This controller manages `createHblMasterBooking` and `updateHblMasterBooking` functions.
        *   `createHblMasterBooking`: Creates a new HBL master booking, including associated routing, container, and basic purchase order lists. It initiates a database transaction, fetches `bookingSerialId` from `agent_booking_entry`, and inserts data into `hbl_master`, `agent_booking_vessel`, `agent_booking_hbl`, `agent_booking_routing`, `agent_booking_container`, and `agent_booking_po` tables. An audit log entry is created.
        *   `updateHblMasterBooking`: Updates an existing HBL master booking. It takes `hbl_master_id` and performs `UPDATE` operations on `hbl_master`, `agent_booking_vessel`, and `agent_booking_hbl` tables. It also logs changes using an audit module.
    *   **Observation:** Similar to the `booking.controller.ts`, the code content is identical across all logged timestamps, indicating no functional modifications in this series of updates.

3.  **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-backend\src\routes\hblEntry.route.ts`**
    *   **Timestamp:** 12/3/2025, 2:36:19 PM.
    *   **Key Functionality:** Defines the API routes for HBL management. It includes endpoints for fetching HBL details (`/`, `/get-hbl`, `/get-po-details`), creating HBLs (`/create`), updating HBLs (`/update`), and deleting HBLs (`/delete`). The delete route is protected by `authMiddleware`.

4.  **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-backend\src\controllers\analytics\query\booking.query.ts`**
    *   **Timestamps:** Multiple entries from 12/4/2025, 11:59:53 AM to 12/4/2025, 3:35:27 PM.
    *   **Key Functionality:** Contains the `bookingQueryBuilder` function, which dynamically generates PostgreSQL queries for various analytics reports related to bookings.
        *   It configures a `customizer` object with report-specific settings like `dateRange`, `calType` (e.g., 'avg'), `dateColumns`, `booking`, `mblwise`, and `calColumnConfig`.
        *   It supports report types such as `BookingDatetoActualDeparture` (both container-wise and MBL-wise), and stacked bar versions of these reports.
        *   The SQL queries involve joins between `mtr_tracking_data` and `agent_booking_entry` tables, calculation of day differences between various dates, filtering by `account_name`, and time-based grouping for stacked bar charts (e.g., 'Less than 1 week', '1 - 2 weeks').
    *   **Observation:** The code content is identical across all logged timestamps, indicating no functional changes.

5.  **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-backend\src\controllers\analytics\others.controller.ts`**
    *   **Timestamp:** 12/4/2025, 12:02:39 PM.
    *   **Key Functionality:** The `getTableDataReports` function acts as a central dispatcher for analytics reports.
        *   It uses `defaultDateRange` if no dates are provided.
        *   It identifies user and company context using `getUserObject`.
        *   A large conditional structure (if-else if) delegates query generation to specific builder functions (`chassisQueryBuilder`, `bookingQueryBuilder`, `containerQueryBuilder`, `departureQueryBuilder`, `generalQueryBuilder`) based on the requested `type` of report.
        *   After query construction, it executes the query against the database and returns the results.

6.  **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-backend\src\controllers\analytics\query\export.query.ts`**
    *   **Timestamps:** 12/4/2025, 3:39:54 PM to 12/4/2025, 3:40:05 PM.
    *   **Key Functionality:** Provides a `getMonthValue` helper for date conversions and a `bookingQuery` function that acts as a lookup for SQL query snippets used for exporting analytics data.
        *   The `bookingQuery` object contains parameterized SQL strings for various booking-related reports, including conditions for filtering by month, week, or quarter, and grouping for stacked bar chart exports.
    *   **Observation:** The code content is identical across all logged timestamps, indicating no functional changes.

**Patterns and Recurring Elements:**

*   **Identical Code Across Multiple Timestamps:** A dominant pattern is the repeated logging of identical code for several files (booking.controller.ts, hblEntry.controller.ts, booking.query.ts, export.query.ts) across different timestamps on the same day. This suggests these are either automatic saves, minor non-functional changes (e.g., whitespace, comments not captured), or repeated commits without logical code alterations.
*   **Modular Architecture:** The analytics section demonstrates a clear modular pattern, with a central controller (`others.controller.ts`) delegating report-specific query construction to dedicated builder files (e.g., `booking.query.ts`, `export.query.ts`).
*   **Database Transaction Management:** Explicit `await query('BEGIN')`, `await query('COMMIT')`, and `await query('ROLLBACK')` calls are used in transactional operations to ensure data consistency.
*   **Data Sanitization and Date Formatting:** `sanitizeString`, `sanitizeIntString`, and `AppDateFormate` are frequently used to process incoming request data before database interaction.
*   **Audit Logging:** Critical operations like HBL creation and updates include calls to `simpleAudit` or `insertAudit`, indicating a requirement for tracking changes.
*   **Complex SQL for Analytics:** Analytics queries involve intricate joins, date difference calculations, and conditional aggregations, indicating a robust reporting capability for shipping and logistics data.
*   **Role-Based Logic:** User roles (e.g., 'AGENT', 'ADMIN') impact data handling, particularly in determining location context.
*   **Error Handling:** `try-catch` blocks are consistently implemented for robust error management, including rolling back database transactions on failure.