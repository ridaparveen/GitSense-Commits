# Activity Summary for 12/23/2025

## 9:43:50 AM
The file `c:\Users\ridap\OneDrive\Documents\T360-V2\t360-backend-v2\src\services\analytics\customerAutosearchOptions.ts`, last modified on 12/18/2025, 3:54:52 PM, introduces a new `getAllCustomerOptions` function. This function handles requests to fetch customer or agent options for autosearch. It dynamically queries either `agent_po_account_master` (for "AGENT" role) or `mtr_tracking_data` (for "CUSTOMER" role), selecting distinct names. For the "CUSTOMER" role, it also supports pagination, calculating `total` and applying `LIMIT` and `OFFSET` based on query parameters. Errors are logged, and a 500 status is returned for internal server errors.

The file `c:\Users\ridap\OneDrive\Documents\T360-V2\t360-backend-v2\src\common\constants\Paths.ts`, updated on 12/18/2025, 3:55:32 PM, expands the application's API routing definitions. It adds new base paths for `CustomerOptions` (`/getCustomerOptions`), `Menu` (`/menus` with `GetUserMenus` endpoint), and `CO2Emission` (`/co2emission` with a `Get` endpoint). Existing paths for various modules like Users, Auth, Shipment, Dashboard, Analytics, and Reports remain in place.

The main router configuration file `c:\Users\ridap\OneDrive\Documents\T360-V2\t360-backend-v2\src\routes\index.ts`, timestamped 12/18/2025, 3:56:44 PM, integrates the newly defined routes and services. Specifically, it imports `MenuRoutes`, `Co2EmissionRoutes`, and `getAllCustomerOptions` and mounts them to their respective base paths (`Paths.Menu.Base`, `Paths.CO2Emission.Base`, `Paths.CustomerOptions.Base`) using `apiRouter.use`. This makes the new customer options, menu management, and CO2 emission functionalities accessible via the API.

Significant changes occurred in `c:\Users\ridap\OneDrive\Documents\T360-V2\t360-backend-v2\src\common\util\export.query.ts` on 12/19/2025, 7:53:25 AM. This file now includes a `getMonthValue` helper function and a robust `bookingQuery` function. The `bookingQuery` function dynamically generates complex SQL queries for various reports, such as "Booking Date to Actual Departure" and "Booking Date to POD Arrival," including "Stacked Bar" and "MBL Wise" variations. These queries involve joining `mtr_tracking_data` and `agent_booking_entry` tables, calculating date differences (`day_diff`), and applying filters based on `CompanyName` and date validity. Crucially, it incorporates conditional logic to dynamically filter by month, week, or quarter and uses `CASE` statements to categorize `day_diff` into specific time ranges (e.g., "Less than 1 week", "1 - 2 weeks") for stacked bar reports.

**Key Patterns and Recurring Elements:**
*   **API Expansion:** The changes consistently indicate an expansion of API capabilities, particularly around customer options, user-specific menus, CO2 emissions, and detailed booking/analytics reports.
*   **Role-Based Data Access:** The `customerAutosearchOptions.ts` file demonstrates fetching data tailored to specific user roles (AGENT vs. CUSTOMER).
*   **Dynamic SQL Generation:** The `export.query.ts` file heavily utilizes dynamic SQL construction, adapting queries based on report parameters, date ranges, and display preferences, with a focus on calculating and categorizing date differences.
*   **Database Interaction:** All files imply direct or indirect interaction with a PostgreSQL database, frequently querying tables like `agent_po_account_master`, `mtr_tracking_data`, and `agent_booking_entry`.
*   **Date Handling:** SQL queries consistently involve extracting date parts, calculating date differences, and validating dates against `NULL` or placeholder values like `'0001-01-01 00:00:00 BC'`.
*   **Timestamp Proximity:** All changes occurred within a short period (December 18-19, 2025), suggesting a concentrated development effort on related features.

## 3:23:51 PM
For the file `c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\pages\dashboard\ShipmentTrackingScreen.jsx`, the following changes and information are notable as of **12/23/2025, 10:08:25 AM**:

This file defines the `ShipmentTrackingScreen` React component, which is responsible for displaying comprehensive shipment tracking details.

**Key Features and Structure:**
*   **Data Fetching**: The component retrieves shipment data using `useFetchShipmentTrackingQuery` from a Redux Toolkit API, passing `mblno` and `fileno` obtained from URL query parameters. It displays a `Loader` while data is being fetched.
*   **Layout**: The screen is structured with a `ScreenToolbar` at the top for navigation (back button and title) and two main content columns below:
    *   A wider left column (74%) contains the main shipment information.
    *   A narrower right column (26%) is dedicated to `MilestonesContainer`.
*   **Shipment Details Display**:
    *   **Map and Tracking Stepper**: Incorporates `MapTrackingContainer` to display geographical tracking and `TrackingStepper` to visualize the shipment's progress through various stages.
    *   **Core Shipment Info**: Presents essential details like 'File No', 'BL', 'Supplier', and 'MBL No' using `CardField` components.
    *   **Expandable "More Details" Section**: An interactive section allows users to toggle the visibility of additional shipment information, including 'Customer Ref No.', 'Notify', 'Commodity', 'Consignee', 'Service', 'Piece count', and 'Weight', using `ExpandMoreIcon` and `ExpandLessIcon`.
*   **Navigation**: Provides a `goBack` function using `useNavigate` to return to the previous screen.
*   **Component Usage**: Relies heavily on Material-UI components (`Box`, `Stack`, `Typography`, `IconButton`, etc.) for its UI, along with custom components like `ScreenToolbar`, `Badge`, `OutlinedButton`, `ThemeButton`, `CardField`, `MapTrackingContainer`, `TrackingStepper`, `TrackingInfoContainer`, `MilestonesContainer`, and `Loader`.
*   **Styling Patterns**: Recurring use of white backgrounds, rounded borders, and subtle box shadows (`boxShadow: '0px 1px 8px 0px #0000001A'`) for card-like containers, indicating a consistent design language.
*   **Data Formatting**: Includes a `fieldFormater` utility to handle specific data fields, like extracting `key` from a `status` object. A `formatDate` utility is also defined for date presentation.
*   **Debugging**: Contains `console.log` statements for `PARAMS` and `shipment page info`, suggesting ongoing development or debugging efforts.
*   **Import Pattern**: Imports for API hooks (`useFetchShipmentTrackingQuery`, `useFetchVesselTrackingQuery`) and utility functions (`appDateFormat`) are standard for Redux Toolkit and date formatting.

## 3:23:56 PM
The provided logs detail a series of backend code changes primarily focused on expanding analytics, reporting, and data retrieval capabilities, along with significant API route additions.

**Key Changes by File:**

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-backend-v2\src\services\analytics\customerAutosearchOptions.ts` (Timestamp: 12/18/2025, 3:54:52 PM)**
    This file introduces the `getAllCustomerOptions` service function. Its primary role is to fetch distinct customer names for autosearch functionalities, tailored by user `role` (AGENT or CUSTOMER). For AGENTs, it queries `agent_po_account_master`, while for CUSTOMERs, it queries `mtr_tracking_data` and includes pagination support. Results are consistently formatted as `[{ value: name, label: name }]`.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-backend-v2\src\common\constants\Paths.ts` (Timestamp: 12/18/2025, 3:55:32 PM)**
    This file, which defines application API endpoints, has undergone significant expansion. New base paths and endpoints have been added for:
    *   `CustomerOptions`: A new base path `/getCustomerOptions`.
    *   `CO2Emission`: A new module with base path `/co2emission` and a `/get` endpoint.
    *   `Planboard`: A new module with base path `/planboard` and a `/get` endpoint.
    *   `Menu`: A new module with base path `/menus` and a `/getusermenus` endpoint.
    *   `Audit`: A new `/audit` get endpoint.
    *   Existing modules like `Analytics` have seen a substantial increase in endpoints, adding paths for various metrics (`GetCbm`, `GetKgs`, `GetTeu`, `GetContainers`, `GetTransit`), table data (`GetTablesData`), and other reporting features.
    *   `Shipment` now includes specific milestone endpoints for `air` (`GetAirMilestone`).
    *   `User` gained a `GetUserSettings` endpoint.

*   **`c:\Users\ridap\OneDrive\T360-V2\t360-backend-v2\src\routes\index.ts` (Timestamp: 12/18/2025, 3:56:44 PM)**
    This central routing file has been updated to integrate the newly defined paths and services. It now imports and uses `PlanbaordRoutes`, `MenuRoutes`, `Co2EmissionRoutes`, and directly links the `getAllCustomerOptions` and `getAllAudit` service functions to their respective API paths (`Paths.CustomerOptions.Base` and `Paths.Audit.Get`). This signifies the activation and accessibility of the new features through the API.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-backend-v2\src\common\util\export.query.ts` (Timestamp: 12/19/2025, 7:53:25 AM)**
    This file focuses on generating dynamic SQL queries for various booking-related reports. It introduces a `getMonthValue` helper function for month name-to-number conversion. The core `bookingQuery` function accepts numerous parameters (report name, company, date filters, stacking options) to construct specific SQL queries. These queries consistently involve joins between `mtr_tracking_data` and `agent_booking_entry`, calculate day differences between various booking/departure/arrival dates, and include complex conditional logic for filtering by month, week, or quarter and categorizing time differences into predefined buckets (e.g., "Less than 1 week") for stacked bar charts. This file represents a significant enhancement to the reporting backend.

**Patterns and Recurring Elements:**

*   **Analytics and Reporting Expansion:** A dominant theme is the extensive development of analytics and reporting features, evidenced by new `Analytics` endpoints, dedicated reporting queries in `export.query.ts`, and customer autosearch options.
*   **API Route Proliferation:** The `Paths.ts` and `index.ts` changes show a rapid expansion of API endpoints, indicating the introduction of many new features or granular access to existing ones across different modules like Shipments, Booking, User, and entirely new modules such as CO2 Emission and Planboard.
*   **Database-Centric Operations:** The services heavily rely on direct database queries, joining tables like `mtr_tracking_data` and `agent_booking_entry` to retrieve and process data.
*   **Date/Time Manipulation in Queries:** SQL queries frequently use `EXTRACT` and `DATE_PART` functions for calculating date differences and filtering by specific time periods (month, week, quarter), especially for analytical reports.
*   **Role-Based Logic:** There's an instance of role-based data fetching (`getAllCustomerOptions`) which suggests differing data access based on user type.
*   **Structured Data Output:** Service functions tend to format their output consistently (e.g., `[{ value: ..., label: ... }]` for dropdowns).
*   **Error Handling and Logging:** Services include basic `try...catch` blocks and `logger.error` calls for robust error management.
*   **Future-Dated Timestamps:** All timestamps are from December 2025, indicating that these log entries might be from a planned or future development cycle.