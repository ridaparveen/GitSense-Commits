# Activity Summary for 12/23/2025

## 9:43:50 AM
The file `c:\Users\ridap\OneDrive\Documents\T360-V2\t360-backend-v2\src\services\analytics\customerAutosearchOptions.ts`, last modified on 12/18/2025, 3:54:52 PM, introduces a new `getAllCustomerOptions` function. This function handles requests to fetch customer or agent options for autosearch. It dynamically queries either `agent_po_account_master` (for "AGENT" role) or `mtr_tracking_data` (for "CUSTOMER" role), selecting distinct names. For the "CUSTOMER" role, it also supports pagination, calculating `total` and applying `LIMIT` and `OFFSET` based on query parameters. Errors are logged, and a 500 status is returned for internal server errors.

The file `c:\Users\ridap\OneDrive\Documents\T360-V2\t360-backend-v2\src\common\constants\Paths.ts`, updated on 12/18/2025, 3:55:32 PM, expands the application's API routing definitions. It adds new base paths for `CustomerOptions` (`/getCustomerOptions`), `Menu` (`/menus` with `GetUserMenus` endpoint), and `CO2Emission` (`/co2emission` with a `Get` endpoint). Existing paths for various modules like Users, Auth, Shipment, Dashboard, Analytics, and Reports remain in place.

The main router configuration file `c:\Users\ridap\OneDrive\Documents\T360-V2\t360-backend-v2\src\routes\index.ts`, timestamped 12/18/2025, 3:56:44 PM, integrates the newly defined routes and services. Specifically, it imports `MenuRoutes`, `Co2EmissionRoutes`, and `getAllCustomerOptions` and mounts them to their respective base paths (`Paths.Menu.Base`, `Paths.CO2Emission.Base`, `Paths.CustomerOptions.Base`) using `apiRouter.use`. This makes the new customer options, menu management, and CO2 emission functionalities accessible via the API.

Significant changes occurred in `c:\Users\ridap\OneDrive\Documents\T360-V2\t360-backend-v2\src\common\util\export.query.ts` on 12/19/2025, 7:53:25 AM. This file now includes a `getMonthValue` helper function and a robust `bookingQuery` function. The `bookingQuery` function dynamically generates complex SQL queries for various reports, such as "Booking Date to Actual Departure" and "Booking Date to POD Arrival," including "Stacked Bar" and "MBL Wise" variations. These queries involve joining `mtr_tracking_data` and `agent_booking_entry` tables, calculating date differences (`day_diff`), and applying filters based on `CompanyName` and date validity. Crucially, it incorporates conditional logic to dynamically filter by month, week, or quarter and uses `CASE` statements to categorize `day_diff` into specific time ranges (e.g., "Less than 1 week", "1 - 2 weeks") for stacked bar reports.

**Key Patterns and Recurring Elements:**
*   **API Expansion:** The changes consistently indicate an expansion of API capabilities, particularly around customer options, user-specific menus, CO2 emissions, and detailed booking/analytics reports.
*   **Role-Based Data Access:** The `customerAutosearchOptions.ts` file demonstrates fetching data tailored to specific user roles (AGENT vs. CUSTOMER).
*   **Dynamic SQL Generation:** The `export.query.ts` file heavily utilizes dynamic SQL construction, adapting queries based on report parameters, date ranges, and display preferences, with a focus on calculating and categorizing date differences.
*   **Database Interaction:** All files imply direct or indirect interaction with a PostgreSQL database, frequently querying tables like `agent_po_account_master`, `mtr_tracking_data`, and `agent_booking_entry`.
*   **Date Handling:** SQL queries consistently involve extracting date parts, calculating date differences, and validating dates against `NULL` or placeholder values like `'0001-01-01 00:00:00 BC'`.
*   **Timestamp Proximity:** All changes occurred within a short period (December 18-19, 2025), suggesting a concentrated development effort on related features.