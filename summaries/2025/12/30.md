# Activity Summary for 12/30/2025

## 1:46:00 PM
The log details changes across two primary controller files in the `t360-backend` API.

**File: `c:\Users\ridap\OneDrive\Documents\T360_Api\t360-backend\src\controllers\analytics\transit.controller.ts`**
*   **Timestamp:** 12/30/2025, 9:54:51 AM
*   **Key Update:** The `getTransitReports` function has been enhanced to provide dynamic transit analytics. It processes query parameters such as `group_by_column`, `fromDate`, `toDate`, `mblwise`, `viewBy`, `type`, and `reportName`. If date ranges are not provided, it defaults them. It dynamically constructs a SQL query using `transitQueryBuilder`, allowing for distinct grouping by MBL number or voyage based on the `mblwise` flag. The controller fetches user-specific company and user ID details and includes robust error handling and logging.

**File: `c:\Users\ridap\OneDrive\Documents\T360_Api\t360-backend\src\controllers\code.controller.ts`**
*   **Timestamp:** 12/30/2025, 10:23:43 AM
*   **Key Update:** This file now contains comprehensive customer management logic through two main functions:
    *   **`getAllCustomer`:** This function retrieves customer records from `PO_AccountMaster_Customer_Master`. It supports pagination, dynamic sorting (based on `orderBy` parameter), and searching across various customer fields. It also enriches customer data by fetching associated shipper information from `account_master_shipper_MAP`, document upload details from `document_upload_details`, and customer mappings from `Account_Master_Customer_MAP`, combining them into a single response.
    *   **`createCustomer`:** This function handles the creation and modification of customer records. It supports file uploads and processes extensive customer details from the request body. Key features include:
        *   **Transaction Management:** It uses database transactions (`BEGIN`) to ensure data consistency.
        *   **Existence Check:** It checks if a customer with the provided `acode` already exists. If so, it enters a 'Modify' mode, deleting old associated records (customer master, agent types, shipper maps) before re-inserting. If new, it generates a unique `acode` using `getAccountCode`.
        *   **Data Insertion/Update:** It inserts or updates the `PO_AccountMaster_Customer_Master` table and handles the insertion of customer types (`agent_po_account_master_type`) and shipper mappings (`Account_Master_Shipper_MAP`), resolving codes for `pol`, `shipper`, and `agent` dynamically.
        *   **Data Sanitization:** It sanitizes the `cname` field.
        *   **Error Handling:** Both functions include error logging and appropriate HTTP error responses.

**Patterns and Recurring Elements:**
*   **Database Interaction:** Both controllers heavily utilize a `query` utility for PostgreSQL database operations, often involving dynamic SQL query construction.
*   **Authentication and User Context:** `AuthenticatedRequest` is consistently used to access user information.
*   **Utility Functions:** Common utility functions like `defaultDateRange`, `getUserObject`, `removeLastWord`, `getAccountCode`, `getAccountSubCode`, `chkStr` are leveraged to streamline logic.
*   **Error Handling and Logging:** Both files implement `try...catch` blocks for error handling and use a `logger.error` for internal logging.
*   **Dynamic Data Handling:** Both controllers demonstrate the ability to construct SQL queries and process data based on flexible request parameters (`req.query`, `req.body`).
*   **Timestamp Proximity:** The two log entries are very close in time (within ~30 minutes on the same date), suggesting a concerted effort or a single development session focused on these related areas.

## 1:46:19 PM
This log details focused development activity within a frontend application on December 30, 2025, across three main files related to a booking system.

**File-Specific Updates:**

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\pages\booking\AgentBookingConfirmation.jsx`**
    *   **Initial State (11:17:06 AM):** The component `AgentBookingConfirmation` is set up with extensive imports from Material-UI, Formik, and Redux for state management and API interactions. It handles responsive page sizing, file selection (`selectedFile`), and managing selected/deselected Packing Lists (`selectedPl`, `deselectedPl`). The core logic includes form submission using `useFormik` to `updateDo` (update Delivery Order) and conditional actions for "save\_and\_next" and "send-to-otm". The "send-to-otm" action triggers XML generation (`useCreateBookingXmlMutation`) and upload (`useUploadBookingXmlMutation`). Error and warning handling utilize `react-hot-toast` and a `PopupAlert` component. Numerous `console.log` statements are present throughout the submission logic.
    *   **Icon Imports (11:37:53 AM, 11:58:32 AM, 12:06:24 PM, 12:07:06 PM, 12:44:39 PM):** Several Material-UI icons were incrementally added: `Download`, `HourglassBottom`, `Numbers`, `CalendarMonth`, `IconButton`, `Delete`, and `Folder`.
    *   **Component Imports (11:44:17 AM, 12:50:52 PM):** `CardField` was imported, suggesting a new UI element for displaying structured data. Later, `SingleFileDropzone` was replaced with `UploadFile`, indicating a refactor or redesign of the file upload mechanism.
    *   **Debugging (12:05:42 PM - 12:40:45 PM):** A `console.log("pldata====",plData);` was added before `handlePageChange`, specifically to log packing list data.
    *   **MUI Component Imports (12:41:27 PM):** `Divider` was added to Material-UI imports.

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\components\screen\booking\form\BookingFormExtend.jsx`**
    *   **Initial State (11:23:50 AM):** This component, `BookingFormExtend`, manages a booking form. It leverages Formik for validation and submission. Redux selectors (`agentBookingForm`, `linkPo`) and `useSaveBookingMutation` are used for data interaction. It includes validation logic for required `vesselList`, `booking_no_line`, and `booking_date` fields, displaying `PopupAlert` messages for warnings or errors. Upon successful submission, it navigates the user or advances the step (`setActiveStep`).
    *   **Minor Changes (11:24:03 AM):** No significant code changes were observed in the provided log for this specific timestamp compared to the previous entry, suggesting minor formatting or whitespace adjustments not captured in the summary.

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\components\common\Cards\CardField.jsx`**
    *   **Initial State (12:14:58 PM):** The `CardField` component is introduced, designed to display a title and subtitle, optionally with an icon. It supports date and custom formatting and includes tooltips for both title and subtitle, with initial text styling preventing overflow.
    *   **Styling Adjustments (12:15:09 AM, 12:18:33 PM, 12:19:14 PM, 12:20:24 PM, 12:21:13 PM):** Iterative changes were made to the `Typography` styles for the `title`. Initially, `tooltip` styling was adjusted. Subsequently, `whiteSpace`, `overflow`, and `textOverflow` properties were modified multiple times, alternating between allowing text wrapping and enforcing `nowrap` (single line) while ensuring visibility and removing ellipses for the title. A `gap:10` was added to the title's display flex container.
    *   **Refactor and Revert (12:23:12 PM, 12:36:24 PM, 12:36:40 PM):** A significant refactor occurred, changing the default `grid` layout from `[4, 8]` to `[5, 7]`, improving `valuFormater` to handle `null`/`undefined` values, and restructuring the JSX to explicitly manage `icon`, `title`, `subtitle`, and `postIcon` props. Styles for `title` and `value` were separated. This major refactor was then momentarily reverted (12:36:24 PM) before being re-applied (12:36:40 PM).

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\components\common\UploadFile.jsx`**
    *   **Initial State (12:50:28 PM):** This component provides a `react-dropzone` based file upload interface, showing drag state and selected file name.
    *   **Major UI Redesign (12:52:45 PM):** The component underwent a significant visual overhaul. The simple dropzone was replaced with a `Grid` layout, featuring a "Drag & Drop File(s) to Upload" area and a "Choose File" button. A placeholder for a file list with `FolderIcon` and `DeleteIcon` was added, initially commented out. The `useDropzone` functionality is still present but less visually integrated.
    *   **Refined Imports and Button (12:54:03 PM):** Imports were updated to include `ThemeButton` and `FolderCopy` (replacing `FolderIcon`). The standard `Button` was replaced with `ThemeButton`.
    *   **File Display and Styling (12:54:35 PM - 1:02:39 PM):** The display of the selected file's name was commented out, then temporarily replaced with hardcoded strings ("kkkk", "Lorem spum.pdf") for testing. Various styling adjustments were made to the "Choose File" button (e.g., commenting/uncommenting `sx` properties, setting/removing `width`) and the file display box (e.g., removing border/borderRadius, adjusting icon button padding).
    *   **Icon Change (1:03:35 PM):** The `FolderCopy` icon for displaying files was replaced with `InsertDriveFile`.

**Patterns and Recurring Elements:**

*   **Frontend-focused Development:** All changes are within the `t360-frontend` directory, indicating work on the user interface.
*   **Material-UI (MUI) Framework:** The consistent use of `@mui/material` components (`Box`, `Grid`, `Stack`, `Typography`, `Card`, `Tooltip`, `IconButton`, `Divider`) and icons (`Add`, `ArrowBack`, `ArrowForward`, `CheckCircle`, `CloudDownload`, `Download`, `HourglassBottom`, `Numbers`, `CalendarMonth`, `Delete`, `Folder`, `FolderCopy`, `InsertDriveFile`) highlights a strong reliance on MUI for building the UI.
*   **React Ecosystem:** The codebase uses core React features (`useState`, `useEffect`, `useMemo`, `useCallback`) along with popular libraries like Formik (`useFormik`) for form management and Redux Toolkit Query (`useSaveBookingMutation`, `useCreateBookingXmlMutation`, etc.) for API state management.
*   **Toasting and Alerts:** `react-hot-toast` is used extensively for user feedback (loading, success, error messages), and a `PopupAlert` component is used for more structured warnings and errors.
*   **Debugging Practices:** Frequent and verbose `console.log` statements suggest an active debugging process during development.
*   **Iterative UI/UX Refinement:** Both `CardField` and `UploadFile` components show a pattern of initial implementation followed by multiple small styling and structural adjustments, indicating fine-tuning of the user experience and visual presentation.
*   **Form Submission and API Interaction:** Components consistently handle form data, prepare payloads (including `FormData` for file uploads), interact with API mutations, and manage the resulting feedback (success messages, warnings, errors).
*   **Booking Feature Development:** The changes are primarily centered around booking-related functionalities, including booking confirmation, saving booking details, handling packing lists, and managing document uploads.

## 2:46:03 PM
The provided logs detail recent modifications within a T360 API backend, focusing on analytics reporting and customer master data management.

### File-Specific Updates:

1.  **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-backend\src\controllers\analytics\transit.controller.ts`**
    *   **Timestamp**: 12/30/2025, 9:54:51 AM
    *   This file handles `getTransitReports` functionality. The key updates involve:
        *   **Dynamic Date Range**: If `fromDate` or `toDate` are not provided in the request query, `defaultDateRange()` is used to set them.
        *   **User Object Retrieval**: `getUserObject` is now called to extract `companyname` and `usercode` from the authenticated request, supporting multi-company or user-specific analytics.
        *   **MBL-wise Conditionality**: A new `mblwiseCondition` object dynamically selects between `mblno` and `voyage` for grouping and filtering, allowing reports to be either master bill of lading (MBL) specific or voyage-specific.
        *   **Dynamic Query Building**: The `transitQueryBuilder` utility is central, constructing the main SQL query based on various parameters like `columnName`, `type`, `viewBy`, date range, `CompanyName`, `mblwiseCondition`, `user_id`, and `reportName`.
        *   **Enhanced Logging**: `logger.error` statements are included for debugging the generated query (`mainQueryUI-`) and general error handling.

2.  **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-backend\src\controllers\code.controller.ts`**
    *   **Timestamp**: 12/30/2025, 10:23:43 AM
    *   This file, despite its name, manages `Customer Master` data. The changes introduce:
        *   **`getAllCustomer` Function**:
            *   Retrieves customer records with pagination (`page`, `perPage`) and dynamic ordering (`orderBy`).
            *   **Dynamic Search**: It queries the `PO_AccountMaster_Customer_Master` table to fetch column names dynamically, then constructs search conditions based on matching `req.query` parameters.
            *   **Data Enrichment**: For each customer, it fetches related data from `account_master_shipper_MAP` (shipper, agent), `document_upload_details` (documents), and `Account_Master_Customer_MAP` (customer mappings).
            *   Uses `chkStr` for sanitizing string values before sending the response.
        *   **`createCustomer` Function**:
            *   **File Upload Integration**: Utilizes an `upload` middleware, suggesting potential file attachment capabilities for customer records.
            *   **Transaction Management**: Initiates a database transaction (`BEGIN`) for atomicity.
            *   **Create/Modify Logic**: Checks if a customer `acode` already exists. If so, it performs a "Modify" operation by deleting existing records from `PO_AccountMaster_Customer_Master`, `agent_po_account_master_type`, `Account_Master_Shipper_MAP`, and `account_master_pic` before re-inserting. If new, `getAccountCode` is used to generate a unique `uacode`.
            *   **Data Sanitization**: `cname` is sanitized (`replace(/\s+/g, ' ').replace(/'/g, '`')`) before insertion.
            *   **Type Handling**: If `ctypelist` is 'CUSTOMER', it inserts a corresponding entry into `agent_po_account_master_type` with a generated `asubcode` using `getAccountSubCode`.
            *   **Mapping Processing**: Parses a JSON `mapping` array from the request body. For each item, it resolves `polcode`, `shippercode`, and `agentcode` by querying `portmaster` and `agent_po_account_master` tables, then inserts the mapping into `Account_Master_Shipper_MAP`.

### Timestamps of Significant Changes:

*   The `transit.controller.ts` was last updated on **12/30/2025, 9:54:51 AM**, indicating recent enhancements to its dynamic reporting capabilities.
*   The `code.controller.ts` (customer master) was updated shortly after, on **12/30/2025, 10:23:43 AM**, reflecting comprehensive changes to customer data retrieval and creation logic.

### Patterns and Recurring Elements:

*   **Database Interaction**: Extensive use of `query` for executing SQL commands, `insertQuery`, and `updateQuery` (though only `query` is directly visible for inserts/updates in the snippets). Database transactions (`BEGIN`) are initiated for complex operations.
*   **Request Handling**: Reliance on `AuthenticatedRequest` for user context and `req.query` for filtering/pagination/parameters, and `req.body` for payload data.
*   **Dynamic SQL Generation**: Queries are frequently constructed dynamically based on request parameters (e.g., search conditions, order clauses, transit report parameters).
*   **Error Handling and Logging**: `logger.error(error)` is consistently used within `try...catch` blocks to log errors and return a `500 Internal Server Error` response.
*   **Utility Functions**: Frequent use of custom utility functions like `defaultDateRange`, `getUserObject`, `transitQueryBuilder`, `removeLastWord`, `getAccountCode`, `getAccountSubCode`, and `chkStr` for common tasks.
*   **JSON Response Structure**: API responses consistently return JSON, often including a `status` (e.g., 200) and data, or an error message on failure.
*   **Data Sanitization**: `chkStr` and explicit string replacements are used to clean and validate data.
*   **Modularization**: Controllers import specific functionalities from `config`, `utils`, `requests`, and `types` folders, indicating a structured project.