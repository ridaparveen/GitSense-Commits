# Activity Summary for 12/30/2025

## 1:46:00 PM
The log details changes across two primary controller files in the `t360-backend` API.

**File: `c:\Users\ridap\OneDrive\Documents\T360_Api\t360-backend\src\controllers\analytics\transit.controller.ts`**
*   **Timestamp:** 12/30/2025, 9:54:51 AM
*   **Key Update:** The `getTransitReports` function has been enhanced to provide dynamic transit analytics. It processes query parameters such as `group_by_column`, `fromDate`, `toDate`, `mblwise`, `viewBy`, `type`, and `reportName`. If date ranges are not provided, it defaults them. It dynamically constructs a SQL query using `transitQueryBuilder`, allowing for distinct grouping by MBL number or voyage based on the `mblwise` flag. The controller fetches user-specific company and user ID details and includes robust error handling and logging.

**File: `c:\Users\ridap\OneDrive\Documents\T360_Api\t360-backend\src\controllers\code.controller.ts`**
*   **Timestamp:** 12/30/2025, 10:23:43 AM
*   **Key Update:** This file now contains comprehensive customer management logic through two main functions:
    *   **`getAllCustomer`:** This function retrieves customer records from `PO_AccountMaster_Customer_Master`. It supports pagination, dynamic sorting (based on `orderBy` parameter), and searching across various customer fields. It also enriches customer data by fetching associated shipper information from `account_master_shipper_MAP`, document upload details from `document_upload_details`, and customer mappings from `Account_Master_Customer_MAP`, combining them into a single response.
    *   **`createCustomer`:** This function handles the creation and modification of customer records. It supports file uploads and processes extensive customer details from the request body. Key features include:
        *   **Transaction Management:** It uses database transactions (`BEGIN`) to ensure data consistency.
        *   **Existence Check:** It checks if a customer with the provided `acode` already exists. If so, it enters a 'Modify' mode, deleting old associated records (customer master, agent types, shipper maps) before re-inserting. If new, it generates a unique `acode` using `getAccountCode`.
        *   **Data Insertion/Update:** It inserts or updates the `PO_AccountMaster_Customer_Master` table and handles the insertion of customer types (`agent_po_account_master_type`) and shipper mappings (`Account_Master_Shipper_MAP`), resolving codes for `pol`, `shipper`, and `agent` dynamically.
        *   **Data Sanitization:** It sanitizes the `cname` field.
        *   **Error Handling:** Both functions include error logging and appropriate HTTP error responses.

**Patterns and Recurring Elements:**
*   **Database Interaction:** Both controllers heavily utilize a `query` utility for PostgreSQL database operations, often involving dynamic SQL query construction.
*   **Authentication and User Context:** `AuthenticatedRequest` is consistently used to access user information.
*   **Utility Functions:** Common utility functions like `defaultDateRange`, `getUserObject`, `removeLastWord`, `getAccountCode`, `getAccountSubCode`, `chkStr` are leveraged to streamline logic.
*   **Error Handling and Logging:** Both files implement `try...catch` blocks for error handling and use a `logger.error` for internal logging.
*   **Dynamic Data Handling:** Both controllers demonstrate the ability to construct SQL queries and process data based on flexible request parameters (`req.query`, `req.body`).
*   **Timestamp Proximity:** The two log entries are very close in time (within ~30 minutes on the same date), suggesting a concerted effort or a single development session focused on these related areas.