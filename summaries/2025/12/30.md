# Activity Summary for 12/30/2025

## 1:46:00 PM
The log details changes across two primary controller files in the `t360-backend` API.

**File: `c:\Users\ridap\OneDrive\Documents\T360_Api\t360-backend\src\controllers\analytics\transit.controller.ts`**
*   **Timestamp:** 12/30/2025, 9:54:51 AM
*   **Key Update:** The `getTransitReports` function has been enhanced to provide dynamic transit analytics. It processes query parameters such as `group_by_column`, `fromDate`, `toDate`, `mblwise`, `viewBy`, `type`, and `reportName`. If date ranges are not provided, it defaults them. It dynamically constructs a SQL query using `transitQueryBuilder`, allowing for distinct grouping by MBL number or voyage based on the `mblwise` flag. The controller fetches user-specific company and user ID details and includes robust error handling and logging.

**File: `c:\Users\ridap\OneDrive\Documents\T360_Api\t360-backend\src\controllers\code.controller.ts`**
*   **Timestamp:** 12/30/2025, 10:23:43 AM
*   **Key Update:** This file now contains comprehensive customer management logic through two main functions:
    *   **`getAllCustomer`:** This function retrieves customer records from `PO_AccountMaster_Customer_Master`. It supports pagination, dynamic sorting (based on `orderBy` parameter), and searching across various customer fields. It also enriches customer data by fetching associated shipper information from `account_master_shipper_MAP`, document upload details from `document_upload_details`, and customer mappings from `Account_Master_Customer_MAP`, combining them into a single response.
    *   **`createCustomer`:** This function handles the creation and modification of customer records. It supports file uploads and processes extensive customer details from the request body. Key features include:
        *   **Transaction Management:** It uses database transactions (`BEGIN`) to ensure data consistency.
        *   **Existence Check:** It checks if a customer with the provided `acode` already exists. If so, it enters a 'Modify' mode, deleting old associated records (customer master, agent types, shipper maps) before re-inserting. If new, it generates a unique `acode` using `getAccountCode`.
        *   **Data Insertion/Update:** It inserts or updates the `PO_AccountMaster_Customer_Master` table and handles the insertion of customer types (`agent_po_account_master_type`) and shipper mappings (`Account_Master_Shipper_MAP`), resolving codes for `pol`, `shipper`, and `agent` dynamically.
        *   **Data Sanitization:** It sanitizes the `cname` field.
        *   **Error Handling:** Both functions include error logging and appropriate HTTP error responses.

**Patterns and Recurring Elements:**
*   **Database Interaction:** Both controllers heavily utilize a `query` utility for PostgreSQL database operations, often involving dynamic SQL query construction.
*   **Authentication and User Context:** `AuthenticatedRequest` is consistently used to access user information.
*   **Utility Functions:** Common utility functions like `defaultDateRange`, `getUserObject`, `removeLastWord`, `getAccountCode`, `getAccountSubCode`, `chkStr` are leveraged to streamline logic.
*   **Error Handling and Logging:** Both files implement `try...catch` blocks for error handling and use a `logger.error` for internal logging.
*   **Dynamic Data Handling:** Both controllers demonstrate the ability to construct SQL queries and process data based on flexible request parameters (`req.query`, `req.body`).
*   **Timestamp Proximity:** The two log entries are very close in time (within ~30 minutes on the same date), suggesting a concerted effort or a single development session focused on these related areas.

## 1:46:19 PM
This log details focused development activity within a frontend application on December 30, 2025, across three main files related to a booking system.

**File-Specific Updates:**

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\pages\booking\AgentBookingConfirmation.jsx`**
    *   **Initial State (11:17:06 AM):** The component `AgentBookingConfirmation` is set up with extensive imports from Material-UI, Formik, and Redux for state management and API interactions. It handles responsive page sizing, file selection (`selectedFile`), and managing selected/deselected Packing Lists (`selectedPl`, `deselectedPl`). The core logic includes form submission using `useFormik` to `updateDo` (update Delivery Order) and conditional actions for "save\_and\_next" and "send-to-otm". The "send-to-otm" action triggers XML generation (`useCreateBookingXmlMutation`) and upload (`useUploadBookingXmlMutation`). Error and warning handling utilize `react-hot-toast` and a `PopupAlert` component. Numerous `console.log` statements are present throughout the submission logic.
    *   **Icon Imports (11:37:53 AM, 11:58:32 AM, 12:06:24 PM, 12:07:06 PM, 12:44:39 PM):** Several Material-UI icons were incrementally added: `Download`, `HourglassBottom`, `Numbers`, `CalendarMonth`, `IconButton`, `Delete`, and `Folder`.
    *   **Component Imports (11:44:17 AM, 12:50:52 PM):** `CardField` was imported, suggesting a new UI element for displaying structured data. Later, `SingleFileDropzone` was replaced with `UploadFile`, indicating a refactor or redesign of the file upload mechanism.
    *   **Debugging (12:05:42 PM - 12:40:45 PM):** A `console.log("pldata====",plData);` was added before `handlePageChange`, specifically to log packing list data.
    *   **MUI Component Imports (12:41:27 PM):** `Divider` was added to Material-UI imports.

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\components\screen\booking\form\BookingFormExtend.jsx`**
    *   **Initial State (11:23:50 AM):** This component, `BookingFormExtend`, manages a booking form. It leverages Formik for validation and submission. Redux selectors (`agentBookingForm`, `linkPo`) and `useSaveBookingMutation` are used for data interaction. It includes validation logic for required `vesselList`, `booking_no_line`, and `booking_date` fields, displaying `PopupAlert` messages for warnings or errors. Upon successful submission, it navigates the user or advances the step (`setActiveStep`).
    *   **Minor Changes (11:24:03 AM):** No significant code changes were observed in the provided log for this specific timestamp compared to the previous entry, suggesting minor formatting or whitespace adjustments not captured in the summary.

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\components\common\Cards\CardField.jsx`**
    *   **Initial State (12:14:58 PM):** The `CardField` component is introduced, designed to display a title and subtitle, optionally with an icon. It supports date and custom formatting and includes tooltips for both title and subtitle, with initial text styling preventing overflow.
    *   **Styling Adjustments (12:15:09 AM, 12:18:33 PM, 12:19:14 PM, 12:20:24 PM, 12:21:13 PM):** Iterative changes were made to the `Typography` styles for the `title`. Initially, `tooltip` styling was adjusted. Subsequently, `whiteSpace`, `overflow`, and `textOverflow` properties were modified multiple times, alternating between allowing text wrapping and enforcing `nowrap` (single line) while ensuring visibility and removing ellipses for the title. A `gap:10` was added to the title's display flex container.
    *   **Refactor and Revert (12:23:12 PM, 12:36:24 PM, 12:36:40 PM):** A significant refactor occurred, changing the default `grid` layout from `[4, 8]` to `[5, 7]`, improving `valuFormater` to handle `null`/`undefined` values, and restructuring the JSX to explicitly manage `icon`, `title`, `subtitle`, and `postIcon` props. Styles for `title` and `value` were separated. This major refactor was then momentarily reverted (12:36:24 PM) before being re-applied (12:36:40 PM).

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\components\common\UploadFile.jsx`**
    *   **Initial State (12:50:28 PM):** This component provides a `react-dropzone` based file upload interface, showing drag state and selected file name.
    *   **Major UI Redesign (12:52:45 PM):** The component underwent a significant visual overhaul. The simple dropzone was replaced with a `Grid` layout, featuring a "Drag & Drop File(s) to Upload" area and a "Choose File" button. A placeholder for a file list with `FolderIcon` and `DeleteIcon` was added, initially commented out. The `useDropzone` functionality is still present but less visually integrated.
    *   **Refined Imports and Button (12:54:03 PM):** Imports were updated to include `ThemeButton` and `FolderCopy` (replacing `FolderIcon`). The standard `Button` was replaced with `ThemeButton`.
    *   **File Display and Styling (12:54:35 PM - 1:02:39 PM):** The display of the selected file's name was commented out, then temporarily replaced with hardcoded strings ("kkkk", "Lorem spum.pdf") for testing. Various styling adjustments were made to the "Choose File" button (e.g., commenting/uncommenting `sx` properties, setting/removing `width`) and the file display box (e.g., removing border/borderRadius, adjusting icon button padding).
    *   **Icon Change (1:03:35 PM):** The `FolderCopy` icon for displaying files was replaced with `InsertDriveFile`.

**Patterns and Recurring Elements:**

*   **Frontend-focused Development:** All changes are within the `t360-frontend` directory, indicating work on the user interface.
*   **Material-UI (MUI) Framework:** The consistent use of `@mui/material` components (`Box`, `Grid`, `Stack`, `Typography`, `Card`, `Tooltip`, `IconButton`, `Divider`) and icons (`Add`, `ArrowBack`, `ArrowForward`, `CheckCircle`, `CloudDownload`, `Download`, `HourglassBottom`, `Numbers`, `CalendarMonth`, `Delete`, `Folder`, `FolderCopy`, `InsertDriveFile`) highlights a strong reliance on MUI for building the UI.
*   **React Ecosystem:** The codebase uses core React features (`useState`, `useEffect`, `useMemo`, `useCallback`) along with popular libraries like Formik (`useFormik`) for form management and Redux Toolkit Query (`useSaveBookingMutation`, `useCreateBookingXmlMutation`, etc.) for API state management.
*   **Toasting and Alerts:** `react-hot-toast` is used extensively for user feedback (loading, success, error messages), and a `PopupAlert` component is used for more structured warnings and errors.
*   **Debugging Practices:** Frequent and verbose `console.log` statements suggest an active debugging process during development.
*   **Iterative UI/UX Refinement:** Both `CardField` and `UploadFile` components show a pattern of initial implementation followed by multiple small styling and structural adjustments, indicating fine-tuning of the user experience and visual presentation.
*   **Form Submission and API Interaction:** Components consistently handle form data, prepare payloads (including `FormData` for file uploads), interact with API mutations, and manage the resulting feedback (success messages, warnings, errors).
*   **Booking Feature Development:** The changes are primarily centered around booking-related functionalities, including booking confirmation, saving booking details, handling packing lists, and managing document uploads.

## 2:46:03 PM
The provided logs detail recent modifications within a T360 API backend, focusing on analytics reporting and customer master data management.

### File-Specific Updates:

1.  **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-backend\src\controllers\analytics\transit.controller.ts`**
    *   **Timestamp**: 12/30/2025, 9:54:51 AM
    *   This file handles `getTransitReports` functionality. The key updates involve:
        *   **Dynamic Date Range**: If `fromDate` or `toDate` are not provided in the request query, `defaultDateRange()` is used to set them.
        *   **User Object Retrieval**: `getUserObject` is now called to extract `companyname` and `usercode` from the authenticated request, supporting multi-company or user-specific analytics.
        *   **MBL-wise Conditionality**: A new `mblwiseCondition` object dynamically selects between `mblno` and `voyage` for grouping and filtering, allowing reports to be either master bill of lading (MBL) specific or voyage-specific.
        *   **Dynamic Query Building**: The `transitQueryBuilder` utility is central, constructing the main SQL query based on various parameters like `columnName`, `type`, `viewBy`, date range, `CompanyName`, `mblwiseCondition`, `user_id`, and `reportName`.
        *   **Enhanced Logging**: `logger.error` statements are included for debugging the generated query (`mainQueryUI-`) and general error handling.

2.  **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-backend\src\controllers\code.controller.ts`**
    *   **Timestamp**: 12/30/2025, 10:23:43 AM
    *   This file, despite its name, manages `Customer Master` data. The changes introduce:
        *   **`getAllCustomer` Function**:
            *   Retrieves customer records with pagination (`page`, `perPage`) and dynamic ordering (`orderBy`).
            *   **Dynamic Search**: It queries the `PO_AccountMaster_Customer_Master` table to fetch column names dynamically, then constructs search conditions based on matching `req.query` parameters.
            *   **Data Enrichment**: For each customer, it fetches related data from `account_master_shipper_MAP` (shipper, agent), `document_upload_details` (documents), and `Account_Master_Customer_MAP` (customer mappings).
            *   Uses `chkStr` for sanitizing string values before sending the response.
        *   **`createCustomer` Function**:
            *   **File Upload Integration**: Utilizes an `upload` middleware, suggesting potential file attachment capabilities for customer records.
            *   **Transaction Management**: Initiates a database transaction (`BEGIN`) for atomicity.
            *   **Create/Modify Logic**: Checks if a customer `acode` already exists. If so, it performs a "Modify" operation by deleting existing records from `PO_AccountMaster_Customer_Master`, `agent_po_account_master_type`, `Account_Master_Shipper_MAP`, and `account_master_pic` before re-inserting. If new, `getAccountCode` is used to generate a unique `uacode`.
            *   **Data Sanitization**: `cname` is sanitized (`replace(/\s+/g, ' ').replace(/'/g, '`')`) before insertion.
            *   **Type Handling**: If `ctypelist` is 'CUSTOMER', it inserts a corresponding entry into `agent_po_account_master_type` with a generated `asubcode` using `getAccountSubCode`.
            *   **Mapping Processing**: Parses a JSON `mapping` array from the request body. For each item, it resolves `polcode`, `shippercode`, and `agentcode` by querying `portmaster` and `agent_po_account_master` tables, then inserts the mapping into `Account_Master_Shipper_MAP`.

### Timestamps of Significant Changes:

*   The `transit.controller.ts` was last updated on **12/30/2025, 9:54:51 AM**, indicating recent enhancements to its dynamic reporting capabilities.
*   The `code.controller.ts` (customer master) was updated shortly after, on **12/30/2025, 10:23:43 AM**, reflecting comprehensive changes to customer data retrieval and creation logic.

### Patterns and Recurring Elements:

*   **Database Interaction**: Extensive use of `query` for executing SQL commands, `insertQuery`, and `updateQuery` (though only `query` is directly visible for inserts/updates in the snippets). Database transactions (`BEGIN`) are initiated for complex operations.
*   **Request Handling**: Reliance on `AuthenticatedRequest` for user context and `req.query` for filtering/pagination/parameters, and `req.body` for payload data.
*   **Dynamic SQL Generation**: Queries are frequently constructed dynamically based on request parameters (e.g., search conditions, order clauses, transit report parameters).
*   **Error Handling and Logging**: `logger.error(error)` is consistently used within `try...catch` blocks to log errors and return a `500 Internal Server Error` response.
*   **Utility Functions**: Frequent use of custom utility functions like `defaultDateRange`, `getUserObject`, `transitQueryBuilder`, `removeLastWord`, `getAccountCode`, `getAccountSubCode`, and `chkStr` for common tasks.
*   **JSON Response Structure**: API responses consistently return JSON, often including a `status` (e.g., 200) and data, or an error message on failure.
*   **Data Sanitization**: `chkStr` and explicit string replacements are used to clean and validate data.
*   **Modularization**: Controllers import specific functionalities from `config`, `utils`, `requests`, and `types` folders, indicating a structured project.

## 2:46:09 PM
The provided logs detail recent development efforts on a frontend application, primarily focusing on booking-related features and common UI components.

**File-Specific Updates:**

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\pages\booking\AgentBookingConfirmation.jsx`**
    *   **Initial State (12/30/2025, 11:17:06 AM):** This React component handles agent booking confirmation. It integrates heavily with MUI for UI, `formik` for form management, `react-redux` for state management, and custom API mutations (`useCreateBookingXmlMutation`, `useUploadBookingXmlMutation`, `useUpdateDoMutation`, `useFetchBookingPlListQuery`, `useGetBookingConfirmQuery`). Key functionalities include selecting/deselecting packing lists (PLs), uploading a "DO document," generating and uploading XML, and displaying responsive data grids. Error and warning handling is robust, utilizing `react-hot-toast` and `PopupAlert`/`WarningToast`.
    *   **Incremental Icon and Component Imports (12/30/2025, 12:05:42 PM - 12:44:39 PM):** Several Material-UI icons (`Download`, `Numbers`, `CalendarMonth`, `Divider`, `IconButton`, `Delete`, `Folder`) were progressively added, indicating planned UI enhancements or new feature implementations requiring these visual elements.
    *   **Debugging Statement (12/30/2025, 12:09:38 PM):** A `console.log("pldata====",plData);` statement was added, suggesting active debugging of the packing list data fetching.
    *   **File Upload Component Refactor (12/30/2025, 12:50:52 PM):** The `SingleFileDropzone` component was replaced by a new `UploadFile` component, signaling a significant refactoring or upgrade of the file upload functionality.

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\components\screen\booking\form\BookingFormExtend.jsx`**
    *   **Consistent State (12/30/2025, 11:23:50 AM - 11:24:03 AM):** This component manages an extended booking form, handling various booking details, linked POs, and validation. The content across the two provided timestamps is identical, indicating stability or no notable functional changes during this period. It shows a comprehensive form structure, validation, and integration with Redux for saving booking data. It also uses `react-hot-toast` and `PopupAlert` for user feedback.

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\components\common\Cards\CardField.jsx`**
    *   **Initial Design (12/30/2025, 12:14:58 PM):** This component serves as a reusable field for displaying titled information, supporting various cell types (date, custom format, list) and optional icons/tooltips.
    *   **Tooltip Prop Correction (12/30/2025, 12:15:09 PM):** An invalid `gap` prop was removed from the title's `Tooltip` component.
    *   **Typography Styling Adjustments (12/30/2025, 12:18:33 PM - 12:21:13 PM):** Iterative changes were made to the title's `Typography` styles, initially to allow text wrapping, then refined to ensure the title remains on a single line (`whiteSpace: "nowrap"`, `overflow: "visible"`, `textOverflow: "unset"`) while adjusting alignment and spacing with icons.
    *   **Major Refactor and Prop Expansion (12/30/2025, 12:23:12 PM - 12:36:40 PM):**
        *   The default grid ratio was changed from `[4, 8]` to `[5, 7]`.
        *   A `postIcon` prop was introduced, allowing an icon to be displayed after the subtitle.
        *   The `valuFormater` was enhanced to handle `null`/`undefined` values gracefully (returning "-") and now uses a `switch` statement for clarity.
        *   Layout properties for the main `Grid` and nested `Grid item` components were updated for better alignment and responsiveness.
        *   The subtitle rendering was made more flexible to accept React elements directly.
        *   This refactor was briefly reverted (12:36:24 PM) and then re-applied (12:36:40 PM), indicating a consolidation of the changes.

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\components\common\UploadFile.jsx`**
    *   **Initial Dropzone (12/30/2025, 12:50:28 PM):** A basic file upload component utilizing `react-dropzone` for drag-and-drop functionality and `Paper` for styling.
    *   **UI Redesign and Layout Changes (12/30/2025, 12:52:45 PM):** The component underwent a significant UI overhaul, transitioning from a single `Paper` dropzone to a `Grid` layout. This introduced a dedicated area for drag-and-drop (`sm={3}`) and a "File List" display (`sm={9}`). The native HTML `input type="file"` was integrated, replacing the `useDropzone` `getRootProps` for the visual drag-and-drop element. MUI `Button` was used for file selection.
    *   **Component and Icon Refinements (12/30/2025, 12:54:03 PM):** The MUI `Button` was replaced with a custom `ThemeButton`, and specific icons (`Delete`, `FolderCopy`) from Material-UI were imported and used.
    *   **Styling and Debugging Iterations (12/30/2025, 12:54:35 PM - 1:03:35 PM):** A rapid series of minor changes occurred:
        *   Filename display was temporarily commented out or hardcoded ("kkkk", "Lorem spum.pdf"), suggesting debugging of file information rendering.
        *   Background color of the dropzone `Box` was adjusted.
        *   `ThemeButton` styling (`sx` properties like `width`, `backgroundColor`) was toggled or modified several times, indicating fine-tuning of button appearance.
        *   Layout spacing (`mt`, `mb`) on the file list `Grid item` was adjusted.
        *   Borders were removed from the file display `Box`.
        *   `IconButton` padding was repeatedly adjusted.
        *   Finally, the `FolderCopy` icon for displayed files was replaced with `InsertDriveFile`.

**Patterns and Recurring Elements:**

*   **Frequent Saves and Minor Tweaks:** Many timestamps are very close, often seconds apart, with identical or very subtle code changes, particularly in `AgentBookingConfirmation.jsx` and `UploadFile.jsx`. This suggests an active, iterative development process with frequent saves.
*   **UI Component-Driven Development:** The consistent use of Material-UI components (`Box`, `Grid`, `Stack`, `Typography`, `Tooltip`, `IconButton`, `Divider`) and custom common components (`OutlinedButton`, `ThemeButton`, `InputBoxExtend`, `AppDatePickerExtend`, `ThemedGrid`, `PopupAlert`, `WarningToast`, `CardField`, `UploadFile`) indicates a modular and component-based approach to frontend development.
*   **Redux Toolkit for API Interaction:** All significant functional components (`AgentBookingConfirmation`, `BookingFormExtend`) leverage Redux Toolkit's `useQuery` and `useMutation` hooks for data fetching and manipulation, pointing to a centralized and standardized API interaction pattern.
*   **Formik for Form Management:** `useFormik` is consistently used for handling form state, validation, and submission, ensuring a unified approach to forms across the application.
*   **Gradual UI Refinement:** The evolution of `CardField.jsx` and `UploadFile.jsx` shows a clear pattern of initial implementation followed by iterative styling adjustments, layout changes, and prop enhancements to improve flexibility and presentation.
*   **Debugging Practices:** The presence of `console.log` statements and temporary hardcoded values in `UploadFile.jsx` highlights typical frontend debugging methods during development.

## 3:46:00 PM
**File: `c:\Users\ridap\OneDrive\Documents\T360_Api\t360-backend\src\controllers\analytics\transit.controller.ts`**
**Timestamp: 12/30/2025, 9:54:51 AM**
This file introduces the `getTransitReports` function, which is responsible for fetching and presenting transit-related analytical data. Key updates include:
*   Retrieval of various query parameters like `group_by_column`, `fromDate`, `toDate`, `mblwise`, `viewBy`, `type`, and `reportName`.
*   Automatic application of a `defaultDateRange` if `fromDate` or `toDate` are not provided.
*   Dynamic construction of a `userObj` based on the authenticated user and company/access details from the query.
*   Conditional logic to determine `mblwiseCondition` for SQL queries, selecting either distinct MBL numbers or voyages based on the `mblwise` parameter.
*   Integration with a `transitQueryBuilder` to construct complex SQL queries for fetching analytics data.
*   Execution of the constructed query and sending back the `analysticsData` and `customizer` in the response.
*   Includes robust error handling and logging for issues during report generation.

**File: `c:\Users\ridap\OneDrive\Documents\T360_Api\t360-backend\src\controllers\code.controller.ts`**
**Timestamp: 12/30/2025, 10:23:43 AM**
This file contains two main functionalities for managing customer master data: `getAllCustomer` and `createCustomer`.

*   **`getAllCustomer`**: This function is designed to retrieve a paginated list of customer records.
    *   It supports dynamic searching by allowing query parameters to map directly to database columns in `PO_AccountMaster_Customer_Master`.
    *   It also supports ordering results by a specified column and direction (`orderBy` parameter).
    *   The function performs several additional queries to enrich the customer data, fetching associated shipper mappings (`account_master_shipper_MAP`), uploaded documents (`document_upload_details`), and customer mappings (`Account_Master_Customer_MAP`) related to each customer's `acode`.
    *   All retrieved data is aggregated into a comprehensive JSON response for each customer, utilizing a `chkStr` utility for data cleanliness.
*   **`createCustomer`**: This function handles the creation or modification of customer records.
    *   It integrates a file upload mechanism using the `upload` middleware.
    *   It extracts numerous customer details from the request body, including contact information, sales representative, status, and specific mappings like `descartes_customer_map` and `isf_party_map`.
    *   The function sanitizes the customer name (`cname`) before database operations.
    *   It uses database transactions (`BEGIN`) to ensure data integrity during creation or modification.
    *   It checks for existing customers by `acode`: if found, it enters a 'Modify' mode, deleting old related records from `PO_AccountMaster_Customer_Master`, `agent_po_account_master_type`, `Account_Master_Shipper_MAP`, and `account_master_pic` before proceeding. If new, it generates a unique `acode` using `getAccountCode`.
    *   It inserts or updates the main customer record in `PO_AccountMaster_Customer_Master`.
    *   It includes logic to handle customer types (`ctypelist === 'CUSTOMER'`) by generating an `asubcode` and inserting into `agent_po_account_master_type`.
    *   It parses `mapping` data (presumably for shippers/agents), dynamically retrieves corresponding codes (`polcode`, `shippercode`, `agentcode`) from `portmaster` and `agent_po_account_master`, and then inserts these mappings into `Account_Master_Shipper_MAP`.
    *   The provided log for this function is incomplete.

**Patterns and Recurring Elements:**
*   **Database Interaction:** Both files extensively use a `query` utility for executing SQL commands, indicating a centralized database access layer.
*   **Error Handling & Logging:** `try...catch` blocks are consistently used to manage potential errors, with `logger.error` for capturing exceptions and `logger.info` for debugging and tracing critical data flows. Responses typically include a 500 status for server errors.
*   **Dynamic SQL Generation:** SQL queries are often constructed dynamically based on request parameters (e.g., search conditions, ordering, mblwise selection) to provide flexible data retrieval.
*   **Utility Function Usage:** The code leverages several helper functions for common tasks such as date range handling (`defaultDateRange`), user object retrieval (`getUserObject`), string cleaning (`chkStr`), and dynamic code generation (`getAccountCode`, `getAccountSubCode`).
*   **Request Parameter Handling:** Both controllers extensively process query and body parameters from `AuthenticatedRequest` objects to drive their logic.
*   **Data Transformation:** Data fetched from the database is frequently transformed or sanitized before being sent in the response or used in further operations.

## 3:46:44 PM
The code changes exclusively concern the file `c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\pages\shipment\tracking-stepper.tsx`, which appears to implement a React component for a shipment tracking stepper. The component visualizes the progress of a shipment, displaying different stages (Port of Loading, Port of Discharge/Terminal, Port to Rail, Port to Door) based on the `shipmentProgress.scope`.

The changes primarily revolve around refining the logic for determining the "completion" status, "percentage" progress, and the display of icons (pin vs. terminal, ship/railway/truck icons, and their colors/positions) for each step in the tracking timeline.

Key changes and patterns observed across multiple timestamps:

1.  **POD/Terminal Completion Logic (Frequent Adjustments)**:
    *   **12/30/2025, 2:02:12 PM**: The completion criteria for the POD/Terminal stage, specifically for "Port-Rail-Door" shipments, was made more explicit, changing from `podCompleted` (which uses a helper function) to directly checking `!!info.eta && !!info.ata && !!info.pod`.
    *   **12/30/2025, 2:04:44 PM - 2:05:03 PM**: A temporary regression where `completed` was simplified to `info.pod` was introduced and then corrected using a new `podData` variable that maintained the `eta`, `ata`, and `pod` checks.
    *   **12/30/2025, 3:00:53 PM**: The completion logic for POD in the "Port-Rail-Door" path was relaxed to `info.pod || isEtaAtaAvailable`, meaning completion could be met if either condition was true.
    *   **12/30/2025, 3:04:11 PM**: This was then made stricter again to `info.pod && isInlandAtaAvailable`, requiring both conditions to be true.
    *   **12/30/2025, 3:18:12 PM**: The completion logic was modified to `info.pod || isRailVerified`, making it dependent on `info.pod` or `isRailVerified`.

2.  **Icon and Styling Conditions (Iterative Refinements)**:
    *   **12/30/2025, 1:58:19 PM - 2:00:36 PM**: Repeated minor tweaks and simplifications to the `pinIcon` logic within the "POD / TERMINAL" section for "Port-Rail-Door" shipments, often simplifying complex conditions to a fixed "terminal" icon.
    *   **12/30/2025, 2:19:42 PM**: The `ShipIcon` color condition for POL in "Port-Rail-Door" was updated to consider `isEtaAtaAvailable` alongside `isRailVerified`.
    *   **12/30/2025, 2:31:41 PM**: The `centerIcon` condition for POL was modified to include `isEtaAtaAvailable`. The icon logic for POD in "Port-Rail-Door" was changed to always render `RailwayIcon` if `hasRail` is true, implying it's the default icon.
    *   **12/30/2025, 2:31:50 PM**: The condition for showing the POD icon for "Port-Rail-Door" was flipped from `!podCompleted` to `podCompleted`.
    *   **12/30/2025, 2:32:50 PM**: The `centerIcon` condition for POD in "Port-Rail-Door" was changed from `!podCompleted && isRailVerified` to `podCompleted && isRailVerified`.

3.  **Percentage Calculation Updates**:
    *   **12/30/2025, 2:20:13 PM - 2:21:05 PM**: The percentage calculation for the POL stage within "Port-Rail-Door" scope was repeatedly altered, moving from a `100:50:0` split to a `50:100:50` split based on various conditions (`notDeprted`, `isRailVerified`, `isEtaAtaAvailable`).
    *   **12/30/2025, 3:09:42 PM - 3:10:55 PM**: The percentage calculation for POD in "Port-Rail-Door" was adjusted to differentiate between 0% and 50% based on `trackingInfo.inland_rail_move`.

4.  **Date Fallback and Reversions (Ongoing Issue)**:
    *   **12/30/2025, 2:41:30 PM - 2:48:15 PM**: Multiple attempts were made to introduce fallback date strings (e.g., "2025-11-05") for `info.ata` in `polToPodcompletedValidation` and for display in subtitles. These changes were introduced and then fully reverted in a subsequent commit, suggesting issues or reconsiderations with default date handling.
    *   **12/30/2025, 2:47:09 PM**: A fallback date was added to `isEtaAtaAvailable`'s calculation, then reverted at **2:48:15 PM**, and briefly re-added at **2:49:45 PM** before another reversion at **2:49:53 PM**.
    *   **12/30/2025, 3:03:30 PM**: A fallback date ("2025-09-27") was added to `finalETA` in `isInlandAtaAvailable`.
    *   **12/30/2025, 3:06:33 PM**: A fallback date ("2025-09-27") was added to `finalATA` in `isRailVerified`, and later removed at **3:12:11 PM**.

5.  **Refactoring and Debugging**:
    *   **12/30/2025, 2:09:38 PM**: The subtitle formatting for "PORT → RAIL" was streamlined, and a `console.log` was added, indicating debugging. The `console.log` appears repeatedly in later logs, suggesting it remained for some time.
    *   **12/30/2025, 2:18:55 PM - 2:19:02 PM**: A temporary inversion of the `notDeprted` variable's meaning was introduced and quickly reverted, highlighting variable definition issues.
    *   **12/30/2025, 2:44:56 PM - 2:46:20 PM**: Temporary literal strings like "ETA:1234" were introduced in subtitles, likely for quick visual debugging, and then removed. Similarly for "ETA:123" at **3:02:17 PM - 3:02:25 PM**.

6.  **POL and PORT -> RAIL/DOOR Completion Logic**:
    *   **12/30/2025, 2:18:04 PM**: The POL completion in "Port-Rail-Door" simplified by removing `(hasRail && isRailVerified)` from its `completed` condition.
    *   **12/30/2025, 2:22:20 PM - 2:22:42 PM**: `isEtaAtaAvailable` was added to the `completed` and `centerIcon` conditions for POL in "Port-Rail-Door" then immediately reverted.
    *   **12/30/2025, 2:57:39 PM**: The `railLabel` generation logic in the "PORT → RAIL" stage was made more robust, requiring `info.delivery_customer_date` to be present alongside `info.delivery_customer_location` for it to be considered as a primary label.
    *   **12/30/2025, 3:20:49 PM**: The `completed` logic for both "PORT → RAIL" and "PORT → DOOR" stages was updated to factor in `isRailVerified`.

In summary, the developers were actively iterating on the conditional logic within the `getTrackingDetails` function to precisely define completion states, progress percentages, and visual cues for various shipment progress scenarios, particularly for multimodal (Port-Rail-Door) shipments. There were also several temporary debugging insertions and reversions of logical changes, indicating an ongoing process of testing and refining the complex conditional flow. No fundamental changes to the component's structure or its external interfaces were made.

## 4:47:47 PM
The provided code log details recent development activity across two critical backend controllers, both timestamped on December 30, 2025, indicating focused updates within a short timeframe.

### File: `c:\Users\ridap\OneDrive\Documents\T360_Api\t360-backend\src\controllers\analytics\transit.controller.ts`
**Timestamp:** 12/30/2025, 9:54:51 AM
This file introduces a `getTransitReports` function designed to fetch analytical data related to transit operations. Key updates include:
*   **Dynamic Query Building:** The function now dynamically constructs SQL queries using a `transitQueryBuilder`, incorporating parameters like `group_by_column`, `fromDate`, `toDate`, `viewBy`, `type`, and `reportName`.
*   **MBL-wise Conditionality:** A significant addition is the `mblwiseCondition` logic, which alters the SQL `SELECT`, `CONDITION`, and `GROUP BY` clauses based on whether `mblwise` is set to "true". If true, it selects distinct MBL numbers; otherwise, it selects distinct voyages.
*   **User and Company Context:** It fetches `CompanyName` and `user_id` using `getUserObject` based on the authenticated request and query parameters, ensuring data is scoped correctly.
*   **Date Range Handling:** Implements a fallback to `defaultDateRange` if `fromDate` or `toDate` are not provided in the request.
*   **Error Logging:** Includes `logger.error` for comprehensive error reporting.

### File: `c:\Users\ridap\OneDrive\Documents\T360_Api\t360-backend\src\controllers\code.controller.ts`
**Timestamp:** 12/30/2025, 10:23:43 AM
This file contains extensive updates for customer management, including functionalities to retrieve and create/update customer records.

#### `getAllCustomer` Function:
*   **Pagination and Sorting:** Supports dynamic pagination (`page`, `perPage`) and sorting (`orderBy`), allowing clients to specify the column and direction for ordering customer data.
*   **Dynamic Search:** It dynamically extracts column names from the `PO_AccountMaster_Customer_Master` table and uses them to build a `searchCondition` based on `req.query` parameters, enabling flexible filtering.
*   **Comprehensive Customer Data Retrieval:** Beyond basic customer details, it performs multiple linked queries to fetch:
    *   `shipperData` from `account_master_shipper_MAP`.
    *   `documentData` from `document_upload_details`.
    *   `customerMapData` from `Account_Master_Customer_MAP`.
    These related datasets are then combined with the main customer information into a single response.
*   **Data Sanitation:** Utilizes a `chkStr` utility to ensure all retrieved string fields are properly handled.

#### `createCustomer` Function:
*   **Upsert Logic:** This function handles both creation and modification of customer records. It first checks for an existing customer using the `acode`.
    *   If found, it operates in 'Modify' mode, deleting existing related entries (customer, type, shipper maps, PIC) before re-inserting.
    *   If not found, it's a 'NEW' operation, generating a new `acode` using `getAccountCode`.
*   **Transaction Management:** Initiates a database transaction (`BEGIN`) to ensure data consistency during complex insertions and updates.
*   **Customer Type Handling:** Specifically handles the 'CUSTOMER' `ctypelist` entry, generating an `asubcode` and inserting into `agent_po_account_master_type`.
*   **Shipper Mapping:** Processes a `mapping` array from the request body to insert detailed shipper information into `Account_Master_Shipper_MAP`. This includes resolving `polcode`, `shippercode`, and `agentcode` from other master tables.
*   **Input Sanitization:** Sanitizes the `cname` field to handle spaces and apostrophes.
*   **File Upload Integration:** The function is wrapped within an `upload` middleware, indicating potential file attachment capabilities during customer creation/modification, although the detailed file processing logic isn't fully shown.

### Patterns and Recurring Elements:
*   **Database Centric:** Both controllers heavily rely on a `query` function for all interactions with the PostgreSQL database, including complex selects, inserts, and deletes.
*   **Error Handling Consistency:** Both files implement consistent `try...catch` blocks with `logger.error` and standardized 500 Internal Server Error responses.
*   **Dynamic Query Construction:** A recurring pattern is the dynamic building of SQL queries based on user input and various conditions, enhancing flexibility.
*   **Utility Function Usage:** Frequent calls to custom utility functions (e.g., `getUserObject`, `defaultDateRange`, `getAccountCode`, `chkStr`) for common tasks like data fetching, code generation, and data sanitation.
*   **Timestamp Proximity:** The timestamps indicate these changes were likely part of a single development session, focusing on analytics reporting and comprehensive customer data management.

## 4:48:00 PM
The log details recent development focusing on the `AgentBookingConfirmation.jsx` page, `BookingFormExtend.jsx` component, and common UI elements like `CardField.jsx` and `UploadFile.jsx`.

**File-Specific Updates:**

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\pages\booking\AgentBookingConfirmation.jsx`**
    *   **Initial Setup (12/30/2025, 11:17:06 AM):** The file was created or significantly updated to include extensive Material-UI imports, state management using `useState`, `useMemo`, and `react-redux`'s `useSelector`. It integrates several API mutations for booking operations (XML creation, upload, booking confirmation, DO updates, fetching PL lists) from `agentBookingApi`. Form handling is managed with `useFormik` and a `bookingConfirmationValidation` schema. The `onSubmit` logic includes conditional actions for "save\_and\_next" and "send-to-otm" (XML generation and upload), with detailed toast notifications for success, errors, and warnings. Responsive page sizing based on screen breakpoints is also implemented.
    *   **Icon Additions (12/30/2025, 11:37:53 AM onwards):** Multiple Material-UI icons were progressively added to the imports: `Download`, `HourglassBottom`, `Numbers`, `CalendarMonth`, `Divider`, `IconButton`, `Delete`, `Folder`. This suggests ongoing UI development or refinement of data display with new visual cues.
    *   **Component Integration (12/30/2025, 11:44:17 AM & 12:50:52 PM):** The `CardField` component was imported, and a notable change involved replacing `SingleFileDropzone` with `UploadFile`, indicating a custom or updated file upload mechanism was introduced or switched.
    *   **Debugging (12/30/2025, 12:09:38 PM to 12:39:51 PM):** A `console.log("pldata====",plData);` statement was added, removed, and re-added multiple times, suggesting active debugging efforts related to packing list data.

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\components\screen\booking\form\BookingFormExtend.jsx`**
    *   **Extensive Form Logic (12/30/2025, 11:23:50 AM):** This component manages an extended booking form, also using `useFormik` and `react-redux`. It handles initial values for various booking fields (header, port, supplier, linked POs) and incorporates a `getBookingHeaderValidationSchema`. The `onSubmit` function processes and saves booking data, including transforming linked PO list items and recovering values. It includes critical validation for `vesselList` and core booking numbers/dates, showing error and warning alerts via `toast` and `PopupAlert`/`WarningToast`. There were no functional code changes visible in the immediate subsequent commit at 11:24:03 AM.

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\components\common\Cards\CardField.jsx`**
    *   **Initial Display (12/30/2025, 12:14:58 PM):** The component was designed to display a title and subtitle, with optional icons and custom formatting for dates and lists. It initially applied ellipsis for overflow text.
    *   **Styling Adjustments & Refactoring (12/30/2025, 12:15:09 PM to 12:36:40 PM):**
        *   Minor tweaks were made to `Tooltip` props and `Typography` styles, particularly regarding text wrapping (`whiteSpace`, `overflow`, `textOverflow`) for the title.
        *   A significant refactoring occurred (12:23:12 PM), changing default grid layout, enhancing the `valuFormater` function to handle null/undefined values, and allowing `subtitle` to be a React element. Layout properties like `alignItems` and `wrap` were added to the main `Grid` container. This refactoring was temporarily reverted (12:36:24 PM) and then re-applied (12:36:40 PM), indicating careful consideration and implementation of structural changes.

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\components\common\UploadFile.jsx`**
    *   **Initial Dropzone (12/30/2025, 12:50:28 PM):** Started as a simple `react-dropzone` based component showing a cloud upload icon and basic text feedback.
    *   **Major UI Redesign (12/30/2025, 12:52:45 PM onwards):** The component underwent a significant visual and structural overhaul. It transitioned from a single paper-style dropzone to a two-column grid layout, separating the "Drag & Drop File(s) to Upload" area from a "File List" display. The implementation of `useDropzone` became less direct, with a standard file input and custom button (`ThemeButton`). Various stylistic changes were applied to margins, padding, and background colors.
    *   **Icon and Text Updates (12/30/2025, 12:54:03 PM onwards):** Icons were updated from `FolderIcon` to `FolderCopy` and later to `InsertDriveFile` (1:03:35 PM). Placeholder text for the uploaded file was changed from commented-out `file.name` to static "kkkk" and then to "Lorem spum.pdf".

**Patterns and Recurring Elements:**

*   **Frontend Focus:** All changes are within the `t360-frontend` directory, indicating active development on the user interface.
*   **Booking Module Development:** A large portion of the changes are concentrated around booking-related pages and forms, specifically `AgentBookingConfirmation` and `BookingFormExtend`, suggesting continuous iteration on core booking functionalities.
*   **Material-UI for UI Components:** The extensive use and repeated import additions of Material-UI components (`Box`, `Card`, `Grid`, `Stack`, `Typography`, `IconButton`, various icons) confirm Material-UI is the primary UI library, with ongoing refinement of component usage and styling.
*   **State Management and API Integration:** `react-redux` (`useSelector`) and `RTK Query` mutations are central to how data is managed and fetched/sent to the backend across the booking-related components.
*   **Form Handling:** `Formik` is consistently used for form state and validation, paired with custom validation schemas.
*   **User Feedback:** `react-hot-toast` and custom `PopupAlert`/`WarningToast` components are widely used for providing user notifications regarding operations and errors.
*   **Iterative Design and Debugging:** The repeated saving of identical code, slight styling tweaks, and explicit console logs point to an iterative development process that includes frequent saving, UI adjustments, and debugging.
*   **Component Refinement:** The `CardField` and `UploadFile` components show a pattern of initial implementation, followed by significant refactoring and numerous small adjustments to improve functionality, styling, and user experience.