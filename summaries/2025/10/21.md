# Activity Summary for 10/21/2025

## 1:28:40 PM
The `enquiryService.ts` file, last updated on October 21, 2025, at 11:02:05 AM, contains significant updates to how enquiry and related information is retrieved.

**File-specific updates for `enquiryService.ts`:**

*   **`getAll` function:** This function for retrieving all enquiries has been enhanced for performance and data enrichment.
    *   It now fetches all nominated agents from the `nominated_agent` table in a single query upfront, then uses a `Map` for efficient lookup by `serial_id`.
    *   Each enquiry record is subsequently enriched with a new `agent_details` array, containing the full details of its nominated agents, resolved from the pre-fetched agent data.
    *   The query construction utilizes a `QueryBuilder` for dynamic pagination, sorting by `created_at` (or a specified field) and direction, and filtering by `enq_no`.
    *   Error logging using `logger.info` has been implemented for better traceability.
*   **`getEnquiryCardInfo` function:** A new function has been introduced to provide aggregated "card" information.
    *   Despite being in `enquiryService`, this function queries the `vendor` table to count `active_vendor`, `inactive_vendor`, and `total_vendor` records.
    *   It supports various filtering options including specific date ranges (`fromDate`, `toDate`) and pre-defined time filters like "weekly" and "monthly", dynamically constructing SQL `WHERE` clauses.

**General patterns and recurring elements:**

*   Consistent use of `HttpStatusCodes` for API responses.
*   Reliance on a `QueryBuilder` utility for constructing complex SQL queries, promoting reusability and reducing direct string concatenation for main queries.
*   Emphasis on performance optimization, as seen in the pre-fetching and mapping of nominated agents in `getAll`.
*   Dynamic SQL query generation based on request parameters for filtering and sorting.
*   Error handling includes both `logger.info` for internal logging and `console.error` for immediate debugging, along with returning appropriate `500 Internal Server Error` responses.