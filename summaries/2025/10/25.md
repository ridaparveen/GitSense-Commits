# Activity Summary for 10/25/2025

## 8:22:12 PM
The `analytics.route.ts` file, last updated on 10/22/2025 at 11:01:53 AM, defines a comprehensive set of API routes for an analytics module within the `t360-backend` project.

Key updates and functionalities include:

*   **Dashboard Management:** Full CRUD (Create, Read, Update, Delete) operations for dashboards are exposed via `/dashboards` endpoints, managed by `core.view.controller`.
*   **Core Analytics Data:** Routes like `/dashboardEndPoints` and `/metricsList` are available to fetch lists of dashboard endpoints and metrics, respectively. An `/excelExport` endpoint is also provided for data export.
*   **User Preferences:** Endpoints `/save_sequence` and `/save_size` allow users to save preferences related to data display or layout.
*   **Specific Analytical Reports:** Dedicated routes are established for various report types, including `/cbm`, `/kgs`, `/teu`, `/containers`, `/transit`, and `/Tables/tableData`. Each of these points to a specific controller (e.g., `cbm.controller`, `kgs.controller`) for fetching the relevant reports.

A clear pattern observed is the modular organization of controllers within the `src/controllers/analytics/` directory, with each specific report type or core functionality having its own dedicated controller file, and the routes directly mapping to these functionalities.

## 8:22:21 PM
The `AnalyticsScreen.jsx` file, last updated on 10/23/2025, 3:18:36 PM, serves as a central analytics dashboard component.

**File-Specific Updates:**
- **`AnalyticsScreen.jsx`**: This component is responsible for orchestrating the fetching, processing, and display of analytics data.
    - It heavily utilizes Redux for state management, including `useDispatch` and `useSelector` to interact with `analytics`, `settings`, and `auth` slices of the Redux store.
    - Data fetching is managed through Redux Toolkit Query, specifically using `useFetchDashboardsQuery` for available dashboards, `useLazyFetchEndpointsQuery` for analytics endpoints, and `useLazyFetchReportQuery` for individual reports.
    - A key `useEffect` hook handles the initial loading of dashboards and subsequently fetches analytics endpoints (either default or based on a selected custom dashboard) and then dispatches concurrent calls to `fetchReport` for all associated reports.
    - Report queries include parameters like `apiKey` (hardcoded as "nRKniUrJd6rjNCyvT8iRRHmG"), `reportName`, `userid`, a dynamically set date range (defaulting to "year_2_date"), `displayBy`, `viewBy`, `companyname`, and `access`.
    - Fetched report data is processed using `metricsPackageHandler` and then stored in the Redux state via `setAllMetric`.
    - Loading states are managed using `setLoading` to display a `Loader` component.
    - The component implements role-based logic: if the user's role is 'CUSTOMER', their `companyname` is automatically set as the `selectedCustomer`; if 'ADMIN' and no customer is selected, an informative `Alert` is displayed.
    - The UI integrates various common components such as `ScreenToolbar`, `ThemedBreadcrumb`, `AnalyticsToolbar`, `Alert`, and `Loader`.

**Timestamps of Significant Changes:**
The provided log indicates one significant update for `AnalyticsScreen.jsx` on 10/23/2025, 3:18:36 PM, which encompasses the detailed functionality described above.

**Patterns or Recurring Elements:**
- **Extensive Redux Toolkit Query Usage**: The component demonstrates a strong pattern of using RTK Query for all API interactions, facilitating centralized and efficient data fetching.
- **Conditional Rendering**: There's a recurring pattern of conditionally rendering UI elements based on loading states (`isLoading`), user roles (`user.role`), and the presence of selected data (e.g., `mainState.selectedCustomer`).
- **Role-Based Access Control**: API queries consistently include `access` and `companyname` parameters, and UI logic adapts based on `user.role`, indicating a system designed with role-based access control.
- **Moment.js for Date Handling**: `moment` is used to format dates for API requests, specifically `YYYY-MM-DD`.
- **Hardcoded API Key**: The `apiKey: "nRKniUrJd6rjNCyvT8iRRHmG"` in `fetchReport` query is a hardcoded value, which is a recurring element within this specific API call.