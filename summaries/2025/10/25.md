# Activity Summary for 10/25/2025

## 8:22:12 PM
The `analytics.route.ts` file, last updated on 10/22/2025 at 11:01:53 AM, defines a comprehensive set of API routes for an analytics module within the `t360-backend` project.

Key updates and functionalities include:

*   **Dashboard Management:** Full CRUD (Create, Read, Update, Delete) operations for dashboards are exposed via `/dashboards` endpoints, managed by `core.view.controller`.
*   **Core Analytics Data:** Routes like `/dashboardEndPoints` and `/metricsList` are available to fetch lists of dashboard endpoints and metrics, respectively. An `/excelExport` endpoint is also provided for data export.
*   **User Preferences:** Endpoints `/save_sequence` and `/save_size` allow users to save preferences related to data display or layout.
*   **Specific Analytical Reports:** Dedicated routes are established for various report types, including `/cbm`, `/kgs`, `/teu`, `/containers`, `/transit`, and `/Tables/tableData`. Each of these points to a specific controller (e.g., `cbm.controller`, `kgs.controller`) for fetching the relevant reports.

A clear pattern observed is the modular organization of controllers within the `src/controllers/analytics/` directory, with each specific report type or core functionality having its own dedicated controller file, and the routes directly mapping to these functionalities.

## 8:22:21 PM
The `AnalyticsScreen.jsx` file, last updated on 10/23/2025, 3:18:36 PM, serves as a central analytics dashboard component.

**File-Specific Updates:**
- **`AnalyticsScreen.jsx`**: This component is responsible for orchestrating the fetching, processing, and display of analytics data.
    - It heavily utilizes Redux for state management, including `useDispatch` and `useSelector` to interact with `analytics`, `settings`, and `auth` slices of the Redux store.
    - Data fetching is managed through Redux Toolkit Query, specifically using `useFetchDashboardsQuery` for available dashboards, `useLazyFetchEndpointsQuery` for analytics endpoints, and `useLazyFetchReportQuery` for individual reports.
    - A key `useEffect` hook handles the initial loading of dashboards and subsequently fetches analytics endpoints (either default or based on a selected custom dashboard) and then dispatches concurrent calls to `fetchReport` for all associated reports.
    - Report queries include parameters like `apiKey` (hardcoded as "nRKniUrJd6rjNCyvT8iRRHmG"), `reportName`, `userid`, a dynamically set date range (defaulting to "year_2_date"), `displayBy`, `viewBy`, `companyname`, and `access`.
    - Fetched report data is processed using `metricsPackageHandler` and then stored in the Redux state via `setAllMetric`.
    - Loading states are managed using `setLoading` to display a `Loader` component.
    - The component implements role-based logic: if the user's role is 'CUSTOMER', their `companyname` is automatically set as the `selectedCustomer`; if 'ADMIN' and no customer is selected, an informative `Alert` is displayed.
    - The UI integrates various common components such as `ScreenToolbar`, `ThemedBreadcrumb`, `AnalyticsToolbar`, `Alert`, and `Loader`.

**Timestamps of Significant Changes:**
The provided log indicates one significant update for `AnalyticsScreen.jsx` on 10/23/2025, 3:18:36 PM, which encompasses the detailed functionality described above.

**Patterns or Recurring Elements:**
- **Extensive Redux Toolkit Query Usage**: The component demonstrates a strong pattern of using RTK Query for all API interactions, facilitating centralized and efficient data fetching.
- **Conditional Rendering**: There's a recurring pattern of conditionally rendering UI elements based on loading states (`isLoading`), user roles (`user.role`), and the presence of selected data (e.g., `mainState.selectedCustomer`).
- **Role-Based Access Control**: API queries consistently include `access` and `companyname` parameters, and UI logic adapts based on `user.role`, indicating a system designed with role-based access control.
- **Moment.js for Date Handling**: `moment` is used to format dates for API requests, specifically `YYYY-MM-DD`.
- **Hardcoded API Key**: The `apiKey: "nRKniUrJd6rjNCyvT8iRRHmG"` in `fetchReport` query is a hardcoded value, which is a recurring element within this specific API call.

## 8:22:45 PM
The provided log details a series of code changes within a frontend application, specifically focusing on analytics, planboard, and common UI components. The timestamps indicate all changes occurred on October 24, 2025, between 11:12 AM and 6:05 PM, suggesting a continuous development session.

### File-Specific Updates:

*   **`src\types\enum.ts` (and `src\types\enum.type.ts`, `src\types\common.ts`)**:
    *   **Timestamp: 10/24/2025, 11:12:22 AM**: Initial enum definitions for `UserRoleEnum`, `UserStatusEnum`, `PL_STATUS`, `TRM_STATUS`, `SHIPMENT_STATUS_OBJ`, `TierTypeEnum`, `BookingStatusEnum`, `CngBookingStatusEnum`, `AnalyticsChartType`, `BookingAtypeEnum`, `CNG_STATUS`, `ISF_STATUS`, and `SPR_INVOICE_STATUS`. `SHIPMENT_STATUS_OBJ` is particularly detailed with color, background, and MUI icons.
    *   **Timestamp: 10/24/2025, 5:16:14 PM - 5:27:44 PM**: Several changes across `enum.type.ts`, `common.ts`, and `enum.ts` related to the `AnalyticsChartType`. Initially, it was an object literal. It was then converted to an `enum`, then to a `type` alias with literal string unions, and finally `SHIPMENT_STATUS_OBJ` was commented out in `enum.type.ts` and restored in `enum.ts`. This indicates a refactoring effort to standardize how `AnalyticsChartType` is defined and used, potentially addressing type-safety concerns. The `SHIPMENT_STATUS_OBJ` commenting out and restoring suggests an undo or testing phase for a larger refactor, possibly related to moving or consolidating types.

*   **`src\components\screen\analytics\methods.ts`**:
    *   **Timestamps: 10/24/2025, 11:12:33 AM, 11:13:13 AM**: Minor changes, likely formatting or small logic adjustments in `downloadReportSpreadsheet` and `metricsPackageHandler`.
    *   **Timestamp: 10/24/2025, 11:19:54 AM**: Significant refactoring. The file now imports `React` and introduces explicit TypeScript interfaces (`AnalyticsData`, `Customizer`, `Metric`, `Endpoint`, `FormatSettings`, `MetricsPackageReturn`) and an `enum AnalyticsChartType` (though this enum is later moved/refactored as seen in `src\types\enum.ts`). The `metricsPackageHandler` function is converted to use these types, enhancing type safety and readability.
    *   **Timestamp: 10/24/2025, 2:38:19 PM - 5:26:39 PM**: Continuous updates related to the `AnalyticsChartType` definition, mirroring the changes seen in `src\types\enum.ts`. This file consistently imports `AnalyticsChartType` and `AnalyticsChart` from `types/enum.type` and adjusts its internal type definitions accordingly, indicating a dependency on the external type definitions.

*   **`src\components\screen\analytics\AnalyticsToolbar.tsx`**:
    *   **Timestamp: 10/24/2025, 11:20:34 AM**: Changed the import path for `logo` from `../../../assets/images/TransmodalBlackLogo.png` to `../../../assets/logo.svg`. The `downloadDashboardPDF` function was updated to incorporate a logo into the PDF export, reserving space for it and adding it before the dashboard content.
    *   **Timestamp: 10/24/2025, 2:54:15 PM - 6:03:13 PM**: Numerous updates:
        *   Switched Redux `useSelector` to use `RootState` for type safety.
        *   Updated `SelectBox` component usage by removing `sx` and `none` props, which might be deprecated or moved.
        *   Adjusted the `permission` check for `SelectCustomerPanel`, moving it from a conditional render (`{permission?.selectCustomer && ...}`) to always rendering it, then back to conditional rendering again. This suggests testing or changing access control logic.
        *   Added `console.log` statements for `permission` to debug access control.

*   **`src\components\screen\analytics\analyticsContainer.tsx`**:
    *   **Timestamp: 10/24/2025, 11:25:18 AM**: Updated Redux selectors to use `RootState` for `mainState` and `settingsState`. The `user` object is now parsed from `localStorage` instead of being selected from a Redux slice (`state.auth.user`).
    *   **Timestamp: 10/24/2025, 2:55:12 PM - 2:55:26 PM**: `mainState` selector changed from `state.analyticsApi` to `state.analyticSlice`. `settingsState` selector also changed from `state.setting` to `state.userSettings`. `user` is consistently parsed from `localStorage`.

*   **`src\components\common\theme-model.tsx`**:
    *   **Timestamp: 10/24/2025, 11:31:24 AM**: Introduced `ThemedModalExtend` component which is a variation of `ThemedModal` with slightly different styling (e.g., `borderRadius` for `container` and `backgroundColor` for `header`).

*   **`src\components\screen\analytics\metricBox.tsx`**:
    *   **Timestamp: 10/24/2025, 11:31:40 AM**: Changed import for `ThemedModal` from a relative path to an alias (`@components/common/theme-model`), indicating a project-wide module alias setup.

*   **`src\store\api\plan-board-api.ts`**:
    *   **Timestamp: 10/24/2025, 11:34:23 AM**: Defined Redux Toolkit Query API for planboard, including `fetchPlanboard` (query) and `updatePlanboardSuggestion` (mutation) endpoints.

*   **`src\components\screen\planboard\PlanboardCardView.tsx`**:
    *   **Timestamp: 10/24/2025, 11:35:10 AM**: Integrated `useFetchPlanboardQuery` for data fetching. Added logic for `MonthViewItem` and `YearViewItem` to display planboard data based on the view type, using a `filterHandler` and data preparation functions. Introduced a `NoDataAvailable` component.

*   **`src\components\screen\analytics\MetricFooter.tsx`**:
    *   **Timestamp: 10/24/2025, 11:35:42 AM - 12:17:36 PM**: Multiple updates related to imports and dependencies, moving `PdfRenderer` import, changing `ThemedModal` import to an alias, and commenting out `ViewFiled` import. This shows a cleanup of import paths and potentially unused components.

*   **`src\components\screen\analytics\custom-view\ViewContainer.tsx`**:
    *   **Timestamp: 10/24/2025, 12:07:28 PM - 12:15:49 PM**:
        *   Refactored imports for `ThemeTabs`, `Loader`, `InputBox` to use aliases (`@components/common/...`).
        *   Refactored Redux store imports (`useFetchDashboardOptionsQuery`, `useSaveDasboardMutation`, `setDashboard`, `setRefetchAll`) to use aliases (`../../../../store/api/analyticsApi` to `../../../../../src/store/api/analytics-api`, `../../../../store/freatures/analyticsSlice` to `../../../../../src/store/fretures/analytics-slice`).
        *   Commented out `PopupAlert`, `AuditViewDrawer`, and `ANALYTICS_VIEW_AUDIT_COLUMNS` imports and their JSX usage, suggesting a temporary disablement or removal of audit and alert features for this view.

*   **`src\components\common\theme-tabs.tsx`**:
    *   **Timestamp: 10/24/2025, 12:08:23 PM - 12:17:04 PM**: Changed the import path for `ThemeTabsContext` from a relative path to `theme-tab-contax` (a new file).

*   **`src\components\common\audit-view-drawer.tsx`**:
    *   **Timestamp: 10/24/2025, 12:13:36 PM**: Refactored `InputBox` import to use an alias (`@components/common/input-box`).

*   **`src\components\common\theme-tab-contax.tsx`**:
    *   **Timestamp: 10/24/2025, 12:16:56 PM**: New file created to define `ThemeTabsContext` using React's Context API and a `useThemeTabs` hook, centralizing tab state management.

*   **`src\components\common\select-box.tsx`**:
    *   **Timestamp: 10/24/2025, 12:20:21 PM**: Removed `none` prop and added `name` and `label` as required props to `SelectBox` component definition.

*   **`src\components\screen\analytics\MetricToolbar.tsx`**:
    *   **Timestamp: 10/24/2025, 12:22:24 PM**: Commented out several imports and JSX blocks related to `PopoverPanel`, `DateRange`, and specific `SelectBox` instances, possibly simplifying the toolbar's filtering capabilities or deferring their implementation.

*   **`src\components\screen\analytics\DateRange.tsx`**:
    *   **Timestamp: 10/24/2025, 12:29:09 PM - 2:41:29 PM**: Updated to explicitly type `Moment` for date handling and adjusted import paths.

*   **`src\components\screen\analytics\Charts\StackedBarChart.tsx`**:
    *   **Timestamp: 10/24/2025, 12:30:23 PM**: Added `exportPdf` prop to control animations for PDF exports, and refined `generateYAxisData` to handle different period filters for chart categories.

*   **`src\components\screen\analytics\custom-view\TreeViewContianer.tsx`**:
    *   **Timestamp: 10/24/2025, 12:31:02 PM**: Added a `Box` wrapper with styling for scrollability.

*   **`src\components\screen\analytics\SelectCustomerPanel.tsx`**:
    *   **Timestamp: 10/24/2025, 12:32:01 PM - 5:54:08 PM**: Substantial refactoring to introduce explicit TypeScript interfaces for props, API responses, and parameters. The `fetchOptions` function now uses `ApiManager.getPaginatedCompanyOptions` with typed parameters.

*   **`src\components\screen\analytics\resizableGridItem.tsx`**:
    *   **Timestamp: 10/24/2025, 12:32:56 PM**: Added `memo` to `ResizableGridItem` and conditional rendering logic based on `operationType` (move/resize) to enable drag-and-drop or resize functionality.

*   **`src\hooks\useFormat.tsx`**:
    *   **Timestamp: 10/24/2025, 12:35:47 PM - 12:35:58 PM**: Moved `applyFormatting` import from a relative path to an alias (`@components/screen/settings/format/methods`).

*   **`src\components\screen\planboard\PlanBoardCardItems.tsx`**:
    *   **Timestamp: 10/24/2025, 12:37:09 PM - 12:44:05 PM**: Removed `ContainerIcon` and `processor` GIF imports and their corresponding JSX, indicating a visual simplification or removal of an "analyzing" animation.

*   **`src\components\common\filter-chip-group.tsx`**:
    *   **Timestamp: 10/24/2025, 12:38:23 PM**: Added `CHUNK_SIZE` and `visibleCount` for "show more/less" functionality on chip options.

*   **`src\store\fretures\planboard-slice.ts`**:
    *   **Timestamp: 10/24/2025, 12:40:21 PM**: Added `resetPlanbardFilters` reducer to clear card filters.

*   **`src\store\store.ts`**:
    *   **Timestamp: 10/24/2025, 12:41:53 PM**: Added `planBoardSlice` and `analyticSlice` to the combined reducers and `analyticsApi` middleware. Changed `analytics` to `analyticSlice`.

*   **`src\components\screen\planboard\PlanBoardFilter.tsx`**:
    *   **Timestamp: 10/24/2025, 12:42:28 PM**: Integrated `resetPlanbardFilters` into a "Clear All" button. Updated chip options to include `AdjustIcon` with dynamic colors based on week number.

*   **`src\components\screen\analytics\PdfRenderer.tsx`**:
    *   **Timestamp: 10/24/2025, 12:44:43 PM**: Commented out the logo import and its usage in JSX.

*   **`src\components\screen\planboard\PBUpdateForm.tsx`**:
    *   **Timestamp: 10/24/2025, 2:33:55 PM - 2:36:44 PM**:
        *   Refactored `OutlinedButton`, `SelectBox`, `InputBox`, `AppAutocomplete`, `DynamicEditableTable` imports, commenting them out and replacing `AppAutocomplete` with `@components/common/autocomplete/AutocompleteBox`.
        *   Commented out the "Save" button, potentially indicating an incomplete feature or a different saving mechanism.
        *   Removed the `recoverValue` function import.
        *   Updated the `useUpdatePlanboardSuggestionMutation` import path.

*   **`src\components\screen\analytics\ColumnsSelector.tsx`**:
    *   **Timestamp: 10/24/2025, 2:41:02 PM**: Added `showAll` state and a `Switch` component to toggle visibility of all columns. The logic for `selectedKeys` and `filteredColumns` was updated to reflect this.

*   **`src\pages\analytics\analytics-page.tsx`**:
    *   **Timestamp: 10/24/2025, 2:41:55 PM - 3:44:02 PM**:
        *   Extensive updates to Redux `useSelector` hooks for type safety using `RootState`.
        *   `user` object is now parsed from `localStorage` instead of being fetched from `state.userApi`, indicating a change in user data management.
        *   Added `EndpointType`, `MetricData`, and `User` interfaces for better type definition.
        *   Added `AppDispatch` type for `useDispatch` hook.
        *   Added `console.log` statements for debugging `mainState` and `user`.
        *   The `Alert` component for "Please Select Any Customer" is conditionally rendered based on `user.role` being "ADMIN".
        *   The main `AnalyticsContainer` component is now conditionally rendered based on `user.role` and `mainState.selectedCustomer`, and `mainState?.isLoading`.
        *   Removed the `token` comment, signifying that hardcoded tokens are no longer relevant or in use.
    *   **Timestamp: 10/24/2025, 5:28:28 PM - 5:28:41 PM**: The conditional rendering for the `Alert` component was changed. Initially, it showed for ADMIN role if `!mainState.selectedCustomer`. It was then changed to show for CUSTOMER role if `!mainState.selectedCustomer`. This indicates a shift in which user role needs to be prompted to select a customer, or a correction in the display logic.

*   **`src\config\analytics.ts`**:
    *   **Timestamp: 10/24/2025, 3:03:22 PM - 3:03:47 PM**: No significant content changes, just minor reformatting. The file defines default analytics endpoints, Excel export columns, cargo-ready to ETD columns, and analytics report headers.

*   **`src\store\api\analytics-api.ts`**:
    *   **Timestamp: 10/24/2025, 3:05:20 PM - 3:06:25 PM**: Minor formatting adjustments. This file defines API endpoints for fetching and saving analytics reports, dashboards, and metric configurations, using Redux Toolkit Query.

*   **`src\types\reports.types.ts`**:
    *   **Timestamp: 10/24/2025, 5:12:11 PM**: Introduced `FormValues` interface for report scheduling and configuration.

*   **`src\services\Endpoints.ts`**:
    *   **Timestamp: 10/24/2025, 5:47:35 PM**: Updated `PAGINATED_COMPANY_OPTION` endpoint to accept `params` for query string generation. Commented out `USER_SETTINGS` endpoint.

*   **`src\services\ApiManager.ts`**:
    *   **Timestamp: 10/24/2025, 5:47:42 PM**: Added `getPaginatedCompanyOptions` method that uses the updated `PAGINATED_COMPANY_OPTION` endpoint. `getDateFormat` method and its endpoint are commented out.

*   **`src\hooks\useAccess.tsx`**:
    *   **Timestamp: 10/24/2025, 2:50:58 PM - 6:02:35 PM**:
        *   Initial version fetched `auth` from Redux store, but was commented out. `user` role is directly parsed from `localStorage`.
        *   Introduced explicit TypeScript interfaces for `BasePermissions`, `AgentPermissions`, `CustomerPermissions`, `AdminPermissions`, and `Permissions` to define role-based access control more strictly.
        *   The return type of the hook was explicitly typed to be a union of possible permission objects.
        *   Minor syntax adjustments (`role && permissions[role as keyof typeof permissions]`) to ensure type safety when accessing `permissions` object.

### Patterns and Recurring Elements:

1.  **TypeScript Adoption and Refinement**: There's a strong recurring pattern of introducing and refining TypeScript types and interfaces across various files (`enum.ts`, `methods.ts`, `analytics-page.tsx`, `SelectCustomerPanel.tsx`, `useAccess.tsx`). This indicates a focus on improving code maintainability, readability, and error prevention through stronger type checking.
2.  **Redux Integration and State Management**: Redux (specifically Redux Toolkit Query and slices) is heavily used for API interactions and state management across analytics and planboard features. Updates often involve ensuring proper type inference for selectors (`useSelector`) and dispatch actions (`useDispatch`).
3.  **Component Refactoring and Aliases**: Several components (`ViewContainer`, `MetricFooter`, `SelectCustomerPanel`, `MetricToolbar`) have undergone import path refactoring, moving from relative paths to absolute paths using aliases (e.g., `@components/common/`). This suggests a structured project setup for easier imports and better modularity.
4.  **UI/UX Enhancements (Analytics & Planboard)**:
    *   **PDF Export**: Logic for exporting dashboards and individual metrics to PDF is being refined, including adding a logo to the dashboard PDF and controlling chart animations for PDF output.
    *   **Filtering and Customization**: Analytics components support various filters (date ranges, period, view by) and allow users to create/manage custom views. The `PlanBoardCardView` also introduces filtering and different views (year/month).
    *   **Data Visualization**: The project uses `ReactApexChart` for various chart types (bar, pie, line, stacked bar, gauge), and handles display logic for data-less scenarios (`NoDataAvailable`).
5.  **Access Control**: The `useAccess` hook is used to determine user permissions dynamically, impacting the visibility or functionality of UI elements (e.g., `SelectCustomerPanel`). The mechanism for retrieving user role has shifted from a Redux selector to parsing `localStorage`.
6.  **Temporary Feature Disablement**: Several sections of code, particularly in `ViewContainer.tsx` and `PlanBoardCardItems.tsx`, have been commented out (e.g., audit features, "analyzing" GIFs, Save buttons). This might indicate features being temporarily disabled, deprioritized, or in a testing phase.
7.  **Data Formatting**: The `useFormat` hook and `applyFormatting` utility are consistently used to format numerical values for display, ensuring a consistent presentation layer.