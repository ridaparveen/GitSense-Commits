# Activity Summary for 10/17/2025

## 9:49:12 AM
The file `c:\Users\ridap\OneDrive\Documents\Envosyes\envosys-backend\src\services\customerService.ts` was significantly updated on **10/16/2025, 5:37:25 PM**. This TypeScript file appears to be a core service for managing customer-related operations in the `envosys-backend` application.

Key updates and functionalities include:

*   **`getAll` Function**:
    *   Retrieves a paginated list of customers, supporting extensive filtering based on `status`, `fromDate`, `toDate`, `customer_type`, `customer_id`, `location`, `customer_name`, and `orderBy` (field and direction).
    *   Utilizes a `QueryBuilder` for constructing dynamic SQL queries, joining `customer` and `customer_gst_location` tables.
    *   Fetches distinct options (status, city, customer_type) for frontend dropdowns.
    *   Enriches each customer row with a `_uniqueId` for better frontend management.

*   **`getCustomerDashboardCardInfo` Function**:
    *   Provides aggregated customer dashboard metrics, specifically counting active, inactive, and total customers.
    *   Supports filtering these counts by date range (`fromDate`, `toDate`) or predefined intervals like "weekly" or "monthly".

*   **`saveCustomerDetails` Function**:
    *   Handles the initial creation of a new customer.
    *   Generates a unique `customer_id` using a "CUST" prefix and a timestamp.
    *   Manages basic customer details such as name, PAN number, and creation/update timestamps.
    *   Ensures data consistency using database transactions (`BEGIN`, `COMMIT`, `ROLLBACK`).

*   **`CreateCustomer` Function (partially logged)**:
    *   This function is designed for comprehensive customer creation or update, integrating various related details.
    *   It expects a `customer_id` and can update the customer's `status`.
    *   Handles multiple nested data structures like `gstLocations`, `keyPersonalDetails`, `alertMappingDetails`, `creditControlDetails`, `facDetails`, and `uploadDocuments`.
    *   Includes logic to parse JSON strings from the request body into JavaScript objects for these nested structures.
    *   Begins iterating through `gstLocations` to insert them into the `customer_gst_location` table, indicating a multi-part data insertion process within a transaction.

**Recurring Elements and Patterns**:

*   **Database Interactions**: Extensive use of `query`, `insertQuery`, and `updateQuery` utilities for PostgreSQL database operations. Transactions (`BEGIN`, `COMMIT`, `ROLLBACK`) are employed to ensure data integrity for multi-step operations.
*   **Query Building**: The `QueryBuilder` utility is central to constructing complex and dynamic SQL queries, especially for filtering, pagination, and sorting.
*   **Error Handling**: Consistent `try...catch` blocks are used for error management, logging errors with `logger` and returning appropriate `HttpStatusCodes` and error messages.
*   **Logging**: `logger.info` and `logger.error` are frequently used throughout the service for monitoring and debugging.
*   **Date Handling**: `moment` library is utilized for formatting dates in SQL queries.
*   **Data Structure Management**: Multiple custom types are imported (`CustomerPayloadTypes`, `GetCustomerParams`, `GstLocationPayload`, etc.) to ensure type safety for request bodies and database interactions.
*   **Request/Response Handling**: Uses common `IReq` and `IRes` types for request and response objects, and `HttpStatusCodes` for standard HTTP responses.