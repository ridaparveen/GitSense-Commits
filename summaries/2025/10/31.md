# Activity Summary for 10/31/2025

## 9:49:31 AM
The file `c:\Users\ridap\OneDrive\Documents\T360_Api\t360-thirdparty\src\routes\external.routes.ts` was updated on 10/30/2025, 3:40:26 PM. This file establishes external API routes using Express.js. It imports and utilizes controllers from `v1` of `shipments`, `bookings`, `7501_duties`, `invoice`, and `isf` modules.

The defined routes are:
*   `/test`: A GET endpoint that returns a protected message including `req.companyname`.
*   `/tracking`: A GET endpoint handled by `shipments.getAll`.
*   `/booking`: A GET endpoint handled by `bookings.getAll`.
*   `/7501_duties`: A GET endpoint handled by `duties.getAll`.
*   `/invoice`: A GET endpoint handled by `invoice.getAll`.
*   `/isf`: A GET endpoint handled by `isf.getAll`.

A clear pattern emerges where most external data retrieval routes (tracking, booking, duties, invoice, isf) consistently call a `getAll` method from their respective controllers, all residing under a `v1` directory, suggesting API versioning.

## 9:49:32 AM
The provided log shows a series of frequent, incremental changes focused on refining SQL queries and their handling within a backend analytics application. All modifications occurred between October 29, 2025, and October 30, 2025.

**File-Specific Updates:**

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-backend\src\controllers\analytics\query\booking.query.ts`**:
    *   This file, responsible for building SQL queries related to booking data, saw numerous minor updates across 20 entries.
    *   All changes were consistent and appear to be formatting adjustments (e.g., adding spaces, newlines, changing double quotes to single quotes for strings) or minor structural reorganizations within existing SQL query strings. No functional changes were introduced in these specific log entries; the core logic for `BookingDatetoActualDeparture`, `BookingDatetoActualDepartureMblWise`, `BookingDatetoActualDepartureStackedBar`, and `BookingDatetoActualDepartureMblWiseStackedBar` remained identical across these timestamps.

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-backend\src\controllers\analytics\query\export.query.ts`**:
    *   This file defines SQL query snippets for various reports used in export functionality.
    *   Between 10/30/2025, 12:05:05 AM and 10/30/2025, 12:28:49 AM, a significant change was made to the `"Containers Shipped (Mbl Wise)"` query. Initially, it was a simple `SELECT COUNT(DISTINCT m.mblno)` grouped by month and quarter. It was then expanded significantly into a complex Common Table Expression (CTE) structure (`WITH shipment_data AS (...) SELECT TO_CHAR(...)`) to extract more detailed shipment data including various tracking fields, and to classify quarters based on dynamic date ranges relative to `CURRENT_DATE`.
    *   A new report type, `"Total Spend per Month ($)"`, was introduced around 10/30/2025, 4:53:29 PM. This query uses a CTE (`date_series`, `invoice_data`) to calculate total spend per month, categorized by "This Quarter" and "Last Quarter" based on invoice dates from `cng_invoice` or `spr_invoice` tables, depending on the `CompanyName`.
    *   Another new report type, `"Average Transit Time per Month (Days)"`, was added around 10/30/2025, 6:27:10 PM. This also uses CTEs (`date_series`, `transit_data`) to calculate the average transit time (actual arrival date - actual departure date) grouped by month and quarter.
    *   There were minor formatting adjustments similar to `booking.query.ts` as well, such as changing quotes (`'`) and spacing.

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-backend\src\controllers\analytics\core.export.controller.ts`**:
    *   This controller handles the export data requests.
    *   Around 10/30/2025, 11:46:42 AM, logic was added to handle specific report types (`"Containers Shipped (Mbl Wise)"`) that might provide a full SQL query including CTEs (starting with `WITH`). For such reports, the `mainQuery` is directly assigned the `customQuery` to avoid wrapping it in an unnecessary `SELECT * FROM (...)` subquery, which was causing errors.
    *   Further refinements were made to this CTE handling logic around 10/30/2025, 6:41:38 PM and 10/30/2025, 6:42:42 PM, ensuring that if a `customQuery` starts with `WITH`, it is used as the base query, and if not, it's integrated into a standard `SELECT * FROM (...)` structure. This indicates a fix for how complex, pre-formed queries are incorporated into the export flow.
    *   The `replaceColumnHandler` function, which modifies `pod` and `place_of_delivery` values from 'LONG BEACH' to 'LOS ANGELES', remained consistent throughout.
    *   The `console.log` statements were added for debugging purposes (`mainQuery::booking`, `mainQuery::non-booking`, `mainQuery::filteredData`, `===merge`).

**Timestamps of Significant Changes:**

*   **10/30/2025, 12:05:05 AM**: Introduction of a more complex CTE structure for `"Containers Shipped (Mbl Wise)"` in `export.query.ts`.
*   **10/30/2025, 11:46:42 AM**: Logic added in `core.export.controller.ts` to correctly handle `WITH` clauses in `customQuery` for certain reports to prevent erroneous query construction during export.
*   **10/30/2025, 4:53:29 PM**: Addition of `"Total Spend per Month ($)"` report query in `export.query.ts`.
*   **10/30/2025, 6:27:10 PM**: Addition of `"Average Transit Time per Month (Days)"` report query in `export.query.ts`.
*   **10/30/2025, 6:41:38 PM - 6:42:42 PM**: Refinement of CTE handling logic in `core.export.controller.ts`.

**Patterns and Recurring Elements:**

*   **Date Range Filtering**: Many queries consistently apply a date range filter using `departure_date >= '${fromDate}'::timestamp AND departure_date < '${toDate}'::timestamp + INTERVAL '1 day'`.
*   **Company-Specific Filtering**: Queries frequently include `LOWER(account_name) = '${CompanyName}'` or `LOWER(m.account_name) = '${CompanyName.toLowerCase()}'` to filter data by company.
*   **Null and Empty String Checks**: Numerous `WHERE` clauses include checks like `IS NOT NULL` and `<> ''` for critical fields such as `mblno`, `bookingdate`, and `t49_vessel_actualdeparted_date`. This indicates data quality considerations and robust query design.
*   **Date Difference Calculations**: Several queries use `EXTRACT(DAY FROM date1 - date2)` or `DATE_PART('day', date1 - date2)` to calculate day differences, often categorizing them into time buckets (e.g., "Less than 1 week", "1 - 2 weeks").
*   **Stacked Bar Chart Logic**: Reports with "Stacked Bar" in their name (`BookingDatetoActualDepartureStackedBar`, `BookingDatetoActualDepartureMblWiseStackedBar`) consistently use `CASE WHEN day_diff < 7 THEN 'Less than 1 week' ... ELSE 'Above 5 weeks' END AS name` for categorization.
*   **MBL Wise vs. Container Wise Aggregation**: Queries differentiate between `DISTINCT ON (m.voyage,m.contno, ...)` for container-level uniqueness and `DISTINCT ON (LOWER(m.mblno))` for MBL (Master Bill of Lading) level uniqueness.
*   **Debugging Logs**: Extensive `console.log` and `logger.info` statements are present, indicating active debugging during development or recent issue resolution.
*   **Standard Utility Imports**: Both `booking.query.ts` and `core.export.controller.ts` import utility functions like `getColumnsByCategory`, `getFilterQueryByDisplayValue`, `defaultDateRange`, `getUserObject`, `columnsQuery`, `dateFilterOnExport`, and `saveColumns` from `../../../utils/analytics`.
*   **Code Customization Flag**: The `codeCustomization` boolean in `others.controller.ts` is used to bypass the generic `query(mainQuery)` execution for certain reports (like `TotalShipments`), suggesting some reports require specific data processing outside the standard query builder flow.

## 9:51:02 AM
The changes primarily focus on the `t360-frontend` application, with significant activity in the analytics and planboard sections. Most modifications occurred on October 28th and 29th, 2025, often in rapid succession, suggesting active development and debugging.

**File-Specific Updates:**

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\components\screen\analytics\custom-view\ViewContainer.jsx`**
    *   **10/28/2025 (2:02:33 PM, 3:48:07 PM, 5:53:50 PM):** This component, responsible for managing custom analytical views, was updated to include more debugging `console.log` statements (e.g., `viewOptions`, `viewName`). The core functionality of creating, editing, saving, deleting, and auditing views, along with checkbox selection logic for metrics (with a maximum limit of 9), remained consistent. It integrates with Redux for state management and an analytics API for data operations.

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\components\screen\analytics\custom-view\TreeViewContianer.jsx`**
    *   **10/28/2025 (2:04:34 PM, 3:46:33 PM, 3:46:51 PM):** This component, which renders a selectable tree of metrics, saw a brief, likely debugging-related, addition of "kk" to a label at 3:46:33 PM, which was then immediately reverted at 3:46:51 PM.

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\config\analytics.js`**
    *   **10/28/2025 (3:35:37 PM to 3:38:11 PM) & 10/29/2025 (11:09:14 AM to 11:56:24 AM) & 10/30/2025 (1:44:18 PM to 5:34:31 PM):** This configuration file defines default analytics endpoints, columns for Excel exports, and report headers for various analytics reports (CBM, TEU, KGS, Transit, Chassis metrics). Although there are many timestamps for this file, the provided snippets across these dates show identical content, indicating either no functional changes in the displayed sections or minor, uncaptured changes like whitespace or comments. The overall pattern is a comprehensive and expanding definition of report headers, categorized by "Container Wise" and "MBL Wise" metrics.

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\components\screen\planboard\PlanboardCardView.jsx`**
    *   **10/28/2025 (4:05:26 PM, 4:08:24 PM):** A debugging `console.log` statement for `planboardData` was added at 4:08:24 PM. This component is responsible for displaying planboard data in either monthly or yearly card views, applying filters from Redux state.

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\components\screen\analytics\MetricFooter.jsx`**
    *   **10/29/2025 (9:56:31 AM, 9:57:53 AM) & 10/30/2025 (5:37:40 PM):** This component handles export functionalities (Excel, PDF) and full-screen view for analytics metrics. Debugging `console.log` statements were added for `item` (9:57:53 AM) and `columns` during Excel export (10/30/2025). The component also features a `ColumnsSelector` modal for custom Excel exports.

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\components\screen\analytics\MetricToolbar.jsx`**
    *   **10/29/2025 (10:54:57 AM to 11:02:26 AM) & 10/29/2025 (5:27:47 PM):** This file saw numerous rapid changes, including:
        *   Minor label correction (`"Period1"` to `"Period"`).
        *   Frequent commenting/uncommenting of `PopoverPanel` for custom date ranges and `SelectBoxLight` components for "Period" and "View By" filters. This indicates active testing and iteration of filter visibility and functionality.
        *   Temporary addition and removal of `<h1>hhhhh</h1>` and correction of a syntax error (`<SwitchBox`).
        *   Addition of a `console.log` for `toolState` at 5:27:47 PM.

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\components\screen\analytics\MetricsBox.jsx`**
    *   **10/29/2025 (11:02:52 AM to 12:11:06 PM):** This component manages the rendering of various chart types (Bar, Pie, Line, StackedBar, Gauge) and integrates with `MetricToolbar` and `MetricFooter`. Changes included:
        *   Temporary commenting/uncommenting of the `MetricToolbar` component.
        *   Addition of debugging `console.log` statements for `item` and `data`.
        *   Adjustment in how chart data is sliced for display versus full-screen view (e.g., `item.data.slice(0, 9)` for initial view).

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\components\screen\analytics\Charts\StackedBarChart.jsx`**
    *   **10/29/2025 (11:45:45 AM to 5:20:39 PM):** This file was the most frequently and extensively modified, indicating a highly iterative development process for handling stacked bar chart data. Key changes include:
        *   Numerous adjustments to chart options, including `plotOptions.bar`, `xaxis`, `yaxis`, `legend`, `dataLabels`, and `tooltip` formatting.
        *   Significant flux in data processing logic within `useEffect`. Initially, it had a `generateYAxisData` function, then shifted to a `prepareStackedData` function for explicit "This Quarter" vs "Last Quarter" comparisons.
        *   It then moved to a more dynamic approach using an `isQuarterData` flag to adapt data series and categories based on whether quarter comparison data is present, reverting between these complex and simpler data aggregation methods multiple times.
        *   Further refinements were made to handle different `periodFilter` values ("quarter", "week", "month") and safely parse numerical data (e.g., `parseInt(d.container_count || "0", 10)`).
        *   Many `console.log` statements (`"===hgdatta===="`) were added for debugging the data input.

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\components\screen\analytics\AnalyticsContainer.jsx`**
    *   **10/29/2025 (4:53:53 PM):** This top-level container for analytics metrics was updated. It handles drag-and-drop reordering of metrics (`moveItem`) and saving of metric sizes (`saveSize`). It also contains the `fetchSingleReport` function which makes API calls for individual metric data and processes it using `metricsPackageHandler`. A debugging `console.log` for `mainState` was added.

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\components\screen\analytics\methods.js`**
    *   **10/29/2025 (11:18:07 AM to 1:31:56 PM) & 10/30/2025 (5:53:02 PM to 6:44:44 PM):** This utility file contains logic for packaging metrics data (`metricsPackageHandler`), generating report formulas (`reportFormula`), formatting dates (`weekDateFormater`), and the `downloadReportSpreadsheet` function.
        *   The `findChartType` function in `metricsPackageHandler` was simplified, removing a specific check for "Containers Shipped (Mbl Wise)".
        *   The `downloadReportSpreadsheet` function received significant updates, introducing complex conditional logic to correctly format data for Excel export based on `chartType` (e.g., "StackedBar", "transitBar") and `periodFilter` (month, week, quarter).
        *   Specific handling was added for reports like "Total Spend per Month ($)", "Average Transit Time per Month (Days)", and "Containers Shipped (Mbl Wise)" to ensure correct data mapping and numerical conversion during Excel export. There was some duplication of code for "Cargo-Ready Date to ETD (Stacked Bar +/- 10 Days)" that was later corrected.

**Patterns and Recurring Elements:**

*   **Debugging focus:** A pervasive pattern is the addition of `console.log` statements across various components (`ViewContainer`, `TreeViewContianer`, `PlanboardCardView`, `MetricFooter`, `MetricToolbar`, `MetricsBox`, `StackedBarChart`). This indicates active, in-progress development and debugging.
*   **Analytics Dashboard Enhancement:** The majority of changes are concentrated on refining the analytics dashboard, specifically around custom view creation, dynamic chart rendering (especially stacked bar charts), and robust data export capabilities to Excel and PDF.
*   **Iterative Chart Data Handling:** The `StackedBarChart.jsx` and `methods.js` files demonstrate a highly iterative process for handling complex data structures (like quarter-over-quarter comparisons or time-series data aggregated by month/week/quarter) for charts and exports, with multiple reverts and re-implementations of logic.
*   **Redux Integration:** Components frequently access and dispatch actions to a Redux store (`state.analytics`, `state.settings`, `state.auth`) for managing application state, user information, and analytical filters.
*   **API Interaction:** Components like `ViewContainer` and `AnalyticsContainer` extensively use RTK Query hooks (`useFetchDashboardOptionsQuery`, `useSaveDasboardMutation`, `useLazyFetchReportQuery`, `useSaveSequenceMutation`, `useSaveMetricSizeMutation`) to interact with a backend API for data fetching and persistence.

## 11:01:02 AM
The log details changes in the file `c:\Users\ridap\OneDrive\Documents\T360_Api\t360-backend\src\controllers\analytics\core.export.controller.ts`, with the timestamp 10/31/2025, 10:31:50 AM.

This file primarily focuses on an analytics export controller, specifically the `getExportData` function, which handles the generation and export of various reports.

Key updates and functionalities include:

*   **Export Data Retrieval (`getExportData` function):**
    *   It processes `AuthenticatedRequest` to extract query parameters such as `fromDate`, `toDate`, `mblwise`, `booking`, `filterBy`, `reportName`, `stackedExport`, `displayBy`, `month`, `startWeek`, `endWeek`, `quarter`, `group`, and `columns`.
    *   Default date ranges (`fromDate`, `toDate`) are applied if not provided in the request.
    *   It retrieves user and company information using `getUserObject`.
    *   Column definitions are processed via `columnsQuery` and `saveColumns` for persistence.
*   **Conditional Query Generation (Booking vs. Non-Booking):**
    *   The core logic branches based on a `booking` parameter (`isBooking`).
    *   **Booking Reports:**
        *   Utilizes `bookingQuery` to construct a base query.
        *   Applies `DISTINCT ON` clauses for `mblwise` or container/voyage uniqueness.
        *   Integrates date filtering based on `filterBy`, `fromDate`, and `toDate`.
        *   Executes the `mainQuery` and filters data using `dateFilterOnExport`.
    *   **Non-Booking Reports:**
        *   Utilizes `nonBookingQuery` to build the custom query.
        *   A specific filtering logic is applied for "TEU MBLwise" reports, where duplicate entries (based on voyage, container number, and container type) have their `teu` value replaced with `'-'`.
        *   Data is then filtered using `dateFilterOnExport`.
*   **Column Value Replacement (`replaceColumnHandler` function):**
    *   This helper function is called on the final dataset before sending the response.
    *   It iterates through the data and replaces specific string values: `pod` (Port of Discharge) and `place_of_delivery` if they contain 'LONG BEACH' (case-insensitive) with 'LOS ANGELES'. This ensures consistency in location names.
*   **Error Handling:** A `try-catch` block is used to catch potential errors during query execution or data processing, responding with a 500 Internal Server Error.
*   **Logging:** Extensive use of `logger.info` and `console.log` statements for debugging and tracing request parameters, main queries, and data processing steps.

**Patterns and Recurring Elements:**

*   **Date Range Management:** Consistent handling of `fromDate` and `toDate` for filtering.
*   **User/Company Context:** Repeated retrieval of `CompanyName` and `usercode` via `getUserObject`.
*   **Query String Construction:** Dynamic SQL query building based on various request parameters, often combining base queries from `bookingQuery` or `nonBookingQuery` with additional filters and selections.
*   **Logging:** Frequent use of `logger.info` and `console.log` for debugging throughout the data flow.
*   **Data Transformation:** The `dateFilterOnExport` and `replaceColumnHandler` functions are consistently applied to the query results for final data preparation.

## 11:01:37 AM
The provided log details changes to a single file: `c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\components\screen\analytics\methods.js`.

The significant changes occurred between 10/31/2025, 10:23:35 AM and 10/31/2025, 10:26:57 AM.

**File-Specific Updates (`methods.js`):**
The `downloadReportSpreadsheet` asynchronous function was updated. Specifically, the logic for exporting "StackedBar" chart types to Excel was refined and standardized across several reports.

*   **Before (10:23:35 AM):** For reports like "Containers Shipped (Mbl Wise)" and "Total Spend per Month ($)", an `updatedData` array was first created to map and normalize the report data (e.g., handling `d.month` or `d.Month`, `d.This_Quarter` or `d.This Quarter`). This `updatedData` was then pushed to the `reportArray`. The "Average Transit Time per Month (Days)" report had a similar commented-out `updatedData` block, followed by `if/else if` conditions for `periodFilter` (month, week, quarter).
*   **After (10:26:57 AM):** The intermediate `updatedData` step was removed. The logic for "Containers Shipped (Mbl Wise)", "Total Spend per Month ($)", and "Average Transit Time per Month (Days)" was refactored to directly incorporate `if/else if` conditions based on the `periodFilter` (month, week, quarter) within the `reportArray.push` call. This streamlines the data mapping for different time granularities, directly extracting and formatting relevant fields (e.g., `d["month"].split(" ")[0]`, `weekDateFormater`, `d["quarter"]`) for the first column, and `d["This Quarter"]`, `d["Last Quarter"]` for subsequent columns.

**Patterns and Recurring Elements:**
The primary pattern observed is the standardization of data export logic for "StackedBar" reports. The changes consistently replace a two-step process (map `item.data` to `updatedData`, then push `updatedData`) with a direct, single-step mapping within the `reportArray.push` call that incorporates `periodFilter` logic. This ensures a uniform approach to handling month, week, and quarter aggregations for various stacked bar charts when generating Excel reports.

## 12:01:08 PM
In `c:\Users\ridap\OneDrive\Documents\T360_Api\t360-backend\src\controllers\analytics\core.export.controller.ts`, updated on **October 31, 2025, at 10:31:50 AM**, the `getExportData` function, responsible for generating analytics reports, received significant enhancements.

Key updates include:
*   **Dynamic Query Construction:** The function now dynamically builds SQL queries based on various request parameters such as `reportName`, `mblwise`, `booking` status, date ranges (`fromDate`, `toDate`), and a list of `columns`. It differentiates between "booking" and "non-booking" report types, calling respective helper functions (`bookingQuery`, `nonBookingQuery`) to generate specific query segments.
*   **Column Management:** It integrates utilities (`columnsQuery`, `saveColumns`) to handle user-selected columns for export, suggesting a feature for customizing report outputs.
*   **Date Range Handling:** Default date ranges are applied if not provided in the request, and date filters are consistently applied to SQL queries and potentially post-query data with `dateFilterOnExport`.
*   **Data Transformation and Standardization:**
    *   A new `replaceColumnHandler` function has been introduced to standardize port names in the exported data. Specifically, any occurrences of 'LONG BEACH' (case-insensitive) in `pod` (port of discharge) or `place_of_delivery` fields are replaced with 'LOS ANGELES' to ensure consistency.
    *   A specific data de-duplication logic is implemented for "TEU MBLwise" reports, where duplicate entries based on `voyage`, `contno`, and `contType` will have their `teu` value set to `'-'`.
*   **Logging:** Extensive `logger.info` and `console.log` statements have been added throughout the function for debugging and tracking the generated queries and data processing steps.

The recurring patterns in this update involve extensive use of dynamic SQL generation, conditional logic based on report types and parameters, and post-query data manipulation for standardization and specific report requirements.

## 12:01:35 PM
The file `c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\components\screen\analytics\methods.js` primarily contains utility functions for analytics within a frontend application. Key functionalities include `TruncateText` for display purposes, `metricsPackageHandler` for processing API responses into chart-ready data, `allChartOptions` and `chartOptionsByType` for defining available chart types, `reportFormula` for generating calculation strings, and `weekDateFormater` for date presentation. The most significant changes observed in the log relate to the `downloadReportSpreadsheet` function, which handles exporting various analytics reports to Excel.

On **10/31/2025, 10:23:35 AM**, the `downloadReportSpreadsheet` function was updated to support Excel export for several `StackedBar` chart types. This included detailed logic for reports like "Cargo-Ready Date to ETD (Stacked Bar)", "Containers Shipped (Mbl Wise)", "Total Spend per Month ($)", "Average Transit Time per Month (Days)", and "Cargo-Ready Date to ETD (Stacked Bar +/- 10 Days)". For "Containers Shipped (Mbl Wise)" and "Total Spend per Month ($)", the implementation involved an intermediate `updatedData` mapping to normalize `Month` and `Quarter` fields before populating the spreadsheet. The "Average Transit Time per Month (Days)" report, however, already used a direct mapping based on the `periodFilter` (month, week, quarter), with a commented-out section that hinted at a potential alternative `updatedData` approach.

A rapid follow-up change occurred on **10/31/2025, 10:26:57 AM**. This update refined the `downloadReportSpreadsheet` function to standardize the data processing for `StackedBar` charts. Specifically, the intermediate `updatedData` mapping previously used for "Containers Shipped (Mbl Wise)" and "Total Spend per Month ($)" was removed. Instead, these reports now directly map data based on the `periodFilter` (month, week, quarter) in a manner consistent with other `StackedBar` reports. This change streamlined the export logic, ensuring a uniform approach to handling time-series data for stacked bar charts across different periods. The commented-out code for "Average Transit Time per Month (Days)" was also removed in this revision.

A recurring pattern in this file is the extensive use of `moment.js` for date formatting and `ExcelJS` for generating Excel workbooks. The `downloadReportSpreadsheet` function repeatedly checks `item?.customizer?.chartType` and `item.reportName` to apply specific data transformation and formatting rules for different report types and `periodFilter` values (month, week, quarter), often utilizing the `weekDateFormater` utility.