# Activity Summary for 10/24/2025

## 9:35:11 AM
The provided log entry details the `AnalyticsScreen.jsx` file as of **10/23/2025, 3:18:36 PM**. This file represents the main screen for the analytics feature in the `t360-frontend` application.

**File-Specific Updates (`AnalyticsScreen.jsx`):**

This component serves as the orchestrator for displaying analytics data. Its key functionalities include:

*   **State Management:** It heavily utilizes Redux, accessing global state for `analytics` (`mainState`), `settings` (`settingsState`), and `auth.user`. It dispatches actions to update `analyticsSlice` with fetched data, loading states, and selected customer information.
*   **Data Fetching with RTK Query:** The screen integrates Redux Toolkit Query for efficient data fetching:
    *   `useFetchDashboardsQuery`: Fetches available dashboards based on the user's company and role upon component mount.
    *   `useLazyFetchEndpointsQuery`: Lazily fetches specific analytics endpoints (e.g., list of reports) based on the `selectedDashboard`.
    *   `useLazyFetchReportQuery`: Lazily fetches individual reports based on the determined endpoints.
*   **Dynamic Dashboard and Report Loading:**
    *   An `useEffect` hook initializes the dashboard state with `dashboardViews` once successfully fetched.
    *   A primary `useEffect` handles the core data fetching logic:
        *   It determines whether to use `DEFAULT_ANALYTICS_ENDPOINTS` or fetch custom endpoints based on `mainState.selectedDashobard`.
        *   It then proceeds to fetch all associated reports concurrently using `Promise.all`, applying an initial date range (`year_2_date`) and formatting dates with `moment`. Each report query includes parameters like `apiKey`, `reportName`, `userid`, date range, `displayBy`, `viewBy`, `companyname`, and `access`.
        *   Fetched data is processed by `metricsPackageHandler` and dispatched to the Redux store.
        *   Loading states are managed, showing a `Loader` during data fetching.
*   **User Role-Based Logic:**
    *   If the user's `role` is 'CUSTOMER', their `companyname` is automatically set as the `selectedCustomer`.
    *   The UI displays an `Alert` for 'ADMIN' users if no customer is selected.
*   **UI Structure:** The screen incorporates common UI components like `ScreenToolbar`, `ThemedBreadcrumb`, and `AnalyticsToolbar`. The core analytics content is rendered within `AnalyticsContainer`, conditional on loading state and customer selection.

**Patterns and Recurring Elements:**

*   **Redux-Centric Architecture:** Frequent use of `useSelector` to retrieve data from the Redux store and `useDispatch` to trigger state updates, demonstrating a strong reliance on Redux for application state management.
*   **API Query Patterns:** API calls through RTK Query consistently include `companyname`, `access`, and `userid` in their query parameters, indicating a pattern of multi-tenancy or role-based access control for analytics data.
*   **Conditional Rendering:** The component makes extensive use of conditional rendering based on `isLoading` states, `user.role`, and the presence of `selectedCustomer` to manage the user experience.
*   **Asynchronous Data Flow:** Multiple `useEffect` hooks and `async/await` patterns are employed to manage the sequential and concurrent fetching of different data sets (dashboards, endpoints, reports), ensuring data dependencies are met.
*   **Utility Functions:** Integration of utility functions like `dateFilterHandle` and `metricsPackageHandler` suggests a modular approach to handling common data manipulation and formatting tasks.

## 9:35:14 AM
The file `c:\Users\ridap\OneDrive\Documents\T360_Api\t360-backend\src\routes\analytics.route.ts` was updated on `10/22/2025, 11:01:53 AM`.

This file, an Express router, defines a comprehensive set of API endpoints for an analytics module. Key updates include:

*   **Dashboard Management:** Full CRUD (Create, Read, Update, Delete) operations are exposed for `/dashboards` endpoints, handled by `core.view.controller`.
*   **Metric and Endpoint Discovery:** Endpoints `/dashboardEndPoints` and `/metricsList` are added to retrieve lists of available dashboard endpoints and metrics, respectively, managed by `core.metric.controller`.
*   **User Preferences:** New POST routes `/save_sequence` and `/save_size` are introduced for saving user-specific preferences related to analytics views or data presentation.
*   **Reporting Endpoints:** Multiple dedicated GET endpoints are added for various types of reports, including `/cbm`, `/kgs`, `/teu`, `/containers`, `/transit`, and `/Tables/tableData`, each leveraging specific controllers (`cbm.controller`, `kgs.controller`, `teu.controller`, `container.controller`, `transit.controller`, `others.controller`).
*   **Data Export:** An endpoint `/excelExport` is added to facilitate data export functionality, handled by `core.export.controller`.

The changes reflect an expansion of the analytics module, introducing more granular control over dashboards, extensive reporting capabilities, and mechanisms for user preferences and data export. The pattern observed is the modular organization of analytics functionalities, with each major feature area (views, metrics, specific report types, export) managed by its own dedicated controller imported into this central route definition file.

## 9:35:43 AM
The provided log details significant development work on a new "Analytics" feature within the T360-V2 frontend application, primarily occurring on **October 23, 2025**.

**File-Specific Updates:**

*   **`src\App.tsx`**:
    *   Initially (3:20:46 PM), an `/app/analytics` route was present but incorrectly pointed to `ShipmentWithContainersPage`.
    *   By 3:22:00 PM, the application's main routing was updated to correctly import and render the new `AnalyticsScreen` component for the `/app/analytics` path.
*   **`src\pages\analytics\analytics-page.tsx`**:
    *   The core `AnalyticsScreen` component was established (3:21:50 PM). It manages fetching dashboard views and reports using Redux Toolkit Query, handles loading states, and dispatches analytics-related actions.
    *   Throughout subsequent changes (3:51:34 PM, 3:52:16 PM, 4:03:08 PM, 4:03:54 PM), there was extensive refactoring of import paths, transitioning from relative paths to absolute paths or aliases (e.g., `@components`, `config/analytics`, `utils/utils`).
    *   The UI structure was modified (4:03:08 PM) to use a `PageWrapper` component for layout instead of directly combining `ScreenToolbar`, `ThemedBreadcrumb`, and `AnalyticsToolbar`.
*   **`src\components\screen\analytics\metricBox.tsx`**:
    *   This new component (3:24:36 PM) was introduced to display various analytics charts (Bar, Pie, Line, Stacked Bar, Gauge). It features a toolbar for chart controls, a footer, and full-screen modal functionality. A minor cleanup of an unused import happened later (3:33:45 PM).
*   **`src\components\screen\analytics\AnalyticsContainer.jsx` (later `.tsx`)**:
    *   Introduced as `.jsx` (3:27:17 PM), this component is central to the analytics dashboard layout. It utilizes `react-dnd` for drag-and-drop reordering and `react-resizable` for changing the size of metric boxes. It includes Redux Toolkit Query mutations (`useSaveSequenceMutation`, `useSaveMetricSizeMutation`) to persist layout changes.
    *   The file was renamed to `.tsx` (3:27:30 PM), indicating a move towards TypeScript. Numerous import path corrections followed, culminating in a specific TypeScript type import (`RootState`) and explicit typing for Redux selectors (3:42:56 PM).
    *   A notable change (3:46:41 PM) involved potentially incorrect Redux selector usage (`state.analyticsApi`, `state.setting`).
*   **`src\components\screen\analytics\ResizableGridItem.jsx`**:
    *   This component (3:30:21 PM) provides the draggable and resizable functionality for individual items within the `AnalyticsContainer`, using `react-resizable` and `react-dnd`.
    *   A minor refactoring changed it to a default export (3:30:28 PM). Subsequent entries (3:31:01 PM, 3:31:28 PM) show identical code, likely representing frequent saves during development.
*   **`src\store\api\analytics-api.ts`**:
    *   This Redux Toolkit Query API slice was created (3:39:04 PM) to handle all analytics-related API interactions (fetching reports, dashboards, saving layouts).
    *   A key improvement (3:40:00 PM) was the addition of `"SEQ"` and `"SIZE"` to `tagTypes` to enable proper cache invalidation for layout-related mutations.
*   **`src\store\store.ts`**:
    *   The main Redux store was updated (3:44:26 PM) to integrate the `analyticsApi` reducer and middleware, making it globally available.
*   **`src\config\analytics.ts`**:
    *   This new configuration file (3:52:59 PM) centralizes constants such as `DEFAULT_ANALYTICS_ENDPOINTS`, `EXCEL_EXPORT_COLUMNS`, and `ANALYTICS_REPORT_HEADER`, providing a single source of truth for analytics-specific configurations.
*   **`src\components\screen\analytics\methods.ts`**:
    *   A new utility file (3:58:24 PM) was introduced to house helper functions for analytics, including `metricsPackageHandler` (data processing), `allChartOptions`, `chartOptionsByType`, `reportFormula`, `weekDateFormater`, and `downloadReportSpreadsheet` (Excel export logic).
*   **`src\store\fretures\analytics-slice.ts`**:
    *   This Redux slice (4:01:14 PM) manages the state specific to the analytics feature, including endpoints, metrics data, date filters, selected dashboards, and loading status.
    *   An import path for `dateFilterHandle` was corrected (4:02:19 PM) to align with utility file reorganization.
*   **`src\utils\utils.ts`**:
    *   This general utility file (4:02:02 PM) was added to consolidate common helper functions such as `appDateFormat`, `parseRawString`, `useDateFormate` (for user-preference-based date formatting), and `dateFilterHandle` (for generating various date ranges).

**Timestamps of Significant Changes:**
The development timeline shows concentrated efforts on October 23, 2025, starting with initial routing for analytics (3:20 PM), followed by the creation of core analytics components (`AnalyticsScreen`, `MetricsBox`, `AnalyticsContainer`, `ResizableGridItem`) between 3:21 PM and 3:30 PM. The Redux Toolkit Query API slice for analytics (`analytics-api.ts`) was set up around 3:39 PM, with a crucial update to cache invalidation tags at 3:40 PM. The Redux store (`store.ts`) was updated to include analytics by 3:44 PM. Later, configuration (`config/analytics.ts`, 3:52 PM), analytics-specific utilities (`methods.ts`, 3:58 PM), the Redux analytics state slice (`analytics-slice.ts`, 4:01 PM), and general utilities (`utils.ts`, 4:02 PM) were added, demonstrating a structured rollout of the feature.

**Patterns and Recurring Elements:**

*   **Feature-Driven Development:** The entire log reflects the sequential development and integration of a new "Analytics" feature.
*   **Redux Toolkit & RTK Query:** Redux Toolkit is consistently used for state management, and RTK Query is the chosen method for all API interactions related to analytics, demonstrating a strong adoption of these technologies.
*   **Modular Component Architecture:** The feature is broken down into highly specialized and reusable React components, following a clear hierarchy (e.g., `AnalyticsScreen` > `AnalyticsContainer` > `ResizableGridItem` > `MetricsBox`).
*   **Import Path Refactoring:** A recurring pattern is the adjustment and standardization of import paths, moving from relative to absolute or aliased paths, suggesting an ongoing effort to improve code organization and maintainability.
*   **Interactive Dashboard Elements:** The inclusion of `react-dnd` and `react-resizable` highlights a focus on providing users with a highly interactive and customizable analytics dashboard experience.
*   **Utility Consolidation:** The creation of `methods.ts` and `utils.ts` indicates a strategy to centralize common logic, such as data processing, date handling, and Excel exports, promoting reusability and reducing redundancy.
*   **TypeScript Adoption:** The conversion of `.jsx` files to `.tsx` and the addition of explicit type imports show an ongoing commitment to leveraging TypeScript for better code quality and maintainability, despite some potential mis-typings observed.
*   **Frequent Saves:** Multiple entries for the same file with identical content suggest a development workflow that involves frequent saving or minor non-functional changes.

## 9:35:59 AM
The provided log details a concentrated development effort between October 22-23, 2025, focused primarily on building out an analytics module within the `t360-backend-v2` project.

**File-Specific Updates:**

*   **`src\common\constants\Paths.ts`**
    *   **Timestamp:** 10/22/2025, 12:19:46 PM
    *   **Key Update:** A significant expansion of the `Analytics` section was introduced, adding new base paths and specific endpoints for getting, creating, updating, and deleting dashboards/views, fetching dashboard endpoints, metrics lists, Excel reports, saving sequences, and sizes (`Get`, `Create`, `Update`, `DeleteView`, `DashboardEndPoints`, `MetricsList`, `GetExcelReport`, `SaveSequence`, `SaveSize`, `GetCbm`, `GetKgs`, `GetTeu`, `GetContainers`, `GetTransit`, `GetTablesData`).

*   **`src\routes\analyticsRoutes.ts`**
    *   **Initial Setup (10/22/2025, 12:20:38 PM):** The `AnalyticsRoutes` were initially configured to serve dashboard card and delivery information from `dashboardService`, which was later changed.
    *   **Major Refactor (10/22/2025, 12:33:16 PM):** The route definitions were significantly revised to use `getAll` from the newly introduced `coreViewService` for the `Paths.Analytics.Get` endpoint.
    *   **Expansion (10/22/2025, 12:34:42 PM - 4:38:37 PM):** Routes for `Create`, `Update`, `DeleteView` (from `coreViewService`), `DashboardEndPoints`, `MetricsList`, `SaveSequence`, and `SaveSize` (from `coreMetricService`) were progressively added and correctly mapped to their respective service functions. The `GetExcelReport` route was also mapped to `getExportData` from `analyticsExportService`. Some `Get` endpoints remained as placeholders for `getAll` from `coreViewService`.

*   **`src\routes\index.ts`**
    *   **Timestamp:** 10/22/2025, 12:21:23 PM
    *   **Key Update:** The `AnalyticsRoutes` were integrated into the main API router, enabling access to the new analytics features.

*   **`src\services\coreViewService.ts`**
    *   **Initial Creation (10/22/2025, 12:26:53 PM):** This new service was created to manage user-specific dashboard views, including `getAll`, `create`, `update`, and `deleteView` functionalities. It also introduced `logAudit` for tracking these actions in an `analytics_view_log` table.
    *   **Refinements (10/22/2025, 12:31:11 PM - 12:46:12 PM):** Imports were updated for better type safety (`IAuthReq`, `Response`, `NextFunction`, `CheckBoxDetails`), function signatures were adjusted, and optional chaining (`user?.usercode`) was added for robustness. A significant security enhancement was made by switching SQL `INSERT` and `UPDATE` queries to use parameterized queries (`$1, $2, $3::int[]`) instead of string interpolation for sensitive data like `dashboard_metrics` and `user_id`, mitigating SQL injection risks.

*   **`src\services\coreMetricService.ts`**
    *   **Initial Creation (10/22/2025, 4:11:45 PM):** Introduced `dashboardEndPointList` to fetch and sort dashboard metrics and their display properties (row/column span).
    *   **Expansion (10/22/2025, 4:17:27 PM - 4:38:20 PM):**
        *   `getMetricList` was added to retrieve and categorize available metrics (`Container_Wise`, `MBL_Wise`) and optionally preload their selection status for a given dashboard.
        *   `saveSequence` was implemented to store the order of reports in a dashboard, including logic for a "Default" dashboard.
        *   `saveSize` was added to store layout information (columnSpan, rowSpan) for individual reports within a dashboard.
        *   Improvements were made to type safety with explicit type guards and nullish coalescing operators.

*   **`src\services\analyticsExportService.ts`**
    *   **Initial Creation (10/22/2025, 4:40:11 PM):** Introduced `getExportData` for generating report export files. This service dynamically constructs SQL queries based on various parameters (date range, report name, booking status, columns, display options), applies date filtering, and includes specific column value replacements (e.g., "LONG BEACH" to "LOS ANGELES").
    *   **Refactoring (10/22/2025, 4:47:46 PM):** Imports were updated to use `@src` aliases, `IAuthReq` was adopted for request types, and `userCode` handling for `saveColumns` was made more robust.
    *   **Minor Inconsistency (10/22/2025, 6:08:54 PM):** The import for `nonBookingQuery` was removed, despite the function still being called in the service logic, indicating a potential oversight or a related unlogged change in `export.query.ts`.

*   **`src\utils\analytics.ts`**
    *   **Initial Creation (10/22/2025, 4:43:56 PM):** A utility file for analytics was created, containing helpers such as `defaultDateRange`, `replaceValueInQuery` (for SQL column transformation), `getUserObject` (for user context), `getFilterQueryByDisplayValue` (for SQL aggregation), `getExcelSelectedColumns` (for dynamic column selection), `isValidDate`, `dateFilterOnExport` (for date formatting), and `EXCEL_EXPORT_COLUMNS` (a list of default export columns).
    *   **Type Safety (10/22/2025, 5:09:52 PM):** Type interfaces (`User`, `UserRow`, `DataItem`) and explicit return types were added to functions, enhancing code predictability and error detection.

*   **`src\common\util\export.query.ts`**
    *   **Initial Creation (10/22/2025, 4:46:51 PM):** This utility file was created to house complex, dynamically generated SQL query fragments specific to various analytics reports. It includes `getMonthValue` for date conversion and a large `bookingQuery` function that branches logic based on report names and display parameters.

*   **`src\models\common\types\analytics.ts`**
    *   **Progressive Definition (10/22/2025, 12:27:34 PM - 4:36:01 PM):** This file saw continuous additions and refinements of interfaces to support the analytics module:
        *   `CheckBoxDetails`: For metrics selection.
        *   `MenuRow`: For dashboard titles, later expanded to include `metricsId`, `dashboard_metrics`, and `size`.
        *   `DashboardItem`: For individual metric components within a dashboard, later adding `dashboard_name`.
        *   `MetricListDataI`: For the comprehensive list of metrics with grouping and filtering.
        *   `MetricRow`: For basic metric ID and name.

**Timestamps of Significant Changes:**

*   **10/22/2025, 12:19:46 PM:** Initial definition of analytics paths.
*   **10/22/2025, 12:26:53 PM:** Creation of `coreViewService` for dashboard management.
*   **10/22/2025, 12:46:12 PM:** Key update in `coreViewService.ts` introducing parameterized queries for security.
*   **10/22/2025, 4:11:45 PM:** Creation of `coreMetricService` for dashboard metric endpoints and ordering.
*   **10/22/2025, 4:40:11 PM:** Creation of `analyticsExportService` for report generation.
*   **10/22/2025, 4:43:56 PM:** Creation of `analytics.ts` utility file.
*   **10/22/2025, 4:46:51 PM:** Creation of `export.query.ts` with complex SQL query definitions.
*   **10/22/2025, 5:09:52 PM:** Major type safety improvements in `analytics.ts`.

**Patterns and Recurring Elements:**

*   **Analytics Module Focus:** The overarching pattern is the rapid development and modularization of an analytics system, including view management, metric configuration, and data export.
*   **Timestamp Consistency:** Most significant changes occurred on October 22, 2025, indicating an intensive single-day development push, with minor updates continuing into October 23, 2025.
*   **Database Interactions:** All services heavily rely on a `query` function (likely a PostgreSQL client) to interact with various database tables (`dashboards`, `metrics`, `mtr_tracking_data`, `agent_booking_entry`, `analytics_view_log`, `mtr_user_master`).
*   **TypeScript Adoption:** There's a clear trend towards improving type safety by introducing explicit interfaces for data structures and using type assertions and guards throughout the codebase.
*   **Robust Error Handling:** Consistent use of `try-catch` blocks with `logger.error` for robust error management across API endpoints and service functions.
*   **Dynamic SQL Generation:** Complex SQL queries are frequently constructed dynamically based on user input, report types, and date ranges, particularly for export functionalities. This pattern initially involved string interpolation but later shifted to parameterized queries for improved security in `coreViewService`.
*   **User Context and Authorization:** The `getUserObject` utility and `IAuthReq` interface highlight the importance of managing user and company-specific data access.
*   **Modularization:** The code is structured into distinct services (`coreViewService`, `coreMetricService`, `analyticsExportService`) and utilities (`analytics.ts`, `export.query.ts`) reflecting a clear separation of concerns.

## 10:35:06 AM
The `AnalyticsScreen.jsx` file, last modified on `10/23/2025, 3:18:36 PM`, represents a React component central to the application's analytics functionality.

**File-specific updates in `AnalyticsScreen.jsx`:**

*   **Core Functionality**: The component serves as the main analytics screen, orchestrating the fetching and display of various analytics reports.
*   **State Management**: It extensively uses Redux (`useDispatch`, `useSelector`) to manage application state. It interacts with the `analytics`, `settings`, and `auth` Redux slices to retrieve selected customer, dashboard, loading status, user details (role, company name, ID), and display formatting.
*   **Data Fetching**: It employs RTK Query for efficient data fetching:
    *   `useFetchDashboardsQuery`: Fetches available dashboards based on the user's role and selected company.
    *   `useLazyFetchEndpointsQuery`: Lazily fetches specific analytics endpoints for a selected custom dashboard.
    *   `useLazyFetchReportQuery`: Lazily fetches individual reports based on a given URL and query parameters.
*   **Data Flow and Effects (`useEffect`)**:
    *   An initial `useEffect` populates the Redux `dashboard` state once dashboard views are successfully fetched and a user ID is available.
    *   A primary `useEffect` handles the core data fetching logic:
        *   It dynamically determines whether to use `DEFAULT_ANALYTICS_ENDPOINTS` or fetch custom endpoints based on the `selectedDashobard`.
        *   It then concurrently fetches multiple reports using `Promise.all` based on the determined endpoints.
        *   Report queries include parameters like `apiKey` (hardcoded "nRKniUrJd6rjNCyvT8iRRHmG"), `reportName`, `userid`, a date range (defaulting to "year_2_date" using `dateFilterHandle`), `displayBy`, `viewBy`, `companyname`, and `access`.
        *   Fetched data is processed by `metricsPackageHandler` and dispatched to the Redux `allMetric` state.
        *   Loading states are managed using `setLoading` actions.
    *   A separate `useEffect` automatically sets the selected customer if the user's role is 'CUSTOMER'.
*   **User Interface**:
    *   The screen incorporates common UI components like `ScreenToolbar`, `ThemedBreadcrumb`, and `AnalyticsToolbar`.
    *   It displays a `Loader` when data is being fetched.
    *   It conditionally renders an `Alert` if an 'ADMIN' user has not selected a customer, or the main `AnalyticsContainer` once data is ready.

**Patterns and Recurring Elements**:

*   **Redux-centric State Management**: The component is heavily integrated with Redux for managing global application state, reflecting a common pattern in the project for data flow.
*   **RTK Query for API Interactions**: All data fetching is handled through RTK Query hooks, indicating a consistent approach to API calls across the application.
*   **Conditional Rendering**: Extensive use of conditional rendering based on user roles, loading states, and data availability (`user.role`, `mainState.isLoading`, `mainState.selectedCustomer`).
*   **Date Handling**: `moment` and `dateFilterHandle` are used for consistent date range calculations for report queries.
*   **Modular Component Structure**: The use of `AnalyticsContainer`, `AnalyticsToolbar`, `ScreenToolbar`, `Loader`, and `Breadcrumb` suggests a modular approach to UI development.
*   **Hardcoded API Key**: The presence of `apiKey: "nRKniUrJd6rjNCyvT8iRRHmG"` directly within the code for `fetchReport` calls is a recurring pattern for API interaction, though this specific instance is hardcoded.

## 10:35:09 AM
The file `c:\Users\ridap\OneDrive\Documents\T360_Api\t360-backend\src\routes\analytics.route.ts` was updated on 10/22/2025, 11:01:53 AM. This file primarily defines the API routes for various analytics functionalities within the `t360-backend`.

Key updates include:
*   **Dashboard Management:** Routes for retrieving all dashboards (`/dashboards` GET), creating (`/dashboards` POST), updating (`/dashboards` PUT), and deleting (`/dashboards` DELETE) dashboards.
*   **Metric and Endpoint Listing:** Endpoints for fetching dashboard endpoints (`/dashboardEndPoints`) and a list of metrics (`/metricsList`).
*   **Data Export:** A route for exporting data to Excel (`/excelExport`).
*   **User Preferences:** Routes for saving user preferences related to sequence (`/save_sequence`) and size (`/save_size`).
*   **Reporting:** Multiple dedicated routes for various analytical reports, including CBM (`/cbm`), KGS (`/kgs`), TEU (`/teu`), container details (`/containers`), transit information (`/transit`), and general table data (`/Tables/tableData`).

A clear pattern is the consolidation of numerous analytics-specific endpoints into this single route file, leveraging multiple specialized controllers (e.g., `cbm.controller`, `kgs.controller`, `teu.controller`, `container.controller`, `transit.controller`, `others.controller`) to handle diverse reporting and dashboard management tasks.

## 10:36:02 AM
The code changes primarily revolve around the development and integration of a new "Analytics" dashboard feature into the T360-V2 frontend application. All modifications occurred on 10/23/2025, indicating a focused development session.

**File-Specific Updates:**

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\App.tsx`**
    *   **3:20:46 PM**: Initial routing showed an `/app/analytics` route pointing to a `ShipmentWithContainersPage`.
    *   **3:22:00 PM**: The new `AnalyticsScreen` component was imported and successfully integrated into the application's routing, replacing the previous placeholder for the `/app/analytics` path.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\pages\analytics\analytics-page.tsx`**
    *   **3:21:50 PM**: This file was introduced or significantly updated to define the core `AnalyticsScreen` component. It leverages Redux Toolkit Query to fetch dashboard views, endpoints, and reports, manages loading states, and dispatches analytics-related state updates. A hardcoded API key (`apiKey: "nRKniUrJd6rjNCyvT8iRRHmG"`) is present within the report fetch query.
    *   **3:52:16 PM**: The import path for `AnalyticsContainer` was updated to use a path alias (`@components`).
    *   **4:03:08 PM**: Underwent a major refactor, updating numerous import paths from relative paths to aliases for Redux API, slice modules, configuration, and common components. The page's layout also changed significantly, replacing `ScreenToolbar` and `ThemedBreadcrumb` with a `PageWrapper` component for a more structured header.
    *   **4:03:54 PM**: Further refined import paths, specifically for `dateFilterHandle`, to use the `utils/utils` alias, and removed any remaining obsolete imports.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\components\screen\analytics\metricBox.tsx`**
    *   **3:24:36 PM**: This component was introduced to display individual analytics metrics within a box. It dynamically renders various chart types (Bar, Pie, Line, StackedBar, Gauge), manages chart view selections, and provides a full-screen modal for detailed chart inspection.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\components\screen\analytics\AnalyticsContainer.jsx` (and subsequent `.tsx` versions)**
    *   **3:27:17 PM**: Initially created as `AnalyticsContainer.jsx`, this component handles the grid layout for analytics metric boxes. It integrates `react-dnd` for drag-and-drop reordering and `react-resizable` for resizing. It also dispatches actions to save metric sequence and size to the backend via Redux mutations.
    *   **3:27:30 PM**: The file was renamed/copied to `AnalyticsContainer.tsx`, transitioning to TypeScript without functional changes.
    *   **3:32:02 PM**: A previously removed `MetricsBox` import was corrected (re-added with a casing adjustment), and Redux slice imports were updated.
    *   **3:42:56 PM**: TypeScript `RootState` type annotations were added to Redux `useSelector` hooks, enhancing type safety.
    *   **3:46:41 PM**: Introduced potential errors by modifying Redux state selectors (e.g., `state.analytics` to `state.analyticsApi`, `state.settings` to `state.setting`), which might cause runtime issues.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\components\screen\analytics\ResizableGridItem.jsx`**
    *   **3:30:21 PM**: This component was introduced to enable individual grid items to be both resizable and draggable within the `AnalyticsContainer`. It leverages `react-resizable` to adjust column and row spans based on size, and `react-dnd` for reordering.
    *   **3:30:28 PM**: The component's export type was changed from a named export to a default export.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\store\api\analytics-api.ts`**
    *   **3:39:04 PM**: This file was added to define the `analyticsApi` using Redux Toolkit Query. It includes endpoints for fetching dashboard data and mutations for saving metric order (`saveSequence`) and size (`saveMetricSize`). The initial version had an oversight with undefined `tagTypes`.
    *   **3:40:00 PM**: The `tagTypes` array was corrected by adding `"SEQ"` and `"SIZE"`, ensuring proper cache invalidation for related mutations.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\store\store.ts`**
    *   **3:44:26 PM**: The `analyticsApi` reducer and its middleware were successfully integrated into the application's global Redux store, making analytics data and functionalities available throughout the application.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\config\analytics.ts`**
    *   **3:52:59 PM**: This new configuration file was added. It defines `DEFAULT_ANALYTICS_ENDPOINTS` for various reports (e.g., CBM, TEU metrics), `EXCEL_EXPORT_COLUMNS` for spreadsheet exports, and a detailed `ANALYTICS_REPORT_HEADER` mapping report names to their respective display column headers for both container-wise and MBL-wise reports.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\components\screen\analytics\methods.ts`**
    *   **3:58:24 PM**: This file was added to centralize utility functions for the analytics feature. It includes `metricsPackageHandler` for data transformation, functions for managing chart options (`allChartOptions`, `chartOptionsByType`), `reportFormula` for calculating report-specific metrics, and `downloadReportSpreadsheet` for robust Excel export capabilities, handling different report structures and filters.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\store\fretures\analytics-slice.ts`**
    *   **4:01:14 PM**: This Redux slice was introduced to manage the state specific to the analytics dashboard. It defines initial states for endpoints, metrics, date filters (global and local), dashboard selections, loading status, and user interaction types (resize/move). It also includes reducers to update these states.
    *   **4:02:19 PM**: The import path for `dateFilterHandle` was updated to `utils/utils`, reflecting a move towards centralized utilities.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\utils\utils.ts`**
    *   **4:02:02 PM**: This utility file was introduced, providing general helper functions such as `appDateFormat` for consistent date formatting, `parseRawString` for data cleaning, `useDateFormate` for dynamic date formatting based on user preferences, and a comprehensive `dateFilterHandle` to calculate date ranges for various common time filters.

**Patterns and Recurring Elements:**

The changes demonstrate a concentrated effort on developing and integrating a new, interactive analytics dashboard. Key patterns include:

*   **Dedicated Feature Development**: The sheer volume of new and modified files within the `analytics` directory structure highlights a focused sprint on this feature.
*   **Redux Toolkit & RTK Query**: These libraries are central to the new analytics feature for both managing global state (`analytics-slice.ts`) and handling all API interactions (`analytics-api.ts`).
*   **Interactive UI**: The use of `react-dnd` and `react-resizable` in `AnalyticsContainer` and `ResizableGridItem` indicates a strong emphasis on user customization and interactivity for dashboard layouts.
*   **Code Standardization and Refactoring**: There is a clear pattern of updating import paths to use path aliases (e.g., `@components`, `config`, `utils`) instead of relative paths, which suggests an ongoing effort to standardize the project's module resolution. The transition from `.jsx` to `.tsx` files also points towards increased adoption of TypeScript.
*   **Centralized Date Handling**: A robust approach to date filtering and formatting is evident, with a dedicated `dateFilterHandle` utility function and consistent use of `moment.js` across analytics components.
*   **Hardcoded API Key**: The presence of a hardcoded `apiKey` in `src\pages\analytics\analytics-page.tsx` is a recurring element, representing a potential security concern.

## 10:36:09 AM
The provided log details a significant development push focused on enhancing analytics features within the `t360-backend-v2` project.

**File-Specific Updates:**

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-backend-v2\src\common\constants\Paths.ts`**
    *   **(10/22/2025, 12:19:46 PM)** Introduced a comprehensive set of new API paths under `Analytics` for retrieving, creating, updating, deleting views, fetching dashboard endpoints, metric lists, Excel reports, saving sequences, and sizes. This forms the foundation for the new analytics module.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-backend-v2\src\routes\analyticsRoutes.ts`**
    *   **(10/22/2025, 12:20:38 PM)** Initially configured with dashboard services (`getDashboardCardInfo`, `getDeliveryData`), which was a temporary or incorrect setup.
    *   **(10/22/2025, 12:33:16 PM - 12:33:26 PM)** Corrected to import and use analytics-specific services, specifically `getAll` from `coreViewService`, removing the dashboard service dependencies.
    *   **(10/22/2025, 12:34:42 PM)** Expanded to include POST, PUT, and DELETE routes for analytics views (`create`, `update`, `deleteView`) using `coreViewService`.
    *   **(10/22/2025, 4:13:43 PM)** Integrated `dashboardEndPointList` from `coreMetricService`. Several routes (`MetricsList`, `GetExcelReport`, `Get`) were temporarily mapped to `getAll` from `coreViewService` as placeholders.
    *   **(10/22/2025, 4:22:31 PM)** Corrected the `MetricsList` route to point to `getMetricList` from `coreMetricService`.
    *   **(10/22/2025, 4:23:23 PM - 4:23:31 PM)** Added `SaveSequence` and `SaveSize` routes as POST requests, initially still pointing to `getAll` as placeholders.
    *   **(10/22/2025, 4:38:37 PM)** Finalized `SaveSequence` and `SaveSize` routes to correctly use their respective functions from `coreMetricService`.
    *   **(10/22/2025, 4:40:33 PM)** Mapped `GetExcelReport` to `getExportData` from the new `analyticsExportService`.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-backend-v2\src\routes\index.ts`**
    *   **(10/22/2025, 12:21:23 PM)** Integrated `AnalyticsRoutes` into the main application router, making the new analytics endpoints accessible.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-backend-v2\src\services\coreViewService.ts`**
    *   **(10/22/2025, 12:26:53 PM)** Introduced core CRUD operations (`getAll`, `create`, `update`, `deleteView`) for managing user-specific dashboard configurations stored in a `dashboards` table. Also, implemented `logAudit` for tracking these changes in `analytics_view_log`.
    *   **(10/22/2025, 12:31:11 PM)** Refactored function signatures for improved type safety (`IAuthReq`, `Response`, `NextFunction`) and introduced imports for `CheckBoxDetails`.
    *   **(10/22/2025, 12:32:31 PM)** Added optional chaining (`?.usercode`) for user object access, making it more robust.
    *   **(10/22/2025, 12:46:12 PM)** Significantly enhanced database interaction by adopting parameterized queries for `create` and `update` operations, improving security (SQL injection prevention) and type handling for array data (`ARRAY[metricsIdsArray]::int[]`). Also, added type safety for `menuListArray` using `MenuRow[]`.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-backend-v2\src\models\common\types\analytics.ts`**
    *   **(10/22/2025, 12:27:34 PM)** Defined `CheckBoxDetails` interface.
    *   **(10/22/2025, 12:37:00 PM)** Added `MenuRow` interface.
    *   **(10/22/2025, 4:05:10 PM)** Expanded `MenuRow` to include `dashboard_metrics` (string) and `size` (number) properties, reflecting changes in dashboard data storage.
    *   **(10/22/2025, 4:11:25 PM)** Introduced `DashboardItem` interface for individual dashboard metric elements.
    *   **(10/22/2025, 4:14:47 PM)** Added `MetricListDataI` interface for metric selection lists.
    *   **(10/22/2025, 4:19:45 PM)** Added `dashboard_name: string` to `DashboardItem`.
    *   **(10/22/2025, 4:36:01 PM)** Added `MetricRow` interface, likely for mapping metric IDs and names.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-backend-v2\src\services\coreMetricService.ts`**
    *   **(10/22/2025, 4:11:45 PM)** New file created with `dashboardEndPointList`, a function to retrieve ordered dashboard metrics and their display properties (`rowSpan`, `columnSpan`) from the `metrics` and `dashboards` tables.
    *   **(10/22/2025, 4:17:27 PM)** Added `getMetricList`, which fetches and categorizes metrics by `filter_by` ("Container_Wise", "MBL_Wise") and `group`, supporting a "preload" feature to mark already selected metrics for a dashboard.
    *   **(10/22/2025, 4:21:55 PM)** Enhanced type safety and null checks for `dashboard_name` and `user.usercode` in `getMetricList`.
    *   **(10/22/2025, 4:27:44 PM)** Implemented `saveSequence` to update the order of metrics in a dashboard and `saveSize` to store layout (column/row span) properties for individual metrics. These functions interact with the `dashboards` table.
    *   **(10/22/2025, 4:32:09 PM - 4:38:20 PM)** Further improved type safety in `saveSequence` and `saveSize`, explicitly handling `undefined` values and ensuring correct type casting. Changed `AuthenticatedRequest` to `IAuthReq`.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-backend-v2\src\services\analyticsExportService.ts`**
    *   **(10/22/2025, 4:40:11 PM)** New file created, introducing `getExportData` for generating detailed Excel exports. This function dynamically constructs complex SQL queries based on numerous parameters (report type, date ranges, columns, booking status, stacking options). It includes logic for date filtering, column replacement (`LONG BEACH` to `LOS ANGELES`), and special handling for "TEU MBLwise" reports.
    *   **(10/22/2025, 6:08:54 PM - 10/23/2025, 11:04:38 AM)** Refined type handling for `userCode` when calling `saveColumns`. A potential issue was introduced or persisted where `nonBookingQuery` is called but not imported explicitly in the latest entries for this file.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-backend-v2\src\utils\analytics.ts`**
    *   **(10/22/2025, 4:43:56 PM)** New file containing several utility functions: `defaultDateRange` (for date calculations), `replaceValueInQuery` (for dynamic SQL column replacement), `getUserObject` (for user and company context retrieval), `getFilterQueryByDisplayValue` (for dynamic date-based SQL grouping/ordering), `getExcelSelectedColumns` (for dynamic column selection in exports), `dateFilterOnExport` (for validating and formatting dates in export data), and `EXCEL_EXPORT_COLUMNS` (a constant for export column definitions).
    *   **(10/22/2025, 5:09:52 PM)** Enhanced type safety by introducing `User` and `UserRow` interfaces and adding explicit type castings and null checks in relevant functions.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-backend-v2\src\common\util\export.query.ts`**
    *   **(10/22/2025, 4:46:51 PM)** New file created. Contains `getMonthValue` helper and `bookingQuery`, a function responsible for generating detailed SQL `WHERE` clauses for various booking-related analytics reports, including logic for stacked bar charts.

**Timestamps of Significant Changes:**

The development activity was highly concentrated on **October 22, 2025**.
*   **Early afternoon (12:19 PM - 12:46 PM):** Initial setup of analytics API paths, core view services (CRUD for dashboards, audit logging), and basic type definitions.
*   **Late afternoon (4:05 PM - 4:47 PM):** Rapid expansion with new types for dashboard items and metrics, creation of `coreMetricService` (for endpoint lists, metric selection, saving sequence/size), and introduction of `analyticsExportService` (for Excel exports) and `utils/analytics.ts` (for helper functions and dynamic SQL generation).
*   **Evening (5:09 PM - 6:08 PM) and next day (10/23/2025, 11:00 AM - 11:04 AM):** Refinement of type safety across `utils/analytics.ts` and `analyticsExportService.ts`.

**Patterns and Recurring Elements:**

1.  **Analytics-Centric Development:** The entire log details the construction of a comprehensive analytics module, covering dashboard view management, metric configuration, and data export.
2.  **Modular Design:** The project adheres to a clear separation of concerns, utilizing `constants` for paths, `routes` for API definitions, `services` for business logic, `models` for data structures, and `utils` for common helpers.
3.  **Extensive Use of TypeScript:** There's a strong pattern of progressively adding and refining interfaces (`CheckBoxDetails`, `MenuRow`, `DashboardItem`, etc.) and type annotations (`IAuthReq`, `Response`, `as string`) to improve code robustness and maintainability, especially apparent in `coreViewService.ts`, `coreMetricService.ts`, and `utils/analytics.ts`.
4.  **Database Interaction:** All services heavily rely on a `query` function (presumably a PostgreSQL client wrapper) for data retrieval and manipulation, interacting with `dashboards`, `metrics`, `mtr_user_master`, `mtr_tracking_data`, and `agent_booking_entry` tables.
5.  **Dynamic SQL Generation:** Complex SQL queries are built dynamically based on user inputs and report parameters, particularly in `analyticsExportService.ts` and `export.query.ts`. Parameterized queries are adopted for security and type correctness.
6.  **Error Handling and Logging:** Consistent implementation of `try...catch` blocks for error management and extensive use of a `logger` for debugging and operational insights across all services.
7.  **Audit Trail:** The `logAudit` function demonstrates a requirement to maintain a record of changes made to dashboard configurations.
8.  **Data Transformation:** Functions like `dateFilterOnExport` and `replaceColumnHandler` are used to standardize and format data before it's presented or exported.
9.  **API Route Definition:** A repetitive pattern of importing service functions and mapping them to specific `Paths.Analytics` endpoints using `express.Router()`.
10. **Refinement and Correction:** An observable pattern of initial implementation followed by quick corrections and refinements, such as fixing misrouted analytics endpoints or enhancing type safety. A potential regression was observed with the `nonBookingQuery` import in `analyticsExportService.ts`.

## 11:35:08 AM
The `AnalyticsScreen.jsx` file, updated on 10/23/2025 at 3:18:36 PM, serves as the main entry point for the analytics dashboard in the `t360-frontend` application.

**File-Specific Updates:**

*   **Redux Integration:** The component extensively uses Redux for state management, dispatching actions to `setDashboard`, `setEndpoints`, `setAllMetric`, `setCustomer`, and `setLoading` from the `analyticsSlice`. It also selects `mainState` (analytics), `settingsState`, and `user` (authentication) from the store.
*   **API Interactions (RTK Query):**
    *   `useFetchDashboardsQuery` is used to initially fetch available dashboards based on the user's role and selected company.
    *   `useLazyFetchEndpointsQuery` is employed to dynamically fetch analytics endpoints (menu items) based on the `selectedDashobard`.
    *   `useLazyFetchReportQuery` is used to fetch individual analytics reports.
*   **Data Fetching Logic:**
    *   An initial `useEffect` populates the Redux store with dashboard views once successfully fetched.
    *   A primary `useEffect` orchestrates the fetching of endpoints and subsequent reports:
        *   It first determines whether to use `DEFAULT_ANALYTICS_ENDPOINTS` or fetch custom endpoints based on `mainState.selectedDashobard`.
        *   It then calls `fetchAllReports`, which uses `Promise.all` to concurrently fetch data for all determined endpoints. Each report fetch includes parameters like `apiKey`, `reportName`, `userid`, `fromDate`, `toDate`, `displayBy`, `viewBy`, `companyname`, and `access`.
        *   A hardcoded `apiKey: "nRKniUrJd6rjNCyvT8iRRHmG"` is present in the report query.
        *   Fetched data is processed by `metricsPackageHandler` and dispatched to the Redux store.
*   **User Role Handling:**
    *   If the user's role is 'CUSTOMER', their `companyname` is automatically set as the `selectedCustomer`.
    *   The UI displays an `Alert` for 'ADMIN' users if no customer is selected, prompting them to choose one.
*   **UI Components:** The screen incorporates common UI elements like `ScreenToolbar` with `ThemedBreadcrumb` and `AnalyticsToolbar`, a `Loader` for loading states, and an `AnalyticsContainer` to display the actual analytics content. Material UI `Box` and `Alert` components are also used.
*   **Date Management:** `moment` and `dateFilterHandle` are utilized to manage date ranges for report queries, specifically setting an `initialDateRange` to "year_2_date".

**Patterns and Recurring Elements:**

*   **Chained Data Fetching:** A clear pattern of fetching dashboards, then endpoints based on selection, and finally multiple reports based on those endpoints.
*   **Redux as Central State:** Heavy reliance on Redux for managing loading states, user selections (customer, dashboard), and all fetched analytics data.
*   **Conditional Rendering:** The component frequently uses conditional rendering (`isLoading`, `user.role`, `selectedCustomer`) to display appropriate UI elements or loaders.
*   **API Query Parameters:** Consistent use of `companyname`, `access`, and `userid` across multiple API calls, indicating role-based and company-specific data access.
*   **Date Filtering:** All report queries include dynamic `fromDate` and `toDate` parameters, highlighting a standardized date filtering mechanism.

## 11:35:10 AM
The `c:\Users\ridap\OneDrive\Documents\T360_Api\t360-backend\src\routes\analytics.route.ts` file was updated on 10/22/2025 at 11:01:53 AM.

This file serves as the central routing definition for the analytics module within the `t360-backend`. Key updates and functionalities include:

*   **Comprehensive Analytics Endpoints:** The route defines a wide array of endpoints for managing and retrieving analytics data.
*   **Dashboard Management:** It includes full CRUD (Create, Read, Update, Delete) operations for dashboards via `/dashboards` endpoints.
*   **Metric and Configuration Retrieval:** Endpoints like `/dashboardEndPoints` and `/metricsList` are provided to fetch available dashboard configurations and metric definitions.
*   **Data Export:** A dedicated endpoint `/excelExport` is available for exporting analytics data.
*   **User Preferences:** Functionality for saving user preferences related to dashboard display, specifically `save_sequence` and `save_size`, is included.
*   **Specific Report Access:** Several dedicated endpoints are defined to fetch various types of reports, including `/cbm`, `/kgs`, `/teu`, `/containers`, `/transit`, and a generic `/Tables/tableData` endpoint for other reports.

The updates consolidate various analytics-related functionalities, ranging from dashboard management and user preferences to specific data reports and export capabilities, all pointing to different controllers under an `analytics` directory.

## 11:35:57 AM
The log details significant development around an analytics feature, with a rapid series of updates focusing on dashboard management, metric display, and data export.

**Key Information by File:**

*   **`src\common\constants\Paths.ts` (10/22/2025, 12:19:46 PM):** This file saw a substantial expansion of the `Analytics` base path. New endpoints were introduced for various analytics operations, including `Get`, `Create`, `Update`, `DeleteView`, `DashboardEndPoints`, `MetricsList`, `GetExcelReport`, `SaveSequence`, `SaveSize`, and several metric-specific endpoints like `GetCbm`, `GetKgs`, `GetTeu`, `GetContainers`, `GetTransit`, and `GetTablesData`. This indicates the foundational setup for a comprehensive analytics module.

*   **`src\routes\analyticsRoutes.ts`:**
    *   **Initial (10/22/2025, 12:20:38 PM):** The analytics router was initially created, surprisingly mapping to `dashboardService` functions for card and delivery info.
    *   **Evolution (10/22/2025, 12:33:16 PM - 12:34:42 PM):** This quickly shifted, removing the dashboard service dependencies and importing `getAll`, `create`, `deleteView`, and `update` from `coreViewService`. Corresponding routes for CRUD operations on analytics views (`/`, `/create`, `/update`, `/delete-view`) were established.
    *   **Expansion (10/22/2025, 4:13:43 PM - 4:40:33 PM):** Further routes were added, integrating `dashboardEndPointList`, `getMetricList`, `saveSequence`, `saveSize` from `coreMetricService`, and `getExportData` from `analyticsExportService`. Several redundant `AnalyticsRoutes.get(Paths.Analytics.Get,getAll);` entries appeared, likely as placeholders or copy-paste errors, but were later correctly mapped to specific service functions (`saveSequence`, `saveSize`, `getExportData`).

*   **`src\routes\index.ts` (10/22/2025, 12:21:23 PM):** This file was updated to include and integrate the new `AnalyticsRoutes` into the main API router, ensuring all defined analytics endpoints are accessible.

*   **`src\services\coreViewService.ts`:**
    *   **Initial (10/22/2025, 12:26:53 PM):** Introduced core logic for managing analytics dashboards (`getAll`, `create`, `update`, `deleteView`). These functions perform database queries against a `dashboards` table and include an audit logging mechanism (`logAudit`) to `analytics_view_log`.
    *   **Refinements (10/22/2025, 12:31:11 PM - 12:33:09 PM):** Type safety was enhanced by importing specific request/response types (`IAuthReq`, `Response`, `NextFunction`) and adding optional chaining (`user?.usercode`) for user properties. The export style was also changed to named exports.
    *   **Security & Type Safety Improvements (10/22/2025, 12:46:12 PM):** A significant change involved migrating `create` and `update` database queries from string interpolation to parameterized queries (`$1`, `$2`, etc.), which is a crucial step for preventing SQL injection. Type casting for database array types (`::int[]`) was also introduced. However, the `deleteView` function still uses string interpolation for query parameters.

*   **`src\models\common\types\analytics.ts`:** This file evolved significantly over time, reflecting the growing complexity of the analytics feature. It started with just `CheckBoxDetails` (10/22/2025, 12:27:34 PM), then added `MenuRow` with `menu_title`, `metricsId`, `dashboard_metrics`, and `size` (up to 10/22/2025, 4:05:10 PM). Later additions included `DashboardItem` (10/22/2025, 4:11:25 PM, with `dashboard_name` added at 4:19:45 PM) for dashboard reports, `MetricListDataI` (10/22/2025, 4:14:47 PM) for metric lists, and `MetricRow` (10/22/2025, 4:36:01 PM) for individual metric data. These changes collectively illustrate the granular data structures required for the new analytics dashboards.

*   **`src\services\coreMetricService.ts`:**
    *   **Initial (10/22/2025, 4:11:45 PM):** Introduced `dashboardEndPointList`, which retrieves dashboard configurations (`dashboard_metrics`, `size`) and maps them to actual metric endpoints, including layout information (`rowSpan`, `columnSpan`).
    *   **Feature Expansion (10/22/2025, 4:17:27 PM - 4:21:55 PM):** Added `getMetricList` for fetching and categorizing metrics (e.g., "Container_Wise", "MBL_Wise") and a "preload" feature to mark selected metrics for a given dashboard. Type casting and null checks were improved here.
    *   **Persistence Logic (10/22/2025, 4:27:44 PM - 4:38:20 PM):** Implemented `saveSequence` to update the order of metrics in a dashboard and `saveSize` to store layout dimensions (row and column spans) for individual reports within a dashboard. These functions include validation and database updates. Further type safety improvements, including type guards and explicit type aliases, were added to these functions.

*   **`src\services\analyticsExportService.ts`:**
    *   **Initial (10/22/2025, 4:40:11 PM):** Introduced `getExportData` for generating Excel report data. This function dynamically builds complex SQL queries based on numerous query parameters (date ranges, report names, column selections, grouping, etc.). It includes a `replaceColumnHandler` to standardize location names (e.g., "LONG BEACH" to "LOS ANGELES") and specialized logic for TEU MBLwise reports.
    *   **Refactor (10/22/2025, 4:47:46 PM):** Refactored imports to use `@src` aliases and improved the handling of `userCode` with nullish coalescing.
    *   **Minor (10/23/2025, 11:00:20 AM - 11:04:38 AM):** Minor formatting updates.

*   **`src\utils\analytics.ts`:**
    *   **Initial (10/22/2025, 4:43:56 PM):** Consolidated utility functions for analytics, including `defaultDateRange`, `replaceValueInQuery` (for column transformation in SQL), `getUserObject` (for user-specific data retrieval), `getFilterQueryByDisplayValue` (for dynamic SQL clauses based on display options), `getExcelSelectedColumns` (for dynamic column selection), `isValidDate`, `dateFilterOnExport` (for date formatting), and `EXCEL_EXPORT_COLUMNS` (a constant list of exportable columns).
    *   **Type Safety (10/22/2025, 5:09:52 PM):** Introduced TypeScript interfaces (`User`, `UserRow`, `DataItem`) and enhanced type annotations for function parameters and return values, significantly improving code robustness and maintainability.
    *   **Minor (10/22/2025, 5:11:25 PM):** Minor formatting changes.

*   **`src\common\util\export.query.ts` (10/22/2025, 4:46:51 PM - 6:05:51 PM):** This new utility file was created to house complex, report-specific SQL query logic. It contains `getMonthValue` for date conversion and a large `bookingQuery` function that dynamically generates SQL fragments for various booking-related reports, including detailed conditions for stacked bar charts based on time differences and grouping. The queries heavily rely on string interpolation for parameters like `CompanyName`, `stackedMonth`, `startWeek`, `endWeek`, `quarter`, and `stackedGroup`.

**Patterns and Recurring Elements:**

*   **Analytics Module Development:** The core theme is the rapid development and integration of a new "Analytics" module, from route definition to backend services and helper utilities.
*   **Database-Centric Operations:** Most changes involve extensive interaction with a PostgreSQL database, performing CRUD operations on `dashboards` and `metrics` tables, and generating complex queries for reporting and export.
*   **Type Safety Evolution:** There's a clear and continuous effort to improve type safety throughout the codebase, particularly in service functions and utility types, by introducing interfaces, explicit type annotations, and type guards.
*   **SQL Query Handling:** A pattern of dynamically constructing SQL queries based on user input and various parameters is prevalent, especially in `coreMetricService`, `analyticsExportService`, and `export.query.ts`. While `coreViewService` improved to parameterized queries for some operations, `export.query.ts` heavily relies on string interpolation for dynamic SQL.
*   **Audit Logging:** The `logAudit` function in `coreViewService` indicates a consistent pattern of tracking changes to critical dashboard configurations.
*   **Date and Data Transformation:** Utility functions for date range defaults, date formatting, and data transformation (e.g., replacing location names) are consistently applied before sending data to the client.
*   **Error Handling:** All service functions include `try...catch` blocks and log errors using `logger.error`, sending a generic "Internal Server Error" response on failure.

## 11:36:04 AM
The provided log details significant development in a frontend application, primarily focusing on the introduction and refinement of an "Analytics" dashboard feature, alongside general UI component enhancements and Redux Toolkit integration.

**File-Specific Updates:**

*   **`src\App.tsx`**:
    *   **Timestamp: 10/23/2025, 3:20:46 PM**: Added a route `/app/analytics` initially pointing to `ShipmentWithContainersPage` (likely a placeholder error).
    *   **Timestamp: 10/23/2025, 3:22:00 PM**: Corrected the `/app/analytics` route to properly render the `AnalyticsScreen` component and imported `AnalyticsScreen`.
*   **`src\pages\analytics\analytics-page.tsx`**:
    *   **Timestamp: 10/23/2025, 3:21:50 PM**: Initial creation of the `AnalyticsScreen` component. It fetches dashboard views and endpoints, then retrieves reports based on user selections. It includes Redux integration (`useDispatch`, `useSelector`) for managing analytics state, user roles, and displays a loader or an alert for admin users without a selected customer.
    *   **Timestamp: 10/23/2025, 3:52:16 PM**: Refactored the import path for `AnalyticsContainer` to use an alias (`@components`).
    *   **Timestamp: 10/23/2025, 4:03:08 PM - 4:03:54 PM**: Further import path refactoring (e.g., Redux API and slice paths, utility paths) and introduced a `PageWrapper` component to structure the toolbar and main content, including `AnalyticsToolbar`.
*   **`src\components\screen\analytics\metricBox.tsx`**:
    *   **Timestamp: 10/23/2025, 3:24:36 PM**: Implemented `MetricsBox` to render various chart types (Bar, Pie, Line, Stacked Bar, Gauge) based on `item.chartType`. It handles chart view state, includes a full-screen modal, and imports several chart-specific components and utility functions.
    *   **Timestamp: 10/24/2025, 11:31:40 AM**: Refactored the import path for `ThemedModal`.
*   **`src\components\screen\analytics\AnalyticsContainer.jsx` / `analyticsContainer.tsx`**:
    *   **Timestamp: 10/23/2025, 3:27:17 PM**: Initial JSX implementation of `AnalyticsContainer`. It integrates `react-dnd` for drag-and-drop and `ResizableGridItem` for resizing. It manages metric display, and dispatches Redux actions to `saveSequence` (metric order) and `saveMetricSize` (metric dimensions) via API mutations.
    *   **Timestamp: 10/23/2025, 3:27:30 PM**: File extension changed from `.jsx` to `.tsx`.
    *   **Timestamp: 10/23/2025, 3:32:02 PM - 3:41:42 PM**: Several updates include re-adding the `MetricsBox` import (with a casing change), refactoring import paths for `ResizableGridItem` and Redux API.
    *   **Timestamp: 10/23/2025, 3:42:56 PM**: Added TypeScript `RootState` type annotation to Redux `useSelector` hooks.
    *   **Timestamp: 10/23/2025, 3:46:41 PM**: Modified Redux selectors for `mainState` to `state.analyticsApi` and `settingsState` to `state.setting`, which might be a refactoring bug as `analyticsApi` is an RTK Query reducer path.
*   **`src\components\screen\analytics\ResizableGridItem.jsx`**:
    *   **Timestamp: 10/23/2025, 3:30:21 PM**: Implemented `ResizableGridItem` using `react-resizable` and `react-dnd` to enable resizing and reordering of grid items. It conditionally applies drag/drop functionality based on `operationType`.
    *   **Timestamp: 10/23/2025, 3:30:28 PM**: Changed export from named to default.
*   **`src\store\api\analytics-api.ts`**:
    *   **Timestamp: 10/23/2025, 3:39:04 PM**: Initialized Redux Toolkit Query API slice `analyticsApi`. Defined endpoints for fetching reports, endpoints, dashboards, dashboard options, and mutations for saving dashboards, sequence, and metric size. Started with `tagTypes: ["VIEW"]`.
    *   **Timestamp: 10/23/2025, 3:40:00 PM**: Added `SEQ` and `SIZE` to `tagTypes` and configured `invalidatesTags` for `saveSequence` and `saveMetricSize` mutations for effective cache management.
*   **`src\store\store.ts`**:
    *   **Timestamp: 10/23/2025, 3:44:26 PM**: Integrated `analyticsApi` reducer and middleware into the main Redux store.
*   **`src\pages\analytics\analytics-page.tsx`**:
    *   (Already mentioned, but a key timestamp for structural change) **Timestamp: 10/23/2025, 4:03:08 PM**: Introduced `PageWrapper` and imported components from aliases like `@components/common/loader` and `@components/screen/analytics/methods`.
*   **`src\config\analytics.ts`**:
    *   **Timestamp: 10/23/2025, 3:52:59 PM**: Defined `DEFAULT_ANALYTICS_ENDPOINTS`, `EXCEL_EXPORT_COLUMNS`, `CargoReadyToETD10Days` and `ANALYTICS_REPORT_HEADER` constants, centralizing configuration for analytics reports and export.
*   **`src\components\screen\analytics\methods.ts`**:
    *   **Timestamp: 10/23/2025, 3:58:24 PM**: Contains utility functions for analytics data processing (`metricsPackageHandler` for formatting chart data, calculating totals/averages), chart options (`allChartOptions`, `chartOptionsByType`), report formula generation (`reportFormula`), date formatting (`weekDateFormater`), and Excel report generation (`downloadReportSpreadsheet`).
    *   **Timestamp: 10/24/2025, 11:19:54 AM**: Major update introducing explicit TypeScript typings for various interfaces and the `metricsPackageHandler` function. An `AnalyticsChartType` enum was also defined, and icon rendering was updated to use `React.createElement`.
*   **`src\store\fretures\analytics-slice.ts`**:
    *   **Timestamp: 10/23/2025, 4:01:14 PM**: Created `analyticsSlice` to manage the analytics dashboard's UI state, including active endpoints, metrics, date filters (global/local), selected dashboard, customer, loading status, period/view filters, and selected columns.
    *   **Timestamp: 10/23/2025, 4:02:19 PM**: Refactored the import path for `dateFilterHandle`.
*   **`src\utils\utils.ts`**:
    *   **Timestamp: 10/23/2025, 4:02:02 PM**: Defined general utility functions for date formatting (`appDateFormat`, `useDateFormate`, `dateFilterHandle`) and string parsing (`parseRawString`).
*   **`src\components\common\switch-tab.tsx`**:
    *   **Timestamp: 10/24/2025, 10:54:08 AM**: Introduced `SwitchTab`, a reusable component for displaying a group of switchable buttons, with dynamic styling and icon support.
*   **`src\data\options\global.ts`**:
    *   **Timestamp: 10/24/2025, 10:55:24 AM**: Centralized various application configuration options including shipment statuses, report statuses, team member roles, booking statuses, shipment scope, booking sort options, shipment status filters, and date filter options (`DATE_FILTER_OPTIONS`).
*   **`src\hooks\useAccess.tsx`**:
    *   **Timestamp: 10/24/2025, 10:59:16 AM**: Initial creation of `useAccess` hook, which retrieves the user's role from Redux `state.auth` and provides role-based permissions.
    *   **Timestamp: 10/24/2025, 10:59:54 AM**: Changed the Redux selector to `state.userApi`, which could be a bug if `userApi` refers to the RTK Query API slice instead of the authentication state.
*   **`src\components\common\chip-tabs-view.tsx`**:
    *   **Timestamp: 10/24/2025, 11:01:10 AM**: Introduced `ChipsTabView` for horizontal scrollable chip-based navigation, supporting custom buttons and active chip highlighting.
*   **`src\components\common\popover-pannel.tsx`**:
    *   **Timestamp: 10/24/2025, 11:02:37 AM**: Introduced `PopoverPanel`, a simple component for popover content with absolute positioning.
*   **`src\components\common\app-drawer.tsx`**:
    *   **Timestamp: 10/24/2025, 11:04:08 AM**: Introduced `AppDrawer`, a customizable drawer component with a header (icon, title, close button) and a blurred backdrop.
*   **`src\components\screen\analytics\AnalyticsToolbar.tsx`**:
    *   **Timestamp: 10/24/2025, 11:06:02 AM**: Initial creation of `AnalyticsToolbar`. It manages global filters (date, customer selection), dashboard views (chips for default/custom views, settings for managing custom views), and toggles for grid item operations (move/resize). Features PDF export functionality for the dashboard using `jspdf` and `html2canvas`. Integrates various common components like `SelectCustomerPanel`, `ChipsTabView`, `SwitchBox`, `SwitchTab`, `SelectBox`, `PopoverPanel`, and `AppDrawer`.
    *   **Timestamp: 10/24/2025, 11:20:34 AM**: Removed unused `AppAutocomplete` and `ApiManager` imports.
    *   **Timestamp: 10/24/2025, 11:24:14 AM**: Updated the logo import path for the PDF export feature.
*   **`src\types\enum.ts`**:
    *   **Timestamp: 10/24/2025, 11:12:22 AM**: Consolidated various application enums, including `UserRoleEnum`, `SHIPMENT_STATUS_OBJ` (with icons and colors), `BookingStatusEnum`, and `AnalyticsChartType`.
*   **`src\components\common\theme-model.tsx`**:
    *   **Timestamp: 10/24/2025, 11:31:24 AM**: Introduced `ThemedModal` and `ThemedModalExtend`, offering two variations of reusable modal components with customizable titles, content, and styling.
*   **`src\store\api\plan-board-api.ts`**:
    *   **Timestamp: 10/24/2025, 11:34:23 AM**: Created `planboardApi` using Redux Toolkit Query, defining endpoints for fetching and updating planboard data.

**Patterns and Recurring Elements:**

1.  **Analytics Feature Development:** The primary focus is on building out a comprehensive "Analytics" dashboard. This involves creating dedicated pages, components, Redux state management (slices and API), and utility functions.
2.  **Redux Toolkit (RTK) Adoption:** RTK is extensively used for both state management (`createSlice`) and API interactions (`createApi`). This includes `useSelector`, `useDispatch`, `providesTags`, and `invalidatesTags` for efficient data fetching and caching.
3.  **UI Component Modularity and Reusability:** There's a clear pattern of developing generic, reusable UI components (e.g., `SwitchTab`, `ChipsTabView`, `PopoverPanel`, `AppDrawer`, `ThemedModal`, `SelectBox`) that are then integrated into the `AnalyticsToolbar` and other parts of the application.
4.  **TypeScript Integration:** The conversion of `.jsx` files to `.tsx` and the addition of explicit typings and enums (e.g., in `methods.ts` and `src\types\enum.ts`) demonstrate a push for increased type safety and code clarity.
5.  **Interactive Dashboard Elements:** The use of `react-dnd` and `react-resizable` in `AnalyticsContainer` and `ResizableGridItem` highlights a focus on user interactivity, allowing users to customize their dashboard layout.
6.  **Configuration and Data Centralization:** Constants for analytics endpoints, report headers, and global options are moved to dedicated configuration files (`src\config\analytics.ts`, `src\data\options\global.ts`), promoting maintainability.
7.  **PDF Export Functionality:** The `AnalyticsToolbar` includes client-side PDF generation using `jspdf` and `html2canvas`, enabling users to export dashboard views.
8.  **Import Path Standardization:** A recurring theme is the refactoring of relative import paths to alias-based paths (`@components`, `store/store`), indicating an effort to improve project structure and readability.

## 12:35:09 PM
**File:** `c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\pages\analytics\AnalyticsScreen.jsx`
**Timestamp:** 10/23/2025, 3:18:36 PM

This update to `AnalyticsScreen.jsx` introduces a comprehensive analytics dashboard screen. Key functionalities include:

*   **Data Fetching Orchestration:** The component now orchestrates the fetching of dashboard views, analytics endpoints, and multiple individual reports. It utilizes Redux Toolkit Query's `useFetchDashboardsQuery`, `useLazyFetchEndpointsQuery`, and `useLazyFetchReportQuery` hooks for API interactions.
*   **Dashboard and Endpoint Management:**
    *   It fetches available `dashboardViews` based on the user's role and selected company.
    *   An `useEffect` hook ensures `dashboardViews` are dispatched to the Redux store.
    *   Another major `useEffect` manages the selection and fetching of analytics endpoints. If "Default" is selected, it uses `DEFAULT_ANALYTICS_ENDPOINTS`; otherwise, it fetches custom endpoints based on the selected dashboard title, company, and user role.
*   **Concurrent Report Fetching:** After determining the endpoints, the system efficiently fetches all associated reports concurrently using `Promise.all`. Each report query includes common parameters like `apiKey` (hardcoded as "nRKniUrJd6rjNCyvT8iRRHmG"), `reportName`, `userid`, `dateRange` (from `dateFilterHandle("year_2_date")` and formatted with `moment`), `displayBy`, `viewBy`, `companyname`, and `access`.
*   **Redux State Integration:** The component dispatches various actions (`setAllMetric`, `setCustomer`, `setDashboard`, `setEndpoints`, `setLoading`) to manage the analytics state, including loading indicators and report data.
*   **Role-Based Logic and UI Feedback:**
    *   For users with the 'CUSTOMER' role, their company name is automatically set as the `selectedCustomer`.
    *   An `Alert` component is displayed for 'ADMIN' users if no customer is selected, guiding them to make a selection before analytics can be displayed.
    *   A `Loader` component provides visual feedback during data fetching.
*   **Data Processing:** Fetched report data is processed using `metricsPackageHandler` to combine and format the results before being dispatched.
*   **User Interface:** The screen includes `ScreenToolbar` with `ThemedBreadcrumb` and `AnalyticsToolbar` for navigation and controls, and `AnalyticsContainer` to display the actual analytics.

**Patterns and Recurring Elements:**

*   **Extensive Redux Toolkit Usage:** Heavy reliance on `useDispatch`, `useSelector`, and various Redux Toolkit Query hooks for state management and API communication.
*   **Standardized API Query Parameters:** A consistent set of query parameters (`userid`, `fromDate`, `toDate`, `displayBy`, `viewBy`, `companyname`, `access`) are passed to report fetching API calls.
*   **Role-Based Conditional Logic:** The `user.role` (e.g., 'ADMIN', 'CUSTOMER') is frequently used to control data fetching, state initialization, and UI rendering.
*   **Date Handling with Moment:** The `moment` library is used for formatting dates (`YYYY-MM-DD`) required by API calls.
*   **Centralized Error and Loading Management:** `try...catch...finally` blocks are used to handle errors during API calls and ensure the loading state is consistently managed.

## 12:35:12 PM
The file `c:\Users\ridap\OneDrive\Documents\T360_Api\t360-backend\src\routes\analytics.route.ts` was last modified on 10/22/2025, 11:01:53 AM. This file defines the API routes for an analytics module within a backend system.

Key updates in this file include:

*   **Dashboard Management:** Full CRUD (Create, Read, Update, Delete) operations are exposed for `/dashboards` via `GET`, `POST`, `PUT`, and `DELETE` requests, handled by the `core.view.controller`.
*   **Metric and Endpoint Retrieval:** Endpoints `/dashboardEndPoints` and `/metricsList` are available to fetch lists of dashboard endpoints and metrics, respectively.
*   **Data Export:** A route `/excelExport` is provided for exporting analytical data.
*   **User Preferences:** Routes `/save_sequence` and `/save_size` allow users to save preferences related to data sequence and size.
*   **Specific Analytical Reports:** Numerous `GET` routes are defined for retrieving various types of analytical reports, including:
    *   `/cbm` (CBM Reports)
    *   `/kgs` (KGS Reports)
    *   `/teu` (TEU Reports)
    *   `/containers` (Container Reports)
    *   `/transit` (Transit Reports)
    *   `/Tables/tableData` (General Table Data Reports)

**Patterns and Recurring Elements:**

The file consistently follows a pattern of importing specific controller functions for different analytical concerns (e.g., `cbm.controller`, `kgs.controller`, `teu.controller`, `container.controller`) and then mapping these functions to distinct GET routes. There's a clear separation of concerns, with dashboard management, metric retrieval, data export, and various report types each having dedicated controllers and endpoints. The naming conventions for routes and controllers suggest a comprehensive analytics suite focused on logistical or shipping metrics (CBM, KGS, TEU, Containers, Transit).

## 12:36:04 PM
The provided log details a significant expansion of the backend system, primarily focusing on the introduction and development of an `Analytics` module and its related features.

**Key Information by File:**

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-backend-v2\src\common\constants\Paths.ts`**
    *   **Timestamp: 10/22/2025, 12:19:46 PM**
    *   Introduced a comprehensive `Analytics` object under the `Paths` constant, defining numerous endpoints for dashboard management, metric retrieval, Excel export, saving sequences, and size adjustments. This indicates a major new feature area.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-backend-v2\src\routes\analyticsRoutes.ts`**
    *   **Initial Setup (10/22/2025, 12:20:38 PM):** The `AnalyticsRoutes` file was first set up, initially mapping `Dashboard` related paths (`GetCardInfo`, `GetDeliveryInfo`) to `dashboardService` functions.
    *   **Transition to CoreViewService (10/22/2025, 12:33:16 PM - 12:34:42 PM):** Rapidly evolved to import and utilize functions (`getAll`, `create`, `update`, `deleteView`) from the newly created `coreViewService.ts` for handling Analytics-specific routes (CRUD for dashboards/views).
    *   **Integration of CoreMetricService (10/22/2025, 4:13:43 PM - 4:38:37 PM):** Further integrated `dashboardEndPointList`, `getMetricList`, `saveSequence`, and `saveSize` from `coreMetricService.ts` to manage dashboard metrics and their layouts.
    *   **Integration of AnalyticsExportService (10/22/2025, 4:40:33 PM):** Added `getExportData` from `analyticsExportService.ts` to handle Excel report generation.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-backend-v2\src\routes\index.ts`**
    *   **Timestamp: 10/22/2025, 12:21:23 PM**
    *   Integrated `AnalyticsRoutes` into the main API router, enabling the new analytics functionality in the application.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-backend-v2\src\services\coreViewService.ts`**
    *   **Initial Creation (10/22/2025, 12:26:53 PM):** Introduced `coreViewService.ts` with functions (`getAll`, `create`, `update`, `deleteView`) for managing user-specific dashboards (menu titles and associated metrics) in a `dashboards` database table. A `logAudit` function was included for tracking CRUD actions on these dashboards.
    *   **Type Safety and Parameterized Queries (10/22/2025, 12:31:11 PM - 12:46:12 PM):** Underwent significant refactoring to improve type safety (e.g., using `IAuthReq`, `Response`, `NextFunction`, importing `CheckBoxDetails`, `MenuRow`, explicit type assertions). Crucially, database `INSERT` and `UPDATE` queries were updated to use parameterized queries (`$1, $2, $3::int[]`) instead of string interpolation, enhancing security against SQL injection and improving data type handling.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-backend-v2\src\models\common\types\analytics.ts`**
    *   **Timestamp: 10/22/2025, 12:27:34 PM - 4:36:01 PM**
    *   This file saw continuous evolution, defining interfaces crucial for analytics data:
        *   `CheckBoxDetails`: For metric selection status.
        *   `MenuRow`: Expanded to include `menu_title`, `metricsId`, `dashboard_metrics`, and `size`.
        *   `DashboardItem`: For individual report/metric details within a dashboard (id, name, endpoint, dashboard_name).
        *   `MetricListDataI`: For listing metrics with grouping and filtering options.
        *   `MetricRow`: For basic metric ID and name.
    These changes reflect the growing complexity and data structures required by the analytics module.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-backend-v2\src\services\coreMetricService.ts`**
    *   **Initial Creation (10/22/2025, 4:11:45 PM):** Introduced `coreMetricService.ts` for handling metric-specific logic. The `dashboardEndPointList` function was created to fetch and format dashboard metrics, including their display size (rowSpan, columnSpan).
    *   **Metric Listing and Preload (10/22/2025, 4:17:27 PM - 4:21:55 PM):** Added `getMetricList` to retrieve and categorize metrics (Container_Wise, MBL_Wise) and apply "preload" functionality to mark metrics already selected in a dashboard. Extensive type safety improvements were applied to queries.
    *   **Saving Layout and Order (10/22/2025, 4:27:44 PM - 4:38:20 PM):** Introduced `saveSequence` to manage the display order of reports within a dashboard and `saveSize` to adjust the row and column span of individual metrics. Further type safety, including type guards and explicit casting, was implemented.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-backend-v2\src\services\analyticsExportService.ts`**
    *   **Initial Creation (10/22/2025, 4:40:11 PM):** Introduced `analyticsExportService.ts` with `getExportData` to handle generating Excel export data for analytics reports. It utilizes various query parameters, helper functions for column selection, and report-specific SQL queries (`bookingQuery`, `nonBookingQuery`). A `replaceColumnHandler` was included to normalize location names (e.g., "LONG BEACH" to "LOS ANGELES").
    *   **Refactoring and User Code Handling (10/22/2025, 4:47:46 PM - 10/23/2025, 11:04:38 AM):** Refactored imports and improved the robust handling of `userCode` for `saveColumns` by using nullish coalescing.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-backend-v2\src\utils\analytics.ts`**
    *   **Initial Creation (10/22/2025, 4:43:56 PM):** This new utility file introduced several helper functions: `defaultDateRange` for date calculations, `replaceValueInQuery` for dynamic SQL string replacement, `getUserObject` for secure user data retrieval, `getFilterQueryByDisplayValue` for generating SQL aggregation clauses, `getExcelSelectedColumns` for column selection, `dateFilterOnExport` for date formatting, and `EXCEL_EXPORT_COLUMNS` as a constant for export schema.
    *   **Enhanced Type Safety (10/22/2025, 5:09:52 PM):** Added explicit interfaces (`User`, `UserRow`, `DataItem`) and type assertions to improve the robustness and clarity of the utility functions.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-backend-v2\src\common\util\export.query.ts`**
    *   **Timestamp: 10/22/2025, 4:46:51 PM**
    *   Created `export.query.ts` to centralize complex SQL query generation logic, particularly for booking-related reports. It includes `getMonthValue` and `bookingQuery` to dynamically construct SQL based on report name, company, time filters (month, week, quarter), and grouping for stacked bar charts.

**Patterns and Recurring Elements:**

*   **Analytics Module Development:** The core theme is the rapid, iterative development of a new analytics and dashboard management system.
*   **CRUD Operations for Dashboards:** The `coreViewService` and `analyticsRoutes` demonstrate a full set of Create, Read, Update, Delete functionalities for user-defined dashboards.
*   **Metric Configuration:** The `coreMetricService` handles fetching, organizing, and saving configurations (order, size) for metrics within these dashboards.
*   **Data Export Capability:** A dedicated `analyticsExportService` provides robust Excel export functionality, with flexible column selection and date filtering.
*   **Emphasis on Type Safety:** Across all new and modified files, there is a strong and consistent effort to introduce and improve TypeScript type definitions (interfaces, type aliases, explicit casting, type guards) to enhance code reliability and maintainability.
*   **SQL Query Management:** Helper functions and dedicated query files (`export.query.ts`) are used to construct complex SQL queries dynamically. A notable security improvement is the shift from string interpolation to parameterized queries in `coreViewService.ts`.
*   **Timestamp of Significant Changes:** The changes occurred primarily on **October 22, 2025**, indicating a focused development effort on the analytics module during that day, with a few minor adjustments spilling over to **October 23, 2025**. Most significant architectural and type safety changes happened between 12:19 PM and 5:11 PM on Oct 22.