# Activity Summary for 11/12/2025

## 11:19:23 AM
A new `SelectCustomerPanel` component has been introduced in `src/SelectCustomer.tsx`, last modified on 11/12/2025, 10:06:36 AM. This component provides a comprehensive customer selection interface.

**File-Specific Updates (`src/SelectCustomer.tsx`):**
*   **Core Functionality:** Implements a searchable, paginated dropdown for selecting customers.
*   **State Management:** Utilizes React's `useState` for local UI state (search query, current page, loading status, customer options) and integrates with Redux via `useDispatch` to update a global `setSelectedCustomer` state.
*   **API Integration:** Fetches paginated customer options from `ApiManager.getPaginatedCompanyOptions` with parameters for search, page, items per page, and role (`CUSTOMER`). The search functionality is debounced for performance.
*   **User Interface:**
    *   Displays the currently selected customer (or "Select Customer") along with an avatar.
    *   The dropdown menu includes a header with a "Clear All" button, a search input field (with a magnifying glass icon), a list of customer results, and pagination controls.
    *   Handles loading states and displays "No results found" messages.
*   **Interaction Logic:** Key event handlers (`handleSearchChange`, `handlePageChange`, `handleCustomerChange`, `handleClearAll`) manage user input and state updates.
*   **Dropdown Persistence:** A notable pattern in the component is the extensive use of `e.stopPropagation()` on `onClick`, `onMouseDown`, `onKeyDown`, and `onFocus` events within the `DropdownMenu` and its internal interactive elements (search input, clear button). This pattern is crucial for preventing the dropdown from closing prematurely when users interact with the components inside the menu itself, enhancing usability.
*   **Styling:** The component leverages Tailwind CSS classes for its layout and visual presentation.

## 12:19:29 PM
The code changes log details updates across three React components: `SelectCustomer.tsx`, `components/core/usercard.tsx`, and `components/core/sidebar.tsx`, all occurring on **11/12/2025** between 10:06 AM and 12:19 PM.

### File-Specific Updates:

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\SelectCustomer.tsx`**
    *   **Initial Commit (10:06:36 AM):** Introduced the `SelectCustomerPanel` component, a comprehensive dropdown for selecting customers. It features:
        *   State management for customer options, search query, current page, total pages, and loading status.
        *   Integration with Redux (`setSelectedCustomer`).
        *   Debounced API calls (`ApiManager.getPaginatedCompanyOptions`) for efficient search.
        *   Pagination functionality using `@mui/material`.
        *   A "Clear All" button to reset selections and search.
        *   Extensive use of `e.stopPropagation()` within the dropdown menu to prevent premature closing when interacting with its internal elements (search input, buttons).
        *   UI styling using Tailwind CSS, incorporating `Dropdown`, `Avatar`, `InputGroup`, and `InputBox` components.
    *   **Minor Styling Tweaks (12:15:47 PM, 12:16:19 PM, 12:16:29 PM):** The `h2` header's CSS class was repeatedly changed between `input-title` and `checkbox-title`, eventually settling on `input-title`.
    *   **Comment Removal (12:17:01 PM):** A non-functional comment `// âœ… allows space typing` was removed from the `InputBox` component.
    *   **Search Input Wrapper Changes (12:18:12 PM, 12:19:03 PM):** The search `InputGroup` was first wrapped in a `div` with styling (`w-60 border cursor-pointer border-border-primary rounded-lg p-1 pl-2 shadow flex gap-2 items-center text-sm justify-between`), then had some of its border and rounded-corner classes removed (`border cursor-pointer border-border-primary rounded-lg`) in the subsequent commit.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\components\core\usercard.tsx`**
    *   **Initial Commit (12:11:33 PM):** Created the `UserCard` component, which displays user information and provides a logout mechanism. Key aspects include:
        *   `getInitials` helper function to generate avatar initials.
        *   Fetches user preferences and retrieves user data from `localStorage`.
        *   `handleLogout` function: Clears user `token` and `user` from `localStorage`, dispatches a Redux `auth/logout` action, and redirects to a specific URL based on whether the `authtype` is "auth0" or a standard application logout. Notably, the active logout logic was refined from a previously commented-out block to ensure local storage clearing and Redux dispatch happen *before* redirection for Auth0.
        *   Renders user avatar, name, and role within a `Dropdown` menu, with a "Sign out" `DropdownItem`.
        *   A minor typo (`{user?.role}ll`) was present in the displayed role.
    *   **Typo Correction (12:14:55 PM):** The typo in the user's role display was fixed from `{user?.role}ll` to `{user?.role}`.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\components\core\sidebar.tsx`**
    *   **Initial Commit (12:13:31 PM):** Implemented the `SideBar` component, forming the main navigation structure of the application.
        *   Renders a logo and application title.
        *   Conditionally renders the `SelectCustomerPanel` (from `src/SelectCustomer.tsx`) only if the logged-in user's role is "ADMIN_V2". It uses the `selectedCustomer` from Redux as its initial value and updates Redux on selection.
        *   Dynamically generates navigation items based on a `sidebarMenu` configuration, applying active styling based on the current `pathname`.
        *   Integrates the `UserCard` component in its footer.

### Patterns and Recurring Elements:

*   **Frontend Technologies:** Consistent use of React functional components and hooks (`useState`, `useEffect`, `useCallback`), Redux for state management, and Tailwind CSS for styling across all modified files.
*   **UI Component Library:** Reliance on custom `@components/kit` (e.g., `Dropdown`, `Avatar`, `InputGroup`, `Sidebar`, `SidebarItem`) and `@mui/material` components for building the user interface.
*   **User Context and Data:** Both `UserCard` and `SideBar` access user information (role, name) from `localStorage` to determine UI elements and permissions.
*   **Global State Management:** `useDispatch` and `useSelector` from `react-redux` are frequently used to interact with a global state slice for user preferences and customer selection.
*   **Timestamp Proximity:** All changes occurred within a relatively short period (approximately 2 hours on the same day), suggesting a focused development session, possibly for implementing or refining user and customer selection features and related UI components.
*   **Styling Iteration:** The `SelectCustomer.tsx` file shows multiple rapid updates to CSS classes and structural `div` wrappers, indicating iterative refinement of component styling.

## 2:15:33 PM
The changes log details updates to two core data definition files within the `t360-frontend` application, both occurring on **11/12/2025** within seconds of each other, indicating a single, coherent set of modifications.

**File-specific updates:**

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\data\enums.js` (Timestamp: 11/12/2025, 12:05:41 PM):**
    *   This file, serving as a central repository for application enumerations, saw substantial expansion.
    *   `UserRoleEnum` was updated to include new roles like `CSF`, `SPR_CUSTOMER`, and `ADMIN_V2`.
    *   `TRM_STATUS` gained a `Received` status.
    *   `SHIPMENT_STATUS_OBJ` was significantly enhanced, now mapping various shipment statuses (e.g., 'Delayed Departure', 'Arrived on time', 'On Rail') to specific colors, background hex codes, and Material-UI icons for visual representation.
    *   `BookingStatusEnum` was expanded with new states: `ALL`, `SAILED`, `ARRIVED`, `BOOKED`, and `INGATE`.
    *   New enumerations were introduced for `CngBookingStatusEnum`, `AnalyticsChartType`, `BookingAtypeEnum` (listing numerous account/booking party types like `CONSOLIDATOR`, `SHIPPER`, `IMPORTER`, `CONSIGNEE`), `CNG_STATUS`, `ISF_STATUS`, and `SPR_INVOICE_STATUS`, detailing their respective workflow states.

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\data\options.js` (Timestamp: 11/12/2025, 12:05:47 PM):**
    *   This file, which defines UI options and dropdown lists, was heavily updated to reflect and utilize the expanded enums from `enums.js`.
    *   `USER_ROLE_OPTIONS` now includes `Admin V2`, aligning with the enum changes.
    *   Extensive new sorting options arrays were added for various data entities, including `USER_SORT_OPTIONS`, `NEW_USER_SORT_OPTIONS`, `PACKING_LIST_SORT_OPTIONS`, `SERVICE_INVOICE_SORT_OPTIONS`, `CNG_INVOICE_SORT_OPTIONS`, `PO_ORDERS_SORT_OPTIONS`, `DSO_ORDERS_SORT_OPTIONS`, `DASHBAORD_SORT_OPTIONS`, `BOOKING_SORT_OPTIONS`, `CNG_BOOKING_SORT_OPTIONS`, and `ISF_SORT_OPTION`. These consistently follow a `field_name*direction` pattern (e.g., `"firstname*asc"`).
    *   `ACCOUNT_TYPE_OPTIONS` was established, providing labels for various roles or types of accounts, consistent with `BookingAtypeEnum`.
    *   `INVENTORY_OPTIONS` was added, listing different container types (e.g., "40HC", "20GP").
    *   Partial definition for `OTM_BOL_SORT_OPTIONS` was introduced.

**Patterns and Recurring Elements:**

*   **Enum-Option Synergy:** There's a clear pattern of `options.js` directly leveraging and reflecting the enumerations defined in `enums.js`. This separation ensures a clean data model for statuses and types in `enums.js` and a corresponding set of user-friendly labels and values for UI elements in `options.js`.
*   **Comprehensive Status Management:** Both files highlight a strong focus on defining and managing a wide array of application statuses across different modules (users, shipments, bookings, invoices, ISF, TRM). The detailed `SHIPMENT_STATUS_OBJ` with visual cues (colors, icons) suggests an advanced UI for tracking.
*   **Extensive Sorting Capabilities:** A dominant pattern in `options.js` is the introduction of numerous sorting configurations. This indicates an increased need for user-driven data organization and filtering across various lists and tables within the application.
*   **Application Feature Expansion:** The sheer volume of new enums and options, particularly for booking types, new roles, and specific invoice/shipment statuses (CNG, ISF, SPR), points to a significant expansion of features and functionalities within the T360 application.
*   **Consistent Naming Conventions:** The sorting options consistently use `field_name*direction` for values, demonstrating a standardized approach to API sorting parameters.

## 2:19:29 PM
The changes log details updates to the backend API routes and a specific analytics service within the `T360-V2` project.

**File-Specific Updates:**

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-backend-v2\src\routes\index.ts`**
    *   **11/12/2025, 1:24:57 PM:** This file sets up the main API router, importing and utilizing various route modules like `AuthRoutes`, `ShipmentRoutes`, `DashboardRoutes`, `ReportsRoutes`, `BookingRoutes`, `UserRoutes`, `NotificationRoutes`, `AnalyticsRoutes`, and `PlanbaordRoutes`. It also defines direct `GET` endpoints for autocomplete, global search, company details (`getAllCompanyDetails`), and audit logs.
    *   **11/12/2025, 1:26:21 PM:** A minor but significant change was made to the routing for company details. The line `apiRouter.get(Paths.Company.Base, getAllCompanyDetails);` was updated to `apiRouter.use(Paths.Company.Base, getAllCompanyDetails);`. This shifts the `Company.Base` path from a specific `GET` method handler to a more general `use` handler, which can apply to all HTTP methods or act as a middleware, potentially indicating a future expansion or a change in how this endpoint is accessed.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-backend-v2\src\services\analytics\company-details-service.ts`**
    *   **11/12/2025, 1:30:16 PM:** This timestamp marks a major functional overhaul. The file initially contained two definitions for `getAllCompanyDetails`, one simpler and one more complex. The active implementation (the second definition) was introduced, significantly enhancing the `CUSTOMER` role's functionality:
        *   For the `AGENT` role, the service continues to fetch distinct company names (`cname`) from `agent_po_account_master` with a search filter and a limit of 10 results.
        *   For the `CUSTOMER` role, the service was refactored to support **pagination**. It now checks for a `pagination` query parameter. If true, it performs a `COUNT` query to get the total number of distinct `account_name` entries from `mtr_tracking_data` and then retrieves paginated results using `LIMIT` and `OFFSET`. If pagination is not requested, it defaults to retrieving 10 distinct `account_name` entries.
        *   Extensive `console.log` and `logger.info` statements were added for debugging the new pagination logic.
    *   **11/12/2025, 1:30:35 PM:** The previous, simpler (and redundant) definition of `getAllCompanyDetails` was commented out entirely, cleaning up the code and ensuring only the more advanced, paginated implementation is active.

**Timestamps of Significant Changes:**

*   **11/12/2025, 1:26:21 PM:** The routing for `Paths.Company.Base` in `index.ts` changed from `apiRouter.get` to `apiRouter.use`.
*   **11/12/2025, 1:30:16 PM:** The `company-details-service.ts` file received a substantial update, introducing pagination for `CUSTOMER` role data retrieval and a dual-function definition.
*   **11/12/2025, 1:30:35 PM:** The redundant `getAllCompanyDetails` function was commented out, formalizing the new paginated implementation.

**Patterns or Recurring Elements:**

*   **Role-Based Logic:** Functionality in `company-details-service.ts` is explicitly differentiated based on the `role` query parameter (e.g., "AGENT" vs. "CUSTOMER"), impacting the data source and query logic.
*   **Case-Insensitive Search:** Both "AGENT" and "CUSTOMER" data retrieval uses `ILIKE` for case-insensitive searching on company/account names.
*   **Data Formatting:** Query results are consistently mapped to an object structure `{ value: string, label: string }` before being sent as a response.
*   **Extensive Logging:** Frequent use of `logger.info`, `logger.error`, and `console.log` throughout the `company-details-service.ts` file suggests active debugging and monitoring.
*   **Database Utility:** All database interactions are handled via a common `query` utility function.
*   **Modular Routing:** The `index.ts` file demonstrates a common pattern for structuring Express.js applications by importing and using separate route modules for different functional areas.

## 2:19:43 PM
The log primarily details changes to two files: `c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\SelectCustomer.tsx` and `c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\components\screen\analytics\SelectCustomerPanel.tsx`, with a few changes also recorded for `c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\index.css`.

**File-Specific Updates:**

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\SelectCustomer.tsx`** (Frequent changes from 11/12/2025, 12:16:19 PM to 2:18:36 PM):
    *   This React component, `SelectCustomerPanel`, implements a dropdown for selecting customers with search and pagination capabilities.
    *   Initial changes between 12:16 PM and 12:20 PM mostly involve adjusting Tailwind CSS classes, particularly `w-full` on the `div` wrapper for the dropdown and `fieldClassName` on the `InputBox`, and `h2` class changes from `checkbox-title` to `input-title`.
    *   Around 12:20 PM to 12:26 PM, there are multiple attempts to adjust the width (`w-[...]`) of the `DropdownButton`, the outer `div` wrapping the button, and the `DropdownMenu` itself. These changes are reverted, or fine-tuned.
    *   The `DropdownMenu` `width` and `height` properties (`w-[260px]`, `h-[192px]`, `w-[50px]`, `w-[100px]`, `min-w-[50px] max-w-[232px]`) are frequently experimented with, suggesting UI layout adjustments.
    *   The `fieldClassName` for the `InputBox` within the search input is also frequently modified to control its width (`w-[220px]`, `w-[192px]`, `w-full`, `w-[170px]`, `w-[150px]`, `w-[120px]`).
    *   Styling for the customer list items (buttons) within the dropdown is updated at 12:36:26 PM, replacing `ListItemText` with direct `<li>` and `<button>` elements, adding classes like `divide-y divide-gray-200` to the `ul` and specific `w-full text-left px-3 py-2 hover:bg-gray-100 focus:outline-none focus:ring-1 focus:ring-pink-500 text-gray-700 text-sm truncate font-medium` to the buttons. These changes are quickly reverted to `List`/`ListItem` structure, but the `primaryTypographyProps` className is often adjusted (`input-title w-[180px]`, `input-title w-[150px]`, etc.).
    *   There's a consistent pattern of changing `input-title` class usage within `ListItemText` `primaryTypographyProps`.
    *   At 12:40:54 PM, a substantial UI refactor occurs. The dropdown button's text is changed from "Select Customer" to "Not Selected" if `initialValue` is empty, and the "Customer" label is added. The "Clear All" button text changes to "Clear" and its styling is simplified. The search input is re-styled with an embedded `MagnifyingGlassIcon` and the `InputBox` field class is adjusted for improved appearance. The list items are completely rewritten from MUI `List`/`ListItem` to a `div` with `button` elements, including specific `truncate` and `transition` classes for better hover/focus effects.
    *   Subsequent changes from 12:41 PM to 1:35 PM are mainly fine-tuning the `width` of the dropdown menu (`DropdownMenu`) and the `fieldClassName` of the `InputBox`, suggesting continued UI layout adjustments for the search input and list items.
    *   At 1:37:42 PM, the `div` containing the results is given a `checkbox-title` class, but this is removed in the next commit.
    *   The `handleCustomerChange` function is modified at 2:17:45 PM to safely close the dropdown by dispatching a click event on the element with `data-state="open"` after a `setTimeout`.
    *   The list rendering is repeatedly toggled between MUI `List`/`ListItem` and custom `div`/`button`/`ul`/`li` structures with different styling (`input-title w-[150px]`, `text-sm font-medium text-gray-800 truncate w-[150px]`, etc.). The final state for this log section shows a custom `div` for the list items, each containing a button with a `span` for the label and specific styling.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\components\screen\analytics\SelectCustomerPanel.tsx`** (Appears twice between 1:17:24 PM and 1:20:46 PM):
    *   This component also handles customer selection with search and pagination, but it uses MUI components more heavily (e.g., `Popover`, `TextField`, `Typography`).
    *   At 1:20:01 PM, the `fetchOptions` `useCallback` dependency array is updated to include `itemsPerPage`. A more robust check for `res` and `payload` is added to ensure `setOptions` and `setTotalPages` handle cases where `res` or `res.data` might be null/empty, setting `totalPages` to 1 in those scenarios. The type assertion for `res` is removed from the `ApiManager.getPaginatedCompanyOptions` call and applied to the `payload` variable.
    *   At 1:20:46 PM, the `fetchOptions` implementation is slightly simplified, casting `res` directly to `PaginatedResponse` as in earlier versions of `SelectCustomer.tsx` and removing the explicit `payload` variable, while retaining the guard for `res?.data?.length > 0`.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\index.css`** (Few changes between 1:35:34 PM and 1:37:24 PM):
    *   Minor adjustments to font-weight (`font-[200]` to `font-[400]`) for the `.checkbox-title` CSS class, and `text-md` to `text-sm`.
    *   The `input-title` class has its font-size changed from `text-md` to `text-sm` at 1:36:47 PM, then back to `text-md` at 1:37:24 PM. These are very small, quick adjustments.

**Timestamps of Significant Changes:**

*   **11/12/2025, 12:40:54 PM:** Major UI refactor for `SelectCustomer.tsx`, changing styling and component structure for dropdown elements.
*   **11/12/2025, 1:17:24 PM:** Introduction of `SelectCustomerPanel.tsx` in a new directory (`components\screen\analytics`), signaling a potential refactoring or creation of a new, similar component. This version uses MUI components for the dropdown UI.
*   **11/12/2025, 1:20:01 PM:** Refinement of API response handling in `components\screen\analytics\SelectCustomerPanel.tsx` for robustness.
*   **11/12/2025, 2:15:21 PM:** Significant update to the customer list rendering in `SelectCustomer.tsx`, moving from MUI `List`/`ListItem` to a custom `div` and `button` structure for each option.
*   **11/12/2025, 2:17:45 PM:** Implementation of a safer dropdown closing mechanism in `SelectCustomer.tsx` using `setTimeout` and event dispatching.

**Patterns and Recurring Elements:**

*   **UI/Styling Iterations:** There's a strong pattern of iterative UI adjustments, particularly concerning widths (e.g., `w-full`, `w-[260px]`, `w-[50px]`, `w-[150px]`) and font classes (`checkbox-title`, `input-title`) in the `SelectCustomer.tsx` component. This suggests active development and fine-tuning of the user interface.
*   **Dropdown Component:** Both `SelectCustomer.tsx` and `SelectCustomerPanel.tsx` (`components\screen\analytics`) implement a customer selection dropdown with common functionalities: searching, pagination, displaying customer initials/name, and a "Clear All" option.
*   **API Interaction:** Both components use `ApiManager.getPaginatedCompanyOptions` to fetch customer data, implementing debouncing for search input and handling loading states and pagination. The `console.log("res3456", res)` line is present in most `fetchOptions` callbacks, indicating active debugging or data inspection during development.
*   **Redux Integration:** Both components use `useDispatch` from `react-redux` to set the selected customer (either `setSelectedCustomer` in `global-slice` or `setCustomer` in `analytics-slice`), indicating a state management pattern.
*   **Dropdown Interaction Logic:** Common logic is used to prevent the dropdown from closing on specific interactions (e.g., `e.stopPropagation()` on `onClick`, `onMouseDown`, `onKeyDown` within the dropdown menu wrapper).
*   **Component Structure Duplication/Refactoring:** The existence of very similar `SelectCustomerPanel.tsx` in both `src` and `src\components\screen\analytics` suggests either a refactoring in progress (moving the component) or the creation of a specialized version for a particular screen/feature. The `src/SelectCustomer.tsx` seems to be the primary focus of development, receiving continuous styling and structural updates, while the analytics version has fewer, more focused changes related to data handling.

## 3:19:45 PM
The provided log entries show continuous development on a React-based frontend application, primarily focusing on customer selection functionality and dashboard views.

### File-Specific Updates:

**`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\SelectCustomer.tsx` (29 entries between 11/12/2025, 12:26:42 PM and 11/12/2025, 2:22:53 PM):**

This file, responsible for a `SelectCustomerPanel` component, underwent numerous iterative changes, mainly related to styling, layout, and dropdown behavior.

*   **Initial Structure:** The component is a customer selection dropdown with search, pagination, and a "Clear All" option, fetching data from `ApiManager.getPaginatedCompanyOptions`. It uses Material-UI components (`List`, `ListItem`, `Pagination`) alongside custom `Dropdown` and `InputBox` components.
*   **Styling Adjustments (Frequent Pattern):**
    *   Many commits involve modifying Tailwind CSS classes on `DropdownMenu` and inner `div` elements, especially `w-full`, `h-[...]px`, `p-[...]px`, `px-[...]px`, and `gap-0`. These adjustments are primarily for fine-tuning the width, height, padding, and spacing of the dropdown menu and its contents. For example, `w-[260px]` changes to `w-[232px]`, then to `w-full`, and there are multiple back-and-forth changes for `h-[...]px` values (e.g., `h-[20px]`, `h-[120px]`, `h-[192px]`).
    *   The `fieldClassName` of `InputBox` also sees changes to `w-[220px]`, `w-[170px]`, `w-[120px]`, `w-[200px]`, `w-[180px]`, and `w-[150px]`, indicating adjustments to the search input width.
    *   Similarly, `ListItemText` within the results list has its width (`w-[...]px`) adjusted multiple times.
    *   Specific CSS properties like `opacity-100` are added and removed.
*   **Result List Rendering Changes:**
    *   Initially, the customer options were rendered using Material-UI `List`, `ListItem`, and `ListItemButton`.
    *   Around **11/12/2025, 12:36:26 PM**, the rendering of the customer list within the `DropdownMenu` changed from MUI `List`/`ListItem` to a plain `<ul>` with custom `<button>` elements, implying a shift towards more custom styling or simplified structure for the list items, later reverting back to MUI `List` and `ListItem`.
    *   At **11/12/2025, 2:15:21 PM**, the list rendering method changes again, this time to a `div` with `flex flex-col divide-y` containing `button` elements, abandoning MUI `List` components for the individual customer options. This suggests a desire for more granular control over styling or performance.
*   **Dropdown Closing Logic:**
    *   Initially, `handleCustomerChange` and `handleClearAll` both included `document.body.click()` to manually close the dropdown.
    *   At **11/12/2025, 2:17:45 PM**, `handleCustomerChange` was updated to attempt a more targeted programmatic close by looking for `[data-state="open"]` on the dropdown button and simulating a click, with `document.body.click()` as a fallback. This indicates an attempt to improve dropdown behavior, likely due to issues with the generic `document.body.click()`.
    *   However, this targeted closing logic was reverted in the subsequent commit at **11/12/2025, 2:19:50 PM**, returning to the simpler `document.body.click()`.
    *   Finally, at **11/12/2025, 2:22:53 PM**, the targeted closing logic for `handleCustomerChange` is re-introduced, along with a more robust `onMouseDown` handler on the dropdown menu wrapper to prevent the dropdown from closing when interacting with the search box or pagination. This signifies a more mature and deliberate approach to dropdown interaction management.
*   **Loading State:** The `loading` state is consistently used to display a "Loading..." message.
*   **Console Logging:** `console.log("Fetched customers:", res);` is added and remains across several commits for debugging API responses.
*   **Pagination Visibility Logic:** At **11/12/2025, 12:52:50 PM**, the condition for rendering pagination in `SelectCustomer.tsx` changes from `totalPages > 1` to `totalPages > 0`. This means pagination will show even if only one page of results is available, which is an unusual change unless it implies a design decision where a single page still warrants a pagination component (e.g., for visual consistency or to show "Page 1 of 1").

**`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\components\screen\analytics\SelectCustomerPanel.tsx` (3 entries between 11/12/2025, 1:17:24 PM and 11/12/2025, 1:20:46 PM):**

This file appears to be a Material-UI based version of a customer selection panel, which was likely an alternative or older component.

*   **Initial Implementation:** This component uses MUI `Popover`, `TextField`, `List`, and `Pagination` for customer selection, search, and display.
*   **Refinement of API Response Handling:** At **11/12/2025, 1:20:01 PM**, the `fetchOptions` function is updated to explicitly cast the API response to `PaginatedResponse | null` and add more robust checks (`payload?.data && payload.data.length > 0`) before setting options, including ensuring `setOptions([])` is called if no data is returned. It also adds `[itemsPerPage]` to the `useCallback` dependency array for `fetchOptions`. This suggests an improvement in type safety and data handling.
*   **Reversion of Type Casting:** At **11/12/2025, 1:20:46 PM**, the explicit `payload` variable and its related checks are removed, reverting to a direct cast of the `ApiManager` response. This might indicate a preference for simpler casting if the API guarantees the `PaginatedResponse` structure, or a temporary test.

**`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\components\screen\booking\booking-dashboard.tsx` (4 entries between 11/12/2025, 2:24:10 PM and 11/12/2025, 2:51:09 PM):**

This file manages a booking dashboard.

*   **Conditional Rendering for Customer Selection:** At **11/12/2025, 2:25:21 PM**, the main content of the dashboard (cards, grid, filters) is wrapped in a conditional render based on `selectedCustomer`. If `selectedCustomer` is not present, it displays "Please Select Any Customer". This indicates a new requirement to ensure a customer is selected before displaying booking data.
*   **Correction in Conditional Logic:** The commit at **11/12/2025, 2:25:31 PM** corrects the conditional rendering from `?` to `selectedCustomer?`, fixing a syntax error in the previous commit.
*   **Role-Based Access for Admin:** The initial commit and the last commit for this file show that the dashboard is primarily rendered if `localUser?.role === "ADMIN_V2"`, otherwise, it defaults to the "Please Select Any Customer" message (although the conditional logic changed from `localUser?.role === "ADMIN_V2"` to `selectedCustomer?`). This implies that `localUser.companyname` is used as a fallback if `selectedCustomer` is not explicitly chosen, or `selectedCustomer` is now the primary determinant for displaying content. The last commit clarifies that the initial condition for `ADMIN_V2` role is removed, and the primary condition for rendering the dashboard becomes `selectedCustomer?`.

**`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\pages\shipment\shipment-container-page.tsx` (1 entry at 11/12/2025, 2:27:02 PM):**

*   **Conditional Rendering:** Similar to the booking dashboard, this page also introduces conditional rendering based on `selectedCustomer` to display content, falling back to a "Please Select Any Customer" message if none is selected. It uses `selectedCustomer || localUser.companyname` for the `CompanyName` query parameter, indicating a priority for the globally selected customer.

**`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\pages\shipment\shipment-page.tsx` (5 entries between 11/12/2025, 2:27:46 PM and 11/12/2025, 2:33:16 PM):**

*   **Conditional Rendering:** This shipment page also adopts the conditional rendering logic based on `selectedCustomer`, displaying a "Please Select Any Customer" message if no customer is selected. It uses `selectedCustomer || localUser.companyname` for fetching data, similar to the container page.
*   **Debugging/Logging:** `console.log("shipmedata",ShipmentData);` is added in the last commit for debugging purposes.
*   **Minor Edits:** Small, isolated edits are visible, such as a partial `co` added in one commit (`11/12/2025, 2:32:56 PM`) which is then corrected in the next, indicating rapid, minor code changes.

**`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\index.css` (4 entries between 11/12/2025, 1:35:34 PM and 11/12/2025, 1:37:24 PM):**

*   **Font-weight Change:** The `checkbox-title` class had its `font-[200]` changed to `font-[400]` at **11/12/2025, 1:35:49 PM**, then back to `font-[200]` at **11/12/2025, 1:36:03 PM**, and finally to `font-[400]` at **11/12/2025, 1:36:47 PM**, indicating repeated adjustments or testing of font weights for this specific style.

### Timestamps of Significant Changes:

*   **11/12/2025, 12:26:42 PM - 12:48:41 PM:** Intensive styling and layout adjustments on `SelectCustomer.tsx`, particularly for the dropdown menu's width, height, padding, and inner element widths. Also, changes to list rendering from MUI components to custom buttons and back.
*   **11/12/2025, 12:52:03 PM:** Significant restructuring of the result rendering in `SelectCustomer.tsx`, moving pagination inside the conditional rendering for options and changing the `totalPages` check.
*   **11/12/2025, 1:17:24 PM:** Introduction of a separate `SelectCustomerPanel.tsx` in `analytics` folder, indicating a new or refactored customer selection component specific to analytics, built with Material-UI.
*   **11/12/2025, 1:20:01 PM:** Improved API response handling in `analytics/SelectCustomerPanel.tsx` with explicit type casting and data guarding.
*   **11/12/2025, 2:15:21 PM:** `SelectCustomer.tsx` shifts from MUI `List`/`ListItem` to a custom `div` and `button` structure for displaying customer options, aiming for more styling control.
*   **11/12/2025, 2:17:45 PM:** Attempt to improve dropdown closing logic in `SelectCustomer.tsx` using `data-state="open"` attribute, later reverted and then re-introduced with additional event propagation control.
*   **11/12/2025, 2:22:53 PM:** Finalized dropdown closing logic and improved event handling in `SelectCustomer.tsx` to prevent unintended closing on search or pagination clicks. Also, refactor of UI structure with comments.
*   **11/12/2025, 2:25:21 PM:** Introduction of conditional rendering in `booking-dashboard.tsx` based on `selectedCustomer`.
*   **11/12/2025, 2:27:02 PM:** Similar conditional rendering applied to `shipment-container-page.tsx`.
*   **11/12/2025, 2:27:46 PM:** Conditional rendering also applied to `shipment-page.tsx`.
*   **11/12/2025, 1:35:34 PM - 1:36:47 PM:** Repeated adjustments to `font-weight` for `.checkbox-title` in `index.css`.

### Patterns and Recurring Elements:

*   **Customer Selection Integration:** A strong recurring pattern is the integration of customer selection functionality (`selectedCustomer` from `global-slice`) across various dashboard and page components (`booking-dashboard.tsx`, `shipment-container-page.tsx`, `shipment-page.tsx`). These components now conditionally render their main content based on whether a customer has been selected, fetching data with `CompanyName: selectedCustomer || localUser.companyname`. This indicates a global feature requiring customer context for data display.
*   **Styling Iteration:** The `SelectCustomer.tsx` file shows a high frequency of small, incremental styling adjustments (widths, heights, padding, margins, shadows, background colors, border-radii) using Tailwind CSS classes. This suggests ongoing UI refinement and perhaps responsiveness testing.
*   **Dropdown/Popover Behavior Refinement:** There's a clear pattern of trying to get the dropdown close behavior right in `SelectCustomer.tsx`, moving from simple `document.body.click()` to more targeted event triggering and then adding `e.stopPropagation()` on interactive elements within the dropdown to keep it open when intended.
*   **API Data Fetching Pattern:** All dashboard/selection components use `debounce` with `ApiManager` to fetch paginated data (customer options, booking data, shipment data) based on search queries and pagination parameters.
*   **Redux State Management:** `react-redux` (`useDispatch`, `useSelector`) is consistently used to manage component state (search, page, filters, selected customer, sort model) and trigger data fetches.
*   **Common UI Components:** Extensive use of reusable components like `Dropdown`, `DropdownButton`, `DropdownMenu`, `Avatar`, `InputGroup`, `MagnifyingGlassIcon`, `InputBox`, `Card`, `PageWrapper`, `FilterSidebar`, and `Pagination` (both MUI and custom) is evident across the different files.
*   **Loading and Empty States:** Components consistently include `loading` states and "No results found" messages for better user experience.
*   **Console Logging for Debugging:** The presence of `console.log("res3456", res);` or similar debugging statements in API call handlers across multiple files indicates active development and debugging efforts.
*   **Material-UI vs. Custom Components:** While `SelectCustomer.tsx` initially used some MUI `List`/`ListItem` components, there's a trend towards replacing them with custom HTML structures and Tailwind CSS, as seen in the later versions of `SelectCustomer.tsx` and the `index.css` changes. This could be due to a preference for a more unified design system or greater control over styling. The `analytics/SelectCustomerPanel.tsx` is an exception, being heavily reliant on MUI components.

## 4:15:34 PM
The changes primarily involve updates to frontend data configuration, specifically enumerations and associated UI options, all occurring on 11/12/2025 around 12:05 PM.

**File-specific Updates:**

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\data\enums.js` (Timestamp: 11/12/2025, 12:05:41 PM):**
    This file was significantly expanded to define numerous application-wide enumerations. Key additions and modifications include:
    *   **User Roles & Statuses:** `UserRoleEnum` was updated to include `ADMIN_V2`, and `UserStatusEnum` defines `ACTIVE` and `INACTIVE` states.
    *   **Shipment & Booking Statuses:** New enums like `PL_STATUS`, `TRM_STATUS` (including 'Received'), `BookingStatusEnum` (with states like `SAILED`, `ARRIVED`, `BOOKED`, `INGATE`), `CngBookingStatusEnum`, `CNG_STATUS`, `ISF_STATUS`, and `SPR_INVOICE_STATUS` were introduced or extended, covering various stages of packing lists, TRM, and different booking and invoice workflows.
    *   **Detailed Shipment Status Object:** A comprehensive `SHIPMENT_STATUS_OBJ` was added or updated. This object maps various shipment statuses (e.g., 'Delayed Departure', 'Departed on time', 'Ready for pickup', 'On Rail', 'Not Yet Diparted', 'Due to Arrive') to specific colors, background colors, and Material UI icons, indicating a robust system for visual representation of shipment progress.
    *   **Other Enums:** `TierTypeEnum`, `AnalyticsChartType`, and `BookingAtypeEnum` (listing various participant roles like CONSOLIDATOR, SHIPPER, IMPORTER, etc.) were also defined or updated.

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\data\options.js` (Timestamp: 11/12/2025, 12:05:47 PM):**
    This file was heavily updated to create arrays of options, primarily for UI components like dropdowns, often deriving values from the enums defined in `enums.js`.
    *   **User and Account Options:** `USER_ROLE_OPTIONS`, `USER_STATUS_OPTIONS`, `ACCOUNT_TYPE_OPTIONS`, and `TIER_TYPE_OPTIONS` were defined, mapping enum values to human-readable labels for selection.
    *   **Extensive Sorting Options:** A large number of sorting options arrays were added for various data entities, including:
        *   `USER_SORT_OPTIONS`, `NEW_USER_SORT_OPTIONS` (for user lists).
        *   `PACKING_LIST_SORT_OPTIONS` (by packing list no., vendor, status).
        *   `SERVICE_INVOICE_SORT_OPTIONS`, `CNG_INVOICE_SORT_OPTIONS` (by invoice no., date, MBL).
        *   `PO_ORDERS_SORT_OPTIONS`, `DSO_ORDERS_SORT_OPTIONS` (by order no., date, supplier).
        *   `DASHBAORD_SORT_OPTIONS`, `BOOKING_SORT_OPTIONS`, `CNG_BOOKING_SORT_OPTIONS` (by POD, POL, shipper/shipment details).
        *   `ISF_SORT_OPTION` (by submission date, status, importer).
        *   `OTM_BOL_SORT_OPTIONS` (by BOL No.).
    *   **Miscellaneous Options:** `Console_BL_OPTIONS` (Yes/No) and `INVENTORY_OPTIONS` (a list of container types like 40HC, 20GP, etc., with one duplicate 40HC entry) were also added.

**Timestamps of Significant Changes:**
Both files were modified within a few seconds of each other on **11/12/2025**, at **12:05:41 PM** for `enums.js` and **12:05:47 PM** for `options.js`. This close proximity suggests a single, coordinated update focused on foundational data structures for the frontend.

**Patterns and Recurring Elements:**
*   **Enum-Driven Data Structure:** There's a clear pattern of defining core status and role values in `enums.js` and then using these enums to construct user-facing options in `options.js`. This promotes consistency and maintainability.
*   **Comprehensive Status Management:** A recurring theme is the detailed management of various states across different entities (users, shipments, bookings, invoices). The `SHIPMENT_STATUS_OBJ` with its color and icon mappings highlights a focus on providing rich, visual feedback for status information.
*   **Standardized Sorting Mechanisms:** The numerous `*_SORT_OPTIONS` arrays in `options.js` demonstrate a consistent pattern for providing sorting capabilities across almost all major data tables or lists in the application. Each sorting option typically includes both ascending and descending values for a specific field, following the `"{field}*asc"` and `"{field}*desc"` format.
*   **Application-wide Configuration:** Both files are central to configuring static, application-wide data that drives UI behavior and data processing, from user roles to shipment lifecycle statuses.

## 5:29:21 PM
The recent code changes primarily focus on refining data fetching, filtering, and user preference management across several core services and routing.

### File-Specific Updates:

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-backend-v2\src\routes\index.ts`**
    *   **Timestamp: 11/12/2025, 1:24:57 PM & 1:26:21 PM**
    *   The primary routing file was updated to change the method used for the `Company` path from `apiRouter.get` to `apiRouter.use`, indicating a shift in how company details are handled, likely to allow for more complex routing or middleware.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-backend-v2\src\services\analytics\company-details-service.ts`**
    *   **Timestamp: 11/12/2025, 1:30:16 PM & 1:30:35 PM**
    *   Significant refactoring and enhancement were made to the `getAllCompanyDetails` function.
    *   The initial version only supported fetching a limited number (LIMIT 10) of company names based on role (`AGENT` or `CUSTOMER`) and a search query.
    *   The updated version introduces **pagination** for `CUSTOMER` role searches, allowing for fetching total records and paginated results (offset and limit). It now dynamically constructs SQL queries based on the `isPagination` flag and includes `COUNT` queries for total records.
    *   The old implementation of `getAllCompanyDetails` was commented out and replaced with the new, more robust version.
    *   Console logs were added for debugging purposes (e.g., `console.log("=====role===>===:", role);`).

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-backend-v2\src\models\common\types\shipment.ts`**
    *   **Timestamp: 11/12/2025, 2:35:15 PM & 3:44:59 PM**
    *   The `ShipmentQueryParams` interface was extended to include an optional `CompanyName` property (`CompanyName?:string;`). This suggests that shipment queries can now be filtered by company name.
    *   Similarly, the `QueryFilters` interface also had the `CompanyName` property added (`CompanyName?:string;`), reinforcing the new filtering capability.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-backend-v2\src\services\shipmentService.ts`**
    *   **Timestamps: 11/12/2025, spanning from 2:35:39 PM to 5:00:52 PM**
    *   Multiple updates were made to the `SqlQueryBuilder` class within `shipmentService.ts`.
    *   A new private method `buildCompanyNameFilter()` was introduced to handle filtering shipments by `CompanyName`. This method adds conditions to either `oceanConditions` or `airConditions` based on the transport mode.
    *   The `constructor` of `SqlQueryBuilder` was updated to call `this.buildCompanyNameFilter()` as part of its initialization, ensuring company name filtering is applied by default when the filter is present.
    *   The `buildFilterConditions()` method was modified across several commits to include a `CompanyName` filter for both ocean and air shipments, adding conditions like `LOWER(TRIM(mtr.account_name)) = $$` or `LOWER(TRIM(air.customer_name)) = $$`. Some intermediate commits showed this logic being integrated and then refined/removed in favor of the dedicated `buildCompanyNameFilter` method.
    *   The `buildUserCondition()` method was updated to include `ADMIN_V2` as an additional role that should bypass user-specific filtering logic, similar to `ADMIN`.
    *   A minor change in `addCondition` was observed (11/12/2025, 4:39:24 PM), where `$$` was replaced with `{{param}}` for placeholder replacement in raw SQL, but this was reverted in subsequent commits back to `$$`.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-backend-v2\src\services\UserService.ts`**
    *   **Timestamps: 11/12/2025, 2:57:50 PM, 3:07:44 PM, 3:08:20 PM, & 3:09:34 PM**
    *   The `saveUserPreferences` function underwent changes related to "otherConfigs" or "Event Configs". Initially, it explicitly handled several `t49_` related date fields (e.g., `t49_cont_emptyout_date`, `t49_vessel_actualdeparted_date`).
    *   In the 3:07:44 PM and 3:08:20 PM commits, these `t49_` fields were commented out from the `saveUserPreferences` function's `req.body` destructuring, the SQL `INSERT` statement, and the `values` array, effectively removing them from being saved as user preferences.
    *   However, by 3:09:34 PM, these `t49_` fields were **reintroduced** into `saveUserPreferences`, indicating a reconsideration or a revert of the previous change, making them part of user preferences again.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-backend-v2\src\services\bookingService.ts`**
    *   **Timestamp: 11/12/2025, 3:15:48 PM**
    *   The `BookingQueryBuilder` class and the `getAll` function were updated.
    *   The `buildSelectQuery` method improved its handling of the `orderBy` clause, ensuring robust parsing and default values for ordering field and direction.
    *   The `getAll` function now includes `CompanyName` as a query parameter and applies it as a filter (`queryBuilder.addFilterClause("abe.customer", CompanyName);`).

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-backend-v2\src\services\notificationService.ts`**
    *   **Timestamps: 11/12/2025, 5:27:46 PM & 5:28:45 PM**
    *   The `getNotificationDetails` function was enhanced to fetch user-specific event preferences from `v2_user_details` (e.g., `t49_cont_emptyout_date`, `t49_vessel_actualdeparted_date`).
    *   It dynamically constructs the `auditEventSql` based on these `trueFields` from user preferences, allowing users to configure which audit events they want notifications for.
    *   The `auditRows` processing now includes detailed descriptions and titles for different status updates (e.g., ETA changes, container status changes).
    *   The `messageEventSql` now filters messages where the recipient `userid` does not match the current user, to avoid showing messages sent by themselves.
    *   The final notification list merges and sorts both audit and message events by `lastmodifieddate`.
    *   A console log `console.log("*****companyName*890****:", req.query.CompanyName);` was added in the latest commit, possibly for debugging a `CompanyName` parameter that isn't actively used in the main query for notifications, but is present in the request object.

### Patterns and Recurring Elements:

*   **Enhanced Filtering Capabilities**: A major theme across `company-details-service.ts`, `shipmentService.ts`, and `bookingService.ts` is the introduction or refinement of filtering, particularly by `CompanyName`. This indicates a drive towards more granular and user-role-specific data access.
*   **Pagination Implementation**: The explicit addition of pagination logic (`page`, `perPage`, `offset`, `total` count) in `company-details-service.ts` for `CUSTOMER` roles signifies an effort to improve performance and user experience for large datasets.
*   **Dynamic SQL Query Construction**: Services like `shipmentService.ts` and `notificationService.ts` heavily rely on dynamic SQL query builders (e.g., `SqlQueryBuilder`, string interpolation with `trueFields.map`) to create flexible queries based on user roles, filters, and preferences.
*   **User Role-Based Logic**: Many services (e.g., `company-details-service.ts`, `shipmentService.ts`, `bookingService.ts`) contain `if (role === "AGENT")`, `if (role === "CUSTOMER")`, `if (this.user.role.toUpperCase() === "ADMIN")` checks, indicating a strong emphasis on access control and data visibility tailored to different user roles.
*   **Logging for Debugging**: Frequent `logger.info` and `console.log` statements throughout the code, especially after significant changes, highlight an active development phase with a focus on monitoring and debugging.
*   **Refactoring and Code Cleanup**: The commenting out and reintroduction of code in `UserService.ts` and the iterative refinement of `buildFilterConditions` in `shipmentService.ts` suggest ongoing refactoring and optimization efforts.
*   **Consistency in Date/Time Handling**: Functions like `formatDate` and `timeAgo` are consistently used for display purposes, suggesting a standardized approach to date formatting.

## 5:29:27 PM
The provided log details changes across several files, primarily focusing on React components and their styling, with significant updates related to customer selection logic and data fetching.

### File-Specific Updates:

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\SelectCustomer.tsx` (Numerous timestamps between 11/12/2025, 12:41:05 PM and 11/12/2025, 2:22:53 PM)**:
    *   This file, a React component for selecting customers, underwent continuous refinement.
    *   **Styling Adjustments:** Many changes involved modifications to `fieldClassName` for `InputBox` and `className` for list items, with widths frequently adjusted (`w-[220px]`, `w-[120px]`, `w-[100px]`, `w-[180px]`, `w-[150px]`). This indicates an iterative process of fine-tuning the layout and responsiveness of the customer selection dropdown.
    *   **Component Structure Refinements:**
        *   Initial versions used `<ul><li><button>` for rendering options.
        *   Around `11/12/2025, 12:45:26 PM`, the component transitioned to using `@mui/material`'s `List`, `ListItem`, and `ListItemButton` for rendering customer options, improving accessibility and adherence to Material UI standards. The `primaryTypographyProps` were added to `ListItemText` to apply styling.
        *   Later, around `11/12/2025, 2:15:21 PM`, it reverted back to a custom `div` and `button` structure for displaying options, dropping the `@mui/material` list components for possibly more granular Tailwind CSS control or custom rendering.
    *   **Dropdown Closure Logic:**
        *   Initially, `document.body.click()` was used to close the dropdown after selection.
        *   A change at `11/12/2025, 2:17:45 PM` attempted a more targeted closure by dispatching a click event on `[data-state="open"]` elements, with a fallback to `document.body.click()`.
        *   This was reverted back to just `document.body.click()` at `11/12/2025, 2:19:50 PM`.
        *   A more robust mechanism was introduced at `11/12/2025, 2:22:53 PM` where `onMouseDown` on the dropdown wrapper explicitly prevents closing when interacting with the search box or pagination, while `handleCustomerChange` still attempts to programmatically click the `[data-state="open"]` button to close the dropdown, with `document.body.click()` as a fallback.
    *   **Styling for Dropdown Menu and Button:** The `DropdownButton` and `DropdownMenu` received consistent `className` updates, adding `w-full`, `rounded-lg`, `border`, and `shadow-sm` styles. The `DropdownMenu` specifically transitioned from `bg-[#FAFAFA]` to `bg-white` at `11/12/2025, 2:22:53 PM`.
    *   **Console Logging:** The `console.log("res3456", res)` statement for API responses was consistently added and maintained in the `fetchOptions` function across many revisions.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\components\screen\analytics\SelectCustomerPanel.tsx` (Timestamps: 11/12/2025, 1:17:24 PM, 1:20:01 PM, 1:20:46 PM)**:
    *   This file, a separate `SelectCustomerPanel` likely for analytics, was introduced and underwent a few quick changes.
    *   It uses `@mui/material` components (Box, List, Popover, TextField) for its UI.
    *   **Data Fetching Logic:** At `11/12/2025, 1:20:01 PM`, the `fetchOptions` function was updated to cast the API response explicitly to `PaginatedResponse | null` and added more robust handling for `payload?.data` to ensure options are cleared when no data is returned. The `useCallback` dependency array was also updated to include `itemsPerPage`.
    *   The casting was simplified again at `11/12/2025, 1:20:46 PM` to directly cast `res` to `PaginatedResponse` without the `payload` variable.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\index.css` (Numerous timestamps between 11/12/2025, 1:35:34 PM and 11/12/2025, 1:37:24 PM)**:
    *   This file primarily defines global CSS styles using Tailwind CSS and `@theme` directives.
    *   **Typography Adjustments:** The `checkbox-title` class saw its `font-weight` adjusted from `font-[200]` to `font-[400]` at `11/12/2025, 1:35:42 PM`, and its `font-size` from `text-md` to `text-sm` at `11/12/2025, 1:35:49 PM`, then back to `text-md` at `11/12/2025, 1:36:47 PM`, and finally `text-sm` again at `11/12/2025, 1:37:24 PM`. This indicates continuous iteration on the visual appearance of checkbox titles.
    *   Other styles remained largely consistent throughout the logged changes.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\components\screen\booking\booking-dashboard.tsx` (Numerous timestamps between 11/12/2025, 2:24:10 PM and 11/12/2025, 5:06:08 PM)**:
    *   This component manages the booking dashboard.
    *   **Customer Selection Dependency:** A significant pattern is the wrapping of the main `PageWrapper` content in a conditional check: `selectedCustomer ? (...) : (<div className="flex justify-center items-center h-96"> <p className="text-gray-500 text-lg">Please select a customer to view booking data.</p> </div>)`. This ensures booking data is only displayed if a customer is selected. This change was introduced around `11/12/2025, 2:25:21 PM` and repeatedly applied.
    *   **API Query Parameter:** The `CompanyName` parameter in `useFetchBookingDashboardDataQuery` consistently uses `selectedCustomer || localUser?.companyname`.
    *   A temporary comment `// CompanyName: selectedCustomer || localUser?.companyname,` was added at `11/12/2025, 4:50:43 PM`, suggesting a test or a momentary removal, but it was re-instated at `11/12/2025, 4:50:49 PM`.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\pages\shipment\shipment-container-page.tsx` (Timestamps: 11/12/2025, 2:27:02 PM, 11/12/2025, 5:09:48 PM, 11/12/2025, 5:10:04 PM)**:
    *   This page displays shipment containers.
    *   **Customer Selection Dependency:** Similar to `booking-dashboard.tsx`, the primary content is wrapped in a conditional check based on `selectedCustomer`, displaying a "Please select a customer" message if `selectedCustomer` is not set. This was introduced at `11/12/2025, 5:09:48 PM`.
    *   **API Query Parameter:** The `CompanyName` parameter in `useFetchShipmentDataQuery` and `useFetchShipmentCardDataQuery` consistently uses `selectedCustomer || localUser?.companyname`.
    *   **Specific Filter:** The `useFetchShipmentDataQuery` includes `transpot_mode: "ocean"` and `viewType: "container"`, confirming its purpose.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\pages\shipment\shipment-page.tsx` (Numerous timestamps between 11/12/2025, 2:27:46 PM and 11/12/2025, 5:08:08 PM)**:
    *   This page displays general shipment information.
    *   **Customer Selection Dependency:** Identical to the booking and container pages, the main content is conditionally rendered based on `selectedCustomer` at `11/12/2025, 5:08:08 PM`.
    *   **API Query Parameter:** `CompanyName: selectedCustomer || localUser?.companyname` is used for `useFetchShipmentDataQuery` and `useFetchShipmentCardDataQuery`.
    *   **Filter Options:** Defines `AIR_SHIPMENT_STATUS_FILTERS` and `TRANSPORT_MODE_OPTIONS`, indicating support for different shipment types and their filtering.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\components\core\sidebar.tsx` (Numerous timestamps between 11/12/2025, 3:22:08 PM and 11/12/2025, 5:03:58 PM)**:
    *   This component defines the application sidebar.
    *   **Customer Selector Visibility:** The `SelectCustomerPanel` component is conditionally rendered based on `localUser?.role === "ADMIN"` (initially) or `localUser?.role === "ADMIN_V2"` (after `11/12/2025, 3:23:33 PM`). This ensures only administrators can select a customer from the sidebar.
    *   `console.log("==selectedCustomer",selectedCustomer)` and `console.log("==localuser",localUser)` appear frequently for debugging purposes.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\types\shipment.types.ts` (Timestamp: 11/12/2025, 3:32:05 PM)**:
    *   Introduced `AirShipmentStatusType` which was previously defined within `shipment-page.tsx`, suggesting a refactoring to centralize type definitions.
    *   Added `selectedCustomer:string; selectedDashobard:string;` to `DashboardState`.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\store\store.ts` (Timestamps: 11/12/2025, 3:34:46 PM, 11/12/2025, 3:37:24 PM)**:
    *   The Redux store configuration.
    *   `globalSlice` was added to the `appReducer`, indicating a new global state management for application-wide concerns like selected customer.
    *   The `dateRange` slice was moved after `globalSlice` at `11/12/2025, 3:37:24 PM`.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\pages\dashboard\dashboard-page.tsx` (Numerous timestamps between 11/12/2025, 3:39:49 PM and 11/12/2025, 5:07:02 PM)**:
    *   This is the main dashboard component.
    *   **Customer-Specific Data Fetching:** `CompanyName: selectedCustomer || localUser?.companyname` was added to the `useFetchShipmentDataQuery`, `useFetchDeliveryDataQuery`, and `useFetchCartDataQuery` queries, similar to other dashboard components. This was introduced at `11/12/2025, 3:41:17 PM`.
    *   **Filter Updates:** The `handleClearFilters` function was updated to include `airstatus: []` and `transpot_mode: "both"` in its filter clearing logic, reflecting the new transport mode filters. This also appears around `11/12/2025, 3:41:17 PM`.
    *   New constants `AIR_SHIPMENT_STATUS_FILTERS` and `TRANSPORT_MODE_OPTIONS` were imported from `pages/shipment/shipment-page` at `11/12/2025, 3:41:17 PM`.
    *   `console.log` statements are frequently used for debugging `selectedCustomer`, `localUser`, `ShipmentData`, and `deliveryData`.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\pages\notifications\notification-page.tsx` (Timestamps: 11/12/2025, 5:23:05 PM, 5:23:24 PM, 5:23:35 PM, 5:25:09 PM)**:
    *   **Customer-Specific Notifications:** The `useFetchNotificationDataQuery` was updated to include `CompanyName: selectedCustomer || localUser?.companyname` at `11/12/2025, 5:25:09 PM`, making notifications context-aware based on the selected customer.
    *   The page title changed from "Notifications12" to "Notifications" at `11/12/2025, 5:23:35 PM`.
    *   Redux `useSelector` was imported for `selectedCustomer` at `11/12/2025, 5:25:09 PM`.

### Patterns and Recurring Elements:

1.  **Customer-Centric Data Filtering:** A pervasive pattern across `SelectCustomer.tsx`, `booking-dashboard.tsx`, `shipment-container-page.tsx`, `shipment-page.tsx`, `dashboard-page.tsx`, and `notification-page.tsx` is the implementation of customer-specific data fetching. This is achieved by passing `CompanyName: selectedCustomer || localUser?.companyname` as a parameter to API queries (`ApiManager.getPaginatedCompanyOptions`, `useFetchBookingDashboardDataQuery`, `useFetchShipmentDataQuery`, `useFetchShipmentCardDataQuery`, `useFetchDeliveryDataQuery`, `useFetchNotificationDataQuery`).
2.  **Conditional Rendering based on `selectedCustomer`:** Many dashboard-like components now wrap their main content in a conditional check (`selectedCustomer ? (<PageWrapper>...</PageWrapper>) : (<div ...>Please select a customer...</div>)`). This suggests a new requirement that data should only be displayed once a specific customer context is established, especially for non-admin users or when an admin has not yet selected a customer.
3.  **Redux Integration:** The use of `useDispatch` and `useSelector` from `react-redux` is consistent across these files for managing global state, such as `selectedCustomer` and various dashboard filters (`dashboardSetFilters`, `dashboardSetPagination`, `setBookingDashboardSortBy`, `cardInfoSetDateRange`, `cardInfoSetPeriod`). The `global-slice` now explicitly handles `setSelectedCustomer`.
4.  **UI/UX Refinements (Tailwind CSS & MUI):**
    *   Frequent adjustments to `className` properties, especially `w-[...]` (width) values, indicate continuous fine-tuning of component sizing and layout for responsive design.
    *   Interplay between custom Tailwind CSS classes and `@mui/material` components (e.g., `List`, `ListItem`, `Pagination`, `TextField`, `Popover`) suggests a hybrid UI approach. Some elements shifted between custom rendering and MUI components (like the list of customer options in `SelectCustomer.tsx`).
5.  **Debounced API Calls:** The `lodash.debounce` utility is consistently used for `fetchOptions` functions, indicating a strategy to optimize API calls triggered by user input (like search) to prevent excessive requests.
6.  **`console.log` for Debugging:** Numerous `console.log` statements (e.g., `console.log("res3456", res)`, `console.log("==selectedCustomer",selectedCustomer)`, `console.log("==localuser",localUser)`) are present throughout the log, indicating active development and debugging.

### Timestamps of Significant Changes:

*   **11/12/2025, 12:45:26 PM**: `SelectCustomer.tsx` shifts to `@mui/material` List components.
*   **11/12/2025, 1:20:01 PM**: `SelectCustomerPanel.tsx` (analytics) introduces robust API response handling.
*   **11/12/2025, 2:15:21 PM**: `SelectCustomer.tsx` reverts customer list rendering from MUI `List` to custom `div`/`button`.
*   **11/12/2025, 2:22:53 PM**: `SelectCustomer.tsx` implements a more refined dropdown close logic and styling updates.
*   **11/12/2025, 2:25:21 PM**: `booking-dashboard.tsx` introduces conditional rendering based on `selectedCustomer`.
*   **11/12/2025, 3:23:33 PM**: `sidebar.tsx` updates customer selector visibility for "ADMIN_V2" role.
*   **11/12/2025, 3:32:05 PM**: `shipment.types.ts` defines new `AirShipmentStatusType` and adds `selectedCustomer` to `DashboardState`.
*   **11/12/2025, 3:34:46 PM**: `store.ts` adds `globalSlice` to the Redux store.
*   **11/12/2025, 3:41:17 PM**: `dashboard-page.tsx` integrates customer-specific data fetching and updated filter clearing logic for transport modes.
*   **11/12/2025, 5:09:48 PM**: `shipment-container-page.tsx` introduces conditional rendering based on `selectedCustomer`.
*   **11/12/2025, 5:25:09 PM**: `notification-page.tsx` implements customer-specific data fetching for notifications.

## 6:29:26 PM
The provided logs indicate a series of changes across several TypeScript files related to a backend application, specifically focusing on routes, services for analytics, shipments, users, notifications, and planboard functionalities.

**File-Specific Updates:**

1.  **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-backend-v2\src\routes\index.ts`**
    *   **Timestamp: 11/12/2025, 1:24:57 PM & 1:26:21 PM**
    *   The routing configuration (`apiRouter`) was modified.
    *   Initially, `apiRouter.get(Paths.Company.Base, getAllCompanyDetails);` was added.
    *   Shortly after, this `apiRouter.get` was changed to `apiRouter.use(Paths.Company.Base, getAllCompanyDetails);`. This suggests a change in how company details are handled, moving from a direct GET route to potentially a middleware-style usage, although using `apiRouter.use` with a single handler for a specific path typically still behaves like a GET/POST/etc. for that path when no method is specified in the `use`. This implies `getAllCompanyDetails` function signature might have changed or was intended to support more than just GET requests under that base path.

2.  **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-backend-v2\src\services\analytics\company-details-service.ts`**
    *   **Timestamp: 11/12/2025, 1:30:16 PM & 1:30:35 PM**
    *   Significant refactoring of the `getAllCompanyDetails` function occurred.
    *   The initial implementation had separate `try...catch` blocks for "AGENT" and "CUSTOMER" roles, retrieving distinct `cname` from `agent_po_account_master` for AGENT and `account_name` from `mtr_tracking_data` for CUSTOMER, both limited to 10 results.
    *   The updated version (which seems to be a merge or replacement, as the old one is commented out) introduces **pagination logic** for the "CUSTOMER" role. It now checks for a `pagination` query parameter and, if true, executes a `COUNT` query for total records and then a paginated `SELECT DISTINCT` query using `LIMIT` and `OFFSET`.
    *   The `search` parameter logic was slightly refined to handle empty strings more robustly.
    *   Logging and console output for `role`, `search`, `countQuery`, `totalResult`, `result`, and `total` were added for debugging purposes.

3.  **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-backend-v2\src\models\common\types\shipment.ts`**
    *   **Timestamp: 11/12/2025, 2:35:15 PM & 3:44:59 PM**
    *   The `ShipmentQueryParams` and `QueryFilters` interfaces were updated to include a new optional `CompanyName?: string;` property. This indicates that shipment-related queries now support filtering by company name.

4.  **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-backend-v2\src\services\shipmentService.ts`**
    *   **Timestamp: 11/12/2025, 2:35:39 PM to 4:56:32 PM (multiple changes)**
    *   There are numerous, iterative changes within the `SqlQueryBuilder` class, particularly related to how filters and user conditions are built.
    *   **Initial addition of `CompanyName` filter:** At 2:41:37 PM, the `buildFilterConditions` method was updated to handle `CompanyName` filter for both `ocean` and `air` queries.
    *   **Refactoring `CompanyName` filter:** At 3:52:23 PM, a dedicated `buildCompanyNameFilter()` private method was introduced. The constructor was updated to call this new method. The logic for handling `CompanyName` was moved from `buildFilterConditions` to `buildCompanyNameFilter`. The placeholder syntax for parameters was also adjusted from `$$` to `{{param}}` in `addCondition` but then reverted back to `$$` in subsequent changes.
    *   **Further `CompanyName` filter adjustments:** Between 4:02:44 PM and 4:16:23 PM, the `buildCompanyNameFilter` method's implementation for passing parameters (`this.params.push(CompanyName);`) and placeholder string (`$$` vs `{{param}}`) was repeatedly modified, then reverted, then adjusted again. This suggests some trial and error or fine-tuning regarding parameter binding and placeholder consistency within the `addCondition` method.
    *   **Reversion of `CompanyName` filter in `buildFilterConditions`:** At 4:43:30 PM, the explicit `CompanyName` condition within `buildFilterConditions` was commented out for both `ocean` and `air`, indicating that the separate `buildCompanyNameFilter` method is now solely responsible for applying this filter. This makes sense for separation of concerns and preventing duplicate filtering logic.
    *   **Re-inclusion of `CompanyName` in `buildFilterConditions`:** At 4:48:06 PM, the `CompanyName` filter was uncommented and re-included directly in `buildFilterConditions` for both `ocean` and `air` conditions, bypassing the dedicated `buildCompanyNameFilter` method. This change seems to revert the prior refactoring.
    *   **Admin/Admin_V2 role bypass for user conditions:** At 5:00:52 PM, the `buildUserCondition` method was updated to explicitly bypass all user-specific filtering if the user's role is "ADMIN" or "ADMIN\_V2". This is a crucial change for administrative access, allowing them to view all data regardless of company association.

5.  **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-backend-v2\src\services\UserService.ts`**
    *   **Timestamp: 11/12/2025, 2:57:50 PM to 3:09:34 PM (multiple changes)**
    *   The `saveUserPreferences` function underwent changes related to the "Event Configs" section of the `v2_user_details` table.
    *   Initially, fields like `t49_cont_emptyout_date`, `empty_return_date`, etc., were included in the `INSERT` and `ON CONFLICT DO UPDATE SET` clauses and `values` array.
    *   At 3:07:44 PM and 3:08:20 PM, these "Event Configs" fields were commented out from the `req.body` destructuring, the SQL query (`INSERT` and `UPDATE` clauses), and the `values` array.
    *   By 3:09:34 PM, these fields were uncommented and re-integrated into the `saveUserPreferences` function, indicating a temporary removal or testing of this functionality before restoring it.

6.  **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-backend-v2\src\services\bookingService.ts`**
    *   **Timestamp: 11/12/2025, 3:15:48 PM**
    *   The `getAllBookingPlanbaord` function was modified to support filtering bookings by `CompanyName`.
    *   A new `CompanyName` query parameter is checked. If present, the `userWhere` clause in the SQL query is overridden to filter `master.customer` by this provided company name (case-insensitive `UPPER` comparison). Otherwise, it defaults to the logged-in user's company or `1=1` for admin.
    *   The `addFilterClause` in `getAll` was updated to include `abe.customer` for `CompanyName` filtering.

7.  **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-backend-v2\src\services\notificationService.ts`**
    *   **Timestamp: 11/12/2025, 5:27:46 PM to 5:57:44 PM (multiple changes)**
    *   The `getNotificationDetails` function was the primary focus of changes.
    *   **Company Name Filtering Logic:** The initial implementation used `req?.user?.companyname?.toLowerCase()` directly for the `auditEventSql` and `messageEventSql`. From 5:29:44 PM onwards, the logic was adjusted to prioritize `req.query.CompanyName` (decoded and trimmed) over the user's company name. This allows an admin to fetch notifications for a specific company via a query parameter.
    *   **Refined Event Notification Fetching:** The process for retrieving user's event notification preferences (`getEventNotification` query) was slightly improved with more explicit comments and checks for `trueFields` length.
    *   **Message Event Filtering Logic:** The `messageEventSql` was updated multiple times.
        *   Initially, it filtered messages where `ref` was associated with the logged-in user's `userid` and excluded messages *from* that user (`LOWER(userid) != $1`).
        *   At 5:33:05 PM, the message event filtering was modified to consider `company_name` directly in `shipment_tracking_message` for better scope. It now checks if `LOWER(TRIM(company_name)) = $1` and `ref` in `(SELECT DISTINCT ref FROM ... WHERE LOWER(TRIM(company_name)) = $1)`. It also explicitly filters out messages created by the current user.
        *   Later, at 5:56:42 PM, the `messageEventSql`'s company filtering reverted to using only `req.user?.userid.toLowerCase()` for `ref` selection, removing the `company_name` filter from the outer query for messages. It explicitly states "not filtered by company intentionally", suggesting a design choice.
    *   **Parameter Consistency:** There was an addition of `paramIndex` and `conditions` array in `getNotificationDetails` at 5:57:31 PM, which were not fully utilized in the provided snippet, indicating a potential ongoing refactoring or incomplete change. This was quickly removed in the next timestamp.

8.  **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-backend-v2\src\services\planbaordService.ts`**
    *   **Timestamp: 11/12/2025, 6:19:05 PM**
    *   The `getAllBookingPlanbaord` function was updated to support filtering the planboard data by `CompanyName`.
    *   Similar to `bookingService`, the `userWhere` clause in the main SQL query now checks for a `CompanyName` query parameter and overrides the default user-specific company filter if provided.
    *   The logic for grouping points by `pod` was slightly refined to sort known keys alphabetically and place "UNKNOWN" pods last.

**Patterns and Recurring Elements:**

*   **Timestamp Consistency:** All changes occurred on **11/12/2025**, indicating a concentrated development or hotfix session. The timestamps are very close together, showing rapid iterative changes, particularly in `shipmentService.ts` and `notificationService.ts`.
*   **Company Name Filtering:** A prominent recurring pattern is the addition and refinement of `CompanyName` as a filter parameter across multiple services (`company-details-service`, `shipmentService`, `bookingService`, `notificationService`). This suggests a new or enhanced requirement for filtering data based on a company affiliation, often allowing administrators to view data for specific companies.
*   **Database Interactions:** The changes heavily involve SQL queries (`SELECT`, `INSERT`, `UPDATE`, `COUNT`) executed via a `query` utility function. There's a consistent use of parameterized queries (`$1`, `$2`, etc.) to prevent SQL injection.
*   **User Role-Based Logic:** User roles (ADMIN, CUSTOMER, FRONTOFFICE, AGENT) are frequently checked (`req.user?.role.toUpperCase()`) to apply appropriate data access restrictions or filtering logic. The `ADMIN`/`ADMIN_V2` roles are often given broader access.
*   **Pagination:** The `company-details-service` and `bookingService` demonstrate an implementation of pagination using `LIMIT` and `OFFSET` in SQL queries, suggesting a focus on handling large datasets efficiently for UI display.
*   **Logging:** `logger.info` and `logger.error` calls are pervasive, indicating a strong emphasis on debugging and operational monitoring. `console.log` is also used for immediate debugging.
*   **Data Transformation:** Functions like `formatDate` and `timeAgo` are used to format data for user-friendly display, especially evident in `notificationService`.
*   **SQL Query Builder Pattern:** The `SqlQueryBuilder` class in `shipmentService` highlights a pattern for dynamically constructing complex SQL queries based on various filters and user roles, making the query logic modular and reusable.
*   **Notification System Refinement:** The `notificationService` shows efforts to combine different types of notifications (audit logs, user messages) into a single feed, with detailed descriptions and sorting, and robust handling of user-specific notification preferences.

## 8:57:42 PM
The provided log details a series of iterative changes primarily focused on frontend components and their integration with a global customer selection state.

### File-Specific Updates:

1.  **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\SelectCustomer.tsx`**
    *   **Initial Structure (11/12/2025, 12:48:41 PM)**: Introduced a `SelectCustomerPanel` component using `@mui/material` (List, Pagination) and custom `Dropdown` components. It fetches paginated customer options, supports searching, pagination, and dispatches the selected customer to a Redux slice.
    *   **Pagination and Loading Logic**: Experienced frequent modifications and reverts.
        *   The condition for rendering `Pagination` changed multiple times between `totalPages > 1` and `totalPages > 0` before settling on `totalPages > 1` again (e.g., 12:52:03 PM, 12:52:50 PM, 12:56:27 PM).
        *   The `setLoading` state management within `fetchOptions` was initially robust, then briefly removed (12:52:50 PM), and later re-added and refined (12:54:59 PM).
    *   **Styling & Layout Iterations (11/12/2025, 1:32 PM - 1:35 PM)**: Numerous minor styling adjustments were made to component widths (`ListItemText`, `InputBox`, pagination wrapper) and spacing (`gap`, `ml-2`) within the dropdown menu, indicating fine-tuning of the UI.
    *   **Component Refactor (11/12/2025, 2:15:21 PM)**: The display of customer options was significantly refactored from using `@mui/material` `List`, `ListItem`, `ListItemButton`, `ListItemText` to a custom `div` containing plain `button` elements, aiming for a more streamlined UI within the dropdown.
    *   **Dropdown Close Mechanism (11/12/2025, 2:17:45 PM - 2:19:50 PM)**: The logic for closing the dropdown after selection (`handleCustomerChange`) was repeatedly changed. It moved from a direct `document.body.click()` to a more sophisticated `setTimeout` approach that targets specific DOM elements (`[data-state="open"]`) for Headless UI compatibility, and then back to the simpler `document.body.click()` twice.
    *   **Major UI/UX Overhaul (11/12/2025, 2:22:53 PM)**: A substantial refactor of the dropdown's appearance and behavior, including updated `DropdownButton` and `DropdownMenu` styling (e.g., `bg-white`, `shadow-sm`), an enhanced `onMouseDown` handler to prevent accidental closure on search input/pagination, and improved scrollability (`max-h-[150px] overflow-y-auto`) for the results list.

2.  **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\components\screen\analytics\SelectCustomerPanel.tsx`**
    *   **New Component Introduction (11/12/2025, 1:17:24 PM)**: A new `SelectCustomerPanel` component was introduced in the `analytics` directory. This version is built using `@mui/material` components like `Popover`, `TextField`, `List`, and `Pagination`, providing similar customer selection functionality but with a distinct MUI-based UI and styling.
    *   **API Response Handling (11/12/2025, 1:20:01 PM)**: The `fetchOptions` function was briefly modified to explicitly cast the API response and include `itemsPerPage` in its `useCallback` dependencies, but these changes were reverted shortly after (1:20:46 PM).

3.  **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\components\screen\booking\booking-dashboard.tsx`**
    *   **Customer-Based Conditional Rendering (11/12/2025, 2:24:10 PM - 2:51:09 PM, 5:05:22 PM)**: The dashboard's main content was made conditionally rendered, initially based on `localUser?.role === "ADMIN_V2"`, then repeatedly toggled to be dependent on the `selectedCustomer` state from Redux. If no customer is selected, a placeholder message is displayed.
    *   **API Query Updates**: The `CompanyName` parameter in `useFetchBookingDashboardDataQuery` was consistently updated to use `selectedCustomer || localUser?.companyname` as a fallback. There was a temporary removal (4:50:28 PM) and re-addition (4:50:43 PM) of this parameter.
    *   **Placeholder Message Refinement**: The "no customer" message was refined for clarity multiple times (2:25:31 PM, 5:05:22 PM).

4.  **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\index.css`**
    *   **Typography Adjustments (11/12/2025, 1:35:42 PM - 1:37:24 PM)**: Several minor changes were made to the font weight (`font-[200]` to `font-[400]`) and font size (`text-md` to `text-sm`) of `.checkbox-title` and `.input-title` utility classes.

5.  **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\components\core\sidebar.tsx`**
    *   **Customer Selector Integration (11/12/2025, 3:22:08 PM)**: The `SelectCustomerPanel` component was integrated into the main sidebar.
    *   **Role-Based Visibility (11/12/2025, 3:23:33 PM - 5:02:13 PM)**: The visibility of the `SelectCustomerPanel` in the sidebar was made conditional, specifically for users with the role `"ADMIN_V2"`. This condition was briefly reverted to `"ADMIN"` and back to `"ADMIN_V2"` multiple times.

6.  **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\types\shipment.types.ts`**
    *   **State Interface Expansion (11/12/2025, 3:32:05 PM)**: The `DashboardState` interface was updated to include `selectedCustomer: string;` and `selectedDashobard: string;`, reflecting the introduction of a global customer selection mechanism.

7.  **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\store\store.ts`**
    *   **Redux Store Updates (11/12/2025, 3:34:46 PM - 3:37:24 PM)**: The Redux store's `appReducer` was updated to include `globalSlice`. A `dateRange` slice, which might have been a duplicate or intended to be part of `globalSlice`, was removed as a top-level entry.

8.  **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\pages\shipment\shipment-container-page.tsx`**
    *   **Customer-Based Data Fetching/Rendering (11/12/2025, 2:27:02 PM)**: The component adopted conditional rendering based on `selectedCustomer`. API calls for shipment data now include `CompanyName: selectedCustomer || localUser.companyname`. A fallback message is displayed if no customer is selected.
    *   **Explicit Transport Mode and Message Refinement (11/12/2025, 5:09:48 PM)**: Explicitly set `transpot_mode: "ocean"` in the `useFetchShipmentDataQuery` and refined the "no customer" message to be more specific to container data.

9.  **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\pages\shipment\shipment-page.tsx`**
    *   **Customer-Based Data Fetching/Rendering (11/12/2025, 2:27:46 PM)**: Similar to `shipment-container-page.tsx`, this page also implemented conditional rendering based on `selectedCustomer` and used `selectedCustomer || localUser.companyname` for `CompanyName` in API calls (`useFetchShipmentDataQuery`, `useFetchShipmentCardDataQuery`).
    *   **Syntax Errors (11/12/2025, 2:29:29 PM, 2:32:56 PM)**: Brief introduction and removal of a dangling `co` syntax error in the code.
    *   **Filter Enhancements (11/12/2025, 4:13:20 PM)**: Added constants for `AIR_SHIPMENT_STATUS_FILTERS` and `TRANSPORT_MODE_OPTIONS`. Updated `handleClearFilters` to include `airstatus` and `transpot_mode` and introduced a `handleTransportModeChange` function.

10. **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\pages\dashboard\dashboard-page.tsx`**
    *   **Customer-Based Data Fetching (11/12/2025, 3:39:49 PM)**: Incorporated `selectedCustomer` and `localUser` to provide `CompanyName` for API queries (`useFetchShipmentDataQuery`, `useFetchDeliveryDataQuery`, `useFetchCartDataQuery`).

11. **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\pages\planboard\planboard-page.tsx`**
    *   **Customer-Based Conditional Rendering (11/12/2025, 6:28:14 PM)**: Implemented conditional rendering of the entire page content based on `selectedCustomer`, displaying a "Please select a customer to view planboard data." message if none is chosen.
    *   **Prop Updates**: The `PlanboardCardView` component now receives `selectedCustomer` as a prop.

12. **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\components\screen\planboard\PlanboardCardView.tsx`**
    *   **Customer-Based Data Fetching (11/12/2025, 6:14:59 PM)**: Updated `useFetchPlanboardQuery` to include `CompanyName: selectedCustomer || localUser?.companyname`. Later changed to only use `selectedCustomer` (6:25:06 PM), implying a full reliance on the global state for customer context.

13. **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\pages\notifications\notification-page.tsx`**
    *   **Customer-Based Data Fetching/Rendering (11/12/2025, 5:23:05 PM, 5:31:57 PM)**: This page also introduced a dependency on `selectedCustomer` for fetching notification data (`useFetchNotificationDataQuery`) and implemented conditional rendering for its content.
    *   **Text and Structure Refinements (11/12/2025, 5:59 PM - 6:04 PM)**: Minor text adjustments for "no notifications" messages and code refactoring for `getIcons` and the main rendering logic were performed.

### Patterns and Recurring Elements:

*   **Global Customer Selection**: A dominant pattern is the introduction and pervasive use of a global `selectedCustomer` state, managed via Redux's `global-slice`. Most dashboard and data-displaying pages now fetch data and conditionally render their content based on whether a customer is selected. This indicates a shift towards a multi-customer or customer-specific view in the application.
*   **`localUser.companyname` as Fallback**: Many API calls initially used `selectedCustomer || localUser?.companyname` for the `CompanyName` parameter. This suggests that if a global customer isn't explicitly selected, the application falls back to the logged-in user's company. This fallback is sometimes removed in later changes, indicating a stricter dependency on `selectedCustomer`.
*   **API Integration with Redux Toolkit Query**: There's consistent use of RTK Query (`useFetch...Query`) for data fetching, along with Redux slices for managing local component states like pagination, filters, and sorting.
*   **UI/UX Iteration**: Especially evident in `SelectCustomer.tsx`, there's a strong pattern of continuous refinement of UI components, focusing on styling, layout, and user interaction (e.g., dropdown closing behavior, scrollability, dynamic sizing).
*   **Console Logging**: Extensive `console.log` statements are present across multiple files, primarily for debugging the values of `selectedCustomer`, `localUser`, and API responses at various stages.
*   **Conditional Rendering for Empty States**: Components frequently include logic to display user-friendly messages (e.g., "No results found", "Please select a customer to view data") when no data is available or when a required customer context is missing.
*   **Loading Indicators**: `isLoading` and `isFetching` states from RTK Query are consistently used to show loading messages or skeleton UI, improving perceived performance.