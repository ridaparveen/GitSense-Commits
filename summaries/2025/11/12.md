# Activity Summary for 11/12/2025

## 11:19:23 AM
A new `SelectCustomerPanel` component has been introduced in `src/SelectCustomer.tsx`, last modified on 11/12/2025, 10:06:36 AM. This component provides a comprehensive customer selection interface.

**File-Specific Updates (`src/SelectCustomer.tsx`):**
*   **Core Functionality:** Implements a searchable, paginated dropdown for selecting customers.
*   **State Management:** Utilizes React's `useState` for local UI state (search query, current page, loading status, customer options) and integrates with Redux via `useDispatch` to update a global `setSelectedCustomer` state.
*   **API Integration:** Fetches paginated customer options from `ApiManager.getPaginatedCompanyOptions` with parameters for search, page, items per page, and role (`CUSTOMER`). The search functionality is debounced for performance.
*   **User Interface:**
    *   Displays the currently selected customer (or "Select Customer") along with an avatar.
    *   The dropdown menu includes a header with a "Clear All" button, a search input field (with a magnifying glass icon), a list of customer results, and pagination controls.
    *   Handles loading states and displays "No results found" messages.
*   **Interaction Logic:** Key event handlers (`handleSearchChange`, `handlePageChange`, `handleCustomerChange`, `handleClearAll`) manage user input and state updates.
*   **Dropdown Persistence:** A notable pattern in the component is the extensive use of `e.stopPropagation()` on `onClick`, `onMouseDown`, `onKeyDown`, and `onFocus` events within the `DropdownMenu` and its internal interactive elements (search input, clear button). This pattern is crucial for preventing the dropdown from closing prematurely when users interact with the components inside the menu itself, enhancing usability.
*   **Styling:** The component leverages Tailwind CSS classes for its layout and visual presentation.

## 12:19:29 PM
The code changes log details updates across three React components: `SelectCustomer.tsx`, `components/core/usercard.tsx`, and `components/core/sidebar.tsx`, all occurring on **11/12/2025** between 10:06 AM and 12:19 PM.

### File-Specific Updates:

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\SelectCustomer.tsx`**
    *   **Initial Commit (10:06:36 AM):** Introduced the `SelectCustomerPanel` component, a comprehensive dropdown for selecting customers. It features:
        *   State management for customer options, search query, current page, total pages, and loading status.
        *   Integration with Redux (`setSelectedCustomer`).
        *   Debounced API calls (`ApiManager.getPaginatedCompanyOptions`) for efficient search.
        *   Pagination functionality using `@mui/material`.
        *   A "Clear All" button to reset selections and search.
        *   Extensive use of `e.stopPropagation()` within the dropdown menu to prevent premature closing when interacting with its internal elements (search input, buttons).
        *   UI styling using Tailwind CSS, incorporating `Dropdown`, `Avatar`, `InputGroup`, and `InputBox` components.
    *   **Minor Styling Tweaks (12:15:47 PM, 12:16:19 PM, 12:16:29 PM):** The `h2` header's CSS class was repeatedly changed between `input-title` and `checkbox-title`, eventually settling on `input-title`.
    *   **Comment Removal (12:17:01 PM):** A non-functional comment `// âœ… allows space typing` was removed from the `InputBox` component.
    *   **Search Input Wrapper Changes (12:18:12 PM, 12:19:03 PM):** The search `InputGroup` was first wrapped in a `div` with styling (`w-60 border cursor-pointer border-border-primary rounded-lg p-1 pl-2 shadow flex gap-2 items-center text-sm justify-between`), then had some of its border and rounded-corner classes removed (`border cursor-pointer border-border-primary rounded-lg`) in the subsequent commit.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\components\core\usercard.tsx`**
    *   **Initial Commit (12:11:33 PM):** Created the `UserCard` component, which displays user information and provides a logout mechanism. Key aspects include:
        *   `getInitials` helper function to generate avatar initials.
        *   Fetches user preferences and retrieves user data from `localStorage`.
        *   `handleLogout` function: Clears user `token` and `user` from `localStorage`, dispatches a Redux `auth/logout` action, and redirects to a specific URL based on whether the `authtype` is "auth0" or a standard application logout. Notably, the active logout logic was refined from a previously commented-out block to ensure local storage clearing and Redux dispatch happen *before* redirection for Auth0.
        *   Renders user avatar, name, and role within a `Dropdown` menu, with a "Sign out" `DropdownItem`.
        *   A minor typo (`{user?.role}ll`) was present in the displayed role.
    *   **Typo Correction (12:14:55 PM):** The typo in the user's role display was fixed from `{user?.role}ll` to `{user?.role}`.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\components\core\sidebar.tsx`**
    *   **Initial Commit (12:13:31 PM):** Implemented the `SideBar` component, forming the main navigation structure of the application.
        *   Renders a logo and application title.
        *   Conditionally renders the `SelectCustomerPanel` (from `src/SelectCustomer.tsx`) only if the logged-in user's role is "ADMIN_V2". It uses the `selectedCustomer` from Redux as its initial value and updates Redux on selection.
        *   Dynamically generates navigation items based on a `sidebarMenu` configuration, applying active styling based on the current `pathname`.
        *   Integrates the `UserCard` component in its footer.

### Patterns and Recurring Elements:

*   **Frontend Technologies:** Consistent use of React functional components and hooks (`useState`, `useEffect`, `useCallback`), Redux for state management, and Tailwind CSS for styling across all modified files.
*   **UI Component Library:** Reliance on custom `@components/kit` (e.g., `Dropdown`, `Avatar`, `InputGroup`, `Sidebar`, `SidebarItem`) and `@mui/material` components for building the user interface.
*   **User Context and Data:** Both `UserCard` and `SideBar` access user information (role, name) from `localStorage` to determine UI elements and permissions.
*   **Global State Management:** `useDispatch` and `useSelector` from `react-redux` are frequently used to interact with a global state slice for user preferences and customer selection.
*   **Timestamp Proximity:** All changes occurred within a relatively short period (approximately 2 hours on the same day), suggesting a focused development session, possibly for implementing or refining user and customer selection features and related UI components.
*   **Styling Iteration:** The `SelectCustomer.tsx` file shows multiple rapid updates to CSS classes and structural `div` wrappers, indicating iterative refinement of component styling.

## 2:15:33 PM
The changes log details updates to two core data definition files within the `t360-frontend` application, both occurring on **11/12/2025** within seconds of each other, indicating a single, coherent set of modifications.

**File-specific updates:**

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\data\enums.js` (Timestamp: 11/12/2025, 12:05:41 PM):**
    *   This file, serving as a central repository for application enumerations, saw substantial expansion.
    *   `UserRoleEnum` was updated to include new roles like `CSF`, `SPR_CUSTOMER`, and `ADMIN_V2`.
    *   `TRM_STATUS` gained a `Received` status.
    *   `SHIPMENT_STATUS_OBJ` was significantly enhanced, now mapping various shipment statuses (e.g., 'Delayed Departure', 'Arrived on time', 'On Rail') to specific colors, background hex codes, and Material-UI icons for visual representation.
    *   `BookingStatusEnum` was expanded with new states: `ALL`, `SAILED`, `ARRIVED`, `BOOKED`, and `INGATE`.
    *   New enumerations were introduced for `CngBookingStatusEnum`, `AnalyticsChartType`, `BookingAtypeEnum` (listing numerous account/booking party types like `CONSOLIDATOR`, `SHIPPER`, `IMPORTER`, `CONSIGNEE`), `CNG_STATUS`, `ISF_STATUS`, and `SPR_INVOICE_STATUS`, detailing their respective workflow states.

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\data\options.js` (Timestamp: 11/12/2025, 12:05:47 PM):**
    *   This file, which defines UI options and dropdown lists, was heavily updated to reflect and utilize the expanded enums from `enums.js`.
    *   `USER_ROLE_OPTIONS` now includes `Admin V2`, aligning with the enum changes.
    *   Extensive new sorting options arrays were added for various data entities, including `USER_SORT_OPTIONS`, `NEW_USER_SORT_OPTIONS`, `PACKING_LIST_SORT_OPTIONS`, `SERVICE_INVOICE_SORT_OPTIONS`, `CNG_INVOICE_SORT_OPTIONS`, `PO_ORDERS_SORT_OPTIONS`, `DSO_ORDERS_SORT_OPTIONS`, `DASHBAORD_SORT_OPTIONS`, `BOOKING_SORT_OPTIONS`, `CNG_BOOKING_SORT_OPTIONS`, and `ISF_SORT_OPTION`. These consistently follow a `field_name*direction` pattern (e.g., `"firstname*asc"`).
    *   `ACCOUNT_TYPE_OPTIONS` was established, providing labels for various roles or types of accounts, consistent with `BookingAtypeEnum`.
    *   `INVENTORY_OPTIONS` was added, listing different container types (e.g., "40HC", "20GP").
    *   Partial definition for `OTM_BOL_SORT_OPTIONS` was introduced.

**Patterns and Recurring Elements:**

*   **Enum-Option Synergy:** There's a clear pattern of `options.js` directly leveraging and reflecting the enumerations defined in `enums.js`. This separation ensures a clean data model for statuses and types in `enums.js` and a corresponding set of user-friendly labels and values for UI elements in `options.js`.
*   **Comprehensive Status Management:** Both files highlight a strong focus on defining and managing a wide array of application statuses across different modules (users, shipments, bookings, invoices, ISF, TRM). The detailed `SHIPMENT_STATUS_OBJ` with visual cues (colors, icons) suggests an advanced UI for tracking.
*   **Extensive Sorting Capabilities:** A dominant pattern in `options.js` is the introduction of numerous sorting configurations. This indicates an increased need for user-driven data organization and filtering across various lists and tables within the application.
*   **Application Feature Expansion:** The sheer volume of new enums and options, particularly for booking types, new roles, and specific invoice/shipment statuses (CNG, ISF, SPR), points to a significant expansion of features and functionalities within the T360 application.
*   **Consistent Naming Conventions:** The sorting options consistently use `field_name*direction` for values, demonstrating a standardized approach to API sorting parameters.

## 2:19:29 PM
The changes log details updates to the backend API routes and a specific analytics service within the `T360-V2` project.

**File-Specific Updates:**

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-backend-v2\src\routes\index.ts`**
    *   **11/12/2025, 1:24:57 PM:** This file sets up the main API router, importing and utilizing various route modules like `AuthRoutes`, `ShipmentRoutes`, `DashboardRoutes`, `ReportsRoutes`, `BookingRoutes`, `UserRoutes`, `NotificationRoutes`, `AnalyticsRoutes`, and `PlanbaordRoutes`. It also defines direct `GET` endpoints for autocomplete, global search, company details (`getAllCompanyDetails`), and audit logs.
    *   **11/12/2025, 1:26:21 PM:** A minor but significant change was made to the routing for company details. The line `apiRouter.get(Paths.Company.Base, getAllCompanyDetails);` was updated to `apiRouter.use(Paths.Company.Base, getAllCompanyDetails);`. This shifts the `Company.Base` path from a specific `GET` method handler to a more general `use` handler, which can apply to all HTTP methods or act as a middleware, potentially indicating a future expansion or a change in how this endpoint is accessed.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-backend-v2\src\services\analytics\company-details-service.ts`**
    *   **11/12/2025, 1:30:16 PM:** This timestamp marks a major functional overhaul. The file initially contained two definitions for `getAllCompanyDetails`, one simpler and one more complex. The active implementation (the second definition) was introduced, significantly enhancing the `CUSTOMER` role's functionality:
        *   For the `AGENT` role, the service continues to fetch distinct company names (`cname`) from `agent_po_account_master` with a search filter and a limit of 10 results.
        *   For the `CUSTOMER` role, the service was refactored to support **pagination**. It now checks for a `pagination` query parameter. If true, it performs a `COUNT` query to get the total number of distinct `account_name` entries from `mtr_tracking_data` and then retrieves paginated results using `LIMIT` and `OFFSET`. If pagination is not requested, it defaults to retrieving 10 distinct `account_name` entries.
        *   Extensive `console.log` and `logger.info` statements were added for debugging the new pagination logic.
    *   **11/12/2025, 1:30:35 PM:** The previous, simpler (and redundant) definition of `getAllCompanyDetails` was commented out entirely, cleaning up the code and ensuring only the more advanced, paginated implementation is active.

**Timestamps of Significant Changes:**

*   **11/12/2025, 1:26:21 PM:** The routing for `Paths.Company.Base` in `index.ts` changed from `apiRouter.get` to `apiRouter.use`.
*   **11/12/2025, 1:30:16 PM:** The `company-details-service.ts` file received a substantial update, introducing pagination for `CUSTOMER` role data retrieval and a dual-function definition.
*   **11/12/2025, 1:30:35 PM:** The redundant `getAllCompanyDetails` function was commented out, formalizing the new paginated implementation.

**Patterns or Recurring Elements:**

*   **Role-Based Logic:** Functionality in `company-details-service.ts` is explicitly differentiated based on the `role` query parameter (e.g., "AGENT" vs. "CUSTOMER"), impacting the data source and query logic.
*   **Case-Insensitive Search:** Both "AGENT" and "CUSTOMER" data retrieval uses `ILIKE` for case-insensitive searching on company/account names.
*   **Data Formatting:** Query results are consistently mapped to an object structure `{ value: string, label: string }` before being sent as a response.
*   **Extensive Logging:** Frequent use of `logger.info`, `logger.error`, and `console.log` throughout the `company-details-service.ts` file suggests active debugging and monitoring.
*   **Database Utility:** All database interactions are handled via a common `query` utility function.
*   **Modular Routing:** The `index.ts` file demonstrates a common pattern for structuring Express.js applications by importing and using separate route modules for different functional areas.

## 2:19:43 PM
The log primarily details changes to two files: `c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\SelectCustomer.tsx` and `c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\components\screen\analytics\SelectCustomerPanel.tsx`, with a few changes also recorded for `c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\index.css`.

**File-Specific Updates:**

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\SelectCustomer.tsx`** (Frequent changes from 11/12/2025, 12:16:19 PM to 2:18:36 PM):
    *   This React component, `SelectCustomerPanel`, implements a dropdown for selecting customers with search and pagination capabilities.
    *   Initial changes between 12:16 PM and 12:20 PM mostly involve adjusting Tailwind CSS classes, particularly `w-full` on the `div` wrapper for the dropdown and `fieldClassName` on the `InputBox`, and `h2` class changes from `checkbox-title` to `input-title`.
    *   Around 12:20 PM to 12:26 PM, there are multiple attempts to adjust the width (`w-[...]`) of the `DropdownButton`, the outer `div` wrapping the button, and the `DropdownMenu` itself. These changes are reverted, or fine-tuned.
    *   The `DropdownMenu` `width` and `height` properties (`w-[260px]`, `h-[192px]`, `w-[50px]`, `w-[100px]`, `min-w-[50px] max-w-[232px]`) are frequently experimented with, suggesting UI layout adjustments.
    *   The `fieldClassName` for the `InputBox` within the search input is also frequently modified to control its width (`w-[220px]`, `w-[192px]`, `w-full`, `w-[170px]`, `w-[150px]`, `w-[120px]`).
    *   Styling for the customer list items (buttons) within the dropdown is updated at 12:36:26 PM, replacing `ListItemText` with direct `<li>` and `<button>` elements, adding classes like `divide-y divide-gray-200` to the `ul` and specific `w-full text-left px-3 py-2 hover:bg-gray-100 focus:outline-none focus:ring-1 focus:ring-pink-500 text-gray-700 text-sm truncate font-medium` to the buttons. These changes are quickly reverted to `List`/`ListItem` structure, but the `primaryTypographyProps` className is often adjusted (`input-title w-[180px]`, `input-title w-[150px]`, etc.).
    *   There's a consistent pattern of changing `input-title` class usage within `ListItemText` `primaryTypographyProps`.
    *   At 12:40:54 PM, a substantial UI refactor occurs. The dropdown button's text is changed from "Select Customer" to "Not Selected" if `initialValue` is empty, and the "Customer" label is added. The "Clear All" button text changes to "Clear" and its styling is simplified. The search input is re-styled with an embedded `MagnifyingGlassIcon` and the `InputBox` field class is adjusted for improved appearance. The list items are completely rewritten from MUI `List`/`ListItem` to a `div` with `button` elements, including specific `truncate` and `transition` classes for better hover/focus effects.
    *   Subsequent changes from 12:41 PM to 1:35 PM are mainly fine-tuning the `width` of the dropdown menu (`DropdownMenu`) and the `fieldClassName` of the `InputBox`, suggesting continued UI layout adjustments for the search input and list items.
    *   At 1:37:42 PM, the `div` containing the results is given a `checkbox-title` class, but this is removed in the next commit.
    *   The `handleCustomerChange` function is modified at 2:17:45 PM to safely close the dropdown by dispatching a click event on the element with `data-state="open"` after a `setTimeout`.
    *   The list rendering is repeatedly toggled between MUI `List`/`ListItem` and custom `div`/`button`/`ul`/`li` structures with different styling (`input-title w-[150px]`, `text-sm font-medium text-gray-800 truncate w-[150px]`, etc.). The final state for this log section shows a custom `div` for the list items, each containing a button with a `span` for the label and specific styling.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\components\screen\analytics\SelectCustomerPanel.tsx`** (Appears twice between 1:17:24 PM and 1:20:46 PM):
    *   This component also handles customer selection with search and pagination, but it uses MUI components more heavily (e.g., `Popover`, `TextField`, `Typography`).
    *   At 1:20:01 PM, the `fetchOptions` `useCallback` dependency array is updated to include `itemsPerPage`. A more robust check for `res` and `payload` is added to ensure `setOptions` and `setTotalPages` handle cases where `res` or `res.data` might be null/empty, setting `totalPages` to 1 in those scenarios. The type assertion for `res` is removed from the `ApiManager.getPaginatedCompanyOptions` call and applied to the `payload` variable.
    *   At 1:20:46 PM, the `fetchOptions` implementation is slightly simplified, casting `res` directly to `PaginatedResponse` as in earlier versions of `SelectCustomer.tsx` and removing the explicit `payload` variable, while retaining the guard for `res?.data?.length > 0`.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\index.css`** (Few changes between 1:35:34 PM and 1:37:24 PM):
    *   Minor adjustments to font-weight (`font-[200]` to `font-[400]`) for the `.checkbox-title` CSS class, and `text-md` to `text-sm`.
    *   The `input-title` class has its font-size changed from `text-md` to `text-sm` at 1:36:47 PM, then back to `text-md` at 1:37:24 PM. These are very small, quick adjustments.

**Timestamps of Significant Changes:**

*   **11/12/2025, 12:40:54 PM:** Major UI refactor for `SelectCustomer.tsx`, changing styling and component structure for dropdown elements.
*   **11/12/2025, 1:17:24 PM:** Introduction of `SelectCustomerPanel.tsx` in a new directory (`components\screen\analytics`), signaling a potential refactoring or creation of a new, similar component. This version uses MUI components for the dropdown UI.
*   **11/12/2025, 1:20:01 PM:** Refinement of API response handling in `components\screen\analytics\SelectCustomerPanel.tsx` for robustness.
*   **11/12/2025, 2:15:21 PM:** Significant update to the customer list rendering in `SelectCustomer.tsx`, moving from MUI `List`/`ListItem` to a custom `div` and `button` structure for each option.
*   **11/12/2025, 2:17:45 PM:** Implementation of a safer dropdown closing mechanism in `SelectCustomer.tsx` using `setTimeout` and event dispatching.

**Patterns and Recurring Elements:**

*   **UI/Styling Iterations:** There's a strong pattern of iterative UI adjustments, particularly concerning widths (e.g., `w-full`, `w-[260px]`, `w-[50px]`, `w-[150px]`) and font classes (`checkbox-title`, `input-title`) in the `SelectCustomer.tsx` component. This suggests active development and fine-tuning of the user interface.
*   **Dropdown Component:** Both `SelectCustomer.tsx` and `SelectCustomerPanel.tsx` (`components\screen\analytics`) implement a customer selection dropdown with common functionalities: searching, pagination, displaying customer initials/name, and a "Clear All" option.
*   **API Interaction:** Both components use `ApiManager.getPaginatedCompanyOptions` to fetch customer data, implementing debouncing for search input and handling loading states and pagination. The `console.log("res3456", res)` line is present in most `fetchOptions` callbacks, indicating active debugging or data inspection during development.
*   **Redux Integration:** Both components use `useDispatch` from `react-redux` to set the selected customer (either `setSelectedCustomer` in `global-slice` or `setCustomer` in `analytics-slice`), indicating a state management pattern.
*   **Dropdown Interaction Logic:** Common logic is used to prevent the dropdown from closing on specific interactions (e.g., `e.stopPropagation()` on `onClick`, `onMouseDown`, `onKeyDown` within the dropdown menu wrapper).
*   **Component Structure Duplication/Refactoring:** The existence of very similar `SelectCustomerPanel.tsx` in both `src` and `src\components\screen\analytics` suggests either a refactoring in progress (moving the component) or the creation of a specialized version for a particular screen/feature. The `src/SelectCustomer.tsx` seems to be the primary focus of development, receiving continuous styling and structural updates, while the analytics version has fewer, more focused changes related to data handling.