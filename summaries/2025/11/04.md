# Activity Summary for 11/4/2025

## 9:31:42 AM
**File: `c:\Users\ridap\OneDrive\Documents\T360_Api\t360-backend\src\controllers\analytics\others.controller.ts`** (Timestamp: 11/3/2025, 3:44:37 PM)
This file defines the `getTableDataReports` controller function, which is responsible for fetching various analytics reports. It imports several specialized query builder functions (e.g., `chassisQueryBuilder`, `bookingQueryBuilder`, `departureQueryBuilder`, `containerQueryBuilder`, `generalQueryBuilder`). The controller dynamically constructs a SQL query based on a `type` parameter received in the request, categorizing reports into groups such as chassis, booking & cargo-ready, containers, departures, and general metrics. It handles default date ranges, user and company context, and executes the generated query, returning the results. A significant portion of the code is dedicated to a large `if-else if` block that maps the `type` parameter to the appropriate query builder.

**File: `c:\Users\ridap\OneDrive\Documents\T360_Api\t360-backend\src\routes\otm_bol.route.ts`** (Timestamp: 11/3/2025, 5:05:37 PM)
This file sets up the API routes for operations related to OTM (Oracle Transportation Management) Bill of Lading (BOL). It exposes endpoints for: exporting excel data, fetching PLPO (Packing List/Proof of Delivery) by BOL, fetching payload, fetching by BOL number, editing OTM BOL, uploading and saving edits, fetching by a common key, generating XML, and sending data to OTM. A previously used file upload route (`/upload`) is commented out, suggesting a change in file upload handling or a temporary disablement.

**File: `c:\Users\ridap\OneDrive\Documents\T360_Api\t360-backend\src\utils\analytics.ts`** (Timestamp: 11/3/2025, 6:57:38 PM)
This utility file provides a collection of functions essential for analytics and reporting. Key functionalities include:
*   `defaultDateRange`: Generates a default one-year date range.
*   `replaceValueInQuery`: A helper to conditionally modify column values in SQL queries, specifically for 'pod' or 'place_of_delivery'.
*   `getUserObject`: Retrieves user and company-specific information, including handling admin-level access for usercode overrides.
*   `getFilterQueryByDisplayValue`: Generates SQL `GROUP BY`, `ORDER BY`, `date_trunc`, and `SELECT` clauses for aggregating data by month, week, or quarter, based on the `displayBy` parameter.
*   `getExcelSelectedColumns`: Dynamically selects specific columns for Excel exports, with special handling for reports like "Cargo-Ready Date to ETD" (calculating network days) and "BL Release KPI" (adjusting release dates for weekends).
*   `isValidDate` and `dateFilterOnExport`: Functions to validate and format date strings for display and export, ensuring invalid dates are nullified and valid ones are formatted as "MM/DD/YYYY".
*   `EXCEL_EXPORT_COLUMNS`: A comprehensive array defining the key-name mapping for standard columns used in Excel exports, covering various shipment, container, and date-related fields.

**Summary of Key Information, Significant Changes, and Patterns:**

All logged changes occurred on **November 3, 2025**, indicating a focused period of development or updates.

*   **Analytics Feature Enhancement:** A major theme across `others.controller.ts` and `analytics.ts` is the expansion and refinement of analytics capabilities. This involves dynamic SQL query construction based on various report types, sophisticated date calculations (e.g., network days, weekend adjustments for BL release), and robust data preparation for Excel exports, including column selection and date formatting. The architecture uses a modular approach with dedicated query builders for different analytics categories.
*   **Date-Centric Operations:** There's a strong recurring pattern of handling dates for filtering, aggregation, and display. Functions for default date ranges, date validation, and date formatting are central to the analytics utilities.
*   **Dynamic Query Generation & Reporting:** The system extensively uses parameters like `type` and `displayBy` to dynamically build database queries and customize report outputs, specifically for different time granularities (month, week, quarter) and report names.
*   **OTM Integration:** `otm_bol.route.ts` highlights ongoing development related to OTM integration, covering data exchange (payload fetching, XML generation) and management of Bill of Lading information. The commented-out upload route suggests an evolving strategy for handling OTM-related file uploads.
*   **Logistics/Shipping Domain:** The terminology and types of reports (Chassis, Booking, Container, Departure KPIs, BOL, POL, POD, MBL, ETA, ETD) consistently point to an application heavily involved in logistics and shipping operations.