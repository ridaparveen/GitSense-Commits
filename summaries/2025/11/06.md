# Activity Summary for 11/6/2025

## 9:48:47 AM
The log details a series of code changes within a frontend application (T360-frontend-v2), primarily focusing on the dashboard, sidebar, and core layout components, along with related Redux slices and API integrations. The changes occurred between 11/5/2025, 2:54:04 PM and 11/5/2025, 11:28:59 PM.

### File-Specific Updates:

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\components\core\sidebar-layout.tsx`**
    *   **Timestamp: 11/5/2025, 2:54:04 PM:** Initial state or a minor change. The component is a `SidebarLayout` wrapping `Navbar` and `SideBar` components, displaying children as page content. It imports various UI components (Avatar, Dropdown, Navbar, SidebarLayout) and icons from `@heroicons/react`.
    *   **Timestamp: 11/5/2025, 4:33:08 PM & 11/5/2025, 4:33:15 PM:** A trivial change in the `Navbar` rendering, adding "kk" to the content (`<NavbarSpacer />kk`). This suggests a temporary or debugging change, which was likely reverted or removed later.
    *   **Timestamp: 11/5/2025, 9:14:23 PM:** The "kk" in the `Navbar` was removed, restoring the `NavbarSpacer` to its previous state.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\pages\dashboard\dashboard-page.tsx`**
    *   **Timestamp: 11/5/2025, 2:58:06 PM - 11/5/2025, 3:03:46 PM:** The `DashboardPage` component primarily deals with fetching and displaying shipment and delivery data. It uses Redux for state management, including pagination, filters, and sorting. Multiple API calls are made using `useFetchShipmentDataQuery`, `useFetchDeliveryDataQuery`, and `useFetchCartDataQuery`. There are functions for handling pagination (`handlePage`, `handlePageSizeChange`), filters (`handleFilterChange`, `handleClearFilters`), and card clicks (`handleCardClick`). It also includes logic for determining `deliveryMode` (Rail, Door, Port) and preparing calendar data. The initial entries show console logs for `localUser` and `ShipmentData`.
    *   **Timestamp: 11/5/2025, 6:07:06 PM - 11/5/2025, 6:09:52 PM:** A significant change was introduced in `useFetchCartDataQuery` parameters: `CompanyName: localUser?.companyname ? localUser.companyname : ""`, indicating that the cart data fetch now considers the user's company name. This suggests a move towards multi-tenancy or role-based data filtering.
    *   **Timestamp: 11/5/2025, 6:13:35 PM:** An `useEffect` hook was added to explicitly set the customer for users with the "CUSTOMER" role using `dispatch(setCustomer(localUser.companyname))`. This is a direct state update to reflect the customer's context.
    *   **Timestamp: 11/5/2025, 9:01:12 PM:** The `CompanyName` parameter in `useFetchShipmentDataQuery` and `useFetchCartDataQuery` was updated to prioritize `dashboardSelector.selectedCustomer` if available, falling back to `localUser.companyname`. This allows for dynamic customer selection beyond the logged-in user's default company.
    *   **Timestamp: 11/5/2025, 9:11:03 PM:** The `selectedCustomer` state is now read from `state.globalSlice` instead of `state.analyticSlice`, indicating a refactoring of how the selected customer is managed application-wide. The `useEffect` setting `setCustomer` for `CUSTOMER` roles was commented out, implying the `globalSlice` is now the primary source for `selectedCustomer`.
    *   **Timestamp: 11/5/2025, 10:36:47 PM - 11/5/2025, 10:54:28 PM:** Extensive console logs (`console.log("==selectedCustomer",selectedCustomer);` and `console.log("==localuser",localUser);`) were added or modified, likely for debugging purposes related to customer selection logic. The `CompanyName` parameter in `useFetchDeliveryDataQuery` and `useFetchCartDataQuery` was also refined to consistently use `selectedCustomer || localUser.companyname`.
    *   **Timestamp: 11/5/2025, 11:15:22 PM - 11/5/2025, 11:28:59 PM:** The `useSelector` hook for `selectedCustomer` was reverted to fetch from `state.globalSlice` (from `state.global`). The previously commented-out `useEffect` for setting customer for `CUSTOMER` role was removed, consolidating customer selection logic to `globalSlice`. Console logs related to `selectedCustomer` and `localUser` remain prominent, suggesting ongoing debugging or validation of the customer selection mechanism. The `setCustomer` action import from `shipment-dashboard-slice` was removed, reinforcing the move of customer selection logic to `global-slice`.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\components\core\usercard.tsx`**
    *   **Timestamp: 11/5/2025, 3:05:14 PM:** The `UserCard` component handles user display and logout functionality. It retrieves user data from local storage and user preferences from an API (`useFetchUserPreferenceQuery`). The `handleLogout` function supports both Auth0 and normal logout flows, clearing `localStorage` and dispatching a Redux `auth/logout` action. The dropdown menu provides a "Sign out1" option.
    *   **Timestamp: 11/5/2025, 4:23:14 PM - 11/5/2025, 4:32:38 PM:** The component was modified to import `useAccess` and `SelectCustomerPanel`, and it started selecting `toolState` from `analyticSlice`. The `SelectCustomerPanel` was briefly added within the `Dropdown` component, conditionally rendered based on `permission?.selectCustomer`, then removed. This indicates an attempt to integrate customer selection directly into the user card dropdown, which was subsequently reverted or moved.
    *   **Timestamp: 11/5/2025, 8:45:40 PM:** A minor cosmetic change: "Sign out1" in the dropdown menu was changed to "Sign out".

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\components\screen\analytics\AnalyticsToolbar.tsx`**
    *   **Timestamp: 11/5/2025, 3:53:07 PM - 11/5/2025, 3:53:57 PM:** The `AnalyticsToolbar` component manages various filters and actions for analytics dashboards, including date range, custom view management, and PDF export. It uses Redux for state management of global filters, dashboard selection, and operation types. It includes a `downloadDashboardPDF` function which was revised multiple times. The main change visible across these entries is the `downloadDashboardPDF` function, which was initially commented out, then re-implemented to use `html2canvas` and `jspdf` for generating PDFs of the dashboard, including handling logo and scaling. This function also contained commented-out code for attempting to fix rendering issues with CSS variables and filters.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\components\core\layout.tsx`**
    *   **Timestamp: 11/5/2025, 4:20:15 PM - 11/5/2025, 4:21:20 PM:** The `Layout` component provides the main application structure, handling user authentication (token expiry check) and routing. It restricts "ADMIN" users to a specific "Admin Dashboard" view. The changes in this window were minor, adding comments to the token expiry function.
    *   **Timestamp: 11/5/2025, 4:41:20 PM & 11/5/2025, 4:42:14 PM:** A new `useEffect` hook was introduced to dispatch the `setCustomer` action from `analytics-slice` if the `localUser` has a "CUSTOMER" role. This ensures the customer context is set upon layout rendering for customer accounts. The `dispatch` dependency was added to the `useEffect` array.
    *   **Timestamp: 11/5/2025, 6:10:32 PM:** The logic for setting `setCustomer` for CUSTOMER role was removed from `Layout.tsx`.
    *   **Timestamp: 11/5/2025, 9:12:02 PM:** Reintroduced `dispatch(setSelectedCustomer(localUser.companyname));` within a `useEffect` for `CUSTOMER` roles, this time importing `setSelectedCustomer` from `global-slice`. This shows a shift in where customer state is managed.
    *   **Timestamp: 11/5/2025, 11:02:58 PM - 11/5/2025, 11:23:32 PM:** The `Layout` component was updated to initialize `selectedCustomer` from `localStorage` using `initializeSelectedCustomer()` from `global-slice` if the token is valid. This ensures persistence of the selected customer across sessions. The dependency array for the `useEffect` setting `setSelectedCustomer` for `CUSTOMER` roles was adjusted to include optional chaining (`localUser?.role`, `localUser?.companyname`).

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\store\fretures\shipment-dashboard-slice.ts`**
    *   **Timestamp: 11/5/2025, 6:12:29 PM & 11/5/2025, 6:13:25 PM:** The `shipmentDashboardSlice` reducer was updated to include a `setCustomer` action, which sets `selectedCustomer` and defaults `selectedDashobard` to "Default". This change was later reverted or superseded by the `global-slice` refactoring. The `setCustomer` action was exported in the later timestamp.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\store\api\dashboard-api.ts`**
    *   **Timestamp: 11/5/2025, 8:39:50 PM:** No significant changes other than the timestamp, indicating this file was likely reviewed or part of a commit. It defines API endpoints for fetching delivery and card data, utilizing `getAppHeaders()` for authentication.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\types\shipment.types.ts`**
    *   **Timestamp: 11/5/2025, 9:00:51 PM:** No significant code changes. The file defines TypeScript interfaces for shipment-related data structures (`EventAttributes`, `MilestoneItem`, `ShipmentStatusType`, `SortModelItem`, `ShipmentScopeValues`, `DashboardState`, `DashboardCardInfoState`). This indicates definition and structure remained stable.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\store\fretures\global-slice.ts`**
    *   **Timestamp: 11/5/2025, 9:06:15 PM:** A new Redux slice, `globalSlice`, was introduced to manage a `selectedCustomer` state. It provides `setSelectedCustomer` and `clearSelectedCustomer` reducers.
    *   **Timestamp: 11/5/2025, 11:02:03 PM - 11/5/2025, 11:23:54 PM:** The `globalSlice` was enhanced to persist `selectedCustomer` in `localStorage` using `setSelectedCustomer` and to retrieve it on initialization via `initializeSelectedCustomer`. The `PayloadAction` type was added for `setSelectedCustomer`. The `name` of the slice was explicitly set to "globalSlice" in the payload type definition.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\store\store.ts`**
    *   **Timestamp: 11/5/2025, 9:07:08 PM:** The `rootReducer` was updated to include the new `globalSlice` under the key `globalSlice`.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\components\core\sidebar.tsx`**
    *   **Timestamp: 11/5/2025, 9:07:53 PM & 11/5/2025, 9:08:12 PM:** The `SideBar` component was heavily modified to integrate the `SelectCustomerPanel`. It now imports `setSelectedCustomer` from `global-slice` and uses `selectedCustomer` from the global state. Crucially, the `SelectCustomerPanel` is now rendered conditionally, appearing only for "ADMIN" users, and includes an `onSelect` callback to update the global `selectedCustomer` state. Minor styling adjustments (items-center) were also made.
    *   **Timestamp: 11/5/2025, 4:34:00 PM - 11/5/2025, 4:37:01 PM:** The `Sidebar` component was updated to include a `SelectCustomerPanel` based on `useAccess` and `toolState` from `analyticSlice`. It also had temporary "kk" text added to `SidebarLabel` at one point, which was then removed. The `SelectCustomerPanel` was moved to be conditionally rendered based on `permission?.selectCustomer`.
    *   **Timestamp: 11/5/2025, 9:15:46 PM:** The import path for `SelectCustomerPanel` was changed from `@components/screen/analytics/SelectCustomerPanel` to a direct relative import `SelectCustomer`. This likely indicates a refactoring and relocation of this component.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\components\screen\analytics\SelectCustomerPanel.tsx`**
    *   **Timestamp: 11/5/2025, 9:08:52 PM:** The `SelectCustomerPanel` component was introduced or significantly revised. It allows for searching, pagination, and selection of customers, using Material-UI components (Box, List, Popover, TextField, Pagination). It dispatches `setCustomer` from `analytics-slice` upon selection. It uses `lodash.debounce` for search input.
    *   **Timestamp: 11/5/2025, 9:13:54 PM & 11/5/2025, 9:14:14 PM:** This component was renamed to `SelectCustomer.tsx` (implied by the subsequent `sidebar.tsx` change, although the file path here remains `SelectCustomerPanel.tsx`). It was updated to dispatch `setSelectedCustomer` from the `global-slice` instead of `analytics-slice`. An `onSelect` callback prop was added to allow parent components to react to customer selection. The component now displays "No results found" if no options are available. The styles were also adjusted.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\SelectCustomer.tsx`**
    *   **Timestamp: 11/5/2025, 9:16:47 PM:** This file is effectively the renamed and relocated version of `SelectCustomerPanel.tsx`. It confirms the changes from the previous timestamp, showing `setSelectedCustomer` from `global-slice` and the `onSelect` prop. The import for `ApiManager` was changed from a relative path to an absolute path (`services/ApiManager`).

### Patterns and Recurring Elements:

1.  **Redux State Management Refactoring:** A prominent pattern is the shifting of `selectedCustomer` state management. Initially, `dashboard-page.tsx` directly used `localUser.companyname`, then it was passed to `useFetchCartDataQuery` and `useFetchShipmentDataQuery`. Later, a `setCustomer` action was introduced in `shipment-dashboard-slice.ts`, then moved to `analytics-slice`, and finally consolidated into a dedicated `global-slice.ts` for application-wide customer selection. This indicates a move towards a more centralized and robust global state management for the selected customer, especially for "ADMIN" users who can select different customers.
2.  **API Query Parameter Refinement:** Multiple instances show the addition of `CompanyName: selectedCustomer || localUser.companyname` to API queries (e.g., in `useFetchShipmentDataQuery`, `useFetchDeliveryDataQuery`, `useFetchCartDataQuery`). This ensures that API calls dynamically adjust based on the globally selected customer or the logged-in user's default company.
3.  **Authentication and User Role Handling:** The `Layout.tsx` component includes logic to check token validity and redirect on expiry. It also has specific rendering logic for "ADMIN" users, displaying a message to select a customer. The `UserCard.tsx` also handles user-specific data and logout based on authentication type (Auth0 or normal).
4.  **Debugging via `console.log`:** Frequent additions of `console.log` statements (e.g., `console.log("==localuser",localUser);`, `console.log("===shipment data === :> ",ShipmentData);`, `console.log("==selectedCustomer",selectedCustomer);`) indicate active debugging during development, especially around data fetching and customer context.
5.  **Component Refactoring and Relocation:** The `SelectCustomerPanel` component was initially integrated into `AnalyticsToolbar.tsx` and briefly into `UserCard.tsx`, then later moved to its own file (`src\SelectCustomer.tsx`) and integrated into `Sidebar.tsx` specifically for "ADMIN" users. This suggests an evolution in component responsibility and placement for better modularity and access control.
6.  **Minor UI/UX Adjustments:** Small changes like "Sign out1" becoming "Sign out" and the temporary "kk" in the `Navbar` demonstrate iterative UI/UX refinements.
7.  **PDF Export Functionality:** The `AnalyticsToolbar.tsx` shows a continuous effort to improve the PDF export functionality, including handling image conversion and embedding, with commented-out code indicating challenges faced during implementation (e.g., CSS variable/color function overrides).

## 9:48:58 AM
The changes log details development efforts on authentication routes and dashboard/user services, all occurring on **11/5/2025**. This suggests a focused work session on specific features of the `t360-backend-v2` project.

### File-Specific Updates:

1.  **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-backend-v2\src\routes\AuthRoutes.ts`**
    *   **Timestamp: 11/5/2025, 12:54:56 PM**
    *   An authentication route (`/api/auth/getUserInfo`) was added or last modified to fetch and return information about the authenticated user (`req.user`). This route uses `express.Router` and integrates `HttpStatusCodes`.

2.  **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-backend-v2\src\services\dashboardService.ts`**
    *   This file underwent numerous iterations throughout the day, primarily focusing on data retrieval for dashboard insights and delivery tracking.
    *   **Initial Implementation (6:04:50 PM - 6:06:01 PM):**
        *   Introduced `getDashboardCardInfo` to calculate and return aggregated shipment data (e.g., Pending Departure, In Transit, ETA within 1 week, Out for Delivery) with corresponding TEU counts. These queries include filters for `fromDate`, `toDate`, `CompanyName`, and user-specific conditions via `buildMtrUserCondition`.
        *   Introduced `getDeliveryData` to fetch delivery or vessel arrival information, filtered by type (`delivery` or `vessel`), mode (e.g., "ALL", "Rail Delivery"), and user-specific conditions.
    *   **Dynamic Company Name Retrieval (8:41:51 PM - 8:42:22 PM):**
        *   The `getDashboardCardInfo` function was updated to fetch `CompanyName` dynamically using a `getUserObject` utility, rather than directly from `req.query`. This change introduced an import from `@src/utils/analytics`.
        *   Debugging `console.log` statements were added to monitor the `CompanyName` value.
    *   **Filtering Adjustments and Debugging (10:41:50 PM - 10:44:51 PM):**
        *   The `if(useWhere) conditions.push(useWhere);` line in `getDashboardCardInfo` was commented out, potentially disabling a user-specific condition in dashboard card queries.
        *   More debugging `console.log` statements were added to inspect the `result[0]` object from database queries.
    *   **`CompanyName` Handling Refinement in `getDeliveryData` (10:46:26 PM - 10:51:27 PM):**
        *   `getDeliveryData` was updated to also attempt dynamic `CompanyName` retrieval using `getUserObject`.
        *   A `companyFilter` variable was introduced and refined to securely construct a `WHERE` clause for `account_name` by using `LOWER()` for case-insensitive matching and `replace(/'/g, "''")` to escape single quotes, preventing SQL injection.
    *   **Reversion of Dynamic `CompanyName` Retrieval (11:06:35 PM - 11:07:02 PM):**
        *   Both `getDashboardCardInfo` and `getDeliveryData` functions had the dynamic `CompanyName` retrieval via `getUserObject` commented out. `CompanyName` was reverted to being directly destructured from `req.query` for both functions.
    *   **Final Debugging and Query Refinement (11:10:55 PM - 11:23:11 PM):**
        *   Additional debugging `console.log` and `logger.info` statements were added (e.g., `sql query :: 1234`, `companyFilter`).
        *   The `baseQuery` construction in `getDashboardCardInfo` was updated to mirror the safe `LOWER()` and single-quote escaping logic applied earlier to `getDeliveryData`'s `companyFilter`. The last few timestamps for this file represent minor saves or cumulative updates without substantial new functional changes.

3.  **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-backend-v2\src\services\UserService.ts`**
    *   **Timestamp: 11/5/2025, 8:51:00 PM**
    *   This file outlines a comprehensive user service, including:
        *   `login`: Handles user authentication, validates credentials against `mtr_user_master`, checks account status, and generates JWT tokens.
        *   `saveUserPreferences`: Manages user preferences in the `v2_user_details` table using `INSERT ... ON CONFLICT DO UPDATE` for various settings (basic info, notifications, event configurations).
        *   `fetchUserPreferences`: Retrieves user preferences by joining `v2_user_details` and `mtr_user_master`.
        *   `saveInviteLog`: Records user invitations in `v2_user_invite_log` and sends an invitation email.
        *   `fetchAllCompanyUser`: Fetches a combined list of active users from `mtr_user_master` and pending invited users from `v2_user_invite_log` for a specific company.
        *   `userSettings`: Retrieves specific user settings like `date_format`.
    *   Subsequent entries for this file (8:51:15 PM, 8:51:46 PM) are identical, indicating no further functional changes were committed after the initial comprehensive update.

### Patterns and Recurring Elements:

*   **Debugging Focus:** A frequent pattern across `dashboardService.ts` changes is the insertion and modification of `console.log` and `logger.info` statements, indicating active debugging and testing during the development process.
*   **User and Company Context:** Both `dashboardService.ts` and `UserService.ts` heavily rely on user-specific (`req.user`, `buildMtrUserCondition`) and company-specific (`CompanyName`) data for filtering and operations.
*   **Direct SQL Query Usage:** Database interactions are predominantly handled through direct PostgreSQL queries embedded within the service functions. This includes complex queries with `FILTER (WHERE ...)` and `REGEXP_REPLACE` for data aggregation in `dashboardService.ts`, and `ON CONFLICT DO UPDATE` for UPSERT operations in `UserService.ts`.
*   **SQL Injection Prevention:** An important recurring refinement, particularly in `dashboardService.ts`, is the explicit use of `LOWER()` for case-insensitive comparisons and `replace(/'/g, "''")` to escape single quotes when constructing dynamic SQL queries with user-provided `CompanyName`, enhancing security.
*   **Error Handling:** All service functions consistently implement `try...catch` blocks to handle potential errors during database operations or logic execution, returning appropriate HTTP status codes (e.g., `500 Internal Server Error`, `404 Not Found`).
*   **Timestamp Clustering:** All changes logged occurred on the same day, suggesting a dedicated development sprint or bug-fixing session.

## 11:02:02 AM
The provided logs indicate a focused development effort on a React-based frontend application, likely a dashboard or analytics platform, centered around shipment and delivery tracking. Key areas of change include:

### File-Specific Updates:

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\pages\dashboard\dashboard-page.tsx`** (Frequent updates between 11/5/2025, 2:58:06 PM and 11/6/2025, 10:01:39 AM):
    *   This file, representing the main dashboard page, underwent numerous changes.
    *   **Initial state and API integration**: It imports various components, icons, and Redux slices (`shipment-dashboard-slice`, `dashboard-api`) to manage state, filters, pagination, and data fetching for shipment and delivery information.
    *   **Filter and Pagination Logic**: Functions `handlePage`, `handlePageSizeChange`, `handleFilterChange`, `handleClearFilters`, and `handleCardClick` are consistently present, indicating robust filtering and pagination capabilities.
    *   **Customer Selection Integration**: Over time, changes show the integration of `selectedCustomer` from a global Redux slice into the API calls for `useFetchShipmentDataQuery` and `useFetchCartDataQuery` (starting around 11/5/2025, 6:07:06 PM and refined through 11:28:59 PM). This ensures data displayed is specific to the selected customer.
    *   **Removal of Redundant Customer Logic**: An `useEffect` hook that previously dispatched `setCustomer(localUser.companyname)` for "CUSTOMER" roles was commented out, indicating a shift in how the `selectedCustomer` is managed globally.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\components\core\sidebar-layout.tsx`** (11/5/2025, 2:54:04 PM; 4:33:08 PM; 4:33:15 PM; 9:14:23 PM):
    *   This component defines the overall layout with a sidebar and navbar.
    *   Minor, possibly test-related, changes like adding "kk" to the navbar (4:33:08 PM, 4:33:15 PM) were introduced and then reverted (9:14:23 PM), indicating small, temporary debugging or layout adjustments.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\components\core\usercard.tsx`** (Multiple updates between 11/5/2025, 3:05:14 PM and 8:45:40 PM):
    *   This component handles user display and logout functionality.
    *   **Logout Refinements**: The `handleLogout` function was initially commented out and then re-enabled, with explicit `localStorage.removeItem` calls before navigation, ensuring proper session cleanup.
    *   **Customer Panel Integration (Temporary)**: There was an attempt to integrate `SelectCustomerPanel` directly into `UserCard` (4:23:14 PM, 4:24:19 PM), followed by its removal (4:30:28 PM, 4:30:34 PM, 4:32:38 PM). This suggests an architectural decision to move the customer selection logic elsewhere.
    *   **Minor Text Change**: "Sign out1" was corrected to "Sign out" in the dropdown label (8:45:40 PM).

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\components\screen\analytics\AnalyticsToolbar.tsx`** (Multiple updates between 11/5/2025, 3:53:07 PM and 3:53:57 PM):
    *   This component manages the analytics dashboard toolbar, including PDF export.
    *   **PDF Export Refinements**: Multiple iterations of the `downloadDashboardPDF` function indicate efforts to improve PDF generation, including using `html2canvas-pro`, handling image loading (logo), and ensuring proper styling restoration after capture. Previously commented-out approaches were replaced with a more robust method involving base64 image conversion.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\components\core\layout.tsx`** (Multiple updates between 11/5/2025, 4:20:15 PM and 11:23:32 PM):
    *   This file defines the main application layout and authentication logic.
    *   **Token Expiry and Redirection**: Consistent logic to check for expired tokens and redirect to the root path on expiry.
    *   **Admin User Restriction**: Specific UI is rendered for "ADMIN" users, instructing them to select a customer.
    *   **Customer Initialization Logic**: An `useEffect` hook was added and refined to dispatch `setSelectedCustomer` from `localUser.companyname` if the user role is "CUSTOMER" (4:42:14 PM), and later `initializeSelectedCustomer` was dispatched on successful token validation to retrieve the customer from local storage (11:02:58 PM).

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\components\core\sidebar.tsx`** (Multiple updates between 11/5/2025, 4:34:00 PM and 9:15:46 PM):
    *   This component renders the application sidebar.
    *   **Customer Selector Relocation**: The `SelectCustomerPanel` component was moved into the sidebar, specifically conditional on the user being an "ADMIN" (9:07:53 PM). This centralizes customer selection for admin users.
    *   **Styling Adjustments**: Minor text "kk" added then removed, indicating small visual debugging.
    *   **Import Path Change**: The `SelectCustomerPanel` import path was adjusted (9:15:46 PM).

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\store\fretures\shipment-dashboard-slice.ts`** (11/5/2025, 6:12:29 PM and 6:13:25 PM):
    *   This Redux slice manages the dashboard state.
    *   **`setCustomer` reducer**: A `setCustomer` reducer was added to update `selectedCustomer` and reset `selectedDashobard` to "Default". This was then exported.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\store\api\dashboard-api.ts`** (11/5/2025, 8:39:50 PM):
    *   This file defines API endpoints for dashboard data.
    *   No significant code changes, but a timestamp indicates it was touched.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\types\shipment.types.ts`** (11/5/2025, 9:00:51 PM):
    *   Type definitions for shipment-related data.
    *   No significant code changes, but a timestamp indicates it was touched.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\store\fretures\global-slice.ts`** (Multiple updates between 11/5/2025, 9:06:15 PM and 11:23:54 PM):
    *   This new Redux slice was introduced to manage global state, particularly `selectedCustomer`.
    *   **Initialization and Persistence**: The `globalSlice` was created to manage `selectedCustomer`, including reducers `setSelectedCustomer` and `clearSelectedCustomer`. Later iterations refined `setSelectedCustomer` to persist the selected customer in `localStorage` and introduced `initializeSelectedCustomer` to load it on app startup.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\store\store.ts`** (11/5/2025, 9:07:08 PM):
    *   Redux store configuration.
    *   **`globalSlice` Integration**: The newly created `globalSlice` was integrated into the root reducer, reflecting the shift to a global customer selection state.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\components\screen\analytics\SelectCustomerPanel.tsx` / `c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\components\screen\analytics\SelectCustomer.tsx` / `c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\SelectCustomer.tsx`** (Multiple updates between 11/5/2025, 9:08:52 PM and 9:16:47 PM):
    *   This component provides a UI for selecting customers.
    *   **Refactored to `SelectCustomerPanel`**: The component was refactored, moving from `analytics-slice` to `global-slice` for `setCustomer` (9:08:52 PM).
    *   **Rename and Relocation**: The file was renamed from `SelectCustomerPanel.tsx` to `SelectCustomer.tsx` and then moved from `components/screen/analytics` to the `src` root as `SelectCustomer.tsx` (9:13:54 PM, 9:14:14 PM, 9:16:47 PM).
    *   **Callback Added**: An `onSelect` prop was added to allow parent components to handle the selected customer.
    *   **Search and Pagination**: Implements debounced search and pagination for fetching customer options from an API.

### Timestamps of Significant Changes:

*   **11/5/2025, ~2:54 PM - ~3:03 PM**: Initial setup and minor adjustments to `dashboard-page.tsx` and `sidebar-layout.tsx`.
*   **11/5/2025, ~3:53 PM**: Multiple changes to `AnalyticsToolbar.tsx` related to PDF export.
*   **11/5/2025, ~4:20 PM - ~4:42 PM**: Refinements to `layout.tsx` for token validation and initial attempts to set customer data for specific roles, along with related shifts in `usercard.tsx`.
*   **11/5/2025, ~6:07 PM**: Integration of `localUser.companyname` into `useFetchCartDataQuery` in `dashboard-page.tsx`.
*   **11/5/2025, ~9:06 PM - ~9:17 PM**: Significant restructuring around customer selection.
    *   Introduction of `global-slice.ts` for managing `selectedCustomer`.
    *   Integration of `global-slice` into `store.ts`.
    *   Relocation of `SelectCustomerPanel` to the sidebar and a change in its import path within `sidebar.tsx`.
    *   The `SelectCustomerPanel` component itself was updated to use `global-slice` and persist selection in `localStorage`.
*   **11/5/2025, ~10:36 PM - ~11:28 PM**: Further refinements in `dashboard-page.tsx` to consistently use `selectedCustomer` from `globalSlice` for API calls (`useFetchShipmentDataQuery`, `useFetchDeliveryDataQuery`, `useFetchCartDataQuery`), ensuring all data fetches respect the globally selected customer. The direct setting of customer from `localUser` in `dashboard-page.tsx` was commented out, deferring this logic to `Layout.tsx`.
*   **11/5/2025, ~11:02 PM - ~11:23 PM**: `global-slice.ts` and `layout.tsx` updated to persist `selectedCustomer` in `localStorage` and initialize it on app load.

### Patterns and Recurring Elements:

*   **Redux State Management**: Consistent use of `react-redux` (`useDispatch`, `useSelector`) to manage application state, particularly for dashboard filters, pagination, and customer selection.
*   **API Integration with RTK Query**: Extensive use of Redux Toolkit Query (`useFetch...Query`) for data fetching, with parameters dynamically constructed from Redux state (filters, pagination, sort model, and `selectedCustomer`).
*   **`localStorage` for User Data**: `localStorage.getItem("user")` and `localStorage.getItem("token")` are frequently accessed to retrieve user details and authentication tokens, and cleared on logout or token expiry.
*   **Conditional Rendering/Logic based on User Role**: The application differentiates behavior for "ADMIN" and "CUSTOMER" roles, for example, by showing a customer selector only for admins or setting a default customer for regular customers.
*   **Console Logging for Debugging**: Numerous `console.log` statements are present, indicating active debugging during development.
*   **Component-based Architecture**: The changes are spread across various components (`sidebar-layout`, `dashboard-page`, `usercard`, `AnalyticsToolbar`, `layout`, `sidebar`, `SelectCustomerPanel`), reflecting a modular frontend structure.
*   **Moment.js for Date Handling**: The `moment` library is used for date manipulation and formatting.
*   **Focus on Dashboard and Analytics**: Many changes revolve around filtering, data presentation, and export features of a dashboard/analytics section.
*   **Refactoring Customer Selection**: There's a clear evolution of the customer selection mechanism, initially tied to individual components, then moving towards a global Redux slice (`global-slice`) and persisting the selection. This suggests a move towards a more centralized and robust approach for multi-customer environments.

## 11:02:20 AM
The log details changes across two primary files: `AuthRoutes.ts` and `dashboardService.ts`, along with a new service file `UserService.ts`.

**File-Specific Updates:**

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-backend-v2\src\routes\AuthRoutes.ts`**
    *   **Timestamp:** 11/5/2025, 12:54:56 PM
    *   This file defines a single authentication route, `GET /api/auth/userInfo`, which logs the authenticated user information and returns it in the response. It imports necessary Express router and common types/constants.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-backend-v2\src\services\dashboardService.ts`**
    *   This file underwent numerous revisions throughout the day, focusing on two main functions: `getDashboardCardInfo` and `getDeliveryData`.
    *   **Initial State (11/5/2025, 6:04:50 PM):** Both functions were implemented to query `mtr_tracking_data`. `getDashboardCardInfo` calculates various shipment metrics (Pending Departure, In Transit, ETA within 1 Week, Out for Delivery) and their TEU equivalents, filtering by date ranges and `CompanyName` directly from `req.query`. `getDeliveryData` retrieves delivery or vessel arrival data with filters based on `type` and `mode`. User-specific conditions are applied via `buildMtrUserCondition`.
    *   **Company Name Handling Refinement (11/5/2025, 8:41:51 PM - 8:42:22 PM):** The `getDashboardCardInfo` function was updated to use `getUserObject` (from `@src/utils/analytics`) to derive `CompanyName` dynamically based on the authenticated user and query parameters, rather than directly using `req.query.CompanyName`. Logging of `req.CompanyName` was added.
    *   **Temporary Filter Removal (11/5/2025, 10:43:59 PM):** The `useWhere` condition (from `buildMtrUserCondition`) was temporarily commented out in `getDashboardCardInfo`, disabling user-specific data filtering for this endpoint.
    *   **`getDeliveryData` Company Filter Introduction (11/5/2025, 10:46:26 PM):** `getDeliveryData` was updated to also derive `CompanyName` using `getUserObject` (initially) and attempt to apply a `CompanyName` filter to its SQL queries. This initial implementation had a potential SQL injection vulnerability as the `CompanyName` was directly concatenated into the query string without proper escaping.
    *   **Critical Security Fix (11/5/2025, 10:51:27 PM):** A significant update introduced a `companyFilter` variable in `getDeliveryData`. This filter correctly applies `LOWER(account_name) = LOWER('${CompanyName.replace(/'/g, "''")}')`, escaping single quotes to prevent SQL injection and ensuring case-insensitive matching. The derivation of `CompanyName` for `getDeliveryData` was explicitly set to come from `req.query.CompanyName` (capitalized) and explicitly commented to ensure frontend consistency.
    *   **Partial Revert and Alignment (11/5/2025, 11:06:35 PM - 11:13:53 PM):** The logic for deriving `CompanyName` via `getUserObject` in both `getDashboardCardInfo` and `getDeliveryData` was commented out and reverted to directly using `CompanyName` from `req.query`. However, the safe `companyFilter` logic (including `replace(/'/g, "''")`) was then applied to `getDashboardCardInfo` as well, ensuring consistent SQL injection protection for company name filters across both dashboard functions. Minor debug `console.log` and logger messages were added.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-backend-v2\src\services\UserService.ts`**
    *   **Initial Comprehensive Implementation (11/5/2025, 8:51:00 PM):** This file was introduced with several new user management functionalities:
        *   `login`: Handles user authentication, validates credentials against `mtr_user_master`, checks account status, and generates a JWT token upon successful login.
        *   `saveUserPreferences`: Stores or updates user settings and notification preferences in the `v2_user_details` table, utilizing `ON CONFLICT` for upsert operations.
        *   `fetchUserPreferences`: Retrieves user preferences, joining `mtr_user_master` and `v2_user_details` to provide default values.
        *   `saveInviteLog`: Records user invitation details to `v2_user_invite_log` and triggers an email invitation.
        *   `fetchAllCompanyUser`: Fetches a combined list of active registered users and pending invited users for a specific company.
        *   `userSettings`: Fetches basic user settings like `date_format`.
    *   **Subsequent timestamps (11/5/2025, 8:51:15 PM - 8:51:46 PM):** Show no functional changes to this file, indicating stability after its initial implementation.

**Timestamps of Significant Changes:**

*   **11/5/2025, 8:41:51 PM:** `dashboardService.ts` begins using `getUserObject` for dynamic `CompanyName` retrieval.
*   **11/5/2025, 8:51:00 PM:** Major new feature development in `UserService.ts` is introduced, adding user preferences, invitations, and comprehensive user listing.
*   **11/5/2025, 10:46:26 PM:** `getDeliveryData` in `dashboardService.ts` starts applying `CompanyName` filtering.
*   **11/5/2025, 10:51:27 PM:** Crucial SQL injection prevention implemented in `getDeliveryData` for `CompanyName` filtering.
*   **11/5/2025, 11:13:53 PM:** `getDashboardCardInfo` in `dashboardService.ts` adopts the same safe SQL escaping for `CompanyName`.

**Patterns/Recurring Elements:**

*   **Dynamic SQL Query Construction:** A consistent pattern across `dashboardService.ts` and `UserService.ts` is the dynamic construction of SQL queries using string concatenation, often based on request parameters and user data.
*   **SQL Injection Prevention:** There is a clear evolution in `dashboardService.ts` towards implementing more robust SQL injection prevention by using `CompanyName?.replace(/'/g, "''")` when concatenating user-provided company names into SQL queries.
*   **Logging and Debugging:** Frequent additions of `logger.info`, `logger.error`, and `console.log` statements indicate active debugging and monitoring during development, particularly around data fetching and parameter handling.
*   **User Context and Authorization:** `req.user` and `buildMtrUserCondition` are consistently used to ensure operations are performed within the context of the authenticated user and their permissions/company affiliation.
*   **Error Handling:** All service functions consistently wrap their logic in `try...catch` blocks to handle potential errors during database operations or business logic, returning appropriate HTTP status codes and error messages.
*   **`ON CONFLICT DO UPDATE`:** In `UserService.ts`, SQL `ON CONFLICT` clauses are used for `saveUserPreferences` and `saveInviteLog`, indicating an upsert pattern for managing user-related data.

## 12:01:48 PM
The code changes primarily focus on improving the T360 frontend application, specifically around **dashboard functionality, user management, and global state management**, with a strong emphasis on handling customer-specific data and authentication.

**Key Information from Changes:**

**File-Specific Updates:**

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\pages\dashboard\dashboard-page.tsx` (Multiple timestamps from 11/5/2025, 2:58 PM to 11/6/2025, 10:01 AM):**
    *   **Timestamp:** Frequent updates throughout the period.
    *   **Summary:** This file, `DashboardPage`, undergoes significant refactoring related to data fetching and filtering.
        *   Initial versions of `useFetchCartDataQuery` and `useFetchShipmentDataQuery` were updated to include a `CompanyName` parameter, either from `localUser?.companyname` or `dashboardSelector.selectedCustomer`.
        *   Later changes remove `localUser.companyname` from direct API calls, relying solely on `dashboardSelector.selectedCustomer` or `selectedCustomer` from the `globalSlice`.
        *   The explicit call to `dispatch(setCustomer(localUser.companyname))` for `CUSTOMER` role users was commented out and subsequently removed as the `selectedCustomer` state is now managed more globally.
        *   There are numerous `console.log` statements added for debugging `localUser`, `selectedCustomer`, `ShipmentData`, and `dashboardCartData`, indicating active development and troubleshooting of data flow.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\components\core\usercard.tsx` (Multiple timestamps from 11/5/2025, 3:05 PM to 11/5/2025, 8:45 PM):**
    *   **Timestamp:** Several changes between 3:05 PM and 4:32 PM, and a final one at 8:45 PM.
    *   **Summary:**
        *   A `SelectCustomerPanel` component was temporarily added and then removed from `UserCard`'s render, indicating a shifting strategy for customer selection UI.
        *   Dependencies like `useAccess` and `useSelector` (for `toolState` and `analyticSlice`) were added, then later removed, simplifying the `UserCard`'s direct responsibilities.
        *   The `handleLogout` function remains consistent, clearing `token` and `user` from `localStorage` and dispatching a Redux `auth/logout` action, with different redirection logic based on `authtype` (Auth0 or normal).
        *   A minor textual change from "Sign out1" to "Sign out" in the dropdown label occurs in the last update.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\components\screen\analytics\AnalyticsToolbar.tsx` (Multiple timestamps around 11/5/2025, 3:53 PM):**
    *   **Summary:** Updates involve refactoring the PDF export functionality (`downloadDashboardPDF`). The commented-out code suggests previous attempts to handle CSS variables and filters during HTML to Canvas conversion. The final version explicitly converts the logo to base64 before adding it to the PDF. The component also uses `useAccess` and manages dashboard and filter states via Redux.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\components\core\layout.tsx` (Multiple timestamps from 11/5/2025, 4:20 PM to 11/5/2025, 11:23 PM):**
    *   **Summary:** This file primarily handles user session management and routing based on user roles.
        *   Consistently checks `token` validity and `localUser.exp` to determine if the user is logged in or if the token has expired, redirecting to the root ("/") if so.
        *   Admin users (`localUser?.role === "ADMIN"`) are explicitly redirected to a "Please select any customer to view data" message, suggesting a design pattern for multi-tenant or role-based access.
        *   A `useEffect` hook was introduced to dispatch `setCustomer` (later `setSelectedCustomer` from `globalSlice`) with `localUser.companyname` for `CUSTOMER` role users, and `initializeSelectedCustomer` for others after successful login, indicating a move towards global customer state management.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\components\core\sidebar.tsx` (Multiple timestamps from 11/5/2025, 4:34 PM to 11/5/2025, 9:15 PM):**
    *   **Summary:** The sidebar component was updated to conditionally render `SelectCustomerPanel` specifically for "ADMIN" users.
        *   Early changes included debugging text ("kk").
        *   Later, `SelectCustomerPanel` was moved into the `SidebarBody` for ADMIN users, integrating customer selection directly into the sidebar for relevant roles.
        *   Refactoring shifted `SelectCustomerPanel`'s import path and removed `toolState` from its props, now taking `selectedCustomer` and `onSelect` from the `globalSlice`.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\store\fretures\shipment-dashboard-slice.ts` (Multiple timestamps around 11/5/2025, 6:12 PM):**
    *   **Summary:** The `shipmentDashboardSlice` initially had a `setCustomer` reducer. This reducer was eventually removed, with its responsibility seemingly shifted to a new `globalSlice`.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\store\fretures\global-slice.ts` (Multiple timestamps from 11/5/2025, 9:06 PM to 11/5/2025, 11:23 PM):**
    *   **Summary:** This new slice (`globalSlice`) was created to manage a `selectedCustomer` state globally.
        *   Initial version stored `selectedCustomer` as a string.
        *   Later, it was refined to handle `null` for `selectedCustomer` and interact with `localStorage` to persist the selected customer across sessions (`localStorage.setItem("selectedCustomer", action.payload)` and `localStorage.removeItem("selectedCustomer")`).
        *   An `initializeSelectedCustomer` reducer was added to load the saved customer from `localStorage` on app initialization.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\store\store.ts` (11/5/2025, 9:07 PM):**
    *   **Summary:** The root Redux store was updated to include the new `globalSlice` in its `combineReducers`.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\types\shipment.types.ts` (11/5/2025, 9:00 PM):**
    *   **Summary:** The `DashboardState` interface was updated to include `selectedCustomer:string;` and `selectedDashobard:string;`, reflecting the new global state management for customer and dashboard selections.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\components\screen\analytics\SelectCustomerPanel.tsx` (11/5/2025, 9:08 PM and 11/5/2025, 9:13 PM):**
    *   **Summary:** This component, initially used with `analytics-slice`, was refactored and renamed (implied by the log sequence leading to `SelectCustomer.tsx`). It now explicitly dispatches `setSelectedCustomer` to the `global-slice` and includes an optional `onSelect` callback for parent components. The implementation uses Material-UI components (Box, List, Popover, TextField, Pagination) and includes a debounced API call for fetching customer options.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\SelectCustomer.tsx` (Multiple timestamps around 11/5/2025, 9:16 PM):**
    *   **Summary:** This file appears to be the final location/renaming of the `SelectCustomerPanel` component, with its functionality refined to integrate with the `global-slice` for `selectedCustomer` management and an explicit `onSelect` prop. The import path for `ApiManager` also changed from a relative path to a root-aliased path.

**Patterns and Recurring Elements:**

1.  **Redux Integration for Global State:** A significant pattern is the migration towards a centralized `globalSlice` in Redux for managing `selectedCustomer`. This indicates a broader architectural shift to make customer selection accessible and consistent across different parts of the application, especially for "ADMIN" users who need to switch contexts.
2.  **`localStorage` for Session Persistence:** `localStorage` is consistently used to store and retrieve user authentication details (`token`, `user`) and the newly introduced `selectedCustomer`, enabling state persistence across browser sessions.
3.  **Role-Based Access Control:** The application explicitly checks `localUser?.role` ("ADMIN" or "CUSTOMER") to tailor UI elements and data fetching logic, particularly visible in `Layout.tsx` and `SideBar.tsx`. Admin users have a specific view and the ability to select customers.
4.  **Data Fetching and Filtering:** Dashboard-related components (`dashboard-page.tsx`, `dashboard-api.ts`) are heavily reliant on Redux state (`dashboardSelector.filters`, `dashboardSelector.pagination`, `dashboardSelector.sortModel`, `dashboardSelector.cardFilter`, `dashboardSelector.dateFilter`) to construct API queries. The `CompanyName` parameter in API calls also reflects the customer selection logic.
5.  **Component Refactoring and Consolidation:** The `SelectCustomerPanel` component underwent significant refactoring, including potential renaming and relocation, and its integration into different parent components (initially `UserCard`, then `AnalyticsToolbar`, and finally `SideBar`). This indicates an iterative process to find the most logical place for shared UI elements and state.
6.  **Debugging `console.log` statements:** Numerous `console.log` statements throughout the code entries (e.g., `console.log("==localuser",localUser);`, `console.log("===shipment data === :> ",ShipmentData);`) suggest active development, testing, and debugging phases.
7.  **Consistent Logout Logic:** The `handleLogout` function across `usercard.tsx` maintains a consistent approach to clearing local storage and dispatching a Redux action for logout, accommodating both Auth0 and normal authentication flows.

## 12:02:04 PM
The provided log details code changes across two main files within a single day, 11/5/2025, primarily focusing on backend services related to authentication, dashboard data, and user management.

### File-Specific Updates:

1.  **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-backend-v2\src\routes\AuthRoutes.ts`**
    *   **Timestamp:** 11/5/2025, 12:54:56 PM
    *   This file defines an Express router for authentication. A single GET route, `Paths.Auth.GetUserInfo`, is configured to log the authenticated user's information and return it as a JSON response with an `OK` status. This appears to be a stable endpoint for retrieving basic user data after authentication.

2.  **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-backend-v2\src\services\dashboardService.ts`**
    *   This file underwent numerous iterations throughout the day, mainly refining how company-specific data and user-specific conditions are applied to dashboard queries.
    *   **Initial State (11/5/2025, 6:04:50 PM):** Introduced `getDashboardCardInfo` and `getDeliveryData` functions. `getDashboardCardInfo` took `CompanyName` directly from `req.query` and applied various conditions, including `buildMtrUserCondition` for user-specific filtering. `getDeliveryData` used `buildMtrUserCondition` and filtered by `type` (delivery/vessel) and `mode`.
    *   **Minor Fixes & Debugging (11/5/2025, 6:05:15 PM - 10:44:51 PM):** Several commits were identical or included minor changes like adding debug `console.log` statements. A notable change at **8:41:51 PM** involved `getDashboardCardInfo` fetching `CompanyName` dynamically using `getUserObject` for potentially more robust access control, importing `getUserObject` from `@src/utils/analytics`. Later, at **10:43:59 PM**, the `useWhere` condition was temporarily commented out in `getDashboardCardInfo`.
    *   **`CompanyName` Handling Refinement (11/5/2025, 10:46:26 PM - 11:13:53 PM):**
        *   At **10:46:26 PM**, `getDeliveryData` also started attempting to fetch `CompanyName` via `getUserObject` and introduced a `CompanyName` filter into its SQL queries using direct string concatenation, which was potentially unsafe.
        *   A critical update at **10:51:27 PM** for `getDeliveryData` reverted the `getUserObject` call for `CompanyName` (meaning `CompanyName` was again expected from `req.query`), but importantly, implemented **SQL injection sanitization** for the `CompanyName` parameter using `CompanyName.replace(/'/g, "''")` before incorporating it into the SQL query string. This significantly improved security.
        *   By **11:06:35 PM**, both `getDashboardCardInfo` and `getDeliveryData` were consistently updated to retrieve `CompanyName` directly from `req.query`, with the `getUserObject` call commented out in both functions.
        *   The final significant change at **11:13:53 PM** applied the same **SQL injection sanitization logic** (`CompanyName?.replace(/'/g, "''") || ""`) to the `CompanyName` filter within the `getDashboardCardInfo` function, ensuring consistent and safer handling of this parameter across both primary dashboard data retrieval functions.
    *   The `buildMtrUserCondition(req.user!)` helper function is consistently used in both `getDashboardCardInfo` and `getDeliveryData` to apply user-specific conditions.

3.  **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-backend-v2\src\services\UserService.ts`**
    *   **Timestamp:** 11/5/2025, 8:51:00 PM (and subsequent identical entries)
    *   This file contains a comprehensive suite of user management functionalities:
        *   `login`: Handles user authentication, validates credentials, checks account status, and generates a JWT token upon successful login. It fetches user data from `mtr_user_master`.
        *   `saveUserPreferences`: Allows users to save personal preferences (e.g., name, email, phone, time zone, language, date format, and various notification/event configurations) to the `v2_user_details` table, with an `ON CONFLICT` clause to handle updates for existing user codes.
        *   `fetchUserPreferences`: Retrieves user preferences, using `mtr_user_master` as a fallback for some basic info if not found in `v2_user_details`.
        *   `saveInviteLog`: Records user invitations in `v2_user_invite_log` and triggers an email using `sentInviteEmail`. It also handles updates on conflict.
        *   `fetchAllCompanyUser`: Fetches a combined list of active users from `mtr_user_master` and pending invited users from `v2_user_invite_log` for a specific company.
        *   `userSettings`: Retrieves specific user settings like `date_format`.
    *   All these functions are exported individually and collectively via an `all` object.

### Patterns and Recurring Elements:

*   **Consistent Logging:** Extensive use of `logger.info` and `logger.error` is present across all service files for monitoring request flow, debugging query statements, and capturing errors.
*   **Standardized Error Handling:** All API endpoints and service functions utilize `try-catch` blocks for robust error handling, returning `HttpStatusCodes.INTERNAL_SERVER_ERROR` or specific HTTP errors like `NOT_FOUND` or custom `HttpError` instances.
*   **Database Interaction:** Direct SQL queries are used extensively via a `query` utility function, often building dynamic `WHERE` clauses based on request parameters and user context.
*   **User Context and Authorization:** The `IAuthReq` interface and `req.user` object are consistently used to access authenticated user details, and `buildMtrUserCondition` is a recurring helper for applying user-specific filters to database queries.
*   **Query Parameter Handling:** There's an iterative process evident in `dashboardService.ts` to correctly and safely extract and apply query parameters (like `CompanyName`, `fromDate`, `toDate`, `type`, `mode`) to SQL queries, including a clear evolution towards preventing SQL injection vulnerabilities.
*   **PostgreSQL-Specific SQL Features:** Queries frequently use advanced PostgreSQL features such as `FILTER (WHERE ...)`, `DISTINCT ON (...)`, `COALESCE`, `REGEXP_REPLACE`, `INTERVAL`, and `ROW_NUMBER() OVER (PARTITION BY ... ORDER BY ...)`.
*   **"Magic String" Debugging:** The `logger.info(`sql query :: 1234${baseQuery}`);` in `dashboardService.ts` indicates a temporary or in-progress debugging technique.

## 12:02:39 PM
Based on the provided instructions, the log entries are for the file `c:\Users\ridap\OneDrive\Documents\Envosyes\envosys-backend\config\.env.development`. As this file path contains `.env`, it falls under the category of files that store keys and should not be summarized. Therefore, no summary of its content will be generated.

## 12:03:14 PM
The log details the development and refinement of a document upload feature within an Envosys frontend application. The changes span across a page component, a screen-level component handling the upload logic, and a column definition file for a data grid.

### File-Specific Updates:

**`c:\Users\ridap\OneDrive\Documents\Envosyes\envosys-frontend\src\pages\upload-docs\uploadDocs.tsx`**
This file defines the main page for document uploads.
*   **Early (11:12 AM):** The component `UploadDocs` was initially set up to render a `PageWrapper` with "Upload Document1s" in the left panel and a `ConfirmLineBookingForm` component in the main content area.
*   **Subsequent (11:12 AM):** A minor textual correction was made, changing "Upload Document1s" to "Upload Documents" in the left panel.

**`c:\Users\ridap\OneDrive\Documents\Envosyes\envosys-frontend\src\data\coulms\upload-doc-coulmn.tsx`**
This file defines the columns for the data grid used to display uploaded document information.
*   **Initial Definition (11:18 AM):** Columns were initially defined for `created_at` (formatted date), `time` (formatted time), `created_by`, `field_name`, `old_value`, and `new_value`.
*   **Major Refactoring (11:22 AM - 11:23 AM):** The column structure underwent a significant overhaul. The original `created_at`, `created_by`, `field_name`, `old_value`, `new_value` columns were replaced with `file`, `json_data`, and `date_time`.
*   **`json_data` Column Evolution (11:28 AM - 11:38 AM):**
    *   An initial `renderCell` for `json_data` attempted to parse and display values like `field_name: old_value  new_value`, with console logging for debugging.
    *   It was temporarily changed to display raw, pretty-printed JSON within a `<pre>` tag.
    *   The `renderCell` then reverted to a more structured display, formatting content based on whether `json_data` was an array or an object.
    *   Finally, the `renderCell` was enhanced to show a concise summary (e.g., just `field_name`s for arrays) and included functionality to download the full JSON data upon clicking the displayed text.
*   **`file` Column Implementation (11:34 AM):** The `file` column gained a `renderCell` function to render a downloadable link. It extracts the filename from the URL and displays it, allowing users to download the file directly.
*   **Styling & Width Adjustments (11:51 AM - 11:54 AM):** Both `file` and `json_data` columns saw their text and hover colors changed from various shades of blue/gray to a consistent dark gray (`#09090B`). Column widths were iteratively adjusted: `file` from 150 to 350, `json_data` from 150 to 400, and `date_time` from 150 to 300.
*   **Cleanup (11:55 AM):** Unused utility imports (`appDateFormat`, `appTimeFormat`) were removed as the custom rendering logic within `json_data` and `file` columns no longer required them.

**`c:\Users\ridap\OneDrive\Documents\Envosyes\envosys-frontend\src\components\screen\upload-docs\uploadDocs.tsx`**
This component (`ConfirmLineBookingForm`) is responsible for the actual document upload UI and logic.
*   **Initial Component Setup (11:19 AM):** The `ConfirmLineBookingForm` component was created with state management for uploaded files, drag-over status, and upload progress. It implemented drag-and-drop file upload, file input, and file removal features. Form handling was set up using Formik, integrating with `useUploadDocumentMutation` for API calls and `react-hot-toast` for user feedback. An `AppGrid` was included to display `tableDummyData`.
*   **Data Alignment (11:24 AM - 11:28 AM):** The `tableDummyData` within this component was continuously updated to reflect the evolving structure of `UPLOAD_TAB_COLUMNS` from `upload-doc-coulmn.tsx`. This included changes from older fields to `date_time`, then introducing `file` and `json_data` (initially as an array, then testing an object structure).
*   **UI/UX Refinements (11:19 AM - 12:02 PM):**
    *   Minor layout adjustments, such as moving the `AppGrid` placement and changing the form's wrapper `div` width from `max-w-md` to `w-full`.
    *   An image import (`envosyLogo`) was added and used as a dummy file in `tableDummyData`.
    *   `tableDummyData` was expanded to include more entries for demonstration purposes (up to 6 files).
    *   There were temporary changes involving wrapping the form within a `Card` component, which was then reverted.
    *   The success toast message upon upload was made more generic from "All files uploaded successfully!" to "file uploaded successfully!".
    *   The submit button text was changed from "Save" to "Upload Files".

### Timestamps of Significant Changes:

*   **11:12 AM:** Initial page setup and a minor text correction.
*   **11:18 AM - 11:23 AM:** Major redefinition of grid columns in `upload-doc-coulmn.tsx` from old date/user fields to `file`, `json_data`, `date_time`.
*   **11:19 AM:** Introduction of the `ConfirmLineBookingForm` component with core upload and display logic.
*   **11:28 AM - 11:38 AM:** Iterative development of the `json_data` column's rendering and download functionality.
*   **11:34 AM:** Implementation of downloadable links for the `file` column.
*   **11:51 AM - 11:54 AM:** Extensive adjustments to column widths and text/hover colors for better visual consistency.
*   **11:57 AM - 12:01 PM:** Experimentation with component wrapping (Card component) and subsequent reversion.
*   **12:02 PM:** Final minor text changes to toast messages and button labels.

### Patterns and Recurring Elements:

*   **Iterative Development and Refinement:** Many changes involve small, incremental adjustments to UI elements (text, colors, widths) and code logic (especially for `json_data` rendering), indicating an iterative development process with frequent commits to fine-tune features.
*   **Tight Coupling of Data and UI:** The `tableDummyData` in `uploadDocs.tsx` was consistently updated to align with the evolving column definitions in `upload-doc-coulmn.tsx`, highlighting a direct relationship between the data presented and its display structure.
*   **Focus on File Upload UX:** Features like drag-and-drop, file listing with removal, and visual feedback (toasts, uploading state) show a strong emphasis on a user-friendly file upload experience.
*   **Component-Based Architecture:** The use of `PageWrapper`, `Card`, `AppGrid`, `ConfirmLineBookingForm`, and utility components (`@components/kit/button`, `@mui/icons-material/Upload`) demonstrates a modular React component approach.
*   **API Integration:** The presence of `useUploadDocumentMutation` indicates that the frontend is designed to interact with a backend API for file storage and management.
*   **Styling with Tailwind CSS:** Extensive use of utility classes (e.g., `text-gray-900`, `border-dashed`, `bg-black`, `text-red-500`, `text-[#09090B]`) points to Tailwind CSS being the primary styling framework.
*   **Debugging and Experimentation:** The `console.log` statements, commented-out code blocks, and multiple revisions of rendering logic suggest active debugging and experimentation during the development of complex features like JSON data display.

## 1:23:53 PM
The provided logs detail a series of front-end code changes, primarily focusing on improving the user experience and data filtering capabilities within a dashboard and layout structure. The changes revolve around state management, API integration, and UI component rendering.

### File-Specific Updates:

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\components\core\sidebar-layout.tsx`**
    *   **Timestamp:** 11/5/2025, 2:54:04 PM
    *   Initial setup of `AppSidebarLayout` component, importing various UI elements like `Avatar`, `Dropdown`, `Navbar`, `SidebarLayout`, and icons from `@heroicons/react`. It integrates a `SideBar` component.
    *   **Timestamps:** 11/5/2025, 4:33:08 PM and 11/5/2025, 4:33:15 PM
    *   Minor, seemingly experimental change: "kk" was temporarily added to the `NavbarSpacer` component and then removed shortly after.
    *   **Timestamp:** 11/5/2025, 9:14:23 PM
    *   The "kk" was removed from `NavbarSpacer`, restoring the component to its original state from 2:54:04 PM.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\pages\dashboard\dashboard-page.tsx`**
    *   **Timestamp:** 11/5/2025, 2:58:06 PM (and subsequent minor changes at 2:58:53 PM, 3:03:35 PM, 3:03:46 PM)
    *   This file is a central point for dashboard logic. It involves fetching shipment and delivery data, managing filters (date range, card filters, shipment status), pagination, and sorting using Redux (`useDispatch`, `useSelector`) and RTK Query (`useFetchShipmentDataQuery`, `useFetchCartDataQuery`, `useFetchDeliveryDataQuery`).
    *   A `cardLabelMap` is defined for dashboard card types, and `getStartOfWeek` utility is present.
    *   The `weekData` memoization logic determines delivery modes (Rail, Door, Port Delivery) based on various date and location attributes.
    *   Event handlers for pagination (`handlePage`, `handlePageSizeChange`), filters (`handleFilterChange`, `handleClearFilters`), and card clicks (`handleCardClick`) are implemented. A `scrollTo` function is used for UI navigation.
    *   **Timestamp:** 11/5/2025, 6:07:06 PM, 6:08:04 PM, 6:09:52 PM
    *   Introduction of `CompanyName: localUser?.companyname ? localUser.companyname : ""` parameter to `useFetchCartDataQuery`. This suggests a change to filter dashboard card data based on the logged-in user's company, specifically if they are a customer.
    *   **Timestamp:** 11/5/2025, 6:13:35 PM
    *   Added an `useEffect` hook to dispatch `setCustomer(localUser.companyname)` if `localUser?.role` is "CUSTOMER", ensuring the customer context is set when the dashboard page loads.
    *   **Timestamp:** 11/5/2025, 9:01:12 PM
    *   Modified the `CompanyName` parameter in `useFetchShipmentDataQuery` and `useFetchCartDataQuery` to use `dashboardSelector.selectedCustomer || localUser.companyname`. This indicates a shift towards a global customer selection, falling back to the local user's company name if no specific customer is selected in the dashboard's Redux state.
    *   **Timestamp:** 11/5/2025, 9:11:03 PM
    *   Removed the `useEffect` responsible for setting the customer for "CUSTOMER" roles directly within `dashboard-page.tsx`. This logic seems to be externalized, likely to the main layout or global state management. The `selectedCustomer` is now explicitly pulled from `state.globalSlice`.
    *   **Timestamps:** 11/5/2025, 10:36:47 PM to 11/5/2025, 11:28:59 PM (multiple minor edits)
    *   The primary recurring change here is adding console logs for `selectedCustomer` and `localUser` to debug the customer selection logic.
    *   **Timestamp:** 11/5/2025, 10:42:24 PM
    *   The `CompanyName` parameter in `useFetchCartDataQuery` was further refined to consistently include `selectedCustomer || localUser.companyname`, even when `fromDate` and `toDate` are not provided.
    *   **Timestamps:** 11/5/2025, 11:15:22 PM to 11/5/2025, 11:28:59 PM (multiple minor edits)
    *   Reverted the dashboard logic for `CompanyName` in API calls from `selectedCustomer || localUser.companyname` back to simply checking date ranges or an empty string, and completely removed the `selectedCustomer` dependency from the API calls within this component. It also removed `setCustomer` from the import, implying its removal from Redux actions specific to the dashboard slice. The console logs for `selectedCustomer` and `localUser` remain, indicating ongoing debugging or monitoring of these values. This suggests a re-evaluation of how `CompanyName` filtering is applied directly within the dashboard's API queries. The `useEffect` for setting customer for "CUSTOMER" roles remains commented out.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\components\core\usercard.tsx`**
    *   **Timestamp:** 11/5/2025, 3:05:14 PM
    *   A `UserCard` component is responsible for displaying user information and providing a logout mechanism. It retrieves user data from local storage and user preferences from an API. It includes a `getInitials` utility. The logout function handles both "auth0" and "normal" authentication types, clearing local storage and dispatching a Redux logout action.
    *   **Timestamps:** 11/5/2025, 4:23:14 PM, 4:24:19 PM
    *   Imported `useAccess`, `SelectCustomerPanel`, and `useSelector` to potentially display a customer selection panel based on user permissions, pulling `toolState` from `analyticSlice`. `SelectCustomerPanel` was rendered conditionally.
    *   **Timestamps:** 11/5/2025, 4:30:28 PM, 4:30:34 PM
    *   Commented out the `permission = useAccess()` hook, and `SelectCustomerPanel` is still rendered but its usage of `toolState.selectedCustomer` might be affected by the commented permission hook. The `permission` import from `process` was also removed.
    *   **Timestamp:** 11/5/2025, 4:31:21 PM
    *   Re-introduced `useAccess` hook and `permission` variable, allowing for conditional rendering based on user access rights. `SelectCustomerPanel` remains present.
    *   **Timestamp:** 11/5/2025, 4:32:38 PM
    *   `SelectCustomerPanel` component was removed from the `UserCard`'s render, indicating that the customer selection logic might be moving elsewhere.
    *   **Timestamp:** 11/5/2025, 8:45:40 PM
    *   Changed the `DropdownLabel` text from "Sign out1" to "Sign out".

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\components\screen\analytics\AnalyticsToolbar.tsx`**
    *   **Timestamp:** 11/5/2025, 3:53:07 PM (and subsequent identical changes at 3:53:47 PM, 3:53:57 PM)
    *   This component manages analytics dashboard filters and PDF export functionality. It uses Redux for state management (`setDashboard`, `setFilterType`, `setGlobalFilter`, `setOperationType`) and handles date range selection and custom views.
    *   Includes a `downloadDashboardPDF` function leveraging `jsPDF` and `html2canvas-pro` to export the dashboard as a PDF, including a logo. Extensive commented-out code suggests previous iterations or debugging of the PDF export functionality, specifically around handling CSS properties and image loading.
    *   The `getBase64Image` utility is added to convert an image to base64 for PDF embedding.
    *   Conditional rendering of `SelectCustomerPanel` based on `permission?.selectCustomer` is present.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\components\core\layout.tsx`**
    *   **Timestamp:** 11/5/2025, 4:20:15 PM (and subsequent minor changes at 4:21:01 PM, 4:21:20 PM)
    *   This layout component handles user authentication checks (token expiration) and redirects unauthenticated users. It also restricts "ADMIN" users from viewing data directly, prompting them to select a customer.
    *   **Timestamp:** 11/5/2025, 4:41:20 PM
    *   An `useEffect` hook was added to potentially set `localUser?.companyname` if the user role is "CUSTOMER", but `dispatch` was missing as a dependency or action.
    *   **Timestamp:** 11/5/2025, 4:42:14 PM
    *   Introduced `useDispatch` and dispatched `setCustomer(localUser.companyname)` for "CUSTOMER" roles, correctly linking customer data to Redux state.
    *   **Timestamp:** 11/5/2025, 6:10:32 PM
    *   Removed the `PageWrapper` component with its "Admin Dashboard" prompt, simplifying the layout for ADMIN users to `Main` and `Outlet`. The customer-setting `useEffect` for "CUSTOMER" roles was also removed.
    *   **Timestamp:** 11/5/2025, 9:12:02 PM
    *   Re-introduced `useDispatch` and the `useEffect` to dispatch `setSelectedCustomer(localUser.companyname)` for "CUSTOMER" roles. This now correctly targets the `global-slice` action instead of `analytics-slice` as in previous iterations of this logic.
    *   **Timestamp:** 11/5/2025, 11:02:58 PM
    *   Added `initializeSelectedCustomer` dispatch within the token expiration `useEffect` for authenticated users to load previously selected customer from local storage.
    *   **Timestamps:** 11/5/2025, 11:22:18 PM, 11:23:32 PM
    *   Toggle between using `initializeSelectedCustomer` (which loads from local storage) and not using it for authenticated users. The final state includes `initializeSelectedCustomer` for authenticated users.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\store\fretures\shipment-dashboard-slice.ts`**
    *   **Timestamp:** 11/5/2025, 6:12:29 PM
    *   Initializes the Redux slice for shipment dashboard state, including pagination, sorting, filters (shipment\_id, dates, status, POL, POD, container number), and `cardFilter`.
    *   Introduced `selectedCustomer` and `selectedDashobard` fields, and a `setCustomer` reducer to update `selectedCustomer` and set `selectedDashobard` to "Default".
    *   **Timestamp:** 11/5/2025, 6:13:25 PM
    *   Exported `setCustomer` action, making it available for other components to dispatch.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\store\api\dashboard-api.ts`**
    *   **Timestamp:** 11/5/2025, 8:39:50 PM
    *   Defines RTK Query API endpoints (`fetchDeliveryData`, `fetchCartData`) for fetching dashboard-related data. Both queries now accept `params` and construct a `queryString` to include them. The `CompanyName` parameter is notably **not** explicitly added here, suggesting it's handled at the component level or passed via `params`.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\types\shipment.types.ts`**
    *   **Timestamp:** 11/5/2025, 9:00:51 PM
    *   Updated the `DashboardState` interface to include `selectedCustomer: string;` and `selectedDashobard: string;` reflecting the new fields in the Redux slice.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\store\fretures\global-slice.ts`**
    *   **Timestamp:** 11/5/2025, 9:06:15 PM
    *   Created a new Redux slice named `global` with `selectedCustomer` state. It includes `setSelectedCustomer` and `clearSelectedCustomer` reducers.
    *   **Timestamp:** 11/5/2025, 11:02:03 PM
    *   Modified `globalSlice` to handle `selectedCustomer` as `string | null`. It now uses local storage to persist the `selectedCustomer` value and introduces `initializeSelectedCustomer` to load this value on app startup.
    *   **Timestamps:** 11/5/2025, 11:21:38 PM, 11:23:37 PM, 11:23:54 PM
    *   Minor adjustments to the `global-slice` interface and PayloadAction type definitions for `selectedCustomer` as `string | null`.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\store\store.ts`**
    *   **Timestamp:** 11/5/2025, 9:07:08 PM
    *   Integrated the new `globalSlice` into the `rootReducer`, making the global customer selection state available throughout the application.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\components\core\sidebar.tsx`**
    *   **Timestamp:** 11/5/2025, 9:07:53 PM, 9:08:12 PM
    *   Modified to import `setSelectedCustomer` from `global-slice`. The `SelectCustomerPanel` is now conditionally rendered inside the sidebar based on `localUser?.role === "ADMIN"`. The `selectedCustomer` state is retrieved from `state.globalSlice`. It also includes a `handleCustomerSelect` callback for `SelectCustomerPanel` to dispatch `setSelectedCustomer`. The logo and text in the header were vertically aligned using `items-center`.
    *   **Timestamp:** 11/5/2025, 9:15:46 PM
    *   Changed the import path for `SelectCustomerPanel` from `@components/screen/analytics/SelectCustomerPanel` to `SelectCustomer`. This implies the `SelectCustomerPanel` component was moved or renamed.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\components\screen\analytics\SelectCustomerPanel.tsx`**
    *   **Timestamp:** 11/5/2025, 9:08:52 PM
    *   This component provides a customer selection popover with search and pagination functionalities. It fetches customer options using `ApiManager.getPaginatedCompanyOptions` and dispatches `setCustomer` (from analytics-slice) upon selection. It uses debouncing for search input.
    *   **Timestamp:** 11/5/2025, 9:13:54 PM, 9:14:14 PM
    *   This file was renamed/moved to `src\components\screen\analytics\SelectCustomer.tsx`. The `SelectCustomerPanelProps` interface now includes an optional `onSelect` callback. More significantly, it now dispatches `setSelectedCustomer` from the *global-slice* instead of the *analytics-slice*, aligning with the refactored state management. Minor stylistic adjustments (gap in field, input padding) were also made.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\SelectCustomer.tsx`**
    *   **Timestamp:** 11/5/2025, 9:16:47 PM
    *   This file represents the final location/renaming of the `SelectCustomerPanel` component. The import paths for `ApiManager` and `setSelectedCustomer` were adjusted to reflect its new top-level `src` directory location.

### Patterns and Recurring Elements:

1.  **Redux/RTK Query Integration:** A consistent pattern of using `useDispatch` and `useSelector` from `react-redux` and RTK Query hooks (e.g., `useFetchShipmentDataQuery`, `useFetchCartDataQuery`, `useFetchDeliveryDataQuery`, `useFetchUserPreferenceQuery`) is evident across multiple files (`dashboard-page.tsx`, `usercard.tsx`, `AnalyticsToolbar.tsx`, `sidebar.tsx`).
2.  **State Management Refinements:** There's an ongoing evolution of state management, particularly regarding `selectedCustomer`.
    *   Initially, `dashboard-page.tsx` directly used `localUser.companyname` for API calls and briefly attempted to dispatch `setCustomer` within its `useEffect`.
    *   A `selectedCustomer` field was introduced in `shipment-dashboard-slice.ts` and `shipment.types.ts`.
    *   Later, a dedicated `global-slice.ts` was created for `selectedCustomer` to manage it globally, including persistence in local storage (`localStorage.setItem`, `localStorage.removeItem`, `initializeSelectedCustomer`).
    *   This `globalSlice`'s `selectedCustomer` then became the primary source for API calls in `dashboard-page.tsx` and for rendering in `sidebar.tsx` and `SelectCustomerPanel.tsx`.
3.  **Authentication and User Role Handling:** The `layout.tsx` component consistently handles token expiration and redirects unauthenticated users. It also includes specific logic for "ADMIN" users, originally to prompt for customer selection, and then "CUSTOMER" users to auto-set their company.
4.  **UI Component Usage:** Consistent use of custom UI components from `@components/kit` (e.g., `SidebarLayout`, `Navbar`, `Dropdown`, `Avatar`) and `@components/common` (e.g., `PageWrapper`, `Cards`, `Datagrid`, `DatePeriodSelector`) suggests a component-based architecture.
5.  **Debugging via `console.log`:** Frequent use of `console.log` statements (e.g., `console.log("==localuser",localUser);`, `console.log("===shipment data === :> ",ShipmentData);`, `console.log("==selectedCustomer",selectedCustomer);`) indicates active development and debugging during these changes. These logs often appear and disappear or are modified across consecutive commits in the same file.
6.  **PDF Export Logic:** The `AnalyticsToolbar.tsx` shows detailed implementation of client-side PDF generation using `jsPDF` and `html2canvas-pro`, with commented-out sections indicating iterative development and troubleshooting of styling issues during export.
7.  **Customer Selection Component Refactoring:** The `SelectCustomerPanel` component underwent changes in its Redux action dispatch (from analytics-slice to global-slice) and its import location within the project structure, suggesting a refactor to make it more generic and globally usable.

## 2:05:57 PM
Based on the provided log, all entries pertain to the file `c:\Users\ridap\OneDrive\Documents\Envosyes\envosys-backend\config\.env.development`. As per the instructions, summaries for file paths containing `.env` files or anything that may store keys are not to be generated. Therefore, no summary can be provided for these changes.

## 2:06:22 PM
The code changes primarily focus on refining the "Upload Documents" functionality and its associated display, specifically affecting two key files: `uploadDocs.tsx` (page and component) and `upload-doc-coulmn.tsx` (data grid column definitions).

**File-Specific Updates:**

*   **`c:\Users\ridap\OneDrive\Documents\Envosyes\envosys-frontend\src\pages\upload-docs\uploadDocs.tsx`**
    *   **Timestamp: 11/6/2025, 11:12:39 AM - 11:12:52 AM**: A minor initial change corrects a typo in the page title from "Upload Document1s" to "Upload Documents".
    *   **Timestamp: 11/6/2025, 12:12:05 PM**: The "Upload Documents" title is wrapped in an `<h2>` tag with a `page-title` class, indicating a stylistic or semantic update.

*   **`c:\Users\ridap\OneDrive\Documents\Envosyes\envosys-frontend\src\data\coulms\upload-doc-coulmn.tsx`**
    *   **Timestamp: 11/6/2025, 11:18:05 AM**: Initially defines data grid columns for an audit trail including `created_at`, `time`, `created_by`, `field_name`, `old_value`, and `new_value`.
    *   **Timestamp: 11/6/2025, 11:22:26 AM - 11:23:37 AM**: Significant refactoring occurs. The column definitions are changed to focus on document-specific data, replacing previous audit fields with `file`, `json_data`, and `date_time`. Old date/time formatting utilities (`appDateFormat`, `appTimeFormat`) are initially retained but eventually removed from imports when no longer used for rendering.
    *   **Timestamp: 11/6/2025, 11:28:55 AM - 11:38:38 AM**: Extensive iteration on the `json_data` column's `renderCell` function. It evolves from attempting to display specific JSON fields to showing raw stringified JSON, then back to a human-readable summary, with different styling and content adjustments. A key feature added is the ability to download the JSON data on click.
    *   **Timestamp: 11/6/2025, 11:34:09 AM**: The `file` column gains a `renderCell` function to display a downloadable link for the file, extracting the filename from the URL.
    *   **Timestamp: 11/6/2025, 11:51:01 AM - 11:53:30 AM**: Minor styling adjustments are made to the `file` and `json_data` columns, primarily tweaking text colors and adding an `underline` class to indicate clickability.
    *   **Timestamp: 11/6/2025, 11:53:49 AM - 11:54:30 AM**: Column widths for `date_time` and `file` are progressively increased for better display.
    *   **Timestamp: 11/6/2025, 11:55:51 AM**: Unused utility imports (`appDateFormat`, `appTimeFormat`) are removed.
    *   **Timestamp: 11/6/2025, 12:04:37 PM**: The header text for the `date_time` column is changed from "Date Time" to "Date And Time".

*   **`c:\Users\ridap\OneDrive\Documents\Envosyes\envosys-frontend\src\components\screen\upload-docs\uploadDocs.tsx`**
    *   **Timestamp: 11/6/2025, 11:19:25 AM**: Introduces the `ConfirmLineBookingForm` component, which includes a drag-and-drop file upload interface, file list display with removal, form handling using Formik, and a mechanism to upload files to a backend via a `useUploadDocumentMutation` hook. It also initially includes an `AppGrid` to display `tableDummyData`.
    *   **Timestamp: 11/6/2025, 11:24:25 AM - 11:28:14 AM**: The `tableDummyData` is consistently updated to align with the evolving column definitions from `upload-doc-coulmn.tsx`, reflecting the change from audit fields to `file`, `json_data`, and `date_time`. It also tests different `json_data` structures (array vs. object).
    *   **Timestamp: 11/6/2025, 11:45:42 AM - 11:46:14 AM**: An image (`envosyLogo`) is imported and used in `tableDummyData` to test the file display, with a subsequent correction to the import statement.
    *   **Timestamp: 11/6/2025, 11:50:28 AM**: The `tableDummyData` is expanded to include more entries (6 total), likely for testing pagination or a fuller grid view.
    *   **Timestamp: 11/6/2025, 11:57:36 AM - 12:08:17 PM**: Significant refactoring of the component's layout and structure, involving the introduction and strategic placement of `Card` components. The form and the `AppGrid` are eventually separated into distinct `Card` sections, with `Card.Header` titles added. The main component title is commented out due to redundancy.
    *   **Timestamp: 11/6/2025, 12:02:07 PM**: The success toast message is shortened from "All files uploaded successfully!" to "file uploaded successfully!".
    *   **Timestamp: 11/6/2025, 12:02:37 PM - 12:10:33 PM**: The primary action button text changes multiple times from "Save" to "Upload Files", then "Upload Documents", and finally "Upload".

**Patterns and Recurring Elements:**

*   **Iterative UI/UX Development**: There's a strong pattern of rapid iteration on UI elements, including styling (Tailwind CSS classes for colors, borders, spacing, widths), text content, and component layout (`Card` usage). This suggests active fine-tuning of the user interface for the upload functionality.
*   **Column Definition Evolution**: The data grid columns (`UPLOAD_TAB_COLUMNS`) undergo a clear evolution from a generic audit log to a specialized view for uploaded documents, with particular attention to how `json_data` is displayed and made downloadable.
*   **Dummy Data Syncing**: `tableDummyData` in the `uploadDocs.tsx` component is consistently updated to reflect the current structure of the `UPLOAD_TAB_COLUMNS`, indicating a robust testing approach during development.
*   **Focus on Upload Functionality**: The core logic for file upload (drag-and-drop, form handling, API integration) remains stable, while the surrounding presentation layers are extensively refined.

## 2:06:26 PM
The provided code changes primarily focus on backend services related to authentication, dashboard analytics, shipment tracking, and booking management, occurring across two days: November 5th and November 6th, 2025. A recurring pattern is the dynamic construction of SQL queries based on user roles and query parameters, with ongoing adjustments for data filtering and potential security enhancements. There were multiple instances of identical file content being logged consecutively, suggesting re-saves or minor non-functional changes not captured by the provided diff.

Here's a breakdown of the key changes per file:

**`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-backend-v2\src\routes\AuthRoutes.ts`**
*   **11/5/2025, 12:54:56 PM**: This file defines an Express router for authentication. It includes a `GET` endpoint at `Paths.Auth.GetUserInfo` which logs the authenticated user's information (`req.user`) and returns it with an `OK` status. This is the only entry for this file, so it represents its state.

**`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-backend-v2\src\services\dashboardService.ts`**
This file saw the most frequent modifications, indicating active development and debugging.
*   **Initial State (11/5/2025, 6:04:50 PM to 6:06:01 PM)**: Introduced `getDashboardCardInfo` and `getDeliveryData` functions.
    *   `getDashboardCardInfo` calculates various shipment statistics (Pending Departure, In Transit, ETA within 1 Week, Out for Delivery) and their TEU equivalents by querying `mtr_tracking_data` with filters for `fromDate`, `toDate`, and `CompanyName`. It uses `buildMtrUserCondition` for user-specific data access.
    *   `getDeliveryData` fetches delivery or vessel arrival details, also from `mtr_tracking_data`, with filters for `type`, `mode`, and `CompanyName`. It employs complex conditional logic to build `vessalFilter` based on `mode` (ALL, Rail Delivery, Door Delivery, Port Delivery).
*   **Dynamic CompanyName Retrieval (11/5/2025, 8:41:51 PM)**: In `getDashboardCardInfo`, the `CompanyName` query parameter was replaced by a dynamic retrieval from `getUserObject`, enhancing how the company name is validated and fetched based on user context and query parameters (`companyname`, `access`).
*   **Debugging Additions (11/5/2025, 8:42:22 PM, 10:44:51 PM, 11:10:55 PM, 11:11:09 PM)**: Several `console.log` statements were added to log `req.CompanyName`, `result[0]`, `sql query :: 1234`, and `companyFilter`, indicating active debugging of the queries and company name resolution.
*   **Query Parameter Refinement (11/5/2025, 10:41:50 PM)**: The `CompanyName` was removed from the direct destructuring of `req.query` in `getDashboardCardInfo`, as it was being fetched separately by `getUserObject`.
*   **Temporary Comment-Out of User Condition (11/5/2025, 10:43:59 PM)**: The `if(useWhere) conditions.push(useWhere);` line was commented out in `getDashboardCardInfo`, temporarily disabling user-specific conditions for dashboard cards.
*   **Company Filtering for `getDeliveryData` (11/5/2025, 10:46:26 PM)**:
    *   `getDeliveryData` was updated to also derive `CompanyName` using `getUserObject`.
    *   **Security Concern Introduced**: This change *directly* interpolated `CompanyName` into the SQL queries (`sqlQueryDelivery`, `SqlQueryVesselArrival`), creating a potential SQL injection vulnerability.
*   **Error Logging Enhancement (11/5/2025, 10:49:15 PM)**: A `console.log(error);` was added to the `catch` block of `getDeliveryData` for better debugging.
*   **SQL Injection Fix for `getDeliveryData` (11/5/2025, 10:51:27 PM)**: A critical security fix was implemented. The direct interpolation of `CompanyName` was replaced with a `companyFilter` variable. This filter sanitizes the `CompanyName` by escaping single quotes (`replace(/'/g, "''")`) and ensures case-insensitive comparison using `LOWER()`, effectively mitigating the previously introduced SQL injection vulnerability.
*   **Reverting CompanyName Source (11/5/2025, 11:06:35 PM to 11:07:02 PM)**:
    *   In `getDeliveryData`, the `getUserObject` call for `CompanyName` was commented out, reverting to taking `CompanyName` directly from `req.query`.
    *   Similarly, in `getDashboardCardInfo`, the logic to derive `CompanyName` via `getUserObject` was commented out, reverting to `CompanyName` being destructured directly from `req.query`. This reintroduces a simpler, less dynamic approach for company name resolution for both functions.
*   **Query Parameter Type Clarification (11/5/2025, 11:13:53 PM)**: The types for `fromDate`, `toDate`, and `CompanyName` in `req.query` were explicitly defined to include `string | undefined`. The `baseQuery` in `getDashboardCardInfo` was also made more robust by adding `|| ""` to the `CompanyName` replacement to handle undefined values gracefully.

**`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-backend-v2\src\services\UserService.ts`**
*   **Initial State (11/5/2025, 8:51:00 PM)**: This file defines several user-related service functions, including `login`, `saveUserPreferences`, `fetchUserPreferences`, `saveInviteLog`, `fetchAllCompanyUser`, and `userSettings`. These functions interact with `mtr_user_master`, `v2_user_details`, and `v2_user_invite_log` tables to manage user data, preferences, invitations, and settings. No functional code changes were observed across the three timestamps provided for this file (8:51:00 PM, 8:51:15 PM, 8:51:46 PM).

**`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-backend-v2\src\services\shipmentService.ts`**
*   **Initial State (11/6/2025, 1:27:09 PM)**: This file introduces the `getAll` function for fetching shipment data. It uses an `SqlQueryBuilder` class to construct dynamic SQL queries for data retrieval and total counts, based on filters like `pol`, `pod`, `shipment_id`, `status`, `fromDate`, `toDate`, `orderBy`, `cardFilter`, `contno`, and `viewType`. The `SqlQueryBuilder` also includes robust `buildUserCondition` logic to filter data based on the authenticated user's role (ADMIN, CUSTOMER, FRONTOFFICE, AGENT) and company. The `getAll` function also processes raw tracking data to determine and assign a human-readable `status` (e.g., Pending, In-Transit, Delivered) to each shipment item.

**`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-backend-v2\src\services\bookingService.ts`**
*   **Initial State (11/6/2025, 2:02:45 PM)**: This file defines the `getAll` and `saveBooking` functions, along with a `BookingQueryBuilder` class. The `BookingQueryBuilder` generates dynamic SQL queries for listing bookings based on various filters (pagination, sorting, status, search, date range) and user roles. The `getAll` function fetches booking data, various counts (all, pending, approved, cancelled, new), and distinct options for filters. `saveBooking` outlines the process for preparing and sanitizing booking payload for database insertion.
*   **New Column Added (11/6/2025, 2:05:16 PM)**: The `selectedColumns` in the `BookingQueryBuilder` was updated to include `abe.est_cargo_ready_date`, making this field available in the booking listing results.

**Patterns and Recurring Elements:**
*   **Focus on Logistics Data:** The changes revolve around managing and displaying data for shipments and bookings in a logistics context.
*   **Dynamic Query Generation:** A prominent pattern is the use of `QueryBuilder` classes (`SqlQueryBuilder`, `BookingQueryBuilder`) and manual conditional logic to build dynamic SQL queries. This allows for flexible filtering, searching, and pagination based on user input and roles.
*   **User-Centric Data Filtering:** All service files demonstrate a strong emphasis on filtering data based on the authenticated user's role and associated company, ensuring data visibility is restricted appropriately.
*   **Security Concerns and Resolution:** An explicit SQL injection vulnerability was introduced and subsequently fixed in `dashboardService.ts` for `getDeliveryData`, highlighting the iterative nature of development and the importance of sanitization.
*   **Debugging Practices:** Frequent additions and removals of `console.log` and custom logger messages (e.g., `logger.info('sql query :: 1234')`) indicate active debugging during the development phase.
*   **Iterative Refinement:** The `dashboardService.ts` file, in particular, shows multiple minor adjustments to query parameters, variable handling, and logging, reflecting an iterative process of development, testing, and debugging.

## 4:18:01 PM
The provided log details a series of changes across multiple frontend files, primarily focusing on dashboard functionalities, booking management, and UI component enhancements.

**File-specific updates:**

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\pages\dashboard\dashboard-page.tsx` (Multiple timestamps between 11/5/2025, 11:17:22 PM and 11/6/2025, 1:52:26 PM):**
    *   Initial changes on 11/5/2025 involved retrieving `selectedCustomer` from `globalSlice` and `localUser` from `localStorage` to be used in API calls for `ShipmentData`, `deliveryData`, and `dashboardCartData`. This indicates an enhancement to filter data based on the logged-in user's company name or a selected customer.
    *   Throughout 11/5/2025, parameter handling for API calls was refined, specifically for `CompanyName` which now defaults to `selectedCustomer || localUser.companyname`.
    *   On 11/6/2025, the `useOverviewDashboardColumns` hook was introduced and assigned to a `columns` constant, suggesting a refactoring of how data grid columns are defined and managed for the dashboard.
*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\store\fretures\global-slice.ts` (11/5/2025, 11:21:38 PM, 11:23:37 PM, 11:23:54 PM):**
    *   Initially, a `globalSlice` was created with `selectedCustomer` as a string.
    *   Later updates introduced `PayloadAction` for `setSelectedCustomer` to allow `string | null` and added logic to persist `selectedCustomer` in `localStorage`.
    *   An `initializeSelectedCustomer` reducer was added to retrieve the `selectedCustomer` from `localStorage` upon initialization, ensuring persistence across sessions. The slice name was also updated to "globalSlice".
*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\components\core\layout.tsx` (11/5/2025, 11:22:18 PM, 11:23:32 PM):**
    *   The `Layout` component was updated to dispatch `setSelectedCustomer` if the `localUser` has a "CUSTOMER" role, setting their company name.
    *   A subsequent change introduced `initializeSelectedCustomer` dispatch in the `useEffect` hook, specifically within the `else` block of the `isTokenExpired` check, ensuring that if a token is valid, the customer selection state is initialized from `localStorage`.
*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\components\screen\booking\booking-dashboard.tsx` (Multiple timestamps between 11/6/2025, 1:54:16 PM and 11/6/2025, 4:13:35 PM):**
    *   Initial commits setup the `BookingDashboard` with functionality to fetch booking data, handle pagination, sorting, and filtering. It displays booking counts across "New", "Approved", "Confirmed", and "Cancelled" statuses.
    *   Filter sidebar fields were expanded to include "Cargo Ready Date From" and "Cargo Ready Date To" in addition to "Carrier Date From/To."
    *   The `handleClearFilters` function was updated to reset the newly added `CargoReadyFromDate` and `CargoReadyToDate` filters.
    *   A `modal` state was introduced (11/6/2025, 2:57:33 PM) to manage a `BaseModal` component, which initially rendered `InvoiceReversal` and was later changed to `BookingView` (11/6/2025, 2:58:27 PM). The modal size was also increased to "4xl".
    *   The `GET_BOOKING_COULMN` function call within `AppGrid` was updated multiple times to adjust its parameters, first including `access`, `setModal`, and `nav` for action menu rendering.
*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\data\coulmns\booking-coulmns.tsx` (Multiple timestamps between 11/6/2025, 1:55:44 PM and 11/6/2025, 4:02:02 PM):**
    *   Significant refactoring of column definitions for the booking dashboard.
    *   The "PO No" field was commented out (11/6/2025, 1:56:31 PM).
    *   A new column "Cargo Ready Date" (`est_cargo_ready_date`) was introduced, replacing an earlier "Carrier Date" entry. The rendering of this date was also adjusted.
    *   The "Carrier Booking No" field was changed from `ship_name` to `bookingno`.
    *   `minWidth` property was extensively added to various columns for better layout control.
    *   The "Action" column's `renderCell` was updated to use a `TMenu` component (11/6/2025, 2:34:14 PM), importing `getBookingActions` and `TMenu`, and passing `nav`, `access`, and `setModal` as parameters. This shifted from a direct button click to a dropdown menu for actions. `EllipsisVerticalIcon` was introduced for the action button icon.
    *   `BOOKING_VESSEL_COLUMN_CUSTOMER` and `ROUTING_COLUMNS` constants were defined (11/6/2025, 4:01:28 PM), including `appDateFormat` for consistent date rendering.
*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\store\fretures\booking-dashboard-slice.ts` (11/6/2025, 2:13:50 PM):**
    *   `CargoReadyFromDate` and `CargoReadyToDate` were added to the initial state of filters, corresponding to the new filter options in the dashboard.
    *   `booking_type` filter was initialized as an empty array instead of a string.
*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\components\common\t-menu.tsx` (11/6/2025, 2:33:44 PM, 11/6/2025, 2:41:58 PM):**
    *   Introduced a new generic `TMenu` component for rendering a dropdown menu with custom icons and labels. It uses React Portals for rendering the menu.
    *   Added a check `menuItems?.map` to handle cases where `menuItems` might be undefined or null.
*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\components\screen\booking\action.tsx` (Multiple timestamps between 11/6/2025, 2:35:28 PM and 11/6/2025, 2:54:07 PM):**
    *   A new file to centralize booking action definitions (`getBookingActions`).
    *   Initially defined "Edit", "View", "Copy HBL", and "Delete" actions.
    *   The "Edit" action's navigation path and state were updated to point to `/app/bookings` with `bookingData` (11/6/2025, 2:45:04 PM).
    *   "Copy HBL" and "Delete" actions were removed, simplifying the menu (11/6/2025, 2:47:21 PM).
    *   The "View" action's `onClick` logic was changed to use `setModal` to open a modal with the row data (11/6/2025, 2:52:10 PM). Icon classes were updated for consistent styling.
*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\components\screen\booking\booking-view.tsx` (Multiple timestamps between 11/6/2025, 2:58:03 PM and 11/6/2025, 4:16:58 PM):**
    *   This component was created (11/6/2025, 2:58:03 PM) and initially was a simple placeholder.
    *   It evolved into `BookingApproveContainer`, displaying booking details using `Formik`, `DynamicEditableTable`, `RadioSelectTable`, and `AppTable`.
    *   Imports were refactored, moving common components to `@components/common` and data-related imports to `data/options/global` and `data/coulmns/booking-coulmns`.
    *   The `AppStepper` component was commented out, replaced by a simple "stepper" text placeholder.
    *   The structure was updated to use MUI `Box` and `Stack` for layout, then transitioned to plain `div` elements with TailwindCSS classes for styling (11/6/2025, 4:16:58 PM).
    *   `PO_COLUMNS` and `INVENTORY_COLUMNS` were explicitly typed as `EditableTableColumn[]`.
    *   `initialRows` for `DynamicEditableTable` was updated to handle empty arrays by providing `[{}, {}]` as a fallback.
    *   The `vesselPackager` function was refactored from an anonymous function to a named function.
    *   The display label for "Agent Booking#" was changed to "Booking Request#".
*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\pages\shipment\shipment-details-page.tsx` (11/6/2025, 3:49:31 PM):**
    *   Imported `Button` and `FaBox`, `FaBuilding` icons.
    *   Added logic to display `shipment_scope` as a badge.
    *   The code for displaying POL and POD was modified to conditionally show `place_of_delivery` along with `pod` if they are different.
*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\components\common\dynamicEditable.tsx` (11/6/2025, 3:53:28 PM, 11/6/2025, 4:06:15 PM):**
    *   Imported `AutocompleteBox`.
    *   The `EditableTableColumn` interface was expanded to include `endpointKey` for `autosearch` type and `label` for `button` type.
    *   The `renderCell` logic for `autosearch` type was modified to correctly handle value changes.
    *   Removed `defaultValue` from `EditableTableColumn` interface.
    *   `Textarea` component rendering was introduced for `type === 'text-field'`.
    *   The `initialRows` prop was updated to just `data`.
*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\data\options\global.ts` (11/6/2025, 3:56:41 PM):**
    *   The `INVENTORY_OPTIONS` array was updated and moved to this file from `../../../data/options`.
*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\components\common\radio-selectable-table.tsx` (11/6/2025, 3:58:08 PM):**
    *   Created this new component, likely to allow selection of a single row in a DataGrid via radio buttons.
*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\store\api\booking-api.ts` (11/6/2025, 4:00:18 PM):**
    *   Added a new `tagType: "CUSTOMER_APPROVE"`.
    *   New endpoints `fetchCustomerApproveDetails` (query) and `saveBookingStatus` (mutation) were added, associated with the `CUSTOMER_APPROVE` tag.
    *   The `saveBookingStatus` mutation URL was updated to include `params.agent_booking_id`.

**Patterns and Recurring Elements:**

*   **Redux Toolkit (RTK) Query:** Heavy reliance on RTK Query for data fetching and state management (`useFetchShipmentDataQuery`, `useFetchCartDataQuery`, `useFetchDeliveryDataQuery`, `useFetchBookingDashboardDataQuery`, `useFetchCustomerApproveDetailsQuery`, `useSaveBookingStatusMutation`). This indicates a consistent approach to data handling.
*   **Filter and Pagination Logic:** Repeated patterns for handling pagination (`handlePage`, `handlePageSizeChange`) and filters (`handleFilterChange`, `handleClearFilters`) across different dashboard components. These functions dispatch Redux actions to update the respective slices.
*   **Component Reusability:** Introduction and modification of generic UI components like `TMenu`, `DynamicEditableTable`, and `RadioSelectTable` suggest an effort to create reusable building blocks.
*   **Local Storage Usage:** The `global-slice.ts` and `layout.tsx` files show a pattern of using `localStorage` to persist user-specific or selected customer data, likely for improved user experience across sessions.
*   **Date Formatting:** Consistent use of `moment` library and custom `useDateFormate` hook for formatting dates.
*   **UI/UX Enhancements:** Changes reflect a focus on improving the user interface, including better filtering options, action menus, and modal pop-ups for detailed views.
*   **Booking Workflow:** A significant part of the changes revolves around a "Booking" feature, including a dashboard, a detailed view for approval/cancellation, and related API integrations. This indicates active development in a booking management module.
*   **Role-based Access Control:** The `access` object in `booking-dashboard.tsx` and `action.tsx` implies that different actions or menu items are displayed based on user roles (e.g., `bookingMenu`, `adminMenu`).

## 4:18:19 PM
The provided log details code changes across four files: `AuthRoutes.ts`, `dashboardService.ts`, `UserService.ts`, and `bookingService.ts`.

### File-Specific Updates:

1.  **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-backend-v2\src\routes\AuthRoutes.ts`**
    *   **Timestamp:** 11/5/2025, 12:54:56 PM
    *   **Updates:** A single `AuthRoutes.get` endpoint for `Paths.Auth.GetUserInfo` was added. This route logs the `req.user` object and returns it in the response with an HTTP 200 OK status, providing basic user information.

2.  **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-backend-v2\src\services\dashboardService.ts`**
    *   **Timestamps:** Multiple changes between 11/5/2025, 6:04:50 PM and 11/5/2025, 11:23:11 PM.
    *   **Key Updates for `getDashboardCardInfo`:**
        *   **Initial (6:04:50 PM):** Introduced logic to fetch dashboard card information (e.g., pending departure, in transit, ETA within 1 week, out for delivery) based on `fromDate`, `toDate`, and `CompanyName` from `req.query`. It used `buildMtrUserCondition` for user-specific data filtering.
        *   **Dynamic CompanyName (8:41:51 PM):** The `CompanyName` parameter for filtering was no longer taken directly from `req.query`. Instead, it was dynamically retrieved using `getUserObject` based on the authenticated user and `req.query.companyname`/`req.query.access`. The `CompanyName` variable was also removed from the destructuring of `req.query`.
        *   **Logging & Refinements (8:42:22 PM, 10:41:50 PM, 10:44:51 PM, 11:10:55 PM):** Minor logging statements were added for `req.CompanyName` and `result[0]`, and a specific log tag `1234` was added to a SQL query log. The type assertion for `req.query` was cleaned up.
        *   **User Condition Exclusion (10:43:59 PM, 11:07:02 PM):** The `useWhere` condition, which applies user-specific filtering, was commented out, effectively disabling this layer of filtering for dashboard cards. This change persisted.
        *   **Reverted CompanyName Retrieval & SQL Injection Fix (11:07:02 PM, 11:13:53 PM):** The logic to derive `CompanyName` using `getUserObject` was commented out, reverting to directly extracting `CompanyName` from `req.query`. A significant security improvement was made in the final `baseQuery` construction to safely incorporate `CompanyName` by converting it to lowercase and escaping single quotes (`CompanyName?.replace(/'/g, "''")`) to prevent SQL injection.
    *   **Key Updates for `getDeliveryData`:**
        *   **Initial (6:04:50 PM):** Fetched delivery or vessel arrival data based on `type` and `mode` from `req.query`. It initially used `buildMtrUserCondition` for user-specific filtering, but notably, `CompanyName` was not explicitly extracted for this function's query filters, leading to a potential oversight in early versions.
        *   **Dynamic CompanyName & SQL Injection Vulnerability (10:46:26 PM):** `CompanyName` was introduced to `getDeliveryData` by using `getUserObject`. However, it was directly concatenated into the SQL query without proper escaping (`${CompanyName ? 'AND '+CompanyName : ''}`), creating a severe SQL injection vulnerability. The `useWhere` user condition was also dropped from the SQL.
        *   **SQL Injection Fix & Query Refinement (10:51:27 PM):** The SQL injection vulnerability was addressed by introducing a `companyFilter` variable that correctly lowercases the company name and escapes single quotes (`CompanyName.replace(/'/g, "''")`). This `companyFilter` was then safely applied to the `sqlQueryDelivery` and `SqlQueryVesselArrival`. The `useWhere` filter continued to be unused.
        *   **Reverted CompanyName Retrieval (11:06:35 PM):** Similar to `getDashboardCardInfo`, the `getUserObject` method for retrieving `CompanyName` was commented out, and `CompanyName` was explicitly added back to the destructured `req.query` object for `getDeliveryData`.
        *   **Logging (11:11:09 PM):** A `console.log` for `companyFilter` was added.
        *   **Final State (11:13:53 PM):** The function stabilized with `CompanyName` directly from `req.query`, and the `companyFilter` remaining in place for safe SQL integration.

3.  **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-backend-v2\src\services\UserService.ts`**
    *   **Timestamps:** Multiple, identical entries at 11/5/2025, 8:51:00 PM, 8:51:15 PM, and 8:51:46 PM.
    *   **Updates:** This file defines several user-related service functions:
        *   `login`: Handles user authentication against `mtr_user_master`, generating a JWT token upon successful login. It also checks for inactive accounts.
        *   `saveUserPreferences`: Manages user preferences in `v2_user_details`, supporting various notification and display settings (e.g., date format, email alerts). Uses `ON CONFLICT DO UPDATE` for upsert functionality.
        *   `fetchUserPreferences`: Retrieves stored user preferences, joining data from `mtr_user_master` and `v2_user_details`.
        *   `saveInviteLog`: Logs user invitations to `v2_user_invite_log` and sends an invitation email.
        *   `fetchAllCompanyUser`: Fetches both active registered users and pending invited users for a specific company.
        *   `userSettings`: Retrieves specific user settings like `date_format`.
        *   An `all` object exports these functions for modular access.

4.  **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-backend-v2\src\services\shipmentService.ts`**
    *   **Timestamp:** 11/6/2025, 1:27:09 PM
    *   **Updates:** This file introduces a comprehensive `getAll` function for fetching shipment data with advanced filtering and pagination.
        *   It leverages a new `SqlQueryBuilder` class to construct dynamic SQL queries for data retrieval and total record counts.
        *   Filters include `pol`, `pod`, `shipment_id`, `status`, `fromDate`, `toDate`, `orderBy`, `cardFilter`, `contno`, and `viewType`.
        *   The `SqlQueryBuilder` incorporates user-specific access control based on roles (ADMIN, CUSTOMER, FRONTOFFICE, AGENT) and builds conditions for various "card filters" (e.g., pending departure, in transit).
        *   The `getAll` function also processes raw tracking data to derive a more user-friendly `ShipmentStatus` (e.g., Pending, Loading, Departed, Arrived, Delivered, Custom Hold) based on dates and events.

5.  **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-backend-v2\src\services\bookingService.ts`**
    *   **Timestamps:** Multiple changes between 11/6/2025, 2:02:45 PM and 11/6/2025, 2:27:15 PM.
    *   **Key Updates for `BookingQueryBuilder` and `getAll`:**
        *   **Initial (2:02:45 PM):** Introduced `BookingQueryBuilder` for dynamic query construction for booking data, supporting pagination, sorting, user roles, search, and date range filtering (`bookingdate`). The `selectedColumns` included basic booking and cargo details.
        *   **Added Cargo Ready Date (2:05:16 PM):** `abe.est_cargo_ready_date` was added to the selected columns.
        *   **Cargo Ready Date Filtering (2:16:39 PM):** New properties `CargoReadyFromDate` and `CargoReadyToDate` were added to `BookingQueryBuilder`, and the `setDateRange` method was extended to allow filtering by `est_cargo_ready_date` in addition to `bookingdate`. The `getAll` endpoint was updated to pass these new query parameters.
        *   **Attempted Refactoring of Where Clauses (2:26:13 PM):** The `whereClauses` property in `BookingQueryBuilder` was refactored from a single string to an array (`string[]`) to allow for more modular accumulation of `WHERE` conditions. A new private `addDateRangeClause` method was introduced to push conditions into this array.
        *   **Partial Revert (2:27:15 PM):** This refactoring was largely reverted. `whereClauses` was changed back to a single string, and the private `addDateRangeClause` (that used the array) was removed. The public `addDateRangeClause` (that appended to `extraConditions`) was re-instated to its original form, indicating a decision to stick with the previous method of accumulating conditional clauses.

### Patterns and Recurring Elements:

*   **Dynamic SQL Query Building:** A strong pattern across `dashboardService.ts`, `shipmentService.ts`, and `bookingService.ts` is the use of dedicated query builder classes (`SqlQueryBuilder`, `BookingQueryBuilder`) to dynamically construct SQL queries. This allows for flexible filtering, sorting, and pagination based on user input and roles.
*   **User-Centric Data Filtering:** All service files consistently implement mechanisms to filter data based on the authenticated user's role (Admin, Customer, Front Office, Agent) and associated company or location. Functions like `buildMtrUserCondition` and `getUserObject` are central to this.
*   **Query Parameter Handling:** There's heavy reliance on `req.query` for receiving diverse filtering, sorting, and pagination parameters from the frontend.
*   **Error Handling and Logging:** Robust error handling with `try-catch` blocks and detailed logging (`logger.info`, `logger.error`, `console.log`) is consistently applied across all service functions for debugging and operational monitoring.
*   **SQL Injection Prevention:** An evolving pattern, particularly visible in `dashboardService.ts`, is the active effort to prevent SQL injection by safely escaping user-provided string inputs (e.g., `CompanyName.replace(/'/g, "''")`) before incorporating them into dynamic SQL queries. Some early versions showed vulnerabilities that were later addressed.
*   **Timestamp Clutter:** There are instances of multiple timestamps for the same file with identical (or almost identical) code, suggesting frequent save operations during development without significant functional changes between them.
*   **Focus on Core Business Logic:** The changes primarily revolve around implementing and refining backend logic for fetching, filtering, and managing shipment, dashboard, and booking data, as well as user authentication and preferences.

## 5:18:23 PM
The code changes, all occurring on 11/6/2025, primarily focus on developing and refining a "Booking" feature within a frontend application, specifically concerning the booking dashboard, action menus, and a detailed booking approval view.

**File-Specific Updates:**

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\data\coulmns\booking-coulmns.tsx`**
    *   **(2:38 PM - 2:43 PM)** Initial development and rapid iteration on the `GET_BOOKING_COULMN` function. The `Action` column's render logic was updated to use a `TMenu` component, initially with a `PencilIcon` button, then changed to an `EllipsisVerticalIcon`. The function signature was also refactored to remove the `handleEdit` prop and reorder parameters (`access`, `setModal`, `nav`).
    *   **(4:01 PM - 4:02 PM)** New column definitions were introduced: `BOOKING_VESSEL_COLUMN_CUSTOMER` for vessel details (including date formatting via `appDateFormat`) and `ROUTING_COLUMNS` for routing information.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\components\screen\booking\action.tsx`**
    *   **(2:40 PM - 2:47 PM)** The `getBookingActions` function, which defines menu items for booking actions, underwent several changes. Initially, it included "Edit", "View", "Copy HBL", and "Delete" options. The "Edit" navigation path was updated from `/app/master/customer/gst-location` to `/app/bookings`. The "Copy HBL" and "Delete" actions were then removed, leaving only "Edit" and "View".
    *   **(2:52 PM - 2:54 PM)** The "View" action's behavior was altered multiple times: first to navigate to an invoice view, then to trigger a modal with booking data, changing its icon (from `TrashIcon` to `EyeIcon`) and label styling. The "Edit" action also had minor icon styling adjustments.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\components\common\t-menu.tsx`**
    *   **(2:41 PM)** A generic `TMenu` component was introduced, featuring dynamic menu items, a customizable button icon, and portal-based positioning for the dropdown menu. It also includes logic for conditional `params` passing to menu item `onClick` handlers.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\components\screen\booking\booking-dashboard.tsx`**
    *   **(2:42 PM - 2:57 PM)** The `BookingDashboard` component was updated to include state for a modal (`modal`), which was initially used for "Invoice Reversal" but later replaced with `BookingView`. The `setModal` prop was consistently passed to the column definitions.
    *   **(4:13 PM - 4:36 PM)** The `BaseModal` size for displaying `BookingView` was repeatedly adjusted (`2xl` to `4xl`), and its `className` prop was modified several times to control width and centering, eventually settling on a `size="4xl"` and a `w-full` className for the modal's content wrapper.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\components\screen\booking\booking-view.tsx`**
    *   **(2:58 PM)** Initially created as a placeholder `BookingView`.
    *   **(3:42 PM)** Underwent a significant transformation, being renamed to `BookingApproveContainer` and evolving into a complex form. This new component heavily relies on `Formik` for state management and integrates several sub-components like `DynamicEditableTable`, `RadioSelectTable`, `AppTable`, and various `@mui` components for structured data display and input. It handles API interactions for fetching booking details (`useFetchCustomerApproveDetailsQuery`) and saving booking status (`useSaveBookingStatusMutation`), with `react-hot-toast` for user feedback.
    *   **(3:50 PM - 4:28 PM)** Numerous iterative changes focused on component imports, initial column definitions, styling (transitioning between MUI `Stack`/`Box` and Tailwind CSS `div` layouts multiple times, then back to MUI with custom Tailwind overrides), and minor logical adjustments for tables (e.g., ensuring default empty rows).
    *   **(4:48 PM - 4:59 PM)** Fine-tuning of column properties (`width` for `PO_COLUMNS`, `INVENTORY_COLUMNS`) and header layout. Introduced location markers (`HiLocationMarker`, `MdOutlineArrowForward`) and a commented-out `Stepper` component for displaying origin/destination.
    *   **(5:02 PM - 5:07 PM)** Further adjustments to console logging within `Formik`'s render prop and added an optional chaining operator to `bookingData?.vessel_details?.find`.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\data\options\global.ts`**
    *   **(3:56 PM)** The `INVENTORY_OPTIONS` array, used for container types, was defined in this global options file.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\components\common\dynamicEditable.tsx`**
    *   **(3:53 PM)** A generic `DynamicEditableTable` component was introduced, capable of rendering various input types (text, select, date, checkbox) based on column configuration, and supporting row additions and deletions.
    *   **(4:06 PM)** Minor changes.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\components\common\radio-selectable-table.tsx`**
    *   **(3:58 PM)** A `RadioSelectTable` component was added, utilizing `@mui/x-data-grid` to display data with radio buttons for single row selection.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\store\api\booking-api.ts`**
    *   **(4:00 PM)** The `bookingApi` was extended with new RTK Query endpoints: `fetchCustomerApproveDetails` and `saveBookingStatus`, essential for the booking approval workflow. These endpoints also specify `tagTypes` for cache invalidation (`CUSTOMER_APPROVE`, `add`).

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\pages\shipment\shipment-details-page.tsx`**
    *   **(3:49 PM)** A `ShipmentDetailsPage` component was introduced for displaying shipment tracking, messages, and documents. It utilizes a `BaseModal` for document uploads.

**Patterns and Recurring Elements:**

*   **Rapid Iteration and Refinement:** The frequent timestamps on the same files, especially `booking-coulmns.tsx` and `booking-view.tsx`, indicate rapid development, refactoring, and debugging, particularly in the mid-afternoon (3:00 PM - 5:00 PM).
*   **Modular Component Design:** The creation and extensive use of reusable common components like `TMenu`, `DynamicEditableTable`, `RadioSelectTable`, `BaseModal`, `Card`, `AppTable`, and `InputBox` is a clear pattern.
*   **Data-Driven UI:** Column definitions are externalized (`data/coulmns`), and options for select inputs are managed centrally (`data/options/global.ts`).
*   **State Management Consistency:** `useState` for local component state and Redux Toolkit Query for global data fetching and mutation are consistently applied.
*   **Styling with Tailwind CSS and MUI:** A hybrid approach to styling is visible, with both `@mui/material` components (like `Box`, `Stack`, `Divider`) and custom Tailwind CSS classes (`flex`, `gap-2`, `p-1`, `shadow-inner`, `max-h-[500px]`, `w-full`) being used, sometimes with back-and-forth adjustments in their application.
*   **Feature Expansion:** The primary goal of these changes seems to be the implementation and robustification of a booking approval workflow, including viewing booking details, modifying PO and inventory, selecting vessels, and approving/cancelling bookings.

## 5:18:36 PM
Changes across the backend project highlight continued development in dashboard functionality, user management, shipment tracking, and booking management.

**File-Specific Updates:**

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-backend-v2\src\routes\AuthRoutes.ts`**
    *   **Timestamp: 11/5/2025, 12:54:56 PM**
    *   An authentication route (`/auth/verify-token`) was added to provide authenticated users with their basic information (`req.user`).

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-backend-v2\src\services\dashboardService.ts`**
    *   **Initial State (11/5/2025, 6:04:50 PM):** Introduced `getDashboardCardInfo` for aggregate shipment metrics (e.g., Pending Departure, In Transit, ETA within 1 week, Out for Delivery) and `getDeliveryData` for detailed delivery/vessel arrival information. Both functions incorporated user-specific conditions.
    *   **Timestamp: 11/5/2025, 8:41:51 PM:** `getDashboardCardInfo` was updated to fetch the `CompanyName` dynamically using `getUserObject` from the `analytics` utility instead of directly from `req.query`, implying more sophisticated company determination logic.
    *   **Timestamp: 11/5/2025, 10:41:50 PM:** The `buildMtrUserCondition` result (`useWhere`) was commented out for `getDashboardCardInfo`, suggesting a change in how general user-based conditions are applied to dashboard card metrics.
    *   **Timestamp: 11/5/2025, 10:46:26 PM:** `getDeliveryData` began dynamically fetching `CompanyName` via `getUserObject` and started using it as a direct SQL filter, replacing the `useWhere` condition previously present in the `sqlQueryDelivery` and `SqlQueryVesselArrival` queries.
    *   **Timestamp: 11/5/2025, 10:51:27 PM:** A security and robustness improvement was made in `getDeliveryData` by introducing a `companyFilter`. This filter now explicitly sanitizes `CompanyName` by escaping single quotes and applies `LOWER()` for case-insensitive comparison, mitigating potential SQL injection risks.
    *   **Timestamp: 11/5/2025, 11:06:35 PM - 11/5/2025, 11:07:02 PM:** Both `getDashboardCardInfo` and `getDeliveryData` had their `getUserObject` calls for `CompanyName` commented out. `CompanyName` was reverted to being directly destructured from `req.query` for these functions, though the improved `companyFilter` logic remained for `getDeliveryData`.
    *   **Timestamp: 11/5/2025, 11:13:53 PM:** `getDashboardCardInfo` also adopted the safe `CompanyName` filtering (including `LOWER()` and single-quote escaping) within its `baseQuery` construction, aligning with the security enhancements in `getDeliveryData`.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-backend-v2\src\services\UserService.ts`**
    *   **Timestamp: 11/5/2025, 8:51:00 PM** (and identical subsequent entries)
    *   This file provides a suite of user-related functionalities: `login` (user authentication with JWT token generation, noting direct string concatenation for credentials as a potential vulnerability), `saveUserPreferences`, `fetchUserPreferences`, `saveInviteLog` (including email sending), `fetchAllCompanyUser`, and `userSettings`. Most database operations, except `login`, use parameterized queries.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-backend-v2\src\services\shipmentService.ts`**
    *   **Timestamp: 11/6/2025, 1:27:09 PM**
    *   A comprehensive `getAll` function was introduced for retrieving shipment data. It utilizes an `SqlQueryBuilder` class to dynamically construct SQL queries, supporting advanced filtering (pagination, POL/POD, shipment ID, status, date ranges, container number, and specific dashboard-related "card filters"). The service also includes logic to derive and assign various shipment statuses (e.g., Pending, In-Transit, Delivered) based on tracking data timestamps. User-based access control is implemented, segmenting data by roles such as Admin, Customer, FrontOffice, and Agent.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-backend-v2\src\services\bookingService.ts`**
    *   **Initial State (11/6/2025, 2:02:45 PM):** Introduced a `BookingQueryBuilder` class for constructing booking-related SQL queries, along with `getAll` for fetching bookings and `saveBooking` for handling booking creation/updates. Role-based filtering was already in place.
    *   **Timestamp: 11/6/2025, 2:05:16 PM:** Added `est_cargo_ready_date` to the selected columns when fetching booking data.
    *   **Timestamp: 11/6/2025, 2:16:39 PM:** The `BookingQueryBuilder` and `getAll` function were enhanced to include filtering by `cargoReadyFromDate` and `cargoReadyToDate`, expanding search capabilities.
    *   **Timestamp: 11/6/2025, 2:26:13 PM:** An attempt was made to refactor `BookingQueryBuilder` to use an array for `whereClauses` for more modular condition building.
    *   **Timestamp: 11/6/2025, 2:27:15 PM:** This refactoring of `whereClauses` to an array was reverted, returning to its previous string-based implementation.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-backend-v2\src\common\constants\Paths.ts`**
    *   **Timestamp: 11/6/2025, 5:06:22 PM:** New routes were added under `Booking` for `getBookingApproveDetails` (`/booking_approve/:agent_booking_id`), indicating new functionality related to fetching booking approval specifics. Base paths for `Audit` and `Company` were also introduced.
    *   **Timestamp: 11/6/2025, 5:13:57 PM:** Another booking route, `createBookingApproveDetails` (also `/booking_approve/:agent_booking_id`), was added, likely for handling POST requests to create or update approval records.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-backend-v2\src\routes\BookingRoutes.ts`**
    *   **Timestamp: 11/6/2025, 5:06:41 PM:** A GET route was registered for `Paths.Booking.getBookingApproveDetails`, mapping to the `getBookingApproveDetails` service function.
    *   **Timestamp: 11/6/2025, 5:15:38 PM:** A POST route was registered for `Paths.Booking.createBookingApproveDetails`, mapping to the `updateBookingApproveDetails` service function.

**Patterns and Recurring Elements:**

*   **Dynamic SQL Query Building:** A consistent pattern across `dashboardService`, `shipmentService`, and `bookingService` is the use of dedicated query builder classes (`SqlQueryBuilder`, `BookingQueryBuilder`). These classes dynamically construct complex SQL queries based on various filters, pagination parameters, and user roles, promoting modularity and reusability.
*   **Role-Based Access Control (RBAC):** All data retrieval services (`dashboardService`, `shipmentService`, `bookingService`) implement robust role-based access control. They filter data based on the authenticated user's role (e.g., Admin, Customer, FrontOffice, Agent) to restrict visibility to relevant companies or locations.
*   **SQL Injection Mitigation:** There's an ongoing effort to improve SQL query safety, particularly visible in `dashboardService.ts`. The introduction of `CompanyName.replace(/'/g, "''")` and `LOWER()` functions for dynamic values demonstrates a focus on preventing SQL injection vulnerabilities. However, some direct string concatenations, notably in the `UserService.ts` login function, remain.
*   **Extensive Logging and Debugging:** Frequent `console.log` and `logger.info`/`logger.error` statements are pervasive throughout the modified code. This indicates an active development process with a strong emphasis on tracing execution flow, debugging parameters, and monitoring results.
*   **Date Range Filtering Enhancements:** Multiple services received updates to support filtering data by various date ranges (e.g., `departure_date`, `bookingdate`, `est_cargo_ready_date`), signifying a common requirement for time-based data analysis and reporting.
*   **Dashboard and Shipment Focus:** Both `dashboardService` and `shipmentService` are heavily involved in tracking and displaying shipment-related data, with `dashboardService` providing summarized metrics and `shipmentService` offering detailed lists and status derivations.
*   **Booking Workflow Development:** Significant work is being done on the booking management system, including capabilities to list bookings, apply various filters, and new endpoints for handling booking approval details (fetching and updating).

## 6:18:22 PM
The code change log predominantly features updates across three files: `dynamicEditable.tsx`, `booking-view.tsx`, and `booking-dashboard.tsx`, all occurring on **11/6/2025** within a concentrated period between **4:06 PM and 6:17 PM**.

**File-Specific Updates:**

1.  **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\components\common\dynamicEditable.tsx` (Timestamp: 11/6/2025, 4:06:15 PM)**
    *   This file defines a highly configurable `DynamicEditableTable` React component.
    *   It was either newly created or underwent a major refactor to support various column types (`text`, `select`, `date`, `checkbox`, `autosearch`, `datetime-local`, `button`, `label`, `text-field`).
    *   The component handles data changes, row additions, and deletions. It features a sticky header and dynamic rendering of input fields based on column types.
    *   A notable detail is the "button" type column, which can display a "Repeat" button that changes to a "Trash" icon if `isRepeated` is true.

2.  **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\components\screen\booking\booking-view.tsx` (Frequent changes between 4:07:55 PM and 6:17:36 PM)**
    *   This component, `BookingApproveContainer`, is responsible for displaying and managing the approval/cancellation of booking requests.
    *   **Initial Structure and Data Handling (around 4:07 PM):** It utilizes `Formik` for form management, `react-hot-toast` for notifications, and Redux Toolkit Queries (`useFetchCustomerApproveDetailsQuery`, `useSaveBookingStatusMutation`) for API interactions. It displays PO Details, Inventory Required, Vessel Details, and Routing Details using `DynamicEditableTable`, `RadioSelectTable`, and `AppTable`.
    *   **UI Layout and Styling Iterations (4:16 PM - 4:28 PM):** The component underwent significant, rapid iterations in its layout. It frequently switched between using Material-UI `Stack`, `Box`, `Divider` components and direct Tailwind CSS `div` elements for structuring the content. There were repeated adjustments to padding, margins (`ml-20`, `ml-50`), component widths (`w-[200px]`, `w-[350px]`, `w-[1200px]`), and box shadows, indicating fine-tuning of the visual presentation. At one point, Material-UI components were largely replaced by plain divs and Tailwind classes, only to be largely reverted.
    *   **Component and Logic Enhancements:**
        *   Explicit typing for table columns (`EditableTableColumn[]`) was introduced (4:12 PM).
        *   The label "Agent Booking#" was updated to "Booking Request#" (4:14 PM).
        *   `width` properties for table columns were added and then removed several times (4:12 PM, 4:27 PM, 4:48 PM, 4:49 PM).
        *   Introduction of `HiLocationMarker` and `MdOutlineArrowForward` icons to display `pol` and `pod` (4:51 PM).
        *   A `Stepper` component was briefly added and then commented out (4:53 PM - 4:56 PM).
        *   Improved conditional fetching logic using `skip` in `useFetchCustomerApproveDetailsQuery` to prevent unnecessary API calls (5:02 PM).
        *   Refactoring of `handleApproval` to include more robust reason validation, `try-catch` blocks for API calls, and redirection logic (`window.location.href` to `/dashboard`, then `useNavigate` to `/app/bookings/dashboard`) upon successful operation (5:23 PM - 5:33 PM).
        *   The `onClose` prop was added to the component to facilitate modal closure after actions (5:19 PM).
        *   Header styling was refined, changing background colors and text styles (6:10 PM).
        *   The text of the "Not Approved" button was changed to "Reject" (6:17 PM).
    *   **Data Handling Refinement:** Initial values for `DynamicEditableTable` were adjusted to ensure empty arrays (`[]`) are passed when `po_details` or `inventory_details` are empty, preventing default `[{}, {}]` behavior in some cases (6:05 PM).

3.  **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\components\screen\booking\booking-dashboard.tsx` (Frequent changes between 4:13:06 PM and 6:13:54 PM)**
    *   This component manages the booking dashboard, displaying a list of bookings and filtering/sorting options.
    *   **Modal Integration and Sizing:** The `BaseModal` component is used to display `BookingView`. There were frequent adjustments to the `size` prop and `className` of the `BaseModal` (`"2xl"`, `"3xl"`, `"4xl"`, with `max-w` and `w-full` classes) to control the size and responsiveness of the displayed booking details modal (4:13 PM, 4:23 PM, 4:24 PM, 4:29 PM, 4:36 PM).
    *   **Data Display Correction (around 5:58 PM - 6:04 PM):** There was a correction in how booking counts (Approved, Confirmed) were displayed on the dashboard cards, ensuring the correct data (`counts.approved`, `counts.confirmed`, `counts.pending`) was mapped to the appropriate status cards.
    *   **Modal Title Update:** The `title` prop of `BaseModal` was updated from "Invoice Reversal" to "View Booking Details" (6:13:54 PM).

4.  **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\components\common\modal.tsx` (Timestamps: 11/6/2025, 4:38:16 PM, 11/6/2025, 4:38:46 PM)**
    *   This file defines a generic `BaseModal` component.
    *   Changes indicate an effort to improve modal sizing flexibility by passing a `className` prop to the internal `Dialog` and setting `w-full` on the `DialogBody`.

**Patterns and Recurring Elements:**

*   **UI Refinement Focus:** The overwhelming majority of changes across `booking-view.tsx` and `booking-dashboard.tsx` are related to UI layout, styling, and user experience. This includes adjusting component widths, margins, paddings, shadows, and the integration of new visual elements (icons, stepper).
*   **Iterative Development:** The rapid succession of timestamps for `booking-view.tsx` and `booking-dashboard.tsx` with similar types of changes (especially UI adjustments and reordering) suggests an iterative development process, likely involving immediate testing and refinement.
*   **Component Reusability:** The `DynamicEditableTable` is a central piece, indicating an effort to build reusable UI components. Its own definition also received an initial significant update.
*   **Data-Driven UI:** Components heavily rely on data (`data`, `bookingData`) to render content and determine UI states (e.g., button disabled states based on `booking_status`).
*   **Form Management:** `Formik` is consistently used for handling form state and submissions, while RTK Query manages data fetching and mutations efficiently.
*   **User Feedback:** `react-hot-toast` is a recurring element for providing immediate feedback to the user on actions.
*   **Conditional Logic:** Frequent use of conditional rendering and logic (e.g., `if (!data) return null;`, `skip: !data?.agent_booking_id`, `values?.po_details?.length ? ... : ...`) to handle different data states and prevent errors.

## 6:18:26 PM
The log captures changes across several backend files, primarily focusing on `AuthRoutes.ts`, `dashboardService.ts`, `UserService.ts`, `shipmentService.ts`, `bookingService.ts`, and associated `Paths.ts` and `types/booking.ts` files. The changes span from November 5th to November 6th, 2025, with several quick, iterative updates occurring within minutes or seconds, often without major functional shifts between very close timestamps.

### File-Specific Updates:

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-backend-v2\src\routes\AuthRoutes.ts` (11/5/2025, 12:54:56 PM)**
    *   A new GET route `AuthRoutes.get(Paths.Auth.GetUserInfo)` was added. This endpoint is responsible for logging the requested user's information and returning it in a 200 OK response.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-backend-v2\src\services\dashboardService.ts` (Multiple timestamps between 11/5/2025, 6:04:50 PM and 11/5/2025, 11:23:11 PM)**
    *   **Initial state (6:04:50 PM - 6:06:01 PM):** The `getDashboardCardInfo` function dynamically constructs an SQL query to calculate shipment statistics (e.g., "Pending Departure", "In Transit", "ETA within 1 week", "Out for delivery") based on date ranges and a directly provided `CompanyName` from query parameters. The `getDeliveryData` function fetches delivery or vessel arrival data, using a `buildMtrUserCondition` for user-specific filtering and various query parameters (`type`, `mode`) to build dynamic SQL queries.
    *   **Significant change (8:41:51 PM):** In `getDashboardCardInfo`, the `CompanyName` parameter retrieval was updated to use `getUserObject` for dynamic resolution, indicating an enhancement in how company context is determined.
    *   **Refinement and Debugging (8:42:22 PM, 10:41:50 PM, 10:44:51 PM, 11:10:55 PM, 11:11:09 PM):** Minor logging statements (`console.log`) were added for debugging query parameters and results. The direct `CompanyName` destructuring from `req.query` was removed in favor of the `getUserObject` approach in `getDashboardCardInfo`.
    *   **User Condition Modification (10:43:59 PM):** The `if(useWhere) conditions.push(useWhere);` line was commented out in `getDashboardCardInfo`, suggesting a temporary or permanent removal of the `buildMtrUserCondition` logic for card information.
    *   **New Company Filter Logic (10:46:26 PM - 10:51:27 PM):** In `getDeliveryData`, a new company filter mechanism was introduced. It retrieves `CompanyName` via `getUserObject` and constructs a `companyFilter` SQL clause that includes SQL injection prevention (`.replace(/'/g, "''")`) and applies it to both delivery and vessel arrival queries. The original `buildMtrUserCondition` (`useWhere`) appears to be superseded or integrated differently for this specific filtering context.
    *   **Reversion and Final Refinement (11:06:35 PM, 11:07:02 PM, 11:13:53 PM):** The dynamic `CompanyName` fetching using `getUserObject` was commented out in both `getDashboardCardInfo` and `getDeliveryData`, reverting to accepting `CompanyName` directly from `req.query` (though still with SQL injection protection for `companyFilter`). The type definition for `CompanyName` in `req.query` was updated to reflect its optional nature.
    *   **No change (11:23:11 PM):** The last entry for this file shows no functional changes, indicating a save operation.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-backend-v2\src\services\UserService.ts` (Multiple timestamps between 11/5/2025, 8:51:00 PM and 8:51:46 PM)**
    *   These three entries are identical, showing no functional changes between them. The file contains several user-related service functions: `login`, `saveUserPreferences`, `fetchUserPreferences`, `saveInviteLog`, `fetchAllCompanyUser`, and `userSettings`. It handles user authentication, preferences management with upsert logic, user invitation logging, fetching company-specific user lists (active and pending invites), and retrieving individual user settings. Logging statements are prominent for tracking function calls and query execution.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-backend-v2\src\services\shipmentService.ts` (11/6/2025, 1:27:09 PM)**
    *   A new `SqlQueryBuilder` class was introduced to modularize the construction of complex SQL queries for fetching shipment data.
    *   The `getAll` function was refactored to use this builder, supporting various filters (POL, POD, status, date ranges, container number, etc.) and pagination.
    *   The service now includes detailed logic to derive a shipment's status (Pending, Loading, Departed, In-Transit, Custom Hold, Arrived, Delivered) based on multiple date fields from `mtr_tracking_data`.
    *   User role-based filtering (Admin, Customer, FrontOffice, Agent) is implemented within the `SqlQueryBuilder` to restrict data access.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-backend-v2\src\services\bookingService.ts` (Multiple timestamps between 11/6/2025, 2:02:45 PM and 11/6/2025, 6:03:51 PM)**
    *   **Initial Structure (2:02:45 PM):** Introduced a `BookingQueryBuilder` class and `getAll` function to manage booking data, supporting filtering by various booking attributes and user roles. `saveBooking` logic is partially visible, handling creation/update of booking entries.
    *   **Feature Expansion (2:05:16 PM, 2:16:39 PM):** The `est_cargo_ready_date` field was added to selected columns and new date range filtering capabilities for "cargo ready dates" were implemented in the `BookingQueryBuilder` and integrated into `getAll`.
    *   **Refactoring Attempt and Reversion (2:26:13 PM, 2:27:15 PM):** A brief attempt to refactor `whereClauses` into an array was made, but quickly reverted, indicating some refactoring instability or reconsideration.
    *   **Minor Changes & Bug Fixes (5:05:22 PM, 5:05:30 PM, 5:55:54 PM, 5:57:33 PM, 5:57:41 PM, 6:03:51 PM):** Minor imports and a fix for a typo in `buildCountQuery` (missing `DISTINCT` and `(`) were observed.
    *   **New Booking Status (6:03:28 PM):** The `BookingStatus` enum was extended with `CONFIRMED`, and the `setWhereClause` logic was updated to support filtering by this new status, along with updating the `getAll` function to count confirmed bookings.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-backend-v2\src\models\common\types\booking.ts` (11/6/2025, 6:02:57 PM)**
    *   The `BookingStatus` enum was updated to include a `CONFIRMED` status, aligning with changes in `bookingService.ts`. The `BookingQueryType` interface was implicitly updated to handle `cargoReadyFromDate` and `cargoReadyToDate`.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-backend-v2\src\common\constants\Paths.ts` (11/6/2025, 5:06:22 PM, 5:13:57 PM)**
    *   New paths for booking approval details were added: `getBookingApproveDetails` and `createBookingApproveDetails`. The `create` path uses the same URL as `get`, suggesting a differentiation by HTTP method (GET vs POST).

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-backend-v2\src\routes\BookingRoutes.ts` (11/6/2025, 5:06:41 PM, 5:15:38 PM)**
    *   Routes were added to support fetching (`GET`) and updating (`POST`) booking approval details, reflecting the new paths defined in `Paths.ts` and integrating with corresponding service functions (`getBookingApproveDetails`, `updateBookingApproveDetails`).

### Patterns and Recurring Elements:

*   **Query Builder Pattern:** Both `shipmentService.ts` and `bookingService.ts` heavily leverage a "Query Builder" class (`SqlQueryBuilder`, `BookingQueryBuilder`) to construct dynamic SQL queries. This pattern promotes modularity, reusability, and easier management of complex filtering and pagination logic.
*   **Role-Based Access Control:** A consistent pattern of applying user role-based conditions (e.g., ADMIN, CUSTOMER, FRONTOFFICE, AGENT) to restrict data visibility is evident across `dashboardService.ts`, `shipmentService.ts`, and `bookingService.ts`. This is typically achieved via `buildMtrUserCondition` or direct role checks within query builders.
*   **Iterative Development & Debugging:** Many commits within a short timeframe often show identical code or minor additions like `console.log` statements and unique logging prefixes (`1234`). This suggests active development, testing, and debugging.
*   **SQL Injection Prevention:** The introduction of `.replace(/'/g, "''")` for sanitizing `CompanyName` in `dashboardService.ts` demonstrates a focus on security by preventing SQL injection vulnerabilities when constructing dynamic queries.
*   **Dashboard/Tracking Focus:** A significant portion of changes revolves around enhancing data retrieval and filtering for dashboard and shipment tracking functionalities, including complex status derivation and multi-faceted query parameters.
*   **Booking Management Features:** New features for booking management include tracking additional date fields (cargo ready date), managing various booking statuses (including a new "Confirmed" status), and dedicated endpoints for booking approval processes.

## 7:18:27 PM
The log details changes across three frontend files, primarily focusing on booking management components. All timestamps fall on **11/6/2025**, indicating a concentrated period of development.

**File-Specific Updates:**

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\components\screen\booking\booking-view.tsx`**
    *   **Initial State (4:25:32 PM):** The `BookingApproveContainer` component is a React form for approving/cancelling booking requests, displaying PO, inventory, vessel, and routing details in various table components. It includes reason validation and API calls to save booking status.
    *   **Early Styling Adjustments (4:25 PM - 4:28 PM):** Minor changes were made to the form's `className` attributes (e.g., `w-full`, `max-w-[1500px]`, `mx-auto`) and the width of the "Inventory Required" card (briefly set to `w-[200px]` then `w-[2000px]`, then removed). The `overflow-y-auto` property for the scrollable body was temporarily removed and re-added.
    *   **Refactor and Cleanup (4:31:41 PM):** Significant cleanup occurred, removing unused MUI imports (`Box`, `Divider`, `Stack`), commenting out `AppStepper`, removing redundant `console.log`s, and improving the structure with `h-full flex flex-col` classes. The `InputBox` for 'Reason' was correctly named `name="reason"`.
    *   **UI/UX Enhancements (4:35:47 PM - 4:56:30 PM):**
        *   The scrollable body was adjusted to use `flex-1` for better layout.
        *   The 'Reason' `InputBox` gained `ref` and `error` props for validation feedback.
        *   Widths were removed from several `PO_COLUMNS` and `INVENTORY_COLUMNS` definitions, allowing for more flexible rendering.
        *   Styling from the header `div` (box-shadow, success color from `DirectionsBoatFilledOutlined`) was removed, indicating a shift towards global or Tailwind-based styling.
        *   Icons (`HiLocationMarker`, `MdOutlineArrowForward`) were introduced to visually represent POL (Port of Loading) and POD (Port of Discharge) in the header.
        *   A `Stepper` component was briefly imported and integrated into the header for `trackingDetails` but later commented out.
    *   **Functional Refinements (5:20:55 PM - 5:32:32 PM):**
        *   The `useFetchCustomerApproveDetailsQuery` was updated with a `skip` option for conditional fetching, preventing calls with null `agent_booking_id`.
        *   The component now accepts an `onClose` prop, enabling it to signal closure to a parent component (e.g., a modal).
        *   The `handleApproval` function was refactored with a `try...catch` block for robust error handling, toast notifications for success/failure, and a redirect to `/app/bookings/dashboard` upon successful approval using `useNavigate`.
        *   A loading UI was added for `isFetchLoading` state.
    *   **Location Path Component (5:30:00 PM - 7:03:33 PM):** A dedicated functional component `LocationPath` was introduced to encapsulate the visual display of POL and POD using SVG icons and a connecting line, enhancing the clarity of the booking route.
    *   **Table Enhancements (5:36:46 PM - 6:38:23 PM):** `hideAddRowIcon={true}` was added to `DynamicEditableTable` components for 'PO Details' and 'Inventory Required', indicating these tables might no longer allow users to add new rows directly in this view. `PO_COLUMNS` was expanded to include `supplier`, `qty`, and `no_of_packages`.
    *   **Final Layout Adjustments (6:10:19 PM - 6:29:14 PM):** The header's "Booking Request #" section was re-styled or removed in various iterations, eventually being replaced by the `LocationPath` component. Styling classes (`ml-50`, `w-[350px]`) were tweaked for layout. The "Reject" button text was explicitly set.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\components\screen\booking\booking-dashboard.tsx`**
    *   **Modal Integration & Styling (4:36:48 PM):** The `BaseModal` wrapping `BookingView` was styled to take full width and height (`className="w-full h-full"`).
    *   **Modal Functionality (5:18:51 PM):** The `onClose` prop was passed from the dashboard's `setModal` function to `BookingView`, allowing the modal to be closed by actions within `BookingView`.
    *   **Dashboard Card Data Correction (5:58:58 PM):** The counts for "Approved Booking" and "Confirmed Booking" cards were corrected to pull data from `bookingDashboardCartData?.counts?.approved` and `bookingDashboardCartData?.counts?.confirmed` respectively, instead of `pending` or `approved` fields.
    *   **Dynamic Modal Title (6:04:09 PM - 6:24:35 PM):** The `BaseModal`'s title was made dynamic to display the specific `agent_booking_id` of the booking being viewed.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\components\common\modal.tsx`**
    *   **Dialog Body Sizing (4:38:16 PM):** The `DialogBody` component had its `max-w-md` class removed and `w-full` added, ensuring its content stretches to the full width of the modal.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\store\api\booking-api.ts`**
    *   **API Invalidation Tag Adjustment (6:42:10 PM):** The `saveBookingStatus` mutation's `invalidatesTags` was updated to remove `"bookingDashboardData"`, implying that saving a booking status no longer directly invalidates the entire dashboard data cache.

**Patterns and Recurring Elements:**

*   **Refactoring and Cleanup:** Across files, there's a recurring pattern of removing commented-out code, unused imports, and redundant `console.log` statements, indicating an emphasis on clean code.
*   **UI Component-driven Development:** Components like `DynamicEditableTable`, `RadioSelectTable`, `AppTable`, `InputBox`, and `Card` are foundational, with styling and behavior adjusted through props and Tailwind CSS classes.
*   **State Management and API Interaction:** `useState`, `useRef`, `Formik`, Redux Toolkit Query (`useFetch...Query`, `useSave...Mutation`) are consistently used for managing local component state, form data, and interactions with a backend API.
*   **User Feedback:** `react-hot-toast` is heavily utilized to provide clear success/error messages to the user after actions.
*   **Dynamic Styling:** Frequent modifications to Tailwind CSS classes (e.g., `w-full`, `h-full`, `p-`, `ml-`, `gap-`) suggest an iterative process of layout and style adjustments.
*   **Conditional Rendering and Data Handling:** Extensive use of optional chaining (`?.`), nullish coalescing (`??`), and ternary operators to safely access data and render UI elements based on data availability or specific conditions.
*   **Navigation:** `useNavigate` for programmatic routing, particularly after form submissions.