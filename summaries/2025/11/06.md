# Activity Summary for 11/6/2025

## 9:48:47 AM
The log details a series of code changes within a frontend application (T360-frontend-v2), primarily focusing on the dashboard, sidebar, and core layout components, along with related Redux slices and API integrations. The changes occurred between 11/5/2025, 2:54:04 PM and 11/5/2025, 11:28:59 PM.

### File-Specific Updates:

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\components\core\sidebar-layout.tsx`**
    *   **Timestamp: 11/5/2025, 2:54:04 PM:** Initial state or a minor change. The component is a `SidebarLayout` wrapping `Navbar` and `SideBar` components, displaying children as page content. It imports various UI components (Avatar, Dropdown, Navbar, SidebarLayout) and icons from `@heroicons/react`.
    *   **Timestamp: 11/5/2025, 4:33:08 PM & 11/5/2025, 4:33:15 PM:** A trivial change in the `Navbar` rendering, adding "kk" to the content (`<NavbarSpacer />kk`). This suggests a temporary or debugging change, which was likely reverted or removed later.
    *   **Timestamp: 11/5/2025, 9:14:23 PM:** The "kk" in the `Navbar` was removed, restoring the `NavbarSpacer` to its previous state.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\pages\dashboard\dashboard-page.tsx`**
    *   **Timestamp: 11/5/2025, 2:58:06 PM - 11/5/2025, 3:03:46 PM:** The `DashboardPage` component primarily deals with fetching and displaying shipment and delivery data. It uses Redux for state management, including pagination, filters, and sorting. Multiple API calls are made using `useFetchShipmentDataQuery`, `useFetchDeliveryDataQuery`, and `useFetchCartDataQuery`. There are functions for handling pagination (`handlePage`, `handlePageSizeChange`), filters (`handleFilterChange`, `handleClearFilters`), and card clicks (`handleCardClick`). It also includes logic for determining `deliveryMode` (Rail, Door, Port) and preparing calendar data. The initial entries show console logs for `localUser` and `ShipmentData`.
    *   **Timestamp: 11/5/2025, 6:07:06 PM - 11/5/2025, 6:09:52 PM:** A significant change was introduced in `useFetchCartDataQuery` parameters: `CompanyName: localUser?.companyname ? localUser.companyname : ""`, indicating that the cart data fetch now considers the user's company name. This suggests a move towards multi-tenancy or role-based data filtering.
    *   **Timestamp: 11/5/2025, 6:13:35 PM:** An `useEffect` hook was added to explicitly set the customer for users with the "CUSTOMER" role using `dispatch(setCustomer(localUser.companyname))`. This is a direct state update to reflect the customer's context.
    *   **Timestamp: 11/5/2025, 9:01:12 PM:** The `CompanyName` parameter in `useFetchShipmentDataQuery` and `useFetchCartDataQuery` was updated to prioritize `dashboardSelector.selectedCustomer` if available, falling back to `localUser.companyname`. This allows for dynamic customer selection beyond the logged-in user's default company.
    *   **Timestamp: 11/5/2025, 9:11:03 PM:** The `selectedCustomer` state is now read from `state.globalSlice` instead of `state.analyticSlice`, indicating a refactoring of how the selected customer is managed application-wide. The `useEffect` setting `setCustomer` for `CUSTOMER` roles was commented out, implying the `globalSlice` is now the primary source for `selectedCustomer`.
    *   **Timestamp: 11/5/2025, 10:36:47 PM - 11/5/2025, 10:54:28 PM:** Extensive console logs (`console.log("==selectedCustomer",selectedCustomer);` and `console.log("==localuser",localUser);`) were added or modified, likely for debugging purposes related to customer selection logic. The `CompanyName` parameter in `useFetchDeliveryDataQuery` and `useFetchCartDataQuery` was also refined to consistently use `selectedCustomer || localUser.companyname`.
    *   **Timestamp: 11/5/2025, 11:15:22 PM - 11/5/2025, 11:28:59 PM:** The `useSelector` hook for `selectedCustomer` was reverted to fetch from `state.globalSlice` (from `state.global`). The previously commented-out `useEffect` for setting customer for `CUSTOMER` role was removed, consolidating customer selection logic to `globalSlice`. Console logs related to `selectedCustomer` and `localUser` remain prominent, suggesting ongoing debugging or validation of the customer selection mechanism. The `setCustomer` action import from `shipment-dashboard-slice` was removed, reinforcing the move of customer selection logic to `global-slice`.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\components\core\usercard.tsx`**
    *   **Timestamp: 11/5/2025, 3:05:14 PM:** The `UserCard` component handles user display and logout functionality. It retrieves user data from local storage and user preferences from an API (`useFetchUserPreferenceQuery`). The `handleLogout` function supports both Auth0 and normal logout flows, clearing `localStorage` and dispatching a Redux `auth/logout` action. The dropdown menu provides a "Sign out1" option.
    *   **Timestamp: 11/5/2025, 4:23:14 PM - 11/5/2025, 4:32:38 PM:** The component was modified to import `useAccess` and `SelectCustomerPanel`, and it started selecting `toolState` from `analyticSlice`. The `SelectCustomerPanel` was briefly added within the `Dropdown` component, conditionally rendered based on `permission?.selectCustomer`, then removed. This indicates an attempt to integrate customer selection directly into the user card dropdown, which was subsequently reverted or moved.
    *   **Timestamp: 11/5/2025, 8:45:40 PM:** A minor cosmetic change: "Sign out1" in the dropdown menu was changed to "Sign out".

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\components\screen\analytics\AnalyticsToolbar.tsx`**
    *   **Timestamp: 11/5/2025, 3:53:07 PM - 11/5/2025, 3:53:57 PM:** The `AnalyticsToolbar` component manages various filters and actions for analytics dashboards, including date range, custom view management, and PDF export. It uses Redux for state management of global filters, dashboard selection, and operation types. It includes a `downloadDashboardPDF` function which was revised multiple times. The main change visible across these entries is the `downloadDashboardPDF` function, which was initially commented out, then re-implemented to use `html2canvas` and `jspdf` for generating PDFs of the dashboard, including handling logo and scaling. This function also contained commented-out code for attempting to fix rendering issues with CSS variables and filters.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\components\core\layout.tsx`**
    *   **Timestamp: 11/5/2025, 4:20:15 PM - 11/5/2025, 4:21:20 PM:** The `Layout` component provides the main application structure, handling user authentication (token expiry check) and routing. It restricts "ADMIN" users to a specific "Admin Dashboard" view. The changes in this window were minor, adding comments to the token expiry function.
    *   **Timestamp: 11/5/2025, 4:41:20 PM & 11/5/2025, 4:42:14 PM:** A new `useEffect` hook was introduced to dispatch the `setCustomer` action from `analytics-slice` if the `localUser` has a "CUSTOMER" role. This ensures the customer context is set upon layout rendering for customer accounts. The `dispatch` dependency was added to the `useEffect` array.
    *   **Timestamp: 11/5/2025, 6:10:32 PM:** The logic for setting `setCustomer` for CUSTOMER role was removed from `Layout.tsx`.
    *   **Timestamp: 11/5/2025, 9:12:02 PM:** Reintroduced `dispatch(setSelectedCustomer(localUser.companyname));` within a `useEffect` for `CUSTOMER` roles, this time importing `setSelectedCustomer` from `global-slice`. This shows a shift in where customer state is managed.
    *   **Timestamp: 11/5/2025, 11:02:58 PM - 11/5/2025, 11:23:32 PM:** The `Layout` component was updated to initialize `selectedCustomer` from `localStorage` using `initializeSelectedCustomer()` from `global-slice` if the token is valid. This ensures persistence of the selected customer across sessions. The dependency array for the `useEffect` setting `setSelectedCustomer` for `CUSTOMER` roles was adjusted to include optional chaining (`localUser?.role`, `localUser?.companyname`).

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\store\fretures\shipment-dashboard-slice.ts`**
    *   **Timestamp: 11/5/2025, 6:12:29 PM & 11/5/2025, 6:13:25 PM:** The `shipmentDashboardSlice` reducer was updated to include a `setCustomer` action, which sets `selectedCustomer` and defaults `selectedDashobard` to "Default". This change was later reverted or superseded by the `global-slice` refactoring. The `setCustomer` action was exported in the later timestamp.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\store\api\dashboard-api.ts`**
    *   **Timestamp: 11/5/2025, 8:39:50 PM:** No significant changes other than the timestamp, indicating this file was likely reviewed or part of a commit. It defines API endpoints for fetching delivery and card data, utilizing `getAppHeaders()` for authentication.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\types\shipment.types.ts`**
    *   **Timestamp: 11/5/2025, 9:00:51 PM:** No significant code changes. The file defines TypeScript interfaces for shipment-related data structures (`EventAttributes`, `MilestoneItem`, `ShipmentStatusType`, `SortModelItem`, `ShipmentScopeValues`, `DashboardState`, `DashboardCardInfoState`). This indicates definition and structure remained stable.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\store\fretures\global-slice.ts`**
    *   **Timestamp: 11/5/2025, 9:06:15 PM:** A new Redux slice, `globalSlice`, was introduced to manage a `selectedCustomer` state. It provides `setSelectedCustomer` and `clearSelectedCustomer` reducers.
    *   **Timestamp: 11/5/2025, 11:02:03 PM - 11/5/2025, 11:23:54 PM:** The `globalSlice` was enhanced to persist `selectedCustomer` in `localStorage` using `setSelectedCustomer` and to retrieve it on initialization via `initializeSelectedCustomer`. The `PayloadAction` type was added for `setSelectedCustomer`. The `name` of the slice was explicitly set to "globalSlice" in the payload type definition.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\store\store.ts`**
    *   **Timestamp: 11/5/2025, 9:07:08 PM:** The `rootReducer` was updated to include the new `globalSlice` under the key `globalSlice`.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\components\core\sidebar.tsx`**
    *   **Timestamp: 11/5/2025, 9:07:53 PM & 11/5/2025, 9:08:12 PM:** The `SideBar` component was heavily modified to integrate the `SelectCustomerPanel`. It now imports `setSelectedCustomer` from `global-slice` and uses `selectedCustomer` from the global state. Crucially, the `SelectCustomerPanel` is now rendered conditionally, appearing only for "ADMIN" users, and includes an `onSelect` callback to update the global `selectedCustomer` state. Minor styling adjustments (items-center) were also made.
    *   **Timestamp: 11/5/2025, 4:34:00 PM - 11/5/2025, 4:37:01 PM:** The `Sidebar` component was updated to include a `SelectCustomerPanel` based on `useAccess` and `toolState` from `analyticSlice`. It also had temporary "kk" text added to `SidebarLabel` at one point, which was then removed. The `SelectCustomerPanel` was moved to be conditionally rendered based on `permission?.selectCustomer`.
    *   **Timestamp: 11/5/2025, 9:15:46 PM:** The import path for `SelectCustomerPanel` was changed from `@components/screen/analytics/SelectCustomerPanel` to a direct relative import `SelectCustomer`. This likely indicates a refactoring and relocation of this component.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\components\screen\analytics\SelectCustomerPanel.tsx`**
    *   **Timestamp: 11/5/2025, 9:08:52 PM:** The `SelectCustomerPanel` component was introduced or significantly revised. It allows for searching, pagination, and selection of customers, using Material-UI components (Box, List, Popover, TextField, Pagination). It dispatches `setCustomer` from `analytics-slice` upon selection. It uses `lodash.debounce` for search input.
    *   **Timestamp: 11/5/2025, 9:13:54 PM & 11/5/2025, 9:14:14 PM:** This component was renamed to `SelectCustomer.tsx` (implied by the subsequent `sidebar.tsx` change, although the file path here remains `SelectCustomerPanel.tsx`). It was updated to dispatch `setSelectedCustomer` from the `global-slice` instead of `analytics-slice`. An `onSelect` callback prop was added to allow parent components to react to customer selection. The component now displays "No results found" if no options are available. The styles were also adjusted.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\SelectCustomer.tsx`**
    *   **Timestamp: 11/5/2025, 9:16:47 PM:** This file is effectively the renamed and relocated version of `SelectCustomerPanel.tsx`. It confirms the changes from the previous timestamp, showing `setSelectedCustomer` from `global-slice` and the `onSelect` prop. The import for `ApiManager` was changed from a relative path to an absolute path (`services/ApiManager`).

### Patterns and Recurring Elements:

1.  **Redux State Management Refactoring:** A prominent pattern is the shifting of `selectedCustomer` state management. Initially, `dashboard-page.tsx` directly used `localUser.companyname`, then it was passed to `useFetchCartDataQuery` and `useFetchShipmentDataQuery`. Later, a `setCustomer` action was introduced in `shipment-dashboard-slice.ts`, then moved to `analytics-slice`, and finally consolidated into a dedicated `global-slice.ts` for application-wide customer selection. This indicates a move towards a more centralized and robust global state management for the selected customer, especially for "ADMIN" users who can select different customers.
2.  **API Query Parameter Refinement:** Multiple instances show the addition of `CompanyName: selectedCustomer || localUser.companyname` to API queries (e.g., in `useFetchShipmentDataQuery`, `useFetchDeliveryDataQuery`, `useFetchCartDataQuery`). This ensures that API calls dynamically adjust based on the globally selected customer or the logged-in user's default company.
3.  **Authentication and User Role Handling:** The `Layout.tsx` component includes logic to check token validity and redirect on expiry. It also has specific rendering logic for "ADMIN" users, displaying a message to select a customer. The `UserCard.tsx` also handles user-specific data and logout based on authentication type (Auth0 or normal).
4.  **Debugging via `console.log`:** Frequent additions of `console.log` statements (e.g., `console.log("==localuser",localUser);`, `console.log("===shipment data === :> ",ShipmentData);`, `console.log("==selectedCustomer",selectedCustomer);`) indicate active debugging during development, especially around data fetching and customer context.
5.  **Component Refactoring and Relocation:** The `SelectCustomerPanel` component was initially integrated into `AnalyticsToolbar.tsx` and briefly into `UserCard.tsx`, then later moved to its own file (`src\SelectCustomer.tsx`) and integrated into `Sidebar.tsx` specifically for "ADMIN" users. This suggests an evolution in component responsibility and placement for better modularity and access control.
6.  **Minor UI/UX Adjustments:** Small changes like "Sign out1" becoming "Sign out" and the temporary "kk" in the `Navbar` demonstrate iterative UI/UX refinements.
7.  **PDF Export Functionality:** The `AnalyticsToolbar.tsx` shows a continuous effort to improve the PDF export functionality, including handling image conversion and embedding, with commented-out code indicating challenges faced during implementation (e.g., CSS variable/color function overrides).

## 9:48:58 AM
The changes log details development efforts on authentication routes and dashboard/user services, all occurring on **11/5/2025**. This suggests a focused work session on specific features of the `t360-backend-v2` project.

### File-Specific Updates:

1.  **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-backend-v2\src\routes\AuthRoutes.ts`**
    *   **Timestamp: 11/5/2025, 12:54:56 PM**
    *   An authentication route (`/api/auth/getUserInfo`) was added or last modified to fetch and return information about the authenticated user (`req.user`). This route uses `express.Router` and integrates `HttpStatusCodes`.

2.  **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-backend-v2\src\services\dashboardService.ts`**
    *   This file underwent numerous iterations throughout the day, primarily focusing on data retrieval for dashboard insights and delivery tracking.
    *   **Initial Implementation (6:04:50 PM - 6:06:01 PM):**
        *   Introduced `getDashboardCardInfo` to calculate and return aggregated shipment data (e.g., Pending Departure, In Transit, ETA within 1 week, Out for Delivery) with corresponding TEU counts. These queries include filters for `fromDate`, `toDate`, `CompanyName`, and user-specific conditions via `buildMtrUserCondition`.
        *   Introduced `getDeliveryData` to fetch delivery or vessel arrival information, filtered by type (`delivery` or `vessel`), mode (e.g., "ALL", "Rail Delivery"), and user-specific conditions.
    *   **Dynamic Company Name Retrieval (8:41:51 PM - 8:42:22 PM):**
        *   The `getDashboardCardInfo` function was updated to fetch `CompanyName` dynamically using a `getUserObject` utility, rather than directly from `req.query`. This change introduced an import from `@src/utils/analytics`.
        *   Debugging `console.log` statements were added to monitor the `CompanyName` value.
    *   **Filtering Adjustments and Debugging (10:41:50 PM - 10:44:51 PM):**
        *   The `if(useWhere) conditions.push(useWhere);` line in `getDashboardCardInfo` was commented out, potentially disabling a user-specific condition in dashboard card queries.
        *   More debugging `console.log` statements were added to inspect the `result[0]` object from database queries.
    *   **`CompanyName` Handling Refinement in `getDeliveryData` (10:46:26 PM - 10:51:27 PM):**
        *   `getDeliveryData` was updated to also attempt dynamic `CompanyName` retrieval using `getUserObject`.
        *   A `companyFilter` variable was introduced and refined to securely construct a `WHERE` clause for `account_name` by using `LOWER()` for case-insensitive matching and `replace(/'/g, "''")` to escape single quotes, preventing SQL injection.
    *   **Reversion of Dynamic `CompanyName` Retrieval (11:06:35 PM - 11:07:02 PM):**
        *   Both `getDashboardCardInfo` and `getDeliveryData` functions had the dynamic `CompanyName` retrieval via `getUserObject` commented out. `CompanyName` was reverted to being directly destructured from `req.query` for both functions.
    *   **Final Debugging and Query Refinement (11:10:55 PM - 11:23:11 PM):**
        *   Additional debugging `console.log` and `logger.info` statements were added (e.g., `sql query :: 1234`, `companyFilter`).
        *   The `baseQuery` construction in `getDashboardCardInfo` was updated to mirror the safe `LOWER()` and single-quote escaping logic applied earlier to `getDeliveryData`'s `companyFilter`. The last few timestamps for this file represent minor saves or cumulative updates without substantial new functional changes.

3.  **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-backend-v2\src\services\UserService.ts`**
    *   **Timestamp: 11/5/2025, 8:51:00 PM**
    *   This file outlines a comprehensive user service, including:
        *   `login`: Handles user authentication, validates credentials against `mtr_user_master`, checks account status, and generates JWT tokens.
        *   `saveUserPreferences`: Manages user preferences in the `v2_user_details` table using `INSERT ... ON CONFLICT DO UPDATE` for various settings (basic info, notifications, event configurations).
        *   `fetchUserPreferences`: Retrieves user preferences by joining `v2_user_details` and `mtr_user_master`.
        *   `saveInviteLog`: Records user invitations in `v2_user_invite_log` and sends an invitation email.
        *   `fetchAllCompanyUser`: Fetches a combined list of active users from `mtr_user_master` and pending invited users from `v2_user_invite_log` for a specific company.
        *   `userSettings`: Retrieves specific user settings like `date_format`.
    *   Subsequent entries for this file (8:51:15 PM, 8:51:46 PM) are identical, indicating no further functional changes were committed after the initial comprehensive update.

### Patterns and Recurring Elements:

*   **Debugging Focus:** A frequent pattern across `dashboardService.ts` changes is the insertion and modification of `console.log` and `logger.info` statements, indicating active debugging and testing during the development process.
*   **User and Company Context:** Both `dashboardService.ts` and `UserService.ts` heavily rely on user-specific (`req.user`, `buildMtrUserCondition`) and company-specific (`CompanyName`) data for filtering and operations.
*   **Direct SQL Query Usage:** Database interactions are predominantly handled through direct PostgreSQL queries embedded within the service functions. This includes complex queries with `FILTER (WHERE ...)` and `REGEXP_REPLACE` for data aggregation in `dashboardService.ts`, and `ON CONFLICT DO UPDATE` for UPSERT operations in `UserService.ts`.
*   **SQL Injection Prevention:** An important recurring refinement, particularly in `dashboardService.ts`, is the explicit use of `LOWER()` for case-insensitive comparisons and `replace(/'/g, "''")` to escape single quotes when constructing dynamic SQL queries with user-provided `CompanyName`, enhancing security.
*   **Error Handling:** All service functions consistently implement `try...catch` blocks to handle potential errors during database operations or logic execution, returning appropriate HTTP status codes (e.g., `500 Internal Server Error`, `404 Not Found`).
*   **Timestamp Clustering:** All changes logged occurred on the same day, suggesting a dedicated development sprint or bug-fixing session.

## 11:02:02 AM
The provided logs indicate a focused development effort on a React-based frontend application, likely a dashboard or analytics platform, centered around shipment and delivery tracking. Key areas of change include:

### File-Specific Updates:

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\pages\dashboard\dashboard-page.tsx`** (Frequent updates between 11/5/2025, 2:58:06 PM and 11/6/2025, 10:01:39 AM):
    *   This file, representing the main dashboard page, underwent numerous changes.
    *   **Initial state and API integration**: It imports various components, icons, and Redux slices (`shipment-dashboard-slice`, `dashboard-api`) to manage state, filters, pagination, and data fetching for shipment and delivery information.
    *   **Filter and Pagination Logic**: Functions `handlePage`, `handlePageSizeChange`, `handleFilterChange`, `handleClearFilters`, and `handleCardClick` are consistently present, indicating robust filtering and pagination capabilities.
    *   **Customer Selection Integration**: Over time, changes show the integration of `selectedCustomer` from a global Redux slice into the API calls for `useFetchShipmentDataQuery` and `useFetchCartDataQuery` (starting around 11/5/2025, 6:07:06 PM and refined through 11:28:59 PM). This ensures data displayed is specific to the selected customer.
    *   **Removal of Redundant Customer Logic**: An `useEffect` hook that previously dispatched `setCustomer(localUser.companyname)` for "CUSTOMER" roles was commented out, indicating a shift in how the `selectedCustomer` is managed globally.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\components\core\sidebar-layout.tsx`** (11/5/2025, 2:54:04 PM; 4:33:08 PM; 4:33:15 PM; 9:14:23 PM):
    *   This component defines the overall layout with a sidebar and navbar.
    *   Minor, possibly test-related, changes like adding "kk" to the navbar (4:33:08 PM, 4:33:15 PM) were introduced and then reverted (9:14:23 PM), indicating small, temporary debugging or layout adjustments.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\components\core\usercard.tsx`** (Multiple updates between 11/5/2025, 3:05:14 PM and 8:45:40 PM):
    *   This component handles user display and logout functionality.
    *   **Logout Refinements**: The `handleLogout` function was initially commented out and then re-enabled, with explicit `localStorage.removeItem` calls before navigation, ensuring proper session cleanup.
    *   **Customer Panel Integration (Temporary)**: There was an attempt to integrate `SelectCustomerPanel` directly into `UserCard` (4:23:14 PM, 4:24:19 PM), followed by its removal (4:30:28 PM, 4:30:34 PM, 4:32:38 PM). This suggests an architectural decision to move the customer selection logic elsewhere.
    *   **Minor Text Change**: "Sign out1" was corrected to "Sign out" in the dropdown label (8:45:40 PM).

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\components\screen\analytics\AnalyticsToolbar.tsx`** (Multiple updates between 11/5/2025, 3:53:07 PM and 3:53:57 PM):
    *   This component manages the analytics dashboard toolbar, including PDF export.
    *   **PDF Export Refinements**: Multiple iterations of the `downloadDashboardPDF` function indicate efforts to improve PDF generation, including using `html2canvas-pro`, handling image loading (logo), and ensuring proper styling restoration after capture. Previously commented-out approaches were replaced with a more robust method involving base64 image conversion.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\components\core\layout.tsx`** (Multiple updates between 11/5/2025, 4:20:15 PM and 11:23:32 PM):
    *   This file defines the main application layout and authentication logic.
    *   **Token Expiry and Redirection**: Consistent logic to check for expired tokens and redirect to the root path on expiry.
    *   **Admin User Restriction**: Specific UI is rendered for "ADMIN" users, instructing them to select a customer.
    *   **Customer Initialization Logic**: An `useEffect` hook was added and refined to dispatch `setSelectedCustomer` from `localUser.companyname` if the user role is "CUSTOMER" (4:42:14 PM), and later `initializeSelectedCustomer` was dispatched on successful token validation to retrieve the customer from local storage (11:02:58 PM).

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\components\core\sidebar.tsx`** (Multiple updates between 11/5/2025, 4:34:00 PM and 9:15:46 PM):
    *   This component renders the application sidebar.
    *   **Customer Selector Relocation**: The `SelectCustomerPanel` component was moved into the sidebar, specifically conditional on the user being an "ADMIN" (9:07:53 PM). This centralizes customer selection for admin users.
    *   **Styling Adjustments**: Minor text "kk" added then removed, indicating small visual debugging.
    *   **Import Path Change**: The `SelectCustomerPanel` import path was adjusted (9:15:46 PM).

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\store\fretures\shipment-dashboard-slice.ts`** (11/5/2025, 6:12:29 PM and 6:13:25 PM):
    *   This Redux slice manages the dashboard state.
    *   **`setCustomer` reducer**: A `setCustomer` reducer was added to update `selectedCustomer` and reset `selectedDashobard` to "Default". This was then exported.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\store\api\dashboard-api.ts`** (11/5/2025, 8:39:50 PM):
    *   This file defines API endpoints for dashboard data.
    *   No significant code changes, but a timestamp indicates it was touched.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\types\shipment.types.ts`** (11/5/2025, 9:00:51 PM):
    *   Type definitions for shipment-related data.
    *   No significant code changes, but a timestamp indicates it was touched.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\store\fretures\global-slice.ts`** (Multiple updates between 11/5/2025, 9:06:15 PM and 11:23:54 PM):
    *   This new Redux slice was introduced to manage global state, particularly `selectedCustomer`.
    *   **Initialization and Persistence**: The `globalSlice` was created to manage `selectedCustomer`, including reducers `setSelectedCustomer` and `clearSelectedCustomer`. Later iterations refined `setSelectedCustomer` to persist the selected customer in `localStorage` and introduced `initializeSelectedCustomer` to load it on app startup.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\store\store.ts`** (11/5/2025, 9:07:08 PM):
    *   Redux store configuration.
    *   **`globalSlice` Integration**: The newly created `globalSlice` was integrated into the root reducer, reflecting the shift to a global customer selection state.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\components\screen\analytics\SelectCustomerPanel.tsx` / `c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\components\screen\analytics\SelectCustomer.tsx` / `c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\SelectCustomer.tsx`** (Multiple updates between 11/5/2025, 9:08:52 PM and 9:16:47 PM):
    *   This component provides a UI for selecting customers.
    *   **Refactored to `SelectCustomerPanel`**: The component was refactored, moving from `analytics-slice` to `global-slice` for `setCustomer` (9:08:52 PM).
    *   **Rename and Relocation**: The file was renamed from `SelectCustomerPanel.tsx` to `SelectCustomer.tsx` and then moved from `components/screen/analytics` to the `src` root as `SelectCustomer.tsx` (9:13:54 PM, 9:14:14 PM, 9:16:47 PM).
    *   **Callback Added**: An `onSelect` prop was added to allow parent components to handle the selected customer.
    *   **Search and Pagination**: Implements debounced search and pagination for fetching customer options from an API.

### Timestamps of Significant Changes:

*   **11/5/2025, ~2:54 PM - ~3:03 PM**: Initial setup and minor adjustments to `dashboard-page.tsx` and `sidebar-layout.tsx`.
*   **11/5/2025, ~3:53 PM**: Multiple changes to `AnalyticsToolbar.tsx` related to PDF export.
*   **11/5/2025, ~4:20 PM - ~4:42 PM**: Refinements to `layout.tsx` for token validation and initial attempts to set customer data for specific roles, along with related shifts in `usercard.tsx`.
*   **11/5/2025, ~6:07 PM**: Integration of `localUser.companyname` into `useFetchCartDataQuery` in `dashboard-page.tsx`.
*   **11/5/2025, ~9:06 PM - ~9:17 PM**: Significant restructuring around customer selection.
    *   Introduction of `global-slice.ts` for managing `selectedCustomer`.
    *   Integration of `global-slice` into `store.ts`.
    *   Relocation of `SelectCustomerPanel` to the sidebar and a change in its import path within `sidebar.tsx`.
    *   The `SelectCustomerPanel` component itself was updated to use `global-slice` and persist selection in `localStorage`.
*   **11/5/2025, ~10:36 PM - ~11:28 PM**: Further refinements in `dashboard-page.tsx` to consistently use `selectedCustomer` from `globalSlice` for API calls (`useFetchShipmentDataQuery`, `useFetchDeliveryDataQuery`, `useFetchCartDataQuery`), ensuring all data fetches respect the globally selected customer. The direct setting of customer from `localUser` in `dashboard-page.tsx` was commented out, deferring this logic to `Layout.tsx`.
*   **11/5/2025, ~11:02 PM - ~11:23 PM**: `global-slice.ts` and `layout.tsx` updated to persist `selectedCustomer` in `localStorage` and initialize it on app load.

### Patterns and Recurring Elements:

*   **Redux State Management**: Consistent use of `react-redux` (`useDispatch`, `useSelector`) to manage application state, particularly for dashboard filters, pagination, and customer selection.
*   **API Integration with RTK Query**: Extensive use of Redux Toolkit Query (`useFetch...Query`) for data fetching, with parameters dynamically constructed from Redux state (filters, pagination, sort model, and `selectedCustomer`).
*   **`localStorage` for User Data**: `localStorage.getItem("user")` and `localStorage.getItem("token")` are frequently accessed to retrieve user details and authentication tokens, and cleared on logout or token expiry.
*   **Conditional Rendering/Logic based on User Role**: The application differentiates behavior for "ADMIN" and "CUSTOMER" roles, for example, by showing a customer selector only for admins or setting a default customer for regular customers.
*   **Console Logging for Debugging**: Numerous `console.log` statements are present, indicating active debugging during development.
*   **Component-based Architecture**: The changes are spread across various components (`sidebar-layout`, `dashboard-page`, `usercard`, `AnalyticsToolbar`, `layout`, `sidebar`, `SelectCustomerPanel`), reflecting a modular frontend structure.
*   **Moment.js for Date Handling**: The `moment` library is used for date manipulation and formatting.
*   **Focus on Dashboard and Analytics**: Many changes revolve around filtering, data presentation, and export features of a dashboard/analytics section.
*   **Refactoring Customer Selection**: There's a clear evolution of the customer selection mechanism, initially tied to individual components, then moving towards a global Redux slice (`global-slice`) and persisting the selection. This suggests a move towards a more centralized and robust approach for multi-customer environments.

## 11:02:20 AM
The log details changes across two primary files: `AuthRoutes.ts` and `dashboardService.ts`, along with a new service file `UserService.ts`.

**File-Specific Updates:**

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-backend-v2\src\routes\AuthRoutes.ts`**
    *   **Timestamp:** 11/5/2025, 12:54:56 PM
    *   This file defines a single authentication route, `GET /api/auth/userInfo`, which logs the authenticated user information and returns it in the response. It imports necessary Express router and common types/constants.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-backend-v2\src\services\dashboardService.ts`**
    *   This file underwent numerous revisions throughout the day, focusing on two main functions: `getDashboardCardInfo` and `getDeliveryData`.
    *   **Initial State (11/5/2025, 6:04:50 PM):** Both functions were implemented to query `mtr_tracking_data`. `getDashboardCardInfo` calculates various shipment metrics (Pending Departure, In Transit, ETA within 1 Week, Out for Delivery) and their TEU equivalents, filtering by date ranges and `CompanyName` directly from `req.query`. `getDeliveryData` retrieves delivery or vessel arrival data with filters based on `type` and `mode`. User-specific conditions are applied via `buildMtrUserCondition`.
    *   **Company Name Handling Refinement (11/5/2025, 8:41:51 PM - 8:42:22 PM):** The `getDashboardCardInfo` function was updated to use `getUserObject` (from `@src/utils/analytics`) to derive `CompanyName` dynamically based on the authenticated user and query parameters, rather than directly using `req.query.CompanyName`. Logging of `req.CompanyName` was added.
    *   **Temporary Filter Removal (11/5/2025, 10:43:59 PM):** The `useWhere` condition (from `buildMtrUserCondition`) was temporarily commented out in `getDashboardCardInfo`, disabling user-specific data filtering for this endpoint.
    *   **`getDeliveryData` Company Filter Introduction (11/5/2025, 10:46:26 PM):** `getDeliveryData` was updated to also derive `CompanyName` using `getUserObject` (initially) and attempt to apply a `CompanyName` filter to its SQL queries. This initial implementation had a potential SQL injection vulnerability as the `CompanyName` was directly concatenated into the query string without proper escaping.
    *   **Critical Security Fix (11/5/2025, 10:51:27 PM):** A significant update introduced a `companyFilter` variable in `getDeliveryData`. This filter correctly applies `LOWER(account_name) = LOWER('${CompanyName.replace(/'/g, "''")}')`, escaping single quotes to prevent SQL injection and ensuring case-insensitive matching. The derivation of `CompanyName` for `getDeliveryData` was explicitly set to come from `req.query.CompanyName` (capitalized) and explicitly commented to ensure frontend consistency.
    *   **Partial Revert and Alignment (11/5/2025, 11:06:35 PM - 11:13:53 PM):** The logic for deriving `CompanyName` via `getUserObject` in both `getDashboardCardInfo` and `getDeliveryData` was commented out and reverted to directly using `CompanyName` from `req.query`. However, the safe `companyFilter` logic (including `replace(/'/g, "''")`) was then applied to `getDashboardCardInfo` as well, ensuring consistent SQL injection protection for company name filters across both dashboard functions. Minor debug `console.log` and logger messages were added.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-backend-v2\src\services\UserService.ts`**
    *   **Initial Comprehensive Implementation (11/5/2025, 8:51:00 PM):** This file was introduced with several new user management functionalities:
        *   `login`: Handles user authentication, validates credentials against `mtr_user_master`, checks account status, and generates a JWT token upon successful login.
        *   `saveUserPreferences`: Stores or updates user settings and notification preferences in the `v2_user_details` table, utilizing `ON CONFLICT` for upsert operations.
        *   `fetchUserPreferences`: Retrieves user preferences, joining `mtr_user_master` and `v2_user_details` to provide default values.
        *   `saveInviteLog`: Records user invitation details to `v2_user_invite_log` and triggers an email invitation.
        *   `fetchAllCompanyUser`: Fetches a combined list of active registered users and pending invited users for a specific company.
        *   `userSettings`: Fetches basic user settings like `date_format`.
    *   **Subsequent timestamps (11/5/2025, 8:51:15 PM - 8:51:46 PM):** Show no functional changes to this file, indicating stability after its initial implementation.

**Timestamps of Significant Changes:**

*   **11/5/2025, 8:41:51 PM:** `dashboardService.ts` begins using `getUserObject` for dynamic `CompanyName` retrieval.
*   **11/5/2025, 8:51:00 PM:** Major new feature development in `UserService.ts` is introduced, adding user preferences, invitations, and comprehensive user listing.
*   **11/5/2025, 10:46:26 PM:** `getDeliveryData` in `dashboardService.ts` starts applying `CompanyName` filtering.
*   **11/5/2025, 10:51:27 PM:** Crucial SQL injection prevention implemented in `getDeliveryData` for `CompanyName` filtering.
*   **11/5/2025, 11:13:53 PM:** `getDashboardCardInfo` in `dashboardService.ts` adopts the same safe SQL escaping for `CompanyName`.

**Patterns/Recurring Elements:**

*   **Dynamic SQL Query Construction:** A consistent pattern across `dashboardService.ts` and `UserService.ts` is the dynamic construction of SQL queries using string concatenation, often based on request parameters and user data.
*   **SQL Injection Prevention:** There is a clear evolution in `dashboardService.ts` towards implementing more robust SQL injection prevention by using `CompanyName?.replace(/'/g, "''")` when concatenating user-provided company names into SQL queries.
*   **Logging and Debugging:** Frequent additions of `logger.info`, `logger.error`, and `console.log` statements indicate active debugging and monitoring during development, particularly around data fetching and parameter handling.
*   **User Context and Authorization:** `req.user` and `buildMtrUserCondition` are consistently used to ensure operations are performed within the context of the authenticated user and their permissions/company affiliation.
*   **Error Handling:** All service functions consistently wrap their logic in `try...catch` blocks to handle potential errors during database operations or business logic, returning appropriate HTTP status codes and error messages.
*   **`ON CONFLICT DO UPDATE`:** In `UserService.ts`, SQL `ON CONFLICT` clauses are used for `saveUserPreferences` and `saveInviteLog`, indicating an upsert pattern for managing user-related data.

## 12:01:48 PM
The code changes primarily focus on improving the T360 frontend application, specifically around **dashboard functionality, user management, and global state management**, with a strong emphasis on handling customer-specific data and authentication.

**Key Information from Changes:**

**File-Specific Updates:**

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\pages\dashboard\dashboard-page.tsx` (Multiple timestamps from 11/5/2025, 2:58 PM to 11/6/2025, 10:01 AM):**
    *   **Timestamp:** Frequent updates throughout the period.
    *   **Summary:** This file, `DashboardPage`, undergoes significant refactoring related to data fetching and filtering.
        *   Initial versions of `useFetchCartDataQuery` and `useFetchShipmentDataQuery` were updated to include a `CompanyName` parameter, either from `localUser?.companyname` or `dashboardSelector.selectedCustomer`.
        *   Later changes remove `localUser.companyname` from direct API calls, relying solely on `dashboardSelector.selectedCustomer` or `selectedCustomer` from the `globalSlice`.
        *   The explicit call to `dispatch(setCustomer(localUser.companyname))` for `CUSTOMER` role users was commented out and subsequently removed as the `selectedCustomer` state is now managed more globally.
        *   There are numerous `console.log` statements added for debugging `localUser`, `selectedCustomer`, `ShipmentData`, and `dashboardCartData`, indicating active development and troubleshooting of data flow.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\components\core\usercard.tsx` (Multiple timestamps from 11/5/2025, 3:05 PM to 11/5/2025, 8:45 PM):**
    *   **Timestamp:** Several changes between 3:05 PM and 4:32 PM, and a final one at 8:45 PM.
    *   **Summary:**
        *   A `SelectCustomerPanel` component was temporarily added and then removed from `UserCard`'s render, indicating a shifting strategy for customer selection UI.
        *   Dependencies like `useAccess` and `useSelector` (for `toolState` and `analyticSlice`) were added, then later removed, simplifying the `UserCard`'s direct responsibilities.
        *   The `handleLogout` function remains consistent, clearing `token` and `user` from `localStorage` and dispatching a Redux `auth/logout` action, with different redirection logic based on `authtype` (Auth0 or normal).
        *   A minor textual change from "Sign out1" to "Sign out" in the dropdown label occurs in the last update.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\components\screen\analytics\AnalyticsToolbar.tsx` (Multiple timestamps around 11/5/2025, 3:53 PM):**
    *   **Summary:** Updates involve refactoring the PDF export functionality (`downloadDashboardPDF`). The commented-out code suggests previous attempts to handle CSS variables and filters during HTML to Canvas conversion. The final version explicitly converts the logo to base64 before adding it to the PDF. The component also uses `useAccess` and manages dashboard and filter states via Redux.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\components\core\layout.tsx` (Multiple timestamps from 11/5/2025, 4:20 PM to 11/5/2025, 11:23 PM):**
    *   **Summary:** This file primarily handles user session management and routing based on user roles.
        *   Consistently checks `token` validity and `localUser.exp` to determine if the user is logged in or if the token has expired, redirecting to the root ("/") if so.
        *   Admin users (`localUser?.role === "ADMIN"`) are explicitly redirected to a "Please select any customer to view data" message, suggesting a design pattern for multi-tenant or role-based access.
        *   A `useEffect` hook was introduced to dispatch `setCustomer` (later `setSelectedCustomer` from `globalSlice`) with `localUser.companyname` for `CUSTOMER` role users, and `initializeSelectedCustomer` for others after successful login, indicating a move towards global customer state management.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\components\core\sidebar.tsx` (Multiple timestamps from 11/5/2025, 4:34 PM to 11/5/2025, 9:15 PM):**
    *   **Summary:** The sidebar component was updated to conditionally render `SelectCustomerPanel` specifically for "ADMIN" users.
        *   Early changes included debugging text ("kk").
        *   Later, `SelectCustomerPanel` was moved into the `SidebarBody` for ADMIN users, integrating customer selection directly into the sidebar for relevant roles.
        *   Refactoring shifted `SelectCustomerPanel`'s import path and removed `toolState` from its props, now taking `selectedCustomer` and `onSelect` from the `globalSlice`.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\store\fretures\shipment-dashboard-slice.ts` (Multiple timestamps around 11/5/2025, 6:12 PM):**
    *   **Summary:** The `shipmentDashboardSlice` initially had a `setCustomer` reducer. This reducer was eventually removed, with its responsibility seemingly shifted to a new `globalSlice`.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\store\fretures\global-slice.ts` (Multiple timestamps from 11/5/2025, 9:06 PM to 11/5/2025, 11:23 PM):**
    *   **Summary:** This new slice (`globalSlice`) was created to manage a `selectedCustomer` state globally.
        *   Initial version stored `selectedCustomer` as a string.
        *   Later, it was refined to handle `null` for `selectedCustomer` and interact with `localStorage` to persist the selected customer across sessions (`localStorage.setItem("selectedCustomer", action.payload)` and `localStorage.removeItem("selectedCustomer")`).
        *   An `initializeSelectedCustomer` reducer was added to load the saved customer from `localStorage` on app initialization.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\store\store.ts` (11/5/2025, 9:07 PM):**
    *   **Summary:** The root Redux store was updated to include the new `globalSlice` in its `combineReducers`.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\types\shipment.types.ts` (11/5/2025, 9:00 PM):**
    *   **Summary:** The `DashboardState` interface was updated to include `selectedCustomer:string;` and `selectedDashobard:string;`, reflecting the new global state management for customer and dashboard selections.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\components\screen\analytics\SelectCustomerPanel.tsx` (11/5/2025, 9:08 PM and 11/5/2025, 9:13 PM):**
    *   **Summary:** This component, initially used with `analytics-slice`, was refactored and renamed (implied by the log sequence leading to `SelectCustomer.tsx`). It now explicitly dispatches `setSelectedCustomer` to the `global-slice` and includes an optional `onSelect` callback for parent components. The implementation uses Material-UI components (Box, List, Popover, TextField, Pagination) and includes a debounced API call for fetching customer options.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\SelectCustomer.tsx` (Multiple timestamps around 11/5/2025, 9:16 PM):**
    *   **Summary:** This file appears to be the final location/renaming of the `SelectCustomerPanel` component, with its functionality refined to integrate with the `global-slice` for `selectedCustomer` management and an explicit `onSelect` prop. The import path for `ApiManager` also changed from a relative path to a root-aliased path.

**Patterns and Recurring Elements:**

1.  **Redux Integration for Global State:** A significant pattern is the migration towards a centralized `globalSlice` in Redux for managing `selectedCustomer`. This indicates a broader architectural shift to make customer selection accessible and consistent across different parts of the application, especially for "ADMIN" users who need to switch contexts.
2.  **`localStorage` for Session Persistence:** `localStorage` is consistently used to store and retrieve user authentication details (`token`, `user`) and the newly introduced `selectedCustomer`, enabling state persistence across browser sessions.
3.  **Role-Based Access Control:** The application explicitly checks `localUser?.role` ("ADMIN" or "CUSTOMER") to tailor UI elements and data fetching logic, particularly visible in `Layout.tsx` and `SideBar.tsx`. Admin users have a specific view and the ability to select customers.
4.  **Data Fetching and Filtering:** Dashboard-related components (`dashboard-page.tsx`, `dashboard-api.ts`) are heavily reliant on Redux state (`dashboardSelector.filters`, `dashboardSelector.pagination`, `dashboardSelector.sortModel`, `dashboardSelector.cardFilter`, `dashboardSelector.dateFilter`) to construct API queries. The `CompanyName` parameter in API calls also reflects the customer selection logic.
5.  **Component Refactoring and Consolidation:** The `SelectCustomerPanel` component underwent significant refactoring, including potential renaming and relocation, and its integration into different parent components (initially `UserCard`, then `AnalyticsToolbar`, and finally `SideBar`). This indicates an iterative process to find the most logical place for shared UI elements and state.
6.  **Debugging `console.log` statements:** Numerous `console.log` statements throughout the code entries (e.g., `console.log("==localuser",localUser);`, `console.log("===shipment data === :> ",ShipmentData);`) suggest active development, testing, and debugging phases.
7.  **Consistent Logout Logic:** The `handleLogout` function across `usercard.tsx` maintains a consistent approach to clearing local storage and dispatching a Redux action for logout, accommodating both Auth0 and normal authentication flows.

## 12:02:04 PM
The provided log details code changes across two main files within a single day, 11/5/2025, primarily focusing on backend services related to authentication, dashboard data, and user management.

### File-Specific Updates:

1.  **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-backend-v2\src\routes\AuthRoutes.ts`**
    *   **Timestamp:** 11/5/2025, 12:54:56 PM
    *   This file defines an Express router for authentication. A single GET route, `Paths.Auth.GetUserInfo`, is configured to log the authenticated user's information and return it as a JSON response with an `OK` status. This appears to be a stable endpoint for retrieving basic user data after authentication.

2.  **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-backend-v2\src\services\dashboardService.ts`**
    *   This file underwent numerous iterations throughout the day, mainly refining how company-specific data and user-specific conditions are applied to dashboard queries.
    *   **Initial State (11/5/2025, 6:04:50 PM):** Introduced `getDashboardCardInfo` and `getDeliveryData` functions. `getDashboardCardInfo` took `CompanyName` directly from `req.query` and applied various conditions, including `buildMtrUserCondition` for user-specific filtering. `getDeliveryData` used `buildMtrUserCondition` and filtered by `type` (delivery/vessel) and `mode`.
    *   **Minor Fixes & Debugging (11/5/2025, 6:05:15 PM - 10:44:51 PM):** Several commits were identical or included minor changes like adding debug `console.log` statements. A notable change at **8:41:51 PM** involved `getDashboardCardInfo` fetching `CompanyName` dynamically using `getUserObject` for potentially more robust access control, importing `getUserObject` from `@src/utils/analytics`. Later, at **10:43:59 PM**, the `useWhere` condition was temporarily commented out in `getDashboardCardInfo`.
    *   **`CompanyName` Handling Refinement (11/5/2025, 10:46:26 PM - 11:13:53 PM):**
        *   At **10:46:26 PM**, `getDeliveryData` also started attempting to fetch `CompanyName` via `getUserObject` and introduced a `CompanyName` filter into its SQL queries using direct string concatenation, which was potentially unsafe.
        *   A critical update at **10:51:27 PM** for `getDeliveryData` reverted the `getUserObject` call for `CompanyName` (meaning `CompanyName` was again expected from `req.query`), but importantly, implemented **SQL injection sanitization** for the `CompanyName` parameter using `CompanyName.replace(/'/g, "''")` before incorporating it into the SQL query string. This significantly improved security.
        *   By **11:06:35 PM**, both `getDashboardCardInfo` and `getDeliveryData` were consistently updated to retrieve `CompanyName` directly from `req.query`, with the `getUserObject` call commented out in both functions.
        *   The final significant change at **11:13:53 PM** applied the same **SQL injection sanitization logic** (`CompanyName?.replace(/'/g, "''") || ""`) to the `CompanyName` filter within the `getDashboardCardInfo` function, ensuring consistent and safer handling of this parameter across both primary dashboard data retrieval functions.
    *   The `buildMtrUserCondition(req.user!)` helper function is consistently used in both `getDashboardCardInfo` and `getDeliveryData` to apply user-specific conditions.

3.  **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-backend-v2\src\services\UserService.ts`**
    *   **Timestamp:** 11/5/2025, 8:51:00 PM (and subsequent identical entries)
    *   This file contains a comprehensive suite of user management functionalities:
        *   `login`: Handles user authentication, validates credentials, checks account status, and generates a JWT token upon successful login. It fetches user data from `mtr_user_master`.
        *   `saveUserPreferences`: Allows users to save personal preferences (e.g., name, email, phone, time zone, language, date format, and various notification/event configurations) to the `v2_user_details` table, with an `ON CONFLICT` clause to handle updates for existing user codes.
        *   `fetchUserPreferences`: Retrieves user preferences, using `mtr_user_master` as a fallback for some basic info if not found in `v2_user_details`.
        *   `saveInviteLog`: Records user invitations in `v2_user_invite_log` and triggers an email using `sentInviteEmail`. It also handles updates on conflict.
        *   `fetchAllCompanyUser`: Fetches a combined list of active users from `mtr_user_master` and pending invited users from `v2_user_invite_log` for a specific company.
        *   `userSettings`: Retrieves specific user settings like `date_format`.
    *   All these functions are exported individually and collectively via an `all` object.

### Patterns and Recurring Elements:

*   **Consistent Logging:** Extensive use of `logger.info` and `logger.error` is present across all service files for monitoring request flow, debugging query statements, and capturing errors.
*   **Standardized Error Handling:** All API endpoints and service functions utilize `try-catch` blocks for robust error handling, returning `HttpStatusCodes.INTERNAL_SERVER_ERROR` or specific HTTP errors like `NOT_FOUND` or custom `HttpError` instances.
*   **Database Interaction:** Direct SQL queries are used extensively via a `query` utility function, often building dynamic `WHERE` clauses based on request parameters and user context.
*   **User Context and Authorization:** The `IAuthReq` interface and `req.user` object are consistently used to access authenticated user details, and `buildMtrUserCondition` is a recurring helper for applying user-specific filters to database queries.
*   **Query Parameter Handling:** There's an iterative process evident in `dashboardService.ts` to correctly and safely extract and apply query parameters (like `CompanyName`, `fromDate`, `toDate`, `type`, `mode`) to SQL queries, including a clear evolution towards preventing SQL injection vulnerabilities.
*   **PostgreSQL-Specific SQL Features:** Queries frequently use advanced PostgreSQL features such as `FILTER (WHERE ...)`, `DISTINCT ON (...)`, `COALESCE`, `REGEXP_REPLACE`, `INTERVAL`, and `ROW_NUMBER() OVER (PARTITION BY ... ORDER BY ...)`.
*   **"Magic String" Debugging:** The `logger.info(`sql query :: 1234${baseQuery}`);` in `dashboardService.ts` indicates a temporary or in-progress debugging technique.

## 12:02:39 PM
Based on the provided instructions, the log entries are for the file `c:\Users\ridap\OneDrive\Documents\Envosyes\envosys-backend\config\.env.development`. As this file path contains `.env`, it falls under the category of files that store keys and should not be summarized. Therefore, no summary of its content will be generated.

## 12:03:14 PM
The log details the development and refinement of a document upload feature within an Envosys frontend application. The changes span across a page component, a screen-level component handling the upload logic, and a column definition file for a data grid.

### File-Specific Updates:

**`c:\Users\ridap\OneDrive\Documents\Envosyes\envosys-frontend\src\pages\upload-docs\uploadDocs.tsx`**
This file defines the main page for document uploads.
*   **Early (11:12 AM):** The component `UploadDocs` was initially set up to render a `PageWrapper` with "Upload Document1s" in the left panel and a `ConfirmLineBookingForm` component in the main content area.
*   **Subsequent (11:12 AM):** A minor textual correction was made, changing "Upload Document1s" to "Upload Documents" in the left panel.

**`c:\Users\ridap\OneDrive\Documents\Envosyes\envosys-frontend\src\data\coulms\upload-doc-coulmn.tsx`**
This file defines the columns for the data grid used to display uploaded document information.
*   **Initial Definition (11:18 AM):** Columns were initially defined for `created_at` (formatted date), `time` (formatted time), `created_by`, `field_name`, `old_value`, and `new_value`.
*   **Major Refactoring (11:22 AM - 11:23 AM):** The column structure underwent a significant overhaul. The original `created_at`, `created_by`, `field_name`, `old_value`, `new_value` columns were replaced with `file`, `json_data`, and `date_time`.
*   **`json_data` Column Evolution (11:28 AM - 11:38 AM):**
    *   An initial `renderCell` for `json_data` attempted to parse and display values like `field_name: old_value  new_value`, with console logging for debugging.
    *   It was temporarily changed to display raw, pretty-printed JSON within a `<pre>` tag.
    *   The `renderCell` then reverted to a more structured display, formatting content based on whether `json_data` was an array or an object.
    *   Finally, the `renderCell` was enhanced to show a concise summary (e.g., just `field_name`s for arrays) and included functionality to download the full JSON data upon clicking the displayed text.
*   **`file` Column Implementation (11:34 AM):** The `file` column gained a `renderCell` function to render a downloadable link. It extracts the filename from the URL and displays it, allowing users to download the file directly.
*   **Styling & Width Adjustments (11:51 AM - 11:54 AM):** Both `file` and `json_data` columns saw their text and hover colors changed from various shades of blue/gray to a consistent dark gray (`#09090B`). Column widths were iteratively adjusted: `file` from 150 to 350, `json_data` from 150 to 400, and `date_time` from 150 to 300.
*   **Cleanup (11:55 AM):** Unused utility imports (`appDateFormat`, `appTimeFormat`) were removed as the custom rendering logic within `json_data` and `file` columns no longer required them.

**`c:\Users\ridap\OneDrive\Documents\Envosyes\envosys-frontend\src\components\screen\upload-docs\uploadDocs.tsx`**
This component (`ConfirmLineBookingForm`) is responsible for the actual document upload UI and logic.
*   **Initial Component Setup (11:19 AM):** The `ConfirmLineBookingForm` component was created with state management for uploaded files, drag-over status, and upload progress. It implemented drag-and-drop file upload, file input, and file removal features. Form handling was set up using Formik, integrating with `useUploadDocumentMutation` for API calls and `react-hot-toast` for user feedback. An `AppGrid` was included to display `tableDummyData`.
*   **Data Alignment (11:24 AM - 11:28 AM):** The `tableDummyData` within this component was continuously updated to reflect the evolving structure of `UPLOAD_TAB_COLUMNS` from `upload-doc-coulmn.tsx`. This included changes from older fields to `date_time`, then introducing `file` and `json_data` (initially as an array, then testing an object structure).
*   **UI/UX Refinements (11:19 AM - 12:02 PM):**
    *   Minor layout adjustments, such as moving the `AppGrid` placement and changing the form's wrapper `div` width from `max-w-md` to `w-full`.
    *   An image import (`envosyLogo`) was added and used as a dummy file in `tableDummyData`.
    *   `tableDummyData` was expanded to include more entries for demonstration purposes (up to 6 files).
    *   There were temporary changes involving wrapping the form within a `Card` component, which was then reverted.
    *   The success toast message upon upload was made more generic from "All files uploaded successfully!" to "file uploaded successfully!".
    *   The submit button text was changed from "Save" to "Upload Files".

### Timestamps of Significant Changes:

*   **11:12 AM:** Initial page setup and a minor text correction.
*   **11:18 AM - 11:23 AM:** Major redefinition of grid columns in `upload-doc-coulmn.tsx` from old date/user fields to `file`, `json_data`, `date_time`.
*   **11:19 AM:** Introduction of the `ConfirmLineBookingForm` component with core upload and display logic.
*   **11:28 AM - 11:38 AM:** Iterative development of the `json_data` column's rendering and download functionality.
*   **11:34 AM:** Implementation of downloadable links for the `file` column.
*   **11:51 AM - 11:54 AM:** Extensive adjustments to column widths and text/hover colors for better visual consistency.
*   **11:57 AM - 12:01 PM:** Experimentation with component wrapping (Card component) and subsequent reversion.
*   **12:02 PM:** Final minor text changes to toast messages and button labels.

### Patterns and Recurring Elements:

*   **Iterative Development and Refinement:** Many changes involve small, incremental adjustments to UI elements (text, colors, widths) and code logic (especially for `json_data` rendering), indicating an iterative development process with frequent commits to fine-tune features.
*   **Tight Coupling of Data and UI:** The `tableDummyData` in `uploadDocs.tsx` was consistently updated to align with the evolving column definitions in `upload-doc-coulmn.tsx`, highlighting a direct relationship between the data presented and its display structure.
*   **Focus on File Upload UX:** Features like drag-and-drop, file listing with removal, and visual feedback (toasts, uploading state) show a strong emphasis on a user-friendly file upload experience.
*   **Component-Based Architecture:** The use of `PageWrapper`, `Card`, `AppGrid`, `ConfirmLineBookingForm`, and utility components (`@components/kit/button`, `@mui/icons-material/Upload`) demonstrates a modular React component approach.
*   **API Integration:** The presence of `useUploadDocumentMutation` indicates that the frontend is designed to interact with a backend API for file storage and management.
*   **Styling with Tailwind CSS:** Extensive use of utility classes (e.g., `text-gray-900`, `border-dashed`, `bg-black`, `text-red-500`, `text-[#09090B]`) points to Tailwind CSS being the primary styling framework.
*   **Debugging and Experimentation:** The `console.log` statements, commented-out code blocks, and multiple revisions of rendering logic suggest active debugging and experimentation during the development of complex features like JSON data display.

## 1:23:53 PM
The provided logs detail a series of front-end code changes, primarily focusing on improving the user experience and data filtering capabilities within a dashboard and layout structure. The changes revolve around state management, API integration, and UI component rendering.

### File-Specific Updates:

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\components\core\sidebar-layout.tsx`**
    *   **Timestamp:** 11/5/2025, 2:54:04 PM
    *   Initial setup of `AppSidebarLayout` component, importing various UI elements like `Avatar`, `Dropdown`, `Navbar`, `SidebarLayout`, and icons from `@heroicons/react`. It integrates a `SideBar` component.
    *   **Timestamps:** 11/5/2025, 4:33:08 PM and 11/5/2025, 4:33:15 PM
    *   Minor, seemingly experimental change: "kk" was temporarily added to the `NavbarSpacer` component and then removed shortly after.
    *   **Timestamp:** 11/5/2025, 9:14:23 PM
    *   The "kk" was removed from `NavbarSpacer`, restoring the component to its original state from 2:54:04 PM.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\pages\dashboard\dashboard-page.tsx`**
    *   **Timestamp:** 11/5/2025, 2:58:06 PM (and subsequent minor changes at 2:58:53 PM, 3:03:35 PM, 3:03:46 PM)
    *   This file is a central point for dashboard logic. It involves fetching shipment and delivery data, managing filters (date range, card filters, shipment status), pagination, and sorting using Redux (`useDispatch`, `useSelector`) and RTK Query (`useFetchShipmentDataQuery`, `useFetchCartDataQuery`, `useFetchDeliveryDataQuery`).
    *   A `cardLabelMap` is defined for dashboard card types, and `getStartOfWeek` utility is present.
    *   The `weekData` memoization logic determines delivery modes (Rail, Door, Port Delivery) based on various date and location attributes.
    *   Event handlers for pagination (`handlePage`, `handlePageSizeChange`), filters (`handleFilterChange`, `handleClearFilters`), and card clicks (`handleCardClick`) are implemented. A `scrollTo` function is used for UI navigation.
    *   **Timestamp:** 11/5/2025, 6:07:06 PM, 6:08:04 PM, 6:09:52 PM
    *   Introduction of `CompanyName: localUser?.companyname ? localUser.companyname : ""` parameter to `useFetchCartDataQuery`. This suggests a change to filter dashboard card data based on the logged-in user's company, specifically if they are a customer.
    *   **Timestamp:** 11/5/2025, 6:13:35 PM
    *   Added an `useEffect` hook to dispatch `setCustomer(localUser.companyname)` if `localUser?.role` is "CUSTOMER", ensuring the customer context is set when the dashboard page loads.
    *   **Timestamp:** 11/5/2025, 9:01:12 PM
    *   Modified the `CompanyName` parameter in `useFetchShipmentDataQuery` and `useFetchCartDataQuery` to use `dashboardSelector.selectedCustomer || localUser.companyname`. This indicates a shift towards a global customer selection, falling back to the local user's company name if no specific customer is selected in the dashboard's Redux state.
    *   **Timestamp:** 11/5/2025, 9:11:03 PM
    *   Removed the `useEffect` responsible for setting the customer for "CUSTOMER" roles directly within `dashboard-page.tsx`. This logic seems to be externalized, likely to the main layout or global state management. The `selectedCustomer` is now explicitly pulled from `state.globalSlice`.
    *   **Timestamps:** 11/5/2025, 10:36:47 PM to 11/5/2025, 11:28:59 PM (multiple minor edits)
    *   The primary recurring change here is adding console logs for `selectedCustomer` and `localUser` to debug the customer selection logic.
    *   **Timestamp:** 11/5/2025, 10:42:24 PM
    *   The `CompanyName` parameter in `useFetchCartDataQuery` was further refined to consistently include `selectedCustomer || localUser.companyname`, even when `fromDate` and `toDate` are not provided.
    *   **Timestamps:** 11/5/2025, 11:15:22 PM to 11/5/2025, 11:28:59 PM (multiple minor edits)
    *   Reverted the dashboard logic for `CompanyName` in API calls from `selectedCustomer || localUser.companyname` back to simply checking date ranges or an empty string, and completely removed the `selectedCustomer` dependency from the API calls within this component. It also removed `setCustomer` from the import, implying its removal from Redux actions specific to the dashboard slice. The console logs for `selectedCustomer` and `localUser` remain, indicating ongoing debugging or monitoring of these values. This suggests a re-evaluation of how `CompanyName` filtering is applied directly within the dashboard's API queries. The `useEffect` for setting customer for "CUSTOMER" roles remains commented out.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\components\core\usercard.tsx`**
    *   **Timestamp:** 11/5/2025, 3:05:14 PM
    *   A `UserCard` component is responsible for displaying user information and providing a logout mechanism. It retrieves user data from local storage and user preferences from an API. It includes a `getInitials` utility. The logout function handles both "auth0" and "normal" authentication types, clearing local storage and dispatching a Redux logout action.
    *   **Timestamps:** 11/5/2025, 4:23:14 PM, 4:24:19 PM
    *   Imported `useAccess`, `SelectCustomerPanel`, and `useSelector` to potentially display a customer selection panel based on user permissions, pulling `toolState` from `analyticSlice`. `SelectCustomerPanel` was rendered conditionally.
    *   **Timestamps:** 11/5/2025, 4:30:28 PM, 4:30:34 PM
    *   Commented out the `permission = useAccess()` hook, and `SelectCustomerPanel` is still rendered but its usage of `toolState.selectedCustomer` might be affected by the commented permission hook. The `permission` import from `process` was also removed.
    *   **Timestamp:** 11/5/2025, 4:31:21 PM
    *   Re-introduced `useAccess` hook and `permission` variable, allowing for conditional rendering based on user access rights. `SelectCustomerPanel` remains present.
    *   **Timestamp:** 11/5/2025, 4:32:38 PM
    *   `SelectCustomerPanel` component was removed from the `UserCard`'s render, indicating that the customer selection logic might be moving elsewhere.
    *   **Timestamp:** 11/5/2025, 8:45:40 PM
    *   Changed the `DropdownLabel` text from "Sign out1" to "Sign out".

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\components\screen\analytics\AnalyticsToolbar.tsx`**
    *   **Timestamp:** 11/5/2025, 3:53:07 PM (and subsequent identical changes at 3:53:47 PM, 3:53:57 PM)
    *   This component manages analytics dashboard filters and PDF export functionality. It uses Redux for state management (`setDashboard`, `setFilterType`, `setGlobalFilter`, `setOperationType`) and handles date range selection and custom views.
    *   Includes a `downloadDashboardPDF` function leveraging `jsPDF` and `html2canvas-pro` to export the dashboard as a PDF, including a logo. Extensive commented-out code suggests previous iterations or debugging of the PDF export functionality, specifically around handling CSS properties and image loading.
    *   The `getBase64Image` utility is added to convert an image to base64 for PDF embedding.
    *   Conditional rendering of `SelectCustomerPanel` based on `permission?.selectCustomer` is present.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\components\core\layout.tsx`**
    *   **Timestamp:** 11/5/2025, 4:20:15 PM (and subsequent minor changes at 4:21:01 PM, 4:21:20 PM)
    *   This layout component handles user authentication checks (token expiration) and redirects unauthenticated users. It also restricts "ADMIN" users from viewing data directly, prompting them to select a customer.
    *   **Timestamp:** 11/5/2025, 4:41:20 PM
    *   An `useEffect` hook was added to potentially set `localUser?.companyname` if the user role is "CUSTOMER", but `dispatch` was missing as a dependency or action.
    *   **Timestamp:** 11/5/2025, 4:42:14 PM
    *   Introduced `useDispatch` and dispatched `setCustomer(localUser.companyname)` for "CUSTOMER" roles, correctly linking customer data to Redux state.
    *   **Timestamp:** 11/5/2025, 6:10:32 PM
    *   Removed the `PageWrapper` component with its "Admin Dashboard" prompt, simplifying the layout for ADMIN users to `Main` and `Outlet`. The customer-setting `useEffect` for "CUSTOMER" roles was also removed.
    *   **Timestamp:** 11/5/2025, 9:12:02 PM
    *   Re-introduced `useDispatch` and the `useEffect` to dispatch `setSelectedCustomer(localUser.companyname)` for "CUSTOMER" roles. This now correctly targets the `global-slice` action instead of `analytics-slice` as in previous iterations of this logic.
    *   **Timestamp:** 11/5/2025, 11:02:58 PM
    *   Added `initializeSelectedCustomer` dispatch within the token expiration `useEffect` for authenticated users to load previously selected customer from local storage.
    *   **Timestamps:** 11/5/2025, 11:22:18 PM, 11:23:32 PM
    *   Toggle between using `initializeSelectedCustomer` (which loads from local storage) and not using it for authenticated users. The final state includes `initializeSelectedCustomer` for authenticated users.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\store\fretures\shipment-dashboard-slice.ts`**
    *   **Timestamp:** 11/5/2025, 6:12:29 PM
    *   Initializes the Redux slice for shipment dashboard state, including pagination, sorting, filters (shipment\_id, dates, status, POL, POD, container number), and `cardFilter`.
    *   Introduced `selectedCustomer` and `selectedDashobard` fields, and a `setCustomer` reducer to update `selectedCustomer` and set `selectedDashobard` to "Default".
    *   **Timestamp:** 11/5/2025, 6:13:25 PM
    *   Exported `setCustomer` action, making it available for other components to dispatch.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\store\api\dashboard-api.ts`**
    *   **Timestamp:** 11/5/2025, 8:39:50 PM
    *   Defines RTK Query API endpoints (`fetchDeliveryData`, `fetchCartData`) for fetching dashboard-related data. Both queries now accept `params` and construct a `queryString` to include them. The `CompanyName` parameter is notably **not** explicitly added here, suggesting it's handled at the component level or passed via `params`.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\types\shipment.types.ts`**
    *   **Timestamp:** 11/5/2025, 9:00:51 PM
    *   Updated the `DashboardState` interface to include `selectedCustomer: string;` and `selectedDashobard: string;` reflecting the new fields in the Redux slice.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\store\fretures\global-slice.ts`**
    *   **Timestamp:** 11/5/2025, 9:06:15 PM
    *   Created a new Redux slice named `global` with `selectedCustomer` state. It includes `setSelectedCustomer` and `clearSelectedCustomer` reducers.
    *   **Timestamp:** 11/5/2025, 11:02:03 PM
    *   Modified `globalSlice` to handle `selectedCustomer` as `string | null`. It now uses local storage to persist the `selectedCustomer` value and introduces `initializeSelectedCustomer` to load this value on app startup.
    *   **Timestamps:** 11/5/2025, 11:21:38 PM, 11:23:37 PM, 11:23:54 PM
    *   Minor adjustments to the `global-slice` interface and PayloadAction type definitions for `selectedCustomer` as `string | null`.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\store\store.ts`**
    *   **Timestamp:** 11/5/2025, 9:07:08 PM
    *   Integrated the new `globalSlice` into the `rootReducer`, making the global customer selection state available throughout the application.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\components\core\sidebar.tsx`**
    *   **Timestamp:** 11/5/2025, 9:07:53 PM, 9:08:12 PM
    *   Modified to import `setSelectedCustomer` from `global-slice`. The `SelectCustomerPanel` is now conditionally rendered inside the sidebar based on `localUser?.role === "ADMIN"`. The `selectedCustomer` state is retrieved from `state.globalSlice`. It also includes a `handleCustomerSelect` callback for `SelectCustomerPanel` to dispatch `setSelectedCustomer`. The logo and text in the header were vertically aligned using `items-center`.
    *   **Timestamp:** 11/5/2025, 9:15:46 PM
    *   Changed the import path for `SelectCustomerPanel` from `@components/screen/analytics/SelectCustomerPanel` to `SelectCustomer`. This implies the `SelectCustomerPanel` component was moved or renamed.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\components\screen\analytics\SelectCustomerPanel.tsx`**
    *   **Timestamp:** 11/5/2025, 9:08:52 PM
    *   This component provides a customer selection popover with search and pagination functionalities. It fetches customer options using `ApiManager.getPaginatedCompanyOptions` and dispatches `setCustomer` (from analytics-slice) upon selection. It uses debouncing for search input.
    *   **Timestamp:** 11/5/2025, 9:13:54 PM, 9:14:14 PM
    *   This file was renamed/moved to `src\components\screen\analytics\SelectCustomer.tsx`. The `SelectCustomerPanelProps` interface now includes an optional `onSelect` callback. More significantly, it now dispatches `setSelectedCustomer` from the *global-slice* instead of the *analytics-slice*, aligning with the refactored state management. Minor stylistic adjustments (gap in field, input padding) were also made.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\SelectCustomer.tsx`**
    *   **Timestamp:** 11/5/2025, 9:16:47 PM
    *   This file represents the final location/renaming of the `SelectCustomerPanel` component. The import paths for `ApiManager` and `setSelectedCustomer` were adjusted to reflect its new top-level `src` directory location.

### Patterns and Recurring Elements:

1.  **Redux/RTK Query Integration:** A consistent pattern of using `useDispatch` and `useSelector` from `react-redux` and RTK Query hooks (e.g., `useFetchShipmentDataQuery`, `useFetchCartDataQuery`, `useFetchDeliveryDataQuery`, `useFetchUserPreferenceQuery`) is evident across multiple files (`dashboard-page.tsx`, `usercard.tsx`, `AnalyticsToolbar.tsx`, `sidebar.tsx`).
2.  **State Management Refinements:** There's an ongoing evolution of state management, particularly regarding `selectedCustomer`.
    *   Initially, `dashboard-page.tsx` directly used `localUser.companyname` for API calls and briefly attempted to dispatch `setCustomer` within its `useEffect`.
    *   A `selectedCustomer` field was introduced in `shipment-dashboard-slice.ts` and `shipment.types.ts`.
    *   Later, a dedicated `global-slice.ts` was created for `selectedCustomer` to manage it globally, including persistence in local storage (`localStorage.setItem`, `localStorage.removeItem`, `initializeSelectedCustomer`).
    *   This `globalSlice`'s `selectedCustomer` then became the primary source for API calls in `dashboard-page.tsx` and for rendering in `sidebar.tsx` and `SelectCustomerPanel.tsx`.
3.  **Authentication and User Role Handling:** The `layout.tsx` component consistently handles token expiration and redirects unauthenticated users. It also includes specific logic for "ADMIN" users, originally to prompt for customer selection, and then "CUSTOMER" users to auto-set their company.
4.  **UI Component Usage:** Consistent use of custom UI components from `@components/kit` (e.g., `SidebarLayout`, `Navbar`, `Dropdown`, `Avatar`) and `@components/common` (e.g., `PageWrapper`, `Cards`, `Datagrid`, `DatePeriodSelector`) suggests a component-based architecture.
5.  **Debugging via `console.log`:** Frequent use of `console.log` statements (e.g., `console.log("==localuser",localUser);`, `console.log("===shipment data === :> ",ShipmentData);`, `console.log("==selectedCustomer",selectedCustomer);`) indicates active development and debugging during these changes. These logs often appear and disappear or are modified across consecutive commits in the same file.
6.  **PDF Export Logic:** The `AnalyticsToolbar.tsx` shows detailed implementation of client-side PDF generation using `jsPDF` and `html2canvas-pro`, with commented-out sections indicating iterative development and troubleshooting of styling issues during export.
7.  **Customer Selection Component Refactoring:** The `SelectCustomerPanel` component underwent changes in its Redux action dispatch (from analytics-slice to global-slice) and its import location within the project structure, suggesting a refactor to make it more generic and globally usable.

## 2:05:57 PM
Based on the provided log, all entries pertain to the file `c:\Users\ridap\OneDrive\Documents\Envosyes\envosys-backend\config\.env.development`. As per the instructions, summaries for file paths containing `.env` files or anything that may store keys are not to be generated. Therefore, no summary can be provided for these changes.