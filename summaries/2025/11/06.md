# Activity Summary for 11/6/2025

## 9:48:47 AM
The log details a series of code changes within a frontend application (T360-frontend-v2), primarily focusing on the dashboard, sidebar, and core layout components, along with related Redux slices and API integrations. The changes occurred between 11/5/2025, 2:54:04 PM and 11/5/2025, 11:28:59 PM.

### File-Specific Updates:

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\components\core\sidebar-layout.tsx`**
    *   **Timestamp: 11/5/2025, 2:54:04 PM:** Initial state or a minor change. The component is a `SidebarLayout` wrapping `Navbar` and `SideBar` components, displaying children as page content. It imports various UI components (Avatar, Dropdown, Navbar, SidebarLayout) and icons from `@heroicons/react`.
    *   **Timestamp: 11/5/2025, 4:33:08 PM & 11/5/2025, 4:33:15 PM:** A trivial change in the `Navbar` rendering, adding "kk" to the content (`<NavbarSpacer />kk`). This suggests a temporary or debugging change, which was likely reverted or removed later.
    *   **Timestamp: 11/5/2025, 9:14:23 PM:** The "kk" in the `Navbar` was removed, restoring the `NavbarSpacer` to its previous state.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\pages\dashboard\dashboard-page.tsx`**
    *   **Timestamp: 11/5/2025, 2:58:06 PM - 11/5/2025, 3:03:46 PM:** The `DashboardPage` component primarily deals with fetching and displaying shipment and delivery data. It uses Redux for state management, including pagination, filters, and sorting. Multiple API calls are made using `useFetchShipmentDataQuery`, `useFetchDeliveryDataQuery`, and `useFetchCartDataQuery`. There are functions for handling pagination (`handlePage`, `handlePageSizeChange`), filters (`handleFilterChange`, `handleClearFilters`), and card clicks (`handleCardClick`). It also includes logic for determining `deliveryMode` (Rail, Door, Port) and preparing calendar data. The initial entries show console logs for `localUser` and `ShipmentData`.
    *   **Timestamp: 11/5/2025, 6:07:06 PM - 11/5/2025, 6:09:52 PM:** A significant change was introduced in `useFetchCartDataQuery` parameters: `CompanyName: localUser?.companyname ? localUser.companyname : ""`, indicating that the cart data fetch now considers the user's company name. This suggests a move towards multi-tenancy or role-based data filtering.
    *   **Timestamp: 11/5/2025, 6:13:35 PM:** An `useEffect` hook was added to explicitly set the customer for users with the "CUSTOMER" role using `dispatch(setCustomer(localUser.companyname))`. This is a direct state update to reflect the customer's context.
    *   **Timestamp: 11/5/2025, 9:01:12 PM:** The `CompanyName` parameter in `useFetchShipmentDataQuery` and `useFetchCartDataQuery` was updated to prioritize `dashboardSelector.selectedCustomer` if available, falling back to `localUser.companyname`. This allows for dynamic customer selection beyond the logged-in user's default company.
    *   **Timestamp: 11/5/2025, 9:11:03 PM:** The `selectedCustomer` state is now read from `state.globalSlice` instead of `state.analyticSlice`, indicating a refactoring of how the selected customer is managed application-wide. The `useEffect` setting `setCustomer` for `CUSTOMER` roles was commented out, implying the `globalSlice` is now the primary source for `selectedCustomer`.
    *   **Timestamp: 11/5/2025, 10:36:47 PM - 11/5/2025, 10:54:28 PM:** Extensive console logs (`console.log("==selectedCustomer",selectedCustomer);` and `console.log("==localuser",localUser);`) were added or modified, likely for debugging purposes related to customer selection logic. The `CompanyName` parameter in `useFetchDeliveryDataQuery` and `useFetchCartDataQuery` was also refined to consistently use `selectedCustomer || localUser.companyname`.
    *   **Timestamp: 11/5/2025, 11:15:22 PM - 11/5/2025, 11:28:59 PM:** The `useSelector` hook for `selectedCustomer` was reverted to fetch from `state.globalSlice` (from `state.global`). The previously commented-out `useEffect` for setting customer for `CUSTOMER` role was removed, consolidating customer selection logic to `globalSlice`. Console logs related to `selectedCustomer` and `localUser` remain prominent, suggesting ongoing debugging or validation of the customer selection mechanism. The `setCustomer` action import from `shipment-dashboard-slice` was removed, reinforcing the move of customer selection logic to `global-slice`.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\components\core\usercard.tsx`**
    *   **Timestamp: 11/5/2025, 3:05:14 PM:** The `UserCard` component handles user display and logout functionality. It retrieves user data from local storage and user preferences from an API (`useFetchUserPreferenceQuery`). The `handleLogout` function supports both Auth0 and normal logout flows, clearing `localStorage` and dispatching a Redux `auth/logout` action. The dropdown menu provides a "Sign out1" option.
    *   **Timestamp: 11/5/2025, 4:23:14 PM - 11/5/2025, 4:32:38 PM:** The component was modified to import `useAccess` and `SelectCustomerPanel`, and it started selecting `toolState` from `analyticSlice`. The `SelectCustomerPanel` was briefly added within the `Dropdown` component, conditionally rendered based on `permission?.selectCustomer`, then removed. This indicates an attempt to integrate customer selection directly into the user card dropdown, which was subsequently reverted or moved.
    *   **Timestamp: 11/5/2025, 8:45:40 PM:** A minor cosmetic change: "Sign out1" in the dropdown menu was changed to "Sign out".

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\components\screen\analytics\AnalyticsToolbar.tsx`**
    *   **Timestamp: 11/5/2025, 3:53:07 PM - 11/5/2025, 3:53:57 PM:** The `AnalyticsToolbar` component manages various filters and actions for analytics dashboards, including date range, custom view management, and PDF export. It uses Redux for state management of global filters, dashboard selection, and operation types. It includes a `downloadDashboardPDF` function which was revised multiple times. The main change visible across these entries is the `downloadDashboardPDF` function, which was initially commented out, then re-implemented to use `html2canvas` and `jspdf` for generating PDFs of the dashboard, including handling logo and scaling. This function also contained commented-out code for attempting to fix rendering issues with CSS variables and filters.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\components\core\layout.tsx`**
    *   **Timestamp: 11/5/2025, 4:20:15 PM - 11/5/2025, 4:21:20 PM:** The `Layout` component provides the main application structure, handling user authentication (token expiry check) and routing. It restricts "ADMIN" users to a specific "Admin Dashboard" view. The changes in this window were minor, adding comments to the token expiry function.
    *   **Timestamp: 11/5/2025, 4:41:20 PM & 11/5/2025, 4:42:14 PM:** A new `useEffect` hook was introduced to dispatch the `setCustomer` action from `analytics-slice` if the `localUser` has a "CUSTOMER" role. This ensures the customer context is set upon layout rendering for customer accounts. The `dispatch` dependency was added to the `useEffect` array.
    *   **Timestamp: 11/5/2025, 6:10:32 PM:** The logic for setting `setCustomer` for CUSTOMER role was removed from `Layout.tsx`.
    *   **Timestamp: 11/5/2025, 9:12:02 PM:** Reintroduced `dispatch(setSelectedCustomer(localUser.companyname));` within a `useEffect` for `CUSTOMER` roles, this time importing `setSelectedCustomer` from `global-slice`. This shows a shift in where customer state is managed.
    *   **Timestamp: 11/5/2025, 11:02:58 PM - 11/5/2025, 11:23:32 PM:** The `Layout` component was updated to initialize `selectedCustomer` from `localStorage` using `initializeSelectedCustomer()` from `global-slice` if the token is valid. This ensures persistence of the selected customer across sessions. The dependency array for the `useEffect` setting `setSelectedCustomer` for `CUSTOMER` roles was adjusted to include optional chaining (`localUser?.role`, `localUser?.companyname`).

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\store\fretures\shipment-dashboard-slice.ts`**
    *   **Timestamp: 11/5/2025, 6:12:29 PM & 11/5/2025, 6:13:25 PM:** The `shipmentDashboardSlice` reducer was updated to include a `setCustomer` action, which sets `selectedCustomer` and defaults `selectedDashobard` to "Default". This change was later reverted or superseded by the `global-slice` refactoring. The `setCustomer` action was exported in the later timestamp.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\store\api\dashboard-api.ts`**
    *   **Timestamp: 11/5/2025, 8:39:50 PM:** No significant changes other than the timestamp, indicating this file was likely reviewed or part of a commit. It defines API endpoints for fetching delivery and card data, utilizing `getAppHeaders()` for authentication.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\types\shipment.types.ts`**
    *   **Timestamp: 11/5/2025, 9:00:51 PM:** No significant code changes. The file defines TypeScript interfaces for shipment-related data structures (`EventAttributes`, `MilestoneItem`, `ShipmentStatusType`, `SortModelItem`, `ShipmentScopeValues`, `DashboardState`, `DashboardCardInfoState`). This indicates definition and structure remained stable.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\store\fretures\global-slice.ts`**
    *   **Timestamp: 11/5/2025, 9:06:15 PM:** A new Redux slice, `globalSlice`, was introduced to manage a `selectedCustomer` state. It provides `setSelectedCustomer` and `clearSelectedCustomer` reducers.
    *   **Timestamp: 11/5/2025, 11:02:03 PM - 11/5/2025, 11:23:54 PM:** The `globalSlice` was enhanced to persist `selectedCustomer` in `localStorage` using `setSelectedCustomer` and to retrieve it on initialization via `initializeSelectedCustomer`. The `PayloadAction` type was added for `setSelectedCustomer`. The `name` of the slice was explicitly set to "globalSlice" in the payload type definition.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\store\store.ts`**
    *   **Timestamp: 11/5/2025, 9:07:08 PM:** The `rootReducer` was updated to include the new `globalSlice` under the key `globalSlice`.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\components\core\sidebar.tsx`**
    *   **Timestamp: 11/5/2025, 9:07:53 PM & 11/5/2025, 9:08:12 PM:** The `SideBar` component was heavily modified to integrate the `SelectCustomerPanel`. It now imports `setSelectedCustomer` from `global-slice` and uses `selectedCustomer` from the global state. Crucially, the `SelectCustomerPanel` is now rendered conditionally, appearing only for "ADMIN" users, and includes an `onSelect` callback to update the global `selectedCustomer` state. Minor styling adjustments (items-center) were also made.
    *   **Timestamp: 11/5/2025, 4:34:00 PM - 11/5/2025, 4:37:01 PM:** The `Sidebar` component was updated to include a `SelectCustomerPanel` based on `useAccess` and `toolState` from `analyticSlice`. It also had temporary "kk" text added to `SidebarLabel` at one point, which was then removed. The `SelectCustomerPanel` was moved to be conditionally rendered based on `permission?.selectCustomer`.
    *   **Timestamp: 11/5/2025, 9:15:46 PM:** The import path for `SelectCustomerPanel` was changed from `@components/screen/analytics/SelectCustomerPanel` to a direct relative import `SelectCustomer`. This likely indicates a refactoring and relocation of this component.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\components\screen\analytics\SelectCustomerPanel.tsx`**
    *   **Timestamp: 11/5/2025, 9:08:52 PM:** The `SelectCustomerPanel` component was introduced or significantly revised. It allows for searching, pagination, and selection of customers, using Material-UI components (Box, List, Popover, TextField, Pagination). It dispatches `setCustomer` from `analytics-slice` upon selection. It uses `lodash.debounce` for search input.
    *   **Timestamp: 11/5/2025, 9:13:54 PM & 11/5/2025, 9:14:14 PM:** This component was renamed to `SelectCustomer.tsx` (implied by the subsequent `sidebar.tsx` change, although the file path here remains `SelectCustomerPanel.tsx`). It was updated to dispatch `setSelectedCustomer` from the `global-slice` instead of `analytics-slice`. An `onSelect` callback prop was added to allow parent components to react to customer selection. The component now displays "No results found" if no options are available. The styles were also adjusted.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\SelectCustomer.tsx`**
    *   **Timestamp: 11/5/2025, 9:16:47 PM:** This file is effectively the renamed and relocated version of `SelectCustomerPanel.tsx`. It confirms the changes from the previous timestamp, showing `setSelectedCustomer` from `global-slice` and the `onSelect` prop. The import for `ApiManager` was changed from a relative path to an absolute path (`services/ApiManager`).

### Patterns and Recurring Elements:

1.  **Redux State Management Refactoring:** A prominent pattern is the shifting of `selectedCustomer` state management. Initially, `dashboard-page.tsx` directly used `localUser.companyname`, then it was passed to `useFetchCartDataQuery` and `useFetchShipmentDataQuery`. Later, a `setCustomer` action was introduced in `shipment-dashboard-slice.ts`, then moved to `analytics-slice`, and finally consolidated into a dedicated `global-slice.ts` for application-wide customer selection. This indicates a move towards a more centralized and robust global state management for the selected customer, especially for "ADMIN" users who can select different customers.
2.  **API Query Parameter Refinement:** Multiple instances show the addition of `CompanyName: selectedCustomer || localUser.companyname` to API queries (e.g., in `useFetchShipmentDataQuery`, `useFetchDeliveryDataQuery`, `useFetchCartDataQuery`). This ensures that API calls dynamically adjust based on the globally selected customer or the logged-in user's default company.
3.  **Authentication and User Role Handling:** The `Layout.tsx` component includes logic to check token validity and redirect on expiry. It also has specific rendering logic for "ADMIN" users, displaying a message to select a customer. The `UserCard.tsx` also handles user-specific data and logout based on authentication type (Auth0 or normal).
4.  **Debugging via `console.log`:** Frequent additions of `console.log` statements (e.g., `console.log("==localuser",localUser);`, `console.log("===shipment data === :> ",ShipmentData);`, `console.log("==selectedCustomer",selectedCustomer);`) indicate active debugging during development, especially around data fetching and customer context.
5.  **Component Refactoring and Relocation:** The `SelectCustomerPanel` component was initially integrated into `AnalyticsToolbar.tsx` and briefly into `UserCard.tsx`, then later moved to its own file (`src\SelectCustomer.tsx`) and integrated into `Sidebar.tsx` specifically for "ADMIN" users. This suggests an evolution in component responsibility and placement for better modularity and access control.
6.  **Minor UI/UX Adjustments:** Small changes like "Sign out1" becoming "Sign out" and the temporary "kk" in the `Navbar` demonstrate iterative UI/UX refinements.
7.  **PDF Export Functionality:** The `AnalyticsToolbar.tsx` shows a continuous effort to improve the PDF export functionality, including handling image conversion and embedding, with commented-out code indicating challenges faced during implementation (e.g., CSS variable/color function overrides).