# Activity Summary for 11/5/2025

## 9:40:09 AM
The `src\routes\index.ts` file, updated at 11/4/2025, 7:35:07 PM, underwent significant expansion to consolidate and register a wide array of API routes for the backend. New routes were added for authentication, customer management, line bookings, customer bookings, document uploads, vessel management, vendor management, and job management. Additionally, dedicated endpoints for autocomplete search (`/autocomplete`) and audit logs (`/audit`) were integrated, utilizing `getAll` from `searchOptions` and `getAllAudit` from `auditService` respectively. A previously existing `EnquiryRoutes` section was commented out.

Following shortly after, at 11/4/2025, 7:43:53 PM, the `src\middleware\uploadMiddleware.ts` file was introduced or updated to implement a robust and flexible file upload mechanism. This file exports an `uploadMiddleware` factory function that leverages `multer` for disk storage. Key features include:
*   **Dynamic folder creation:** The middleware can create highly specific destination folders, optionally including `year/month/day/hour-minute-second` within a `mainFolder/subFolder` structure, ensuring unique and organized storage paths.
*   **Directory Management:** It automatically creates the necessary directories recursively if they don't exist.
*   **Unique Filenaming:** Files are renamed upon upload to include a timestamp-based unique suffix, preventing name collisions while retaining the original base name and extension.
*   **File Filtering and Limits:** It accepts all file types by default (though customizable) and enforces a 10MB file size limit.
*   **Versatile Handlers:** The factory function returns an object containing various `multer` handlers (`single`, `array`, `fields`, `any`) to support different file upload scenarios, making it highly adaptable for handling single files, multiple files, or files associated with specific form fields.

The changes indicate a focused development effort within a short timeframe on 11/4/2025, primarily enhancing the backend's routing capabilities to support core business logic and introducing a sophisticated file upload system, suggesting that document management is a critical component of the application.

## 9:41:05 AM
The codebase reflects a focused effort on implementing and refining a document upload feature, alongside a broader expansion of the Redux store.

**File-Specific Updates:**

*   **`c:\Users\ridap\OneDrive\Documents\Envosyes\envosys-frontend\src\store\store.ts` (11/4/2025, 5:57:55 PM):** This file underwent a significant expansion, integrating numerous new Redux API slices and feature slices. Key additions include `customerDataApi`, `uploadDocumentApi`, `lineBookingApi`, `customerBookingApi`, `vesselAndVoyageDataApi`, `jobApi`, `vendorDataApi`, `auditDataApi`, and `enquiryDataApi`. Corresponding feature slices like `customerDashboardSlice`, `lineBookingSlice`, `voyageDashboardSlice`, `jobDashboardSlice`, and `customerBookingSlice` were also added, indicating a substantial increase in the application's data management capabilities.

*   **`c:\Users\ridap\OneDrive\Documents\Envosyes\envosys-frontend\src\pages\upload-docs\uploadDocs.tsx`**: This file shows a clear evolution of the `UploadDocs` page component:
    *   **Initial Creation (11/4/2025, 6:01:03 PM - 6:01:47 PM):** Started as a simple placeholder React component, quickly renamed to `UploadDocs` (PascalCase).
    *   **Layout Integration (11/4/2025, 6:02:46 PM):** Incorporated a `PageWrapper` component for basic UI structure.
    *   **Feature Implementation (11/4/2025, 6:13:16 PM - 6:19:01 PM):** Transformed into a modal-like component with form management (`useFormik`), state for file uploads (`uploadedFile`, `isDragOver`), drag-and-drop functionality, and basic UI elements for a "Confirm Line Booking" action. It also shifted from a default to a named export.
    *   **Component Refactoring (11/4/2025, 6:24:18 PM - 6:29:14 PM):** The core form logic was extracted into a new component named `ConfirmLineBookingForm` (which was then moved to `components/screen/upload-docs/uploadDocs.tsx`). The `pages` file then became a wrapper, importing and rendering this new form component. The title was also updated from "Confirm Line Booking" to "Upload Documents".
    *   **Final Page Structure (11/4/2025, 7:21:01 PM - 7:22:21 PM):** The page component removed the `bg-gray-100` class and fully integrated `ConfirmLineBookingForm` within `PageWrapper.Content`, showcasing a structured layout.

*   **`c:\Users\ridap\OneDrive\Documents\Envosyes\envosys-frontend\src\components\screen\upload-docs\uploadDocs.tsx`**: This new file was created as the destination for the refactored document upload component.
    *   **Initial Move (11/4/2025, 6:28:22 PM):** The `ConfirmLineBookingForm` component was moved here, retaining its functionality from the `pages` directory.
    *   **Form Simplification and Renaming (11/4/2025, 6:30:54 PM - 6:31:38 PM):** The "Delivery Order No." input was removed, and the component's internal title changed to "Upload Documents".
    *   **Multiple File Upload Capability (11/4/2025, 7:14:53 PM):** A significant enhancement was introduced, allowing multiple files to be uploaded. The state was updated to `uploadedFiles` (an array), and the file handling logic was modified to append unique files. The UI was adapted to list multiple uploaded files.
    *   **UI/UX Refinements (11/4/2025, 7:16:49 PM - 7:20:24 PM):** Improvements were made to the file input (resetting value after selection, z-index for button overlay), drag-and-drop styling, and overall component appearance (e.g., adding `bg-white`, `shadow-sm`, adjusting text colors).
    *   **Backend Integration (11/4/2025, 7:30:35 PM - 7:32:51 PM):** The component was integrated with `useUploadDocumentMutation` from Redux Toolkit Query to handle actual file uploads to a backend API. This involved processing each selected file in a loop, constructing `FormData`, and sending it to the `/uploadDocument` endpoint. Validation for empty uploads, loading states, and toast notifications for success/failure were added, making it a robust upload mechanism. The submit button text also changed from "Confirm" to "Save".

*   **`c:\Users\ridap\OneDrive\Documents\Envosyes\envosys-frontend\src\App.tsx`**: This file received updates to reflect the changes in the `uploadDocs` component.
    *   **Route Addition (11/4/2025, 6:01:52 PM):** A new route `/upload-docs` was added, pointing to the `UploadDocs` component.
    *   **Import Adjustments (11/4/2025, 6:15:23 PM - 6:29:36 PM):** The import statement for `UploadDocs` was updated to reflect its change from a default export to a named export.

**Patterns and Recurring Elements:**

*   **Component Refactoring and Organization:** There's a clear pattern of initial development within a `pages` directory, followed by refactoring the core logic into a dedicated component within a `components/screen` directory for better reusability and separation of concerns.
*   **Progressive Enhancement:** The document upload feature was developed incrementally, starting from a basic placeholder, then adding drag-and-drop, single file upload, multiple file upload, and finally backend API integration with comprehensive feedback.
*   **Styling Consistency:** Extensive use of Tailwind CSS classes for consistent styling across UI elements, including dynamic styling for drag-and-drop interactions.
*   **Form Management:** The `useFormik` hook is a recurring element for handling form state, validation, and submission logic.
*   **Redux Toolkit Query Integration:** The Redux store updates and the final implementation of the file upload component demonstrate a strong reliance on Redux Toolkit Query for managing asynchronous data operations and API interactions.
*   **Iconography:** Icons from `@mui/icons-material` (Upload, Close) and `react-icons/fi` (FiFileText, FiTrash2) are consistently used for visual cues, with a brief deviation to `react-icons/hi` before reverting.

## 10:40:50 AM
The log indicates a series of backend infrastructure updates, all occurring on November 4, 2025.

The following changes were observed in specific files:

*   **`c:\Users\ridap\OneDrive\Documents\Envosyes\envosys-backend\src\routes\index.ts`** (Timestamp: 11/4/2025, 7:35:07 PM): This file, responsible for main API routing, was updated to include and register several new or existing route modules. These modules cover authentication (`AuthRoutes`), customer management (`CustomerRoutes`, `CustomerBookingRoutes`), line bookings (`LineBookingRoutes`), document handling (`DocumentRoutes`), vessel operations (`VesselRoutes`, `VesselAndVoyageRoutes`), vendor management (`VendorRoutes`), and job-related functionalities (`JobRoutes`). It also integrates `getAll` for autocomplete features and `getAllAudit` for audit services. An `EnquiryRoutes` import and usage were found commented out.

*   **`c:\Users\ridap\OneDrive\Documents\Envosyes\envosys-backend\src\middleware\uploadMiddleware.ts`** (Timestamp: 11/4/2025, 7:43:53 PM): A new `uploadMiddleware` factory function was introduced or modified. This middleware leverages `multer` to handle file uploads, allowing for dynamic folder creation based on `mainFolder`, `subFolder`, and an optional `dateFolder` parameter which creates a nested directory structure down to hour-minute-second for precise timestamping. It ensures target directories exist, configures disk storage to generate unique filenames by appending a timestamp, and sets a default file size limit of 10MB. The middleware returns various `multer` upload methods (single, array, fields, any) wrapped as Express `RequestHandler`s.

**Patterns and Recurring Elements:**
All significant code changes occurred on the same day, November 4, 2025, within a short span, indicating a focused development session on backend functionalities. The updates primarily involve setting up new API routes and enhancing file upload capabilities with dynamic folder structuring, suggesting work on expanding the system's core features and data management.

## 10:41:14 AM
The log primarily details significant frontend development activities, focusing on the expansion of Redux state management and the iterative development of a new document upload feature.

**File-Specific Updates:**

*   **`c:\Users\ridap\OneDrive\Documents\Envosyes\envosys-frontend\src\store\store.ts`** (Timestamp: 11/4/2025, 5:57:55 PM)
    *   The Redux store configuration underwent a substantial expansion. Numerous new API slices (`vesseDataApi`, `uploadDocumentApi`, `customerDataApi`, `lineBookingApi`, `customerBookingApi`, `vesselAndVoyageDataApi`, `jobApi`, `vendorDataApi`, `auditDataApi`, `enquiryDataApi`) and feature slices (`userReducer`, `enquiryDetailsFormReducer`, `bookingDetailsFormReducer`, `mblDeatilsFormReducer`, `invoiceChargeDetailsReducer`, `vessalVoyageReducer`, `vendorDetailsFormReducer`, `boxPlanDetailsFormReducer`, `customerDetailsReducer`, `vesselDashboardSlice`, `customerDashboardSlice`, `customerFormSlice`, `lineBookingSlice`, `lineBookingDashboardSlice`, `voyageDashboardSlice`, `jobDashboardSlice`, `customerBookingSlice`, `vendorDashboardSlice`, `customerDashboardDataSlice`) were added to the `combineReducers` and `middleware`. This indicates a significant increase in the application's complexity and scope, with more data models and associated API interactions being integrated into the global state.

*   **`c:\Users\ridap\OneDrive\Documents\Envosyes\envosys-frontend\src\pages\upload-docs\uploadDocs.tsx`**
    *   **Initial creation (11/4/2025, 6:01:03 PM - 6:01:47 PM)**: Started as a basic React functional component displaying "uploadDocs".
    *   **UI Structure Integration (11/4/2025, 6:02:46 PM)**: Wrapped in `PageWrapper` components for layout.
    *   **Functional Refactor to Modal (11/4/2025, 6:13:16 PM - 6:19:01 PM)**: Transformed into a `ConfirmLineBookingPopupProps` component, acting as a modal with drag-and-drop file upload capabilities using `useFormik`, `@mui/icons-material`, and `react-icons/fi`. It handled a single file upload with a "Delivery Order No." input. The export type changed from default to named (`export const UploadDocs`). Minor styling adjustments and icon changes (`X` to `Close`).
    *   **Component Relocation and Wrapper (11/4/2025, 6:28:52 PM - 6:29:14 PM)**: The core form logic was extracted into a new component `ConfirmLineBookingForm` located at `src\components\screen\upload-docs\uploadDocs.tsx`. This file then became a wrapper page, importing and rendering `ConfirmLineBookingForm`. The component was also renamed from `Home` to `UploadDocs`.
    *   **Layout Integration (11/4/2025, 7:22:21 PM)**: The `UploadDocs` page component was further integrated into the application's `PageWrapper` layout, featuring a left sidebar (`PageWrapper.Left`) and main content area (`PageWrapper.Content`).

*   **`c:\Users\ridap\OneDrive\Documents\Envosyes\envosys-frontend\src\components\screen\upload-docs\uploadDocs.tsx`**
    *   **Creation and Initial Form (11/4/2025, 6:24:18 PM)**: This file was created, initially named `ConfirmLineBookingForm`, and contained the detailed file upload form logic previously in `src\pages\upload-docs\uploadDocs.tsx`. It included input for "Delivery Order No." and single file upload with drag-and-drop. It utilized local UI components like `@components/kit/button`, `@components/kit/input`, `@mui/icons-material/Label`.
    *   **Feature Refinement & Multi-File Support (11/4/2025, 6:30:54 PM - 7:14:53 PM)**:
        *   The "Delivery Order No." input field was removed from the UI (though `formik.initialValues` retained it).
        *   The component title changed from "Confirm Line Booking" to "Upload Documents".
        *   **Crucially, it was refactored to support multiple file uploads** by changing `uploadedFile` state to `uploadedFiles: File[]`, modifying `handleFileUpload` to append unique files, and updating the UI to display a list of uploaded files with individual remove buttons. The file input was made `multiple`.
    *   **UI/UX Enhancements (11/4/2025, 7:16:49 PM - 7:20:24 PM)**: Improvements were made to the drag-and-drop area's styling, `z-index` for the file input overlay, and the default background color of the form and file list items. The `handleFileInputChange` was updated to clear the input value, allowing re-selection of the same file.
    *   **Backend Integration and Submission Logic (11/4/2025, 7:30:35 PM - 7:32:51 PM)**:
        *   Integrated `useUploadDocumentMutation` from `store/api/uploadDocumentApi` and `react-hot-toast` for user feedback.
        *   The component's logic was significantly overhauled. The `onSubmit` function now iterates through the `uploadedFiles`, constructs `FormData` for each, and calls the `uploadDocument` mutation. It includes loading states (`isUploading`), error handling, and success/error toasts.
        *   The form clears uploaded files and resets on successful submission or when "Cancel" is clicked.
        *   Despite the multi-file functionality being re-introduced, the `deliveryOrderNo` input is still not rendered, but its value from `formik.initialValues` is used as a "remark" in the `FormData`.
    *   **Minor Styling Adjustments (11/4/2025, 7:44:45 PM)**: No functional changes, only minor whitespace and code formatting.

*   **`c:\Users\ridap\OneDrive\Documents\Envosyes\envosys-frontend\src\App.tsx`**
    *   **Integration of `UploadDocs` Route (11/4/2025, 6:01:52 PM)**: A new route `/upload-docs` was added, pointing to the `UploadDocs` page component, making the new feature accessible in the application.
    *   **Import Adjustments (11/4/2025, 6:15:23 PM - 6:29:36 PM)**: The import statement for `UploadDocs` was adjusted to reflect changes in its export type (named vs. default) in its respective file (`src\pages\upload-docs\uploadDocs.tsx`).

**Patterns and Recurring Elements:**

*   **Redux Toolkit for State Management and APIs:** The `store.ts` file shows extensive use of `@reduxjs/toolkit` for managing application state and integrating with various APIs (e.g., `vesseDataApi`, `customerDataApi`, `uploadDocumentApi`). This indicates a standardized approach to data fetching and state handling.
*   **Component-Based Development:** The document upload feature was developed iteratively, starting as a single component, then refactored into a parent page (`pages/upload-docs`) wrapping a dedicated, reusable form component (`components/screen/upload-docs`). This demonstrates a clear separation of concerns and reusability.
*   **Formik for Form Handling:** `useFormik` is consistently used for managing form state, initial values, and submission logic in the upload components.
*   **Drag-and-Drop File Upload:** The document upload feature heavily relies on drag-and-drop functionality, complemented by a traditional file input button, providing a user-friendly interface for file selection.
*   **Styling with Tailwind CSS:** The presence of utility classes like `bg-black/40`, `text-lg font-semibold text-gray-800`, `border-2 border-dashed`, `rounded-md px-3 py-2`, `space-y-4` across the UI components suggests the use of Tailwind CSS for styling.
*   **Icon Library Usage:** Icons from `@mui/icons-material` (Upload, X/Close, Label) and `react-icons/fi` (FiFileText, FiTrash2) are frequently used for visual cues.
*   **Progressive Enhancement/Refinement:** The document upload component underwent multiple stages of refinement, from a basic placeholder to a fully functional multi-file uploader with backend integration, error handling, and UI feedback.
*   **Frontend-Backend Integration:** The integration of `useUploadDocumentMutation` and `FormData` directly within the component's `onSubmit` logic highlights a direct coupling between the frontend form submission and the backend API for document uploads.

## 11:41:03 AM
The recent code changes primarily focus on enhancing document management functionalities, including file uploading, storage, and retrieval, along with updates to API routing.

**File-specific Updates:**

*   **`src\routes\index.ts` (11/4/2025, 7:35:07 PM):** An `Audit` route (`apiRouter.use(Paths.Audit.Base, getAllAudit)`) was introduced, integrating `getAllAudit` from `auditService`. Concurrently, `EnquiryRoutes` and its corresponding usage were commented out, indicating a temporary suspension or deprioritization of that feature.
*   **`src\middleware\uploadMiddleware.ts` (11/4/2025, 7:43:53 PM):** This file underwent a significant update, introducing a `uploadMiddleware` factory function. This new middleware allows for dynamic creation of upload directories, supporting a date-based folder structure (e.g., `mainFolder/subFolder/year/month/day/hour-minute-second`). It ensures that target directories exist (creating them recursively if not), assigns unique filenames, and sets a file size limit of 10MB. The function returns various Multer upload handlers (`single`, `array`, `fields`, `any`).
*   **`src\services\documentService.ts` (11/5/2025, 11:22:29 AM):** The `uploadDoc` function was updated to handle document uploads, requiring `ref_type` and `ref_id` parameters. More notably, the `downloadDoc` function was enhanced to search for files in a new, more structured date-based path (`basePath/ref_type/year/month/day/file_name`) before falling back to older path conventions (`basePath/ref_type/file_name` and `basePath/file_name`). Extensive `console.log` statements were added to assist in debugging the file path resolution.
*   **`src\common\util\globalUpload.ts` (Multiple timestamps on 11/5/2025, between 11:23:47 AM and 11:36:05 AM):** This file saw rapid, iterative changes focused on the `saveDoc` function.
    *   Initially (11:23:47 AM), the file saving logic shifted to create a target folder structure incorporating `ref_type`, `year`, `month`, and `day`.
    *   Subsequent updates (11:26:32 AM, 11:27:17 AM, 11:28:12 AM, 11:35:10 AM, 11:36:05 AM) show active experimentation with the exact format of the generated folder path. The directory creation evolved from `path.join(globalBasePath, ref_type, year, month, day)` to various concatenations like `globalBasePath, ref_type + year + month + day` and `globalBasePath, ref_type +'_' + year + month + day`. The final recorded change reverts to a structure similar to `globalBasePath, ref_type +'_' + year + month + day`.
    *   A consistent change across these iterations is that the `document_path` stored in the database is now just the `fileName`, simplifying from previous commented-out versions that stored a `relativePath`.
    *   The file contains substantial commented-out code, indicating previous iterations or experimental changes to the `saveDoc` logic.

**Patterns and Recurring Elements:**

*   **Focus on Document Management:** The most prominent pattern is the intensive development around file upload and download capabilities. This includes dedicated middleware for uploads, service functions, and a core utility for saving documents.
*   **Dynamic and Date-based Folder Structures:** There's a clear strategic decision to organize uploaded files into dynamic folders. These folders utilize `ref_type` (a reference type) and current date components (year, month, day, and even time in `uploadMiddleware`) to create a more organized and potentially scalable storage system.
*   **Debugging and Iteration:** The frequent, rapid updates to `globalUpload.ts` and the inclusion of numerous `console.log` statements in `documentService.ts` point to active debugging and refinement of the file storage and retrieval logic. This suggests the team is actively working to stabilize and optimize these new features.
*   **Database Interaction for Metadata:** The process consistently involves saving metadata about the uploaded documents (such as `ref_type`, `ref_id`, `document_name`, `document_path`, `document_type`, `remark`, `uploaded_by`) into a `document_upload` database table, indicating a structured approach to tracking files.

## 11:41:30 AM
The development log primarily details the evolution of a file upload feature and significant updates to the application's Redux store. All changes occurred on 11/4/2025, indicating a focused development period.

**File-Specific Updates:**

*   **`c:\Users\ridap\OneDrive\Documents\Envosyes\envosys-frontend\src\store\store.ts` (11/4/2025, 5:57:55 PM):**
    *   Underwent a major expansion to its Redux store configuration.
    *   Numerous new API endpoints (`customerDataApi`, `uploadDocumentApi`, `lineBookingApi`, `customerBookingApi`, `vesselAndVoyageDataApi`, `jobApi`, `vendorDataApi`, `auditDataApi`, `enquiryDataApi`) were imported and integrated into the `appReducer` and middleware.
    *   Many new Redux slices (`customerDetailsReducer`, `vesselDashboardSlice`, `customerDashboardSlice`, `customerFormSlice`, `lineBookingSlice`, `lineBookingDashboardSlice`, `voyageDashboardSlice`, `jobDashboardSlice`, `customerBookingSlice`, `vendorDashboardSlice`, `customerDashboardDataSlice`) were also added to the store, indicating significant feature development across various modules.

*   **`c:\Users\ridap\OneDrive\Documents\Envosyes\envosys-frontend\src\pages\upload-docs\uploadDocs.tsx` and `c:\Users\ridap\OneDrive\Documents\Envosyes\envosys-frontend\src\components\screen\upload-docs\uploadDocs.tsx`:**
    *   **Initial Setup (11/4/2025, 6:01:03 PM - 6:02:46 PM):** The `uploadDocs.tsx` file was initially created as a placeholder page, then quickly renamed to `UploadDocs` (PascalCase) and integrated into a `PageWrapper` for basic layout.
    *   **Feature Development & Refactoring (11/4/2025, 6:13:16 PM - 6:31:38 PM):**
        *   The component was rapidly transformed into a functional modal/popup named `ConfirmLineBookingPopupProps`, incorporating `useFormik` for form management and supporting single file uploads with drag-and-drop.
        *   It then underwent a significant structural change, being moved from `src\pages` to `src\components\screen` (11/4/2025, 6:28:22 PM), signifying its evolution into a reusable component.
        *   The original `pages/upload-docs/uploadDocs.tsx` was subsequently re-established as a wrapper, importing and rendering the newly relocated component.
        *   The component's internal header title was changed from "Confirm Line Booking" to "Upload Documents" (11/4/2025, 6:31:38 PM), reflecting its true purpose.
    *   **Multiple File Uploads & Backend Integration (11/4/2025, 7:14:53 PM - 7:32:51 PM):**
        *   The component was enhanced to support multiple file uploads (11/4/2025, 7:14:53 PM), including logic to prevent duplicate files and display a list of uploaded items.
        *   Significant styling refinements were applied to the drag-and-drop area and overall form presentation (11/4/2025, 7:20:24 PM).
        *   Crucially, the component was integrated with the `useUploadDocumentMutation` RTK Query hook (11/4/2025, 7:32:51 PM) to handle actual file uploads to a backend API. This included implementing loading states, success/error toasts, and form reset logic. Each file is submitted as a `FormData` object with `document_type`, `ref_type`, `remark`, and `uploaded_by` fields.

*   **`c:\Users\ridap\OneDrive\Documents\Envosyes\envosys-frontend\src\App.tsx` (11/4/2025, 6:01:52 PM - 6:29:36 PM):**
    *   Initially imported and added a route for the new `UploadDocs` page.
    *   Subsequent minor changes were made to align the `UploadDocs` import statement with changes in its export method within its source file.

**Patterns and Recurring Elements:**

*   **Modular Development:** A strong pattern of component refactoring and modularization is evident, as `uploadDocs.tsx` transitioned from a page-level component to a reusable "screen" component.
*   **Redux Toolkit and RTK Query:** The application consistently uses Redux Toolkit for state management and RTK Query for efficient data fetching and mutation, as seen in the extensive updates to `store.ts` and the integration of `useUploadDocumentMutation`.
*   **Form Management:** `Formik` is consistently used for handling form state and submissions, particularly within the file upload component.
*   **UI/UX Enhancements:** Frequent adjustments to Tailwind CSS classes and the integration of custom UI kit components (`Button`, `Input`, `Label`) indicate an ongoing focus on improving the user interface and experience.
*   **Iterative Development:** The `uploadDocs.tsx` component shows a highly iterative development process, with rapid changes to functionality, UI, and backend integration.
*   **Inconsistencies:** A notable inconsistency is present in the `ConfirmLineBookingForm` component: the `deliveryOrderNo` field remains in `formik.initialValues` and the `onConfirm` callback's interface, but the corresponding input element has been removed from the UI. This means `deliveryOrderNo` is likely an empty string when submitted. Additionally, the `pages/upload-docs/uploadDocs.tsx` `handleConfirm` callback has not been updated to reflect the `files: File[]` type expected by the `ConfirmLineBookingForm` component.

## 2:25:07 PM
The file `src/routes/AuthRoutes.ts` was updated on 11/5/2025, 12:54:56 PM. This update primarily introduces a new GET endpoint under `Paths.Auth.GetUserInfo`. This route is designed to retrieve and return information about the currently authenticated user. Specifically, it logs "User Info Requested:" along with the `req.user` object and then responds with the user's data in a JSON format with an HTTP status of OK. The file leverages Express Router for defining routes and imports common types, path constants, and HTTP status codes from internal `@src` modules.

## 2:25:18 PM
The `c:\Users\ridap\OneDrive\Documents\Envosyes\envosys-frontend\src\components\screen\upload-docs\uploadDocs.tsx` file underwent several rapid and distinct transformations between a frontend React component and a backend utility function.

**File-Specific Updates:**

*   **`c:\Users\ridap\OneDrive\Documents\Envosyes\envosys-frontend\src\components\screen\upload-docs\uploadDocs.tsx`**
    *   **Initial state (11/5/2025, 1:57:52 PM):** The file started as a React functional component `ConfirmLineBookingForm`. This component provides a UI for uploading documents, including drag-and-drop functionality, file selection, and displaying a list of selected files. It uses `formik` for form management, `react-hot-toast` for notifications, and interacts with a `useUploadDocumentMutation` API. In the `onSubmit` handler, it constructs `FormData` for each file, appending `document_type`, `remark`, `file`, `ref_id`, and `uploaded_by`. Notably, the `ref_type` field (`formData.append("ref_type", "upload_doc");`) was commented out, meaning this specific field was not being sent to the backend.
    *   **Minor Frontend Update (11/5/2025, 2:03:46 PM):** A small but significant change occurred in the frontend component. The previously commented-out line `formData.append("ref_type", "upload_doc");` was uncommented. This modification ensures that the `ref_type` field with the value "upload_doc" is now explicitly included in the `FormData` sent during file uploads.
    *   **Major Backend Logic Introduction (11/5/2025, 2:06:55 PM):** The file's content dramatically changed from a frontend React component to a backend utility function named `saveDoc`. This new implementation imports Node.js modules like `path`, `fs`, and `moment`. It defines an interface `SaveDocParams` that includes `ref_type`, `ref_id`, `document_type`, `remark`, `uploaded_by`, and `files` (typed as `Express.Multer.File[]`). The function's core logic involves determining target upload paths based on environment variables (`UPLOAD_DOC_PATH`, `GLOBAL_DOC_PATH`) and `ref_type`, creating directories if they don't exist, renaming uploaded files with a timestamp, moving files from temporary locations, and inserting document metadata into a `document_upload` database table.
    *   **Backend Type Adjustment (11/5/2025, 2:07:18 PM):** A slight modification was made to the `saveDoc` backend function. The `files` property in the `SaveDocParams` interface was changed from `Express.Multer.File[]` to `File[]`. The underlying implementation, however, still relied on file properties and `fs` operations typically associated with server-side file handling, suggesting this was a type definition change without a full re-evaluation of the `File` object structure in a Node.js context.
    *   **Reversion to Frontend (11/5/2025, 2:07:54 PM):** The file content reverted entirely back to the React component, specifically to the state from 11/5/2025, 2:03:46 PM. This means the frontend component was restored, and the `ref_type` field remained uncommented and active in the `FormData`.
    *   **Final Frontend Adjustment (11/5/2025, 2:08:32 PM):** The file content again reverted to an earlier state of the React component, specifically the initial version from 11/5/2025, 1:57:52 PM. This change re-comments the `formData.append("ref_type", "upload_doc");` line, making the `ref_type` field inactive once more.

**Timestamps of Significant Changes:**

*   **11/5/2025, 1:57:52 PM:** Initial frontend component version with `ref_type` commented out.
*   **11/5/2025, 2:06:55 PM:** Major shift to a backend file-saving utility function, replacing the entire frontend component.
*   **11/5/2025, 2:07:54 PM:** Complete reversion back to the frontend component, with `ref_type` uncommented.
*   **11/5/2025, 2:08:32 PM:** Final reversion to the initial frontend component state, with `ref_type` commented out again.

**Patterns or Recurring Elements:**

The most prominent pattern is the file `uploadDocs.tsx` oscillating between being a frontend React component and a backend Node.js utility function. This suggests a potential issue in file organization, temporary placement of backend logic in a frontend directory, or a rapid iteration/testing phase where different implementations were tried in the same file path. Within the frontend component, there's a recurring pattern of toggling the `formData.append("ref_type", "upload_doc");` line between commented and uncommented states, indicating an ongoing decision or experiment related to this specific data field in the API request.

## 2:48:40 PM
The `src\common\util\globalUpload.ts` file underwent several significant revisions over a short period, focused on enhancing document upload and storage logic. Initially (11/5/2025, 1:50:30 PM), the `saveDoc` function established a `globalBasePath` and created subfolders based on `ref_type`, storing original filenames in the `document_upload` database table alongside timestamped physical files.

A brief change (11/5/2025, 1:54:52 PM) attempted to simplify by primarily using a static `UPLOAD_DOC_PATH` and removing `ref_type` subfolder creation, with an ephemeral addition of `dotenv.config()`.

The file then evolved rapidly (starting 11/5/2025, 1:59:53 PM) to a more robust path determination strategy. Key changes include:
*   Making the `ref_type` parameter optional in the `SaveDocParams` interface.
*   Introducing both `uploadBasePath` (a default static path, e.g., `../../uploads` or from `UPLOAD_DOC_PATH` env) and `globalBasePath` (from `GLOBAL_DOC_PATH` env, or defaulting to `uploadBasePath`).
*   Implementing conditional logic to determine the `finalBasePath`: if `ref_type` is provided, it creates a subfolder (`globalBasePath/ref_type`); otherwise, it uses the static `uploadBasePath`.
*   The `ref_type` value stored in the database was initially allowed to be `null` (1:59:53 PM) but was later standardized (11/5/2025, 2:09:40 PM) to default to `"upload_doc"` if not explicitly provided, ensuring the database column is never null.
*   Consistency in creating target folders if they don't exist and renaming uploaded files with a `YYYYMMDD_HHmmss` timestamp, while storing only the original filename in the database (`document_path` field).
*   Added console logs for better debugging and clarity, including warning for missing file paths and using emojis for success/failure/info messages (visible in 2:08:03 PM, 2:09:40 PM, and 2:42:23 PM, though some emojis were later removed).
*   The logic for path determination and `ref_type` handling largely stabilized by 11/5/2025, 2:09:40 PM, with subsequent changes being minor refinements in comments or console output (2:11:31 PM, 2:12:13 PM, 2:15:55 PM, 2:22:33 PM, 2:23:07 PM, 2:42:23 PM, 2:45:57 PM).

Concurrently, the `src\services\vendorServices.ts` file (11/5/2025, 2:14:22 PM) demonstrates the integration of the `saveDoc` function.
*   In the `getAll` function, it now fetches associated `document_upload` records for vendors using `ref_type = 'vendor_doc'` and attaches them to the vendor data.
*   The `addVendor` function utilizes `saveDoc` to upload multiple documents related to a vendor, setting `ref_type` to `"vendor_doc"` and `ref_id` to the newly created vendor's `serial_id`.
*   The `updateVendor` function includes logic to delete existing `document_upload` records based on `serial_id` and `ref_type = 'vendor_doc'` if they are marked for deletion.

**Patterns and Recurring Elements:**
*   **Dynamic Path Handling:** A consistent effort to manage file upload paths dynamically based on environment variables (`UPLOAD_DOC_PATH`, `GLOBAL_DOC_PATH`) and the provided `ref_type`.
*   **Timestamping Files, Not DB Entries:** Physical files are always renamed with a `_timestamp` suffix for uniqueness, but the `document_path` in the database consistently stores the original filename.
*   **`document_upload` Table Interaction:** The `saveDoc` function reliably inserts metadata into `document_upload`, and `vendorServices` demonstrates both retrieval and deletion from this table using `ref_type` and `ref_id`.
*   **Error Handling:** All `saveDoc` iterations include a `try...catch` block to handle potential file system or database errors.
*   **Environment Variable Configuration:** The log shows repeated adjustments to `GLOBAL_DOC_PATH` and `UPLOAD_DOC_PATH` in `.env.development`, indicating ongoing configuration changes for file storage locations (e.g., switching between Windows and Linux paths).

## 3:25:08 PM
The file `src\routes\AuthRoutes.ts` was updated on 11/5/2025, 12:54:56 PM. This change introduces or modifies an authentication route designed to retrieve user information. Specifically, a GET endpoint mapped to `Paths.Auth.GetUserInfo` has been implemented. This endpoint logs the requested user information (from `req.user`) to the console and then responds with the user object in JSON format, using an `HttpStatusCodes.OK` (200) status. The file imports necessary modules like `express.Router`, custom types for request/response, and constants for paths and HTTP status codes.

## 3:25:12 PM
The changes observed across the log primarily focus on two files: `sidebar-layout.tsx` and `dashboard-page.tsx`, with a final update to `usercard.tsx`.

**File-Specific Updates:**

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\components\core\sidebar-layout.tsx` (Timestamp: 11/5/2025, 2:54:04 PM)**
    *   This file defines the `AppSidebarLayout` component.
    *   It imports various UI components from `@components/kit` such as `Avatar`, `Dropdown`, `Navbar`, and `SidebarLayout`.
    *   It also imports icons from `@heroicons/react` (both 16/solid and 20/solid versions).
    *   The `AppSidebarLayout` component renders a `SidebarLayout` which includes a `Navbar` (with a `NavbarSpacer`) and a `SideBar` component, wrapping the `children` content. This suggests a foundational layout component for the application.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\pages\dashboard\dashboard-page.tsx` (Timestamps: 11/5/2025, 2:58:06 PM, 2:58:53 PM, 3:03:35 PM, 3:03:46 PM)**
    *   This file represents the main dashboard page.
    *   It imports a vast array of components, hooks, and utilities, indicating a feature-rich page:
        *   UI components: `PageWrapper`, `Card`, `AppGrid`, `DatePeriodSelector`, `Calendar`, `Dialog`, `Badge`, `Button`, `Spinner`, `GlobalSearch`.
        *   Icons: Many from `react-icons/fa6`, `react-icons/hi2`, `react-icons/bs`, `react-icons/fa`, `react-icons/io5`, `react-icons/rx`, `react-icons/md`.
        *   Data management: `useEffect`, `useMemo`, `useState`, `useDispatch`, `useSelector` (from `react-redux`), `useNavigate` (from `react-router-dom`).
        *   API interaction: `useFetchShipmentDataQuery`, `useFetchCartDataQuery`, `useFetchDeliveryDataQuery` (from `store/api`).
        *   State management: `dashboardSetFilters`, `dashboardSetPagination`, `dashboardSetSortModel`, `setCardFilter`, `setDateRange`, `setPeriod` (from `store/fretures/shipment-dashboard-slice`).
        *   Types and constants: `CalendarDay`, `NotificationItemValues`, `DeliveryType`, `FilterType`, `DashboardState`, `ShipmentStatusType`, `SHIPMENT_STATUS`, `SHIPMENT_STATUS_FILTERS`.
    *   Key functionalities implemented in the dashboard:
        *   Fetching shipment data, delivery data, and dashboard card data using Redux Toolkit Query.
        *   Managing dashboard filters (shipment\_id, fromDate, toDate, status), pagination, and sorting via Redux.
        *   Calendar logic to display deliveries and vessels, with a `determineDeliveryMode` function to categorize deliveries.
        *   Handlers for page changes (`handlePage`, `handlePageSizeChange`), filter changes (`handleFilterChange`, `handleClearFilters`), and card clicks (`handleCardClick`) which can scroll to a datagrid.
        *   A `getIcons` utility function to map icon types to corresponding React icons for recent updates.
        *   Retrieval of user data from `localStorage`.
    *   The repeated entries for this file show minor or no substantive code changes, suggesting frequent saves or minor internal modifications within the file. The content remains largely identical across these timestamps.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\components\core\usercard.tsx` (Timestamp: 11/5/2025, 3:05:14 PM)**
    *   This file defines the `UserCard` component, likely used in a sidebar or header for user-related actions.
    *   It imports UI components like `Dropdown`, `DropdownButton`, `DropdownItem`, `DropdownLabel`, `DropdownMenu`, `SidebarItem`, `Avatar`.
    *   Icons: `MdOutlineKeyboardArrowDown`, `IoLogOut`.
    *   Data and navigation: `useFetchUserPreferenceQuery`, `useDispatch`, `useNavigate`.
    *   Includes a `getInitials` helper function to generate initials from a user's name.
    *   The `handleLogout` function is present, with logic to handle both "auth0" and "normal" logout scenarios, including clearing `localStorage` items (`token`, `user`) and dispatching a Redux logout action. It redirects the user based on the authentication type.
    *   The component displays the user's name and role, and provides a "Sign out" option in a dropdown menu.

**Timestamps of Significant Changes:**

*   **11/5/2025, 2:54:04 PM:** Initial definition or major update of `AppSidebarLayout`, establishing the core layout structure.
*   **11/5/2025, 2:58:06 PM:** First recorded substantial state for `DashboardPage`, detailing its complex functionality, data fetching, and state management.
*   **11/5/2025, 3:05:14 PM:** Update to `UserCard`, including the logout functionality and user display.

**Patterns or Recurring Elements:**

*   **Component-based Architecture:** The project heavily uses React components (e.g., `AppSidebarLayout`, `DashboardPage`, `UserCard`) and imports smaller, reusable UI components from a `@components/kit` or `@components/common` directory, indicating a modular design.
*   **Redux for State Management:** `react-redux` (`useDispatch`, `useSelector`) and Redux Toolkit Query (`useFetch...Query`) are consistently used for managing application state, fetching data, and handling mutations, particularly evident in the `dashboard-page.tsx`.
*   **Styling and Icons:** Extensive use of `react-icons` libraries (e.g., `react-icons/fa6`, `@heroicons/react`) for various UI elements across components.
*   **Date/Time Handling:** `moment` library is used for date manipulation, especially in `dashboard-page.tsx` for calendar logic.
*   **User Authentication/Session Management:** `localStorage` is used to store user information and authentication type (`authtype`, `user`, `token`), which is then accessed for displaying user details and handling logout logic. Console logs are used for debugging user information and logout processes.
*   **Frequent Saves/Minor Tweaks:** The `dashboard-page.tsx` file appears in consecutive log entries with very close timestamps and identical code, suggesting either automated saves, minor non-substantive changes, or a period of active development and refinement without significant functional additions between the logged states.
*   **Navigation:** `react-router-dom`'s `useNavigate` hook is used for programmatic navigation within the application.
*   **Separation of Concerns:** Data fetching logic, UI components, and state management logic are typically separated into distinct files and modules (e.g., `store/api`, `store/fretures`, `components/kit`).

## 3:25:16 PM
The log exclusively details changes to a single file: `c:\Users\ridap\OneDrive\Documents\Envosyes\envosys-frontend\src\components\screen\upload-docs\uploadDocs.tsx`.

Initially, at **11/5/2025, 1:57:52 PM**, the file contained a React functional component named `ConfirmLineBookingForm`. This component is responsible for handling document uploads, featuring:
*   State management for `uploadedFiles`, drag-and-drop (`isDragOver`), and upload status (`isUploading`).
*   Form submission logic using `formik` for a `deliveryOrderNo`.
*   Integration with a `useUploadDocumentMutation` API for backend uploads.
*   Client-side file handling including selection, drag-and-drop, and removal of files.
*   Visual feedback using `react-hot-toast` for success/error messages.
*   Styling using Tailwind CSS classes.
*   Crucially, the `ref_type` field in the `FormData` being appended for upload (`formData.append("ref_type", "upload_doc");`) was commented out.

A minor update at **11/5/2025, 2:03:46 PM** involved uncommenting the `formData.append("ref_type", "upload_doc");` line, ensuring "upload_doc" is sent as the `ref_type` with each file.

Significantly, the file's content was entirely replaced at **11/5/2025, 2:06:55 PM**. The React component was swapped out for a Node.js backend utility function named `saveDoc`. This utility function:
*   Manages server-side file saving, utilizing `path`, `fs`, and `moment` libraries.
*   Determines target upload paths based on `process.env.UPLOAD_DOC_PATH` and `process.env.GLOBAL_DOC_PATH`, supporting dynamic folder creation based on `ref_type`.
*   Renames files with a timestamp to prevent collisions.
*   Inserts document metadata (like `ref_type`, `ref_id`, `document_name`, `document_path`, `document_type`, `remark`, `uploaded_by`) into a `document_upload` database table via a `query` function.
*   At **11/5/2025, 2:07:18 PM**, a small refinement was made to the `saveDoc` function's `SaveDocParams` interface, changing the type of `files` from `Express.Multer.File[]` to `File[]`.

The file then reverted back to its original React component content at **11/5/2025, 2:07:54 PM**. This version was identical to the state at 2:03:46 PM, with `formData.append("ref_type", "upload_doc");` being active.

However, almost immediately after, at **11/5/2025, 2:08:32 PM**, the `formData.append("ref_type", "upload_doc");` line was commented out again, reverting to the initial state regarding this specific parameter.

Finally, at **11/5/2025, 2:42:29 PM**, the `formData.append("ref_type", "upload_doc");` line was uncommented once more, bringing the file back to a state where "upload_doc" is actively sent as `ref_type`.

**Key Patterns:**
A prominent pattern observed is the repeated toggling (commenting/uncommenting) of the `formData.append("ref_type", "upload_doc");` line within the React component's `onSubmit` logic. This suggests ongoing indecision or experimentation regarding whether this specific `ref_type` parameter should be sent with the uploads. The brief interlude where the file's entire content changed to a backend utility is a significant, but temporary, anomaly in the log.

## 3:48:46 PM
**File: `src\common\util\globalUpload.ts`**

This file, primarily containing the `saveDoc` function, underwent significant evolution between 1:50 PM and 2:45 PM.

*   **Initial State (11/5/2025, 1:50:30 PM):** The `saveDoc` function was introduced, designed to save uploaded files. It determined a base path using `process.env.GLOBAL_DOC_PATH` or `process.env.UPLOAD_DOC_PATH`, or a default `uploads` folder. It created subfolders based on `ref_type`, renamed files with a timestamp for storage, and inserted document metadata (including the original filename as `document_name` and `document_path`) into a `document_upload` database table.
*   **Early Adjustments (11/5/2025, 1:54:52 PM - 2:01:26 PM):**
    *   Briefly (1:54:52 PM), `dotenv` was imported and configured locally, and the logic was simplified to save files directly into a static `UPLOAD_DOC_PATH` without `ref_type` subfolders.
    *   Soon after (1:59:53 PM), `dotenv` import was removed, `ref_type` in `SaveDocParams` was made optional, and the dynamic subfolder creation logic (using `globalBasePath/ref_type` if `ref_type` exists, else `uploadBasePath`) was reintroduced. This allowed `ref_type` to be `null` in the database.
    *   A minor revert (2:01:26 PM) temporarily made `ref_type` required again and simplified the folder pathing, similar to the initial version, while introducing a minor typo.
*   **Refinement of Pathing and `ref_type` Handling (11/5/2025, 2:08:03 PM - 2:09:40 PM):**
    *   A more robust conditional logic was established (2:08:03 PM) for `targetBasePath`: using `GLOBAL_DOC_PATH/ref_type` if `ref_type` is provided (and not empty), otherwise falling back to `UPLOAD_DOC_PATH`. `ref_type` was again made optional in `SaveDocParams`. Error handling for missing `file.path` was added, and console logs were enhanced with emojis.
    *   The most significant functional change in this period occurred at **11/5/2025, 2:09:40 PM**. `ref_type` was standardized by defaulting it to `"upload_doc"` if it was not provided or empty. This `finalRefType` was then consistently used to determine the `targetBasePath` (either `uploadDocPath` for `"upload_doc"` or `globalDocPath/finalRefType` for others) and for insertion into the `document_upload` table, ensuring `ref_type` is never `null` in the database.
*   **Subsequent Changes (11/5/2025, 2:11:31 PM - 2:45:57 PM):** The core logic from 2:09:40 PM remained largely stable. Minor changes included adding/removing console log messages and emoji decorations, indicating ongoing debugging and minor cleanup without altering functionality. The last change at 2:45:57 PM removed verbose comments and emojis from logs.

**File: `src\services\vendorServices.ts`**

This file received a major update at **11/5/2025, 2:14:22 PM**, integrating the `globalUpload.ts` utility for document management.

*   **`getAll` function:** This function was enhanced to retrieve `document_upload` records associated with vendors. It fetches all vendors, then queries the `document_upload` table for documents where `ref_id` matches a vendor's `serial_id` and `ref_type` is specifically `'vendor_doc'`. These documents are grouped by vendor and attached to the respective vendor objects in the response.
*   **`addVendor` function:** When adding a new vendor, this function now processes `uploadDocuments` (parsed from the request body) and uploaded `files`. It iterates through these, calling the `saveDoc` function (from `globalUpload.ts`) for each file. It explicitly passes `ref_type: "vendor_doc"` and the newly created `vendorSerialId`, along with other document details.
*   **`updateVendor` function:** This function was extended to handle updates to vendor documents. It distinguishes between existing, new, and deleted documents. For deleted documents, it contains logic to remove entries from the `document_upload` table based on `serial_id` and ensuring `ref_type` is `'vendor_doc'`. The change log for this function is truncated, but it clearly indicates robust document management capabilities.

**Patterns and Recurring Elements:**

*   **Document Management Focus:** The dominant theme across these changes is the robust implementation and refinement of a generic document upload and management system.
*   **`ref_type` for Categorization:** The `ref_type` parameter is consistently used to categorize documents (e.g., `'vendor_doc'` in `vendorServices.ts`, and the dynamic subfolder creation/defaulting to `"upload_doc"` in `globalUpload.ts`), indicating a structured approach to document storage.
*   **Separation of Concerns:** The `globalUpload.ts` utility is designed to handle the low-level file system and database insertion for documents, while `vendorServices.ts` consumes this utility to manage vendor-specific documents, demonstrating good modularity.
*   **Timestamped Filenames vs. Original Names in DB:** A consistent pattern is to rename physical files with a timestamp (`${baseName}_${timestamp}${ext}`) for uniqueness but store the original filename (`file.originalname`) in the `document_name` and `document_path` fields in the database.
*   **Environment Variable Dependence:** Both `globalUpload.ts` and `vendorServices.ts` rely on environment variables (`UPLOAD_DOC_PATH`, `GLOBAL_DOC_PATH`) for configuring upload locations.
*   **Database Schema:** The use of `document_upload` table with columns like `ref_type`, `ref_id`, `document_name`, `document_path`, `document_type`, `remark`, `uploaded_by`, `uploaded_at`, `updated_at` is consistent.
*   **Iterative Refinement:** The `globalUpload.ts` file shows an iterative process of adding, removing, and re-adding logic (e.g., `dotenv` import, `ref_type` optionality, logging verbosity), suggesting an active development cycle to achieve the desired functionality and robustness.

## 4:25:07 PM
The file `c:\Users\ridap\OneDrive\Documents\T360-V2\t360-backend-v2\src\routes\AuthRoutes.ts` was updated on `11/5/2025, 12:54:56 PM`. This update primarily focuses on defining an authentication route.

Specifically, the `AuthRoutes.ts` file sets up an Express router. It defines a GET endpoint for `Paths.Auth.GetUserInfo` which is responsible for retrieving and returning user information. When this endpoint is hit, it logs "User Info Requested:" along with the user object from the request (`req.user`) to the console and then sends a 200 OK status with the user object in the JSON response. The file imports necessary modules like `express`, custom types (`IAuthReq`, `IRes`), and constants for paths and HTTP status codes, and exports the configured `AuthRoutes` router. Notably, while `login` from `UserService` is imported, it is not utilized in the provided snippet of code.

## 4:25:18 PM
The `c:\Users\ridap\OneDrive\Documents\Envosyes\envosys-frontend\src\components\screen\upload-docs\uploadDocs.tsx` file undergoes several significant changes and a recurring pattern of modifications:

**File-Specific Updates & Timestamps:**

*   **11/5/2025, 1:57:52 PM:** The file initially contains a React functional component named `ConfirmLineBookingForm`. This component is responsible for a client-side document upload interface, utilizing `formik` for form management, React state for managing uploaded files and drag-and-drop interactions, and `useUploadDocumentMutation` for API calls. At this point, a `formData.append("ref_type", "upload_doc");` line within the `onSubmit` logic is commented out.
*   **11/5/2025, 2:03:46 PM:** A minor update occurs in the `ConfirmLineBookingForm` component. The previously commented-out line `formData.append("ref_type", "upload_doc");` is uncommented, meaning the `ref_type` field is now actively sent with the document upload form data.
*   **11/5/2025, 2:06:55 PM:** The content of the file completely changes. It transforms from a React component to a server-side utility function named `saveDoc`. This `saveDoc` function is designed for handling file system operations (creating directories, renaming files with timestamps using `moment`, and moving uploaded files) and inserting document metadata into a database (`document_upload` table). It uses `Express.Multer.File[]` for its `files` parameter, indicating a backend context despite being in a frontend `.tsx` file path.
*   **11/5/2025, 2:07:18 PM:** A minor refinement is made within the `saveDoc` function. The type definition for the `files` parameter in the `SaveDocParams` interface is changed from `Express.Multer.File[]` to `File[]`. The underlying server-side logic remains the same.
*   **11/5/2025, 2:07:54 PM:** The file content reverts back to the `ConfirmLineBookingForm` React component, specifically to the state where `formData.append("ref_type", "upload_doc");` is uncommented (matching the 2:03:46 PM version). This suggests the server-side `saveDoc` function was temporarily present or accidentally overwitten.
*   **11/5/2025, 2:08:32 PM:** Another small change in the `ConfirmLineBookingForm` component. The line `formData.append("ref_type", "upload_doc");` is once again commented out.
*   **11/5/2025, 2:42:29 PM:** The final recorded change reverts the `ConfirmLineBookingForm` component to the state where `formData.append("ref_type", "upload_doc");` is uncommented, matching the 2:03:46 PM and 2:07:54 PM versions.

**Patterns and Recurring Elements:**

The most prominent pattern is the frequent toggling of the comment status for the line `formData.append("ref_type", "upload_doc");` within the `ConfirmLineBookingForm` component. This field is commented, uncommented, commented again, and finally uncommented. This indicates an iterative process of testing or deciding whether to include this specific piece of data in the frontend-to-backend upload request.

Additionally, there's a notable, albeit temporary, change where a server-side file handling utility (`saveDoc`) completely replaced the frontend React component. This was quickly reverted, suggesting it was either a misplaced file, an error in the version control log, or a very brief experimental phase during development. The primary function of the file, as consistently seen in most entries, is to provide a user interface for document uploads.

## 4:25:29 PM
The code changes primarily focus on refining user interface components, enhancing dashboard functionality, and improving authentication/authorization mechanisms within the `t360-frontend-v2` application. All recorded changes occurred on 11/5/2025.

**File-Specific Updates:**

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\components\core\sidebar-layout.tsx` (Timestamp: 11/5/2025, 2:54:04 PM)**
    *   This file defines the `AppSidebarLayout` component, a wrapper for the application's main content, integrating a navigation bar and a sidebar using custom `@components/kit` UI components and Heroicons. This appears to be an initial or standalone update for this layout structure.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\pages\dashboard\dashboard-page.tsx` (Timestamps: 11/5/2025, 2:58:06 PM; 2:58:53 PM; 3:03:35 PM; 3:03:46 PM)**
    *   This file outlines a complex `DashboardPage` component that integrates various UI elements (cards, data grids, calendar, date selectors, filter sidebar) and fetches shipment and delivery data.
    *   **2:58:06 PM:** Introduces extensive Redux state management for filters, pagination, sorting, and card-based filtering. It uses `useFetchShipmentDataQuery`, `useFetchCartDataQuery`, and `useFetchDeliveryDataQuery` for data retrieval. A `useMemo` hook is used to process calendar data, categorizing deliveries into "Rail", "Door", or "Port". It includes functions for handling pagination, filters, card clicks, and a `scrollTo` utility.
    *   **2:58:53 PM:** A minor cleanup was performed, removing an incorrect `import { console } from "inspector";`.
    *   **3:03:35 PM & 3:03:46 PM:** No discernible functional changes from the 2:58:53 PM version. The provided code for this file is consistently truncated at the same point, `const statusColor = firstStatus`, across all entries.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\components\core\usercard.tsx` (Timestamps: 11/5/2025, 3:05:14 PM; 4:23:14 PM; 4:24:19 PM)**
    *   This file defines the `UserCard` component, responsible for displaying user details and providing a logout mechanism.
    *   **3:05:14 PM:** The `handleLogout` function was refined. For Auth0 authentication, `token` and `user` are now explicitly removed from `localStorage` *before* initiating the redirect to the Auth0 logout endpoint. This ensures local data is cleared promptly.
    *   **4:23:14 PM:** Significant structural changes were made. The component now imports `useSelector`, `useAccess`, and `SelectCustomerPanel`. A `SelectCustomerPanel` component is rendered within the dropdown, conditional on the user having `selectCustomer` permission, indicating a feature to allow users (likely ADMINs) to switch customer contexts directly from the user card area.
    *   **4:24:19 PM:** No discernible functional changes from the 4:23:14 PM version.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\components\screen\analytics\AnalyticsToolbar.tsx` (Timestamps: 11/5/2025, 3:53:07 PM; 3:53:47 PM; 3:53:57 PM)**
    *   This component manages filters and views for an analytics dashboard, including a PDF export feature.
    *   **3:53:07 PM:** The `downloadDashboardPDF` function, which uses `jspdf` and `html2canvas-pro`, was enhanced for more robust logo handling. It now converts the logo image to a base64 string using `getBase64Image` within the `logoImg.onload` callback, and includes an `onerror` handler for the logo image. Earlier commented-out code suggests previous attempts at handling CSS styles for PDF generation.
    *   **3:53:47 PM & 3:53:57 PM:** No discernible functional changes from the 3:53:07 PM version.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\components\core\layout.tsx` (Timestamps: 11/5/2025, 4:20:15 PM; 4:21:01 PM; 4:21:20 PM)**
    *   This file defines the main application layout, handling global concerns like authentication status and role-based content.
    *   **4:20:15 PM:** Introduced logic to check token expiration from `localStorage` using a `useEffect` hook. If the token is expired, `user` and `token` are cleared, and the user is redirected to the root path. It also implements role-based rendering, specifically showing an "Admin Dashboard" message for "ADMIN" users, prompting them to select a customer.
    *   **4:21:01 PM:** No discernible functional changes.
    *   **4:21:20 PM:** A clarifying comment, `// prevent access to the app if user is not logged in`, was added above the `isTokenExpired` function.

**Patterns and Recurring Elements:**

*   **Authentication and Authorization:** There is a strong recurring theme of user authentication and authorization. Both `usercard.tsx` (logout flow, customer selection based on permissions) and `layout.tsx` (token expiration, ADMIN role restriction) actively manage user access and state.
*   **Redux for State Management:** Multiple components (`dashboard-page.tsx`, `AnalyticsToolbar.tsx`, `usercard.tsx`) heavily rely on `react-redux` (`useDispatch`, `useSelector`) for managing application state and interacting with API services (RTK Query).
*   **Custom UI Components:** The project consistently uses custom UI components from `@components/kit` and `@components/common` directories, indicating a standardized component library.
*   **Date and Time Handling:** The dashboard components use `moment.js` extensively for date manipulation and display, especially for calendar and filter functionalities.
*   **Console Logging:** `console.log` statements are frequently used throughout the code, suggesting an active development and debugging phase.
*   **Iterative Development:** The presence of commented-out code in `AnalyticsToolbar.tsx` and the multiple minor timestamp updates for the same file suggest an iterative development approach, particularly for complex features like PDF export.

## 4:48:44 PM
The recent code changes primarily focus on refining the document upload mechanism within the Envosys backend, particularly around how files are stored on the file system and referenced in the database, along with its integration into vendor management.

**File: `src\common\util\globalUpload.ts`**
This file, containing the `saveDoc` function, underwent significant iterations to standardize document storage:
*   **Initial Implementation (11/5/2025, 1:50:30 PM):** The `saveDoc` function was introduced, allowing documents to be saved to a `globalBasePath` (derived from environment variables or a default local path). It would then create subfolders based on a required `ref_type` and store files with a timestamped name. The original filename was recorded in the database.
*   **Path Logic Revisions (11/5/2025, 1:54:52 PM - 2:08:03 PM):**
    *   A brief change (1:54:52 PM) removed the `ref_type` subfolder creation, opting to save all files directly in a main upload path.
    *   This was quickly reverted and refined (1:59:53 PM, 2:08:03 PM). The `ref_type` parameter was made optional, and a more robust logic was established: if `ref_type` is provided and non-empty, files are stored in a subfolder under `GLOBAL_DOC_PATH`; otherwise, they go to a static `UPLOAD_DOC_PATH`. Error handling for missing file paths and enhanced console logs were added.
*   **`ref_type` Standardization (11/5/2025, 2:09:40 PM onwards):** The `ref_type` handling was further refined. If `ref_type` is not provided or empty, it now defaults to the string `"upload_doc"`. This value then dictates the storage location: `"upload_doc"` directs files to `UPLOAD_DOC_PATH` (static folder), while any other `ref_type` creates a dedicated subfolder under `GLOBAL_DOC_PATH`. This ensures `ref_type` is always a meaningful string for database insertion, preventing null values.
*   **Documentation and Consistency (11/5/2025, 2:42:23 PM - 2:45:57 PM):** Comments were extensively added to explain the logic flow, clarifying that physical files are timestamped for uniqueness, but only the original filename is stored in the `document_upload` database table. The core logic for path determination, folder creation, file renaming, and database insertion remained consistent in these final revisions.

**File: `src\services\vendorServices.ts`**
*   **Integration of `globalUpload` (11/5/2025, 2:14:22 PM):** This file demonstrates the practical application of the `globalUpload.saveDoc` function.
    *   **`getAll` function:** It now fetches associated `document_upload` records for vendors using `ref_type = 'vendor_doc'` and attaches them to vendor data, providing a comprehensive view of vendor information including their uploaded documents. It also filters and formats vendor status and email options.
    *   **`addVendor` function:** When adding a new vendor, it processes `uploadDocuments` (parsed from the request body) and actual files (`req.files`). For each new document, it calls `saveDoc` with `ref_type: "vendor_doc"` and the newly created vendor's `serial_id`.
    *   **`updateVendor` function:** It includes logic to handle updates to vendor documents, distinguishing between new, existing, and deleted documents. It iterates through marked `deletedDocs` to remove corresponding entries from the `document_upload` table. The log entry for this function is truncated, but it clearly indicates an intention to manage the lifecycle of vendor-specific documents.
    *   **Audit Logging:** The `updateVendor` function also includes detailed audit logging for changes to vendor fields, recording old and new values in the `spr_vendor_master_audit` table.

**Patterns and Recurring Elements:**
*   **Modular Document Handling:** The `saveDoc` function serves as a centralized, reusable module for file uploads, integrated across different services like `vendorServices`.
*   **Environment Variable Dependency:** The file upload paths (`UPLOAD_DOC_PATH`, `GLOBAL_DOC_PATH`) are consistently read from environment variables, allowing flexible configuration for different deployment environments.
*   **Timestamped Physical Files vs. Original Name in DB:** A consistent pattern is observed where physical files are renamed with a `YYYYMMDD_HHmmss` timestamp for uniqueness, but the original filename is consistently stored in the `document_upload` table for user-friendliness and potentially easier retrieval/display.
*   **Database Schema:** The `document_upload` table consistently stores `ref_type`, `ref_id`, `document_name`, `document_path`, `document_type`, `remark`, `uploaded_by`, and timestamps (`uploaded_at`, `updated_at`).
*   **Robust Folder Management:** The code repeatedly checks for and creates necessary directories (`fs.existsSync`, `fs.mkdirSync`) before saving files, ensuring a stable file system structure.
*   **Error Handling:** `try...catch` blocks are consistently used in `saveDoc` and service functions to catch and log errors during file operations and database interactions.

**Environment Configuration Changes:**
The `.env.development` file saw changes related to the document upload paths and database configuration. Specifically, `GLOBAL_DOC_PATH` and `UPLOAD_DOC_PATH` values were adjusted multiple times, reflecting shifts between local Windows paths and `/root/node` paths, suggesting different development or deployment targets. Later, database connection parameters (DB_USER, DB_PASSWORD, DB_NAME, PORT) were also updated, indicating a potential switch to a different database instance or a dedicated production-like setup within the development environment.

## 5:47:08 PM
**File: `src/routes/AuthRoutes.ts`**
*   **Timestamp:** 11/5/2025, 12:54:56 PM
*   **Update:** This file defines authentication-related routes using Express. It includes an import for a `login` service from `UserService` (though not used in the provided snippet). A GET endpoint for `Paths.Auth.GetUserInfo` is defined. This endpoint logs "User Info Requested:" along with the user object from the request (`req.user`) and then responds with an HTTP status `OK` (200) returning the `req.user` object as JSON. The route leverages predefined constants for paths and HTTP status codes.

## 5:47:21 PM
The provided log details changes exclusively within the file `c:\Users\ridap\OneDrive\Documents\Envosyes\envosys-frontend\src\components\screen\upload-docs\uploadDocs.tsx`.

The most significant pattern observed is a highly unusual, transient change in the file's entire purpose and content, alternating between a React frontend component and a Node.js backend utility, followed by repeated toggling of a specific line in the frontend component.

**File-Specific Updates for `c:\Users\ridap\OneDrive\Documents\Envosyes\envosys-frontend\src\components\screen\upload-docs\uploadDocs.tsx`:**

1.  **Initial Frontend Component (11/5/2025, 1:57:52 PM):** The file began as a React functional component named `ConfirmLineBookingForm`. This component provides a user interface for uploading documents, featuring:
    *   Drag-and-drop functionality for files, with visual feedback (`isDragOver`).
    *   A file input button to select files.
    *   Display of uploaded files with an option to remove them.
    *   Form handling using `formik` with an initial `deliveryOrderNo` field.
    *   Integration with `useUploadDocumentMutation` from `store/api/uploadDocumentApi` for backend interaction.
    *   Client-side validation to ensure at least one file is uploaded.
    *   Error and success notifications using `react-hot-toast`.
    *   The `onSubmit` logic constructs a `FormData` object, appending `document_type`, `remark`, `file`, `ref_id`, and `uploaded_by`. Notably, the `ref_type` field (`formData.append("ref_type", "upload_doc");`) was initially commented out.

2.  **Frontend: `ref_type` Uncommented (11/5/2025, 2:03:46 PM):** The commented line `formData.append("ref_type", "upload_doc");` within the `onSubmit` function was uncommented, activating this field in the upload request.

3.  **Abrupt Shift to Backend Utility (11/5/2025, 2:06:55 PM):** The entire content of the file drastically changed. Instead of the React component, it now defined an asynchronous `saveDoc` function. This function is characteristic of a Node.js backend utility, employing:
    *   Node.js core modules like `path` and `fs` for file system operations.
    *   `moment` for timestamp formatting.
    *   Environment variables (`process.env.UPLOAD_DOC_PATH`, `process.env.GLOBAL_DOC_PATH`) to determine file storage paths.
    *   Logic to create target directories if they don't exist.
    *   Renaming uploaded files with a timestamp prefix (`${baseName}_${timestamp}${ext}`) and moving them to the target directory.
    *   Database interaction via a `query` function (not defined in the snippet but implied), inserting document metadata (`ref_type`, `ref_id`, `document_name`, `document_path`, `document_type`, `remark`, `uploaded_by`, `uploaded_at`, `updated_at`) into a `document_upload` table.
    *   The `SaveDocParams` interface defined `files` as `Express.Multer.File[]`.

4.  **Backend: `SaveDocParams` Type Adjustment (11/5/2025, 2:07:18 PM):** A minor but specific change occurred in the `saveDoc` utility. The type definition for the `files` parameter in the `SaveDocParams` interface was updated from `Express.Multer.File[]` to `File[]`.

5.  **Revert to Frontend Component (11/5/2025, 2:07:54 PM):** The file's content reverted entirely back to the `ConfirmLineBookingForm` React component, specifically to the state where the `ref_type` field was uncommented (as seen at 2:03:46 PM). This suggests either an accidental overwrite of the backend logic or a deliberate restoration of the frontend component.

6.  **Frontend: `ref_type` Commented Again (11/5/2025, 2:08:32 PM):** The `formData.append("ref_type", "upload_doc");` line in the `onSubmit` function of the React component was commented out again.

7.  **Frontend: `ref_type` Uncommented Again (11/5/2025, 2:42:29 PM):** Finally, the `formData.append("ref_type", "upload_doc");` line was uncommented once more, restoring its active status in the upload request.

**Patterns and Recurring Elements:**

*   **File Path Consistency:** All modifications were logged under the identical file path: `c:\Users\ridap\OneDrive\Documents\Envosyes\envosys-frontend\src\components\screen\upload-docs\uploadDocs.tsx`.
*   **`ref_type` Toggling:** The `formData.append("ref_type", "upload_doc");` line within the frontend `ConfirmLineBookingForm` was repeatedly commented and uncommented (commented -> uncommented -> commented -> uncommented).
*   **Frontend Component Stability:** When the file contained the `ConfirmLineBookingForm` component, its core structure, UI elements (drag-and-drop, file list), form logic (Formik), and API integration remained largely consistent, apart from the `ref_type` toggling.
*   **Backend Code Briefness:** The `saveDoc` backend utility appeared only briefly within the log, suggesting it was either a temporary addition, an erroneous log entry, or part of a refactoring that was quickly reverted or moved. Given the "frontend" in the file path, the presence of backend file system and database logic is highly unusual and stands out as a critical observation.