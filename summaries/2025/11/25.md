# Activity Summary for 11/25/2025

## 6:41:03 AM
The code changes primarily revolve around the `t360-frontend` application, showing a significant expansion of features related to booking, shipping, and analytics, along with enhancements in form management and user experience.

### File-Specific Updates:

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\App.js`**
    *   **11/21/2025, 11:31:13 AM:** This file underwent a major update, introducing a vast number of new imports for various screens and components. This indicates a substantial addition of new functionalities across the application, including:
        *   New domain-specific screens: `OtmBolScreen`, `CustomerScreen`, `PartyScreen`, `AgentScreen`, `BookingPlanBoardScreen`, `SPRPlanBoardScreen`, `LineWiseScreen`, `CIScreen`, `ISFEntryFormScreen`, `AlcScreen`, `ShippingOrdersScreen`, `ContainerReportScreen`, `PdfParserScreen`, `FCLScreen`, `LCLScreen`, `RailScreen`, `AirTrackingScreen`, `ShipmentTrackingScreen`, `Dashboard7501Screen`, `ShipmentsScreen`, `CngBookingScreen`, `CityMaster`, `PortmasterScreen`.
        *   New extended form and dashboard components: `AgentBookingFormScreenExtend`, `AgentPoFormExtend`, `BookingDashbaordScreenExtend`, `CngBookingFormScreen`, `CngBookingScreenExtend`.
        *   New administrative and reporting screens: `ReportSchedulerScreen`, `NewReportScreen`, `EditReportScreen`, `AlcExceptionDashboard`, `BackOfficeAdminTerminal`.
    *   The routing configuration was heavily expanded to incorporate these new screens, all protected by `ProtectedRoute` based on `UserRoleEnum` (e.g., ADMIN, CUSTOMER, AGENT, CSF, FRONTOFFICE, BACKOFFICE, SPR_CUSTOMER, ADMIN_V2).
    *   Routes for House Bill of Lading (HBL) forms (`booking/hbl_form`) were explicitly added.
    *   A development console log "TEST on Flow" was present.
    *   **11/21/2025, 11:34:00 AM:** A minor permission adjustment was made for the `shipment_tracking` route, removing `UserRoleEnum.ADMIN_V2` from the allowed roles.

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\components\screen\analytics\MetricsBox.jsx`**
    *   **11/21/2025, 11:36:28 AM:** This file was introduced or significantly updated to define the `MetricsBox` component for rendering analytics charts. It includes:
        *   Dynamic chart rendering (Bar, Pie, Line, Stacked Bar, Gauge) based on `chartType` and `chartView`.
        *   Integration with Redux (`useSelector`) for state management.
        *   Components for toolbar (`MetricToolbar`), footer (`MetricFooter`), and a modal for full-screen viewing (`ThemedModal`).
        *   A `NoDataAvailable` placeholder.

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\components\screen\booking\actions.js`**
    *   **11/24/2025, 2:52:57 PM:** The `getBookingActions` function was refactored. Instead of a single large conditional return, it now defines several reusable arrays of actions (`bookingActions`, `isfActions`, `hblAction`, `createHblAction`, `viewAction`, `updateLineBookingAction`, `updateDOAction`) and combines them based on user access roles. New actions to "Update Line Booking" and "Update DO" were added, which open modals.
    *   **11/24/2025, 2:53:07 PM:** The `formAction` for the `Create HBL` action was corrected from `"edit"` to `"add"`, aligning with its intended "create" functionality.
    *   **11/24/2025, 2:53:44 PM - 11/24/2025, 2:56:17 PM:** A temporary, likely debugging, change was made where the "Edit HBL" label was briefly altered to "Edit HBL123" and then reverted back.
    *   **11/24/2025, 3:43:34 PM:** The icon for the "Create HBL" action was updated from `<Edit />` to the more appropriate `<Create />` icon, enhancing clarity.
    *   **11/24/2025, 3:43:58 PM:** No functional changes observed.

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\store\api\agentBookingApi.js`**
    *   **11/24/2025, 3:02:03 PM:** This Redux Toolkit Query API file was extended with new `tagTypes` (`'FormDetails'`) and several new endpoints:
        *   `saveHblBooking` (mutation) to save House Bill of Lading details.
        *   `fetchHblBookingFormDetails` (query) to retrieve HBL form data.
        *   `updateCarrierBooking` (mutation) for carrier booking updates.
        *   `updateDo` (mutation) for Delivery Order updates, notably removing the `Content-Type` header for its request.
        *   `exportSprReport` (query) for SPR booking reports.
    *   Existing `saveBooking` and `fetchBookingFormDetails` endpoints were updated to invalidate/provide the new `'FormDetails'` tag.

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\components\screen\booking\hbl\HBLform.jsx`**
    *   **11/24/2025, 3:14:32 PM:** This file was introduced to create the `HBLForm` component, a complex form for managing House Bill of Lading entries. Key aspects include:
        *   Extensive form handling using `Formik` and `Yup` for validation, with specific HBL-related validation schema (`HBLvalidationSchema`).
        *   Integration with Redux (`useDispatch`, `useSelector`) to manage form state, routing, container, and PO lists.
        *   Dynamic party management features (edit, view, add new party) and state updates when changing party tabs.
        *   Keyboard shortcuts (`ctrl+u`, `ctrl+d`, `ctrl+a`, `ctrl+s`, `ctrl+p`) for improved user interaction.
        *   Error handling with `toast` notifications and an `AlertConfig` for displaying messages.
        *   **11/24/2025, 3:17:08 PM:** A minor refinement was made to the `agent_booking_id` initialization within `Formik`, simplifying the conditional logic for handling "copy" actions.
        *   Other timestamps between 3:15 PM and 3:17 PM indicate minor saves without functional changes.

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\components\screen\booking\hbl\validation.js`**
    *   **11/24/2025, 3:20:42 PM:** This new file was added to define the `HBLvalidationSchema` using `Yup`.
        *   It includes a `generateAddressValidation` function to create reusable validation schemas for address fields (e.g., `ship_add1`, `cnee_city`, `notify_country`) with specific format and length constraints.
        *   It defines comprehensive validation for core HBL fields such as `pol`, `pod`, `por`, `fpd`, `vessel`, `voyage`, `bookingdate`, `hbldate`, `client_name`, `cnee_name`, `ship_name`, and `blno` (which is now required).
        *   Custom validation tests are included for `mblno` and `blno` to enforce a specific alphanumeric format.
        *   Dynamic inclusion of address validations for `shipper`, `consignee`, and `notify` parties.

### Patterns and Recurring Elements:

*   **Feature-rich Expansion:** The log demonstrates a clear pattern of adding extensive new features and modules to the frontend, particularly in the areas of shipping, booking, analytics, and master data management.
*   **Role-Based Access Control:** The `App.js` file heavily utilizes `ProtectedRoute` and `UserRoleEnum` to enforce role-specific access to different parts of the application, suggesting a robust security and permissions model.
*   **Modular Architecture:** The codebase is being structured with a focus on modularity, evident from the refactoring of booking actions, the use of Redux Toolkit Query for API interactions, and dedicated validation schemas for complex forms.
*   **Form Management Consistency:** `Formik` and `Yup` are consistently used for form state management and validation across new complex forms like HBL, ensuring a standardized approach to data input and integrity.
*   **User Experience Enhancements:** Implementation of keyboard shortcuts for common form actions indicates an effort to improve the efficiency and usability for power users.
*   **Continuous Development & Refinement:** The presence of console logs, temporary label changes, and repeated save operations in the timestamps suggest an active and iterative development process.
*   **Focus on Shipping/Logistics:** A significant portion of the changes are concentrated on core logistics functionalities like packing lists, service invoices, expense codes, destinations, vendors, PO/DSO orders, OTM BOLs, HBLs, ISFs, and various tracking screens (FCL, LCL, Rail, Air, Shipment).

## 6:41:13 AM
The code changes primarily involve updates to two controller files (`company_details.controller.ts`, `hblEntry.controller.ts`) and their associated route files (`otm_bol.route.ts`, `hblEntry.route.ts`).

**File-Specific Updates:**

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-backend\src\controllers\company_details.controller.ts`**
    *   **11/21/2025, 10:07:54 AM**: The `getAll` function was updated to support fetching company names based on user roles (`AGENT` or `CUSTOMER`). For `CUSTOMER` role, new logic was introduced to handle pagination, fetching total counts and paginated results from `mtr_tracking_data`, replacing previously commented-out code. Temporary `console.log` statements were added for debugging.
    *   **11/21/2025, 10:08:08 AM**: The temporary `console.log` statements for debugging were removed, indicating a minor cleanup.

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-backend\src\routes\otm_bol.route.ts`**
    *   **11/21/2025, 11:40:37 AM**: Several new API routes were added for OTM (Open Text Message) Bill of Lading operations, including endpoints for saving/editing uploads (`/upload_save_edit`), fetching payload data (`/fetch_payload`), fetching by a common key (`/fetch/:common_key`), generating XML (`/generate_xml`), and sending data to OTM (`/send_to_otm`). A previous `/upload` route using `uploadMiddleware` was commented out.

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-backend\src\controllers\hblEntry.controller.ts`**
    *   **11/21/2025, 3:11:14 PM**: A new controller for HBL (House Bill of Lading) entry was introduced. It defines `createHblMasterBooking` for single HBL inserts into `hbl_master` and `saveHblBooking` for comprehensive HBL management. `saveHblBooking` supports both new booking creation and updates, involving fetching current data, updating multiple related tables (`agent_booking_entry`, `agent_booking_vessel`, `agent_booking_routing`, `agent_booking_container`, `agent_booking_hbl`, `agent_booking_po` by deleting and re-inserting list items), and logging changes to `agent_booking_hbl_history`. Both functions use database transactions and extensive input sanitization.
    *   **11/21/2025, 3:13:11 PM**: The error handling in `createHblMasterBooking` was changed from using `HttpError` to simply logging the error, potentially affecting client error responses.
    *   **11/21/2025, 3:16:23 PM - 3:19:06 PM**: Minor adjustments were made to the `bookingdate` field in both `createHblMasterBooking` and `saveHblBooking` to allow for null values or to be entirely commented out from the payload.
    *   **11/24/2025, 1:19:43 PM**: The response format for `createHblMasterBooking` was updated to return the full array of inserted rows (`rows`) instead of just the first element (`rows[0]`).
    *   **11/24/2025, 1:23:51 PM**: `createHblMasterBooking` underwent a major refactoring to support bulk creation of HBL entries. It now expects an array `hbl_entries` in the request body, maps it to a payload array, and uses an `insertMany` function for bulk insertion. Error handling was also updated to return a direct 500 response.
    *   **11/24/2025, 1:24:40 PM**: The `lastmodifieddate: "NOW()"` field, which was part of the bulk insert payload, was commented out.
    *   **11/24/2025, 1:26:39 PM**: The `insertMany` call in `createHblMasterBooking` was reverted to `insertQuery`, which might introduce a bug for bulk inserts if `insertQuery` is not designed for array input.
    *   **11/24/2025, 2:59:08 PM**: The `createHblMasterBooking` function was reverted back to its original single-HBL-creation logic, discarding the bulk creation feature and associated changes.
    *   **11/24/2025, 3:22:19 PM**: A `console.log` statement was added to `createHblMasterBooking` for debugging the request body.
    *   **11/24/2025, 3:36:33 PM**: The `payload` for `createHblMasterBooking` was expanded to include `transportaion_mode`, `customer` (aliased as `client_name`), and `description`.
    *   **11/24/2025, 5:09:51 PM**: The entire `createHblMasterBooking` function was commented out. Additionally, the `bookingdate` field was commented out from the `bookingInsertQuery` within `saveHblBooking`.

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-backend\src\routes\hblEntry.route.ts`**
    *   **11/21/2025, 3:11:42 PM**: Initial route setup included two `POST` routes on the same path (`/`), creating a routing conflict.
    *   **11/21/2025, 3:19:52 PM**: The routing conflict was resolved by assigning `createHblMasterBooking` to a new `"/create"` path.
    *   **11/24/2025, 5:10:21 PM - 5:10:39 PM**: The `router.post("/create", createHblMasterBooking);` route was commented out, and its import was removed, disabling this specific HBL creation endpoint.

**Timestamps of Significant Changes:**

*   **11/21/2025, 10:07:54 AM**: Introduction of pagination logic for customer company details.
*   **11/21/2025, 11:40:37 AM**: Expansion of OTM BOL module with multiple new routes.
*   **11/21/2025, 3:11:14 PM**: Initial creation and comprehensive logic for HBL entry (create and save/update).
*   **11/21/2025, 3:19:52 PM**: Resolution of routing conflict for HBL creation.
*   **11/24/2025, 1:23:51 PM**: Major refactoring of `createHblMasterBooking` for bulk HBL creation.
*   **11/24/2025, 2:59:08 PM**: Reversion of the bulk HBL creation logic back to single HBL creation.
*   **11/24/2025, 5:09:51 PM**: Disabling (commenting out) the `createHblMasterBooking` function and commenting out `bookingdate` in `saveHblBooking`.
*   **11/24/2025, 5:10:21 PM - 5:10:39 PM**: Disabling (commenting out) the corresponding HBL creation route.

**Patterns and Recurring Elements:**

*   **Rapid Development and Iteration**: The multiple changes to `hblEntry.controller.ts` in quick succession on 11/24/2025 (especially the introduction, modification, and subsequent reversion/disabling of bulk HBL creation) indicate an active development cycle with experimentation and refinement.
*   **Debugging Practices**: The insertion and removal of `console.log` statements in controllers signify standard debugging during development.
*   **Payload Sanitization**: Consistent use of `sanitizeString` for various request body fields across controllers points to an emphasis on data integrity and security.
*   **Database Transactions**: The recurring use of `BEGIN`, `COMMIT`, and `ROLLBACK` for database operations ensures data consistency, especially in complex update scenarios involving multiple tables within `saveHblBooking`.
*   **Modular API Structure**: Changes consistently appear in both controller and route files for specific modules, following a clear separation of concerns.
*   **Feature Management through Comments**: Commenting out code (e.g., the `/upload` route in `otm_bol.route.ts`, `createHblMasterBooking` function and its route in `hblEntry` files) is used to temporarily disable or defer features.

## 9:15:14 AM
The code changes primarily revolve around expanding frontend routing, enhancing UI components, refactoring booking-related actions, and introducing a new House Bill of Lading (HBL) feature, along with new API endpoints.

**File-specific updates:**

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\App.js` (11/21/2025, 11:31:13 AM & 11:34:00 AM):**
    *   The application's routing expanded significantly with new imports and routes for various screens including FCL/LCL tracking, Rail and Air tracking, MTR forms, Dashboard 7501, Shipping Orders, CNG Booking, City Master, Portmaster, and extended versions of Agent Booking and Booking Dashboard forms.
    *   A new `UserRoleEnum.ADMIN_V2` role was introduced and added to the `allowedRoles` for several `ProtectedRoute` components, indicating an update to the access control system.
    *   The two entries for this file are identical, suggesting a non-functional save or an inconsequential change not captured in the log.

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\components\screen\analytics\MetricsBox.jsx` (11/21/2025, 11:36:28 AM):**
    *   Introduced functionality for viewing analytics charts in a full-screen modal. This involved adding `MetricFooter` and `ThemedModal` components.
    *   The `getChartComponent` function was updated to dynamically adjust chart height when enlarged, with a minimum height constraint.
    *   The default view of charts now displays only the first 9 data points (`item.data.slice(0, 9)`).

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\components\screen\booking\actions.js` (multiple timestamps on 11/24/2025):**
    *   The `getBookingActions` function was substantially refactored to use a modular approach, defining separate arrays for common actions (e.g., `bookingActions`, `isfActions`, `hblAction`, `createHblAction`, `viewAction`, `updateLineBookingAction`, `updateDOAction`).
    *   These action arrays are then combined conditionally based on the user's access role (`agentBookingMenu`, `customerBookingMenu`, `adminBookingMenu`).
    *   The `formAction` for `createHblAction` was initially set to `"edit"` and then quickly corrected to `"add"` (11/24/2025, 2:53:07 PM).
    *   A temporary label "Edit HBL123" was introduced for `hblAction` (11/24/2025, 2:53:44 PM) and then reverted back to "Edit HBL" (11/24/2025, 2:56:17 PM), indicating a testing phase.
    *   The `Create` icon was added and used for the "Create HBL" action (11/24/2025, 3:43:34 PM).
    *   The "Create HBL" action was explicitly included in the actions returned for `agentBookingMenu` and `adminBookingMenu` access (11/24/2025, 2:54:37 PM).

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\store\api\agentBookingApi.js` (11/24/2025, 3:02:03 PM):**
    *   The Redux Toolkit Query API (`agentBookingApi`) was extended to support House Bill of Lading (HBL) operations with new `saveHblBooking` and `fetchHblBookingFormDetails` endpoints.
    *   Additional mutations (`updateCarrierBooking`, `updateDo`) and a query (`exportSprReport`) were added to enhance booking management and reporting capabilities.
    *   A new `FormDetails` tag type was introduced to manage caching and invalidation for booking form details.

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\components\screen\booking\hbl\HBLform.jsx` (multiple timestamps on 11/24/2025):**
    *   This file details the development of the HBL form, integrating multiple sub-forms for container details, routing, header information, and POs.
    *   It utilizes `Formik` for form management, `useSaveHblBookingMutation` for data submission, and Redux for state management of party codes and tab selections.
    *   The form includes party management features (`Edit Party`, `View Parties`, `Add New Parties`) and implements keyboard shortcuts (`ctrl+u`, `ctrl+d`, `ctrl+a`, `ctrl+s`, `ctrl+p`) for improved user experience.
    *   Validation is enforced using `HBLvalidationSchema`.
    *   An initial value change for `agent_booking_id` was noted (11/24/2025, 3:17:51 PM), where it no longer conditionally clears for a "copy" action, suggesting potential changes in how form initialization for copying is handled.
    *   Multiple identical entries for this file suggest frequent saves during development.

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\components\screen\booking\hbl\validation.js` (11/24/2025, 3:20:42 PM):**
    *   A comprehensive `HBLvalidationSchema` was implemented using `Yup` for the HBL form.
    *   This schema includes required fields for origin/destination ports, vessel, voyage, dates, client, consignee, and shipper names.
    *   It also features sophisticated validation for `mblno` and `blno` (nullable vs. required, and specific alphanumeric patterns).
    *   Dynamic address validation is generated using a `generateAddressValidation` function, applying rules consistently across different party types (`ship`, `cnee`, `notify`).

**Patterns and Recurring Elements:**

*   **Feature-driven Development:** The log shows a clear focus on developing new features, specifically around House Bill of Lading (HBL) management and expanding tracking/booking capabilities.
*   **Modularization and Reusability:** The refactoring of `actions.js` demonstrates an effort to create more maintainable and reusable code components, especially for common UI actions.
*   **Redux Integration:** Redux (via `@reduxjs/toolkit/query/react` and `react-redux`) is consistently used for API interaction and global state management across different features.
*   **Form Management:** `Formik` and `Yup` are the chosen tools for form handling and validation, ensuring data integrity across various forms.
*   **User Experience Enhancements:** The addition of full-screen chart views in analytics and keyboard shortcuts in the HBL form indicates a focus on improving the user interface and interaction.
*   **Active Debugging/Testing:** The presence of `console.log` statements and temporary label changes suggests an active development environment with ongoing debugging and testing.
*   **Rapid Iteration:** Numerous small, consecutive changes, especially in `actions.js` and `HBLform.jsx` on 11/24/2025, indicate rapid iterative development or frequent saves.

## 9:15:16 AM
The log details code changes across three main files within the `T360_Api/t360-backend` project: `company_details.controller.ts`, `otm_bol.route.ts`, and `hblEntry.controller.ts`/`hblEntry.route.ts`. All recorded changes occurred between November 21st and November 24th, 2025, suggesting an active development period.

**File-Specific Updates:**

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-backend\src\controllers\company_details.controller.ts`**
    *   **Timestamp: 11/21/2025, 10:07:54 AM**
        *   The `getAll` function was established to fetch company names, differentiating logic based on user `role` (AGENT or CUSTOMER).
        *   For `AGENT`s, it queries `agent_po_account_master` for distinct `cname`s with a search filter and limit 10.
        *   For `CUSTOMER`s, it queries `mtr_tracking_data` for distinct `account_name`s, implementing pagination if `req.query.pagination` is "true", including total count. If no pagination, it defaults to a limit of 10.
        *   Initial version included several `console.log` statements for debugging `totalResult` and `result` arrays.
    *   **Timestamp: 11/21/2025, 10:08:08 AM**
        *   Minor cleanup: Removed `console.log("====totalResult",totalResult)` and `console.log("====result",result)` from the `CUSTOMER` pagination logic.

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-backend\src\routes\otm_bol.route.ts`**
    *   **Timestamp: 11/21/2025, 11:40:37 AM**
        *   This file defines routes for OTM (Open Transport Management) Bill of Lading (BOL) operations.
        *   It includes `GET` routes for fetching excel data, general BOLs, payload, and specific BOLs by number or common key.
        *   `POST` routes are defined for editing OTM BOL, uploading and saving edits, generating XML, and sending data to OTM.
        *   A `POST /upload` route utilizing `uploadMiddleware` and environment variables for file path was commented out.

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-backend\src\controllers\hblEntry.controller.ts`**
    *   **Timestamp: 11/21/2025, 3:11:14 PM**
        *   Introduced `createHblMasterBooking` and `saveHblBooking` functions.
        *   `createHblMasterBooking` handles creating a new HBL master entry, inserting data into the `hbl_master` table within a database transaction.
        *   `saveHblBooking` implements logic for both adding new and updating existing HBL bookings (`agent_booking_entry`). It manages associated data across multiple tables (`agent_booking_vessel`, `agent_booking_routing`, `agent_booking_container`, `agent_booking_hbl`, `agent_booking_po`), often deleting and re-inserting sub-list data (routing, containers, POs) during updates. This function also logs historical changes to `agent_booking_hbl_history`, storing both old and new payload states.
    *   **Timestamp: 11/21/2025, 3:13:11 PM**
        *   Error handling in `createHblMasterBooking` changed from propagating `HttpError` via `next` to directly logging the error.
        *   `booking_date` handling in `saveHblBooking` was adjusted to explicitly allow `null` values.
    *   **Timestamp: 11/21/2025, 3:16:23 PM**
        *   Minor fix in `saveHblBooking` payload for `hbldate` from string `'null'` to actual `null`.
    *   **Timestamp: 11/21/2025, 3:17:07 PM**
        *   `bookingdate` in `createHblMasterBooking` payload was updated to handle `null` values.
    *   **Timestamp: 11/21/2025, 3:19:06 PM**
        *   `bookingdate` field was commented out from the `createHblMasterBooking` payload.
    *   **Timestamp: 11/24/2025, 1:19:43 PM**
        *   `createHblMasterBooking` changed its successful response to return the entire `rows` array instead of just the first element (`rows[0]`).
    *   **Timestamp: 11/24/2025, 1:23:51 PM**
        *   Major refactoring of `createHblMasterBooking`: it was modified to handle *multiple* HBL entries via a `hbl_entries` array in the request body, utilizing an `insertMany` function for bulk insertion. The success message changed to reflect multiple entries.
    *   **Timestamp: 11/24/2025, 1:26:39 PM**
        *   The bulk insert (`insertMany`) in `createHblMasterBooking` was replaced with a call to `insertQuery`, potentially causing issues if `insertQuery` is not designed for array payloads.
    *   **Timestamp: 11/24/2025, 2:59:08 PM**
        *   The `createHblMasterBooking` function was reverted to its pre-bulk-insert state, handling a single HBL master entry via `insertQuery` and returning `rows[0]`.
    *   **Timestamp: 11/24/2025, 3:22:19 PM**
        *   A `console.log` was added to `createHblMasterBooking` for debugging the request body.
    *   **Timestamp: 11/24/2025, 3:36:33 PM**
        *   The `createHblMasterBooking` payload was expanded to include `transportaion_mode`, `customer`, and `description` fields.
    *   **Timestamp: 11/24/2025, 5:09:51 PM**
        *   The entire `createHblMasterBooking` function was commented out.
        *   The `bookingdate` field in `bookingInsertQuery` within `saveHblBooking` was commented out.

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-backend\src\routes\hblEntry.route.ts`**
    *   **Timestamp: 11/21/2025, 3:11:42 PM**
        *   Initial route setup for HBL entries: `POST /` for `saveHblBooking`, `GET /` for `fetchHblFormDetails`, and a conflicting second `POST /` for `createHblMasterBooking`.
    *   **Timestamp: 11/21/2025, 3:19:52 PM**
        *   The conflicting `POST /` route for `createHblMasterBooking` was moved to `POST /create`.
    *   **Timestamp: 11/24/2025, 5:10:21 PM**
        *   The `POST /create` route associated with `createHblMasterBooking` was commented out.
    *   **Timestamp: 11/24/2025, 5:10:39 PM**
        *   The import statement for `createHblMasterBooking` was removed, aligning with the commented-out route.

**Patterns and Recurring Elements:**

*   **Concentrated Development:** All changes fall within a short, three-day period (November 21-24, 2025), indicating intensive work on these features.
*   **Database Transaction Management:** The use of `await query("BEGIN")`, `await query("COMMIT")`, and `await query("ROLLBACK")` is prevalent in controller functions, ensuring data consistency for multi-step database operations.
*   **Input Validation/Sanitization:** A strong pattern of `sanitizeString()` for all incoming string data and `AppDateFormate()` for dates demonstrates a focus on data integrity and security.
*   **Debugging Practices:** Several `console.log` and `logger.info` statements were added and subsequently removed or retained for ongoing debugging.
*   **Feature Evolution and Reversion:** The `hblEntry.controller.ts` file shows a clear pattern of iterative development, with `createHblMasterBooking` undergoing significant changes to support bulk inserts, then reverting, and eventually being commented out, indicating potential redesign, de-prioritization, or issues with the bulk implementation.
*   **Commenting Out Code:** Both routes and controller functions are commented out, suggesting features are being temporarily disabled, re-evaluated, or are under construction.
*   **Role-Based Logic:** The `company_details.controller.ts` demonstrates conditional logic based on user roles (`AGENT`, `CUSTOMER`), suggesting a multi-user system with different data access patterns.
*   **Modular Design:** Routes and controllers are separated, adhering to a common backend architectural pattern.

## 11:27:25 AM
The log details a series of changes primarily focused on the `t360-backend` API, specifically concerning company details and HBL (House Bill of Lading) entry functionality.

**File-specific updates:**

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-backend\src\controllers\company_details.controller.ts`**
    *   **Timestamp: 11/21/2025, 10:07:54 AM**: The `getAll` function was updated to support fetching company names based on user `role` (AGENT or CUSTOMER). For AGENTs, it queries `agent_po_account_master`. For CUSTOMERs, it queries `mtr_tracking_data` and includes logic for optional pagination with `LIMIT` and `OFFSET` clauses, along with a total count.
    *   **Timestamp: 11/21/2025, 10:08:08 AM**: Minor refinement involved removing `console.log` statements from the CUSTOMER role's pagination logic.

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-backend\src\routes\otm_bol.route.ts`**
    *   **Timestamp: 11/21/2025, 11:40:37 AM**: This file defines API routes related to OTM BOL (Bill of Lading). A `POST /upload` route was commented out, which previously used `uploadMiddleware` for handling `plFile` and `dutyFile`. Several new `POST` and `GET` routes were added: `/upload_save_edit`, `/fetch/:common_key`, `/generate_xml`, and `/send_to_otm`, indicating expanded functionality for OTM BOL processing and data manipulation.

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-backend\src\controllers\hblEntry.controller.ts`**
    *   This file experienced significant and frequent modifications over the recorded period, indicating active development and refactoring.
    *   **Timestamp: 11/21/2025, 3:11:14 PM**: Introduced two main asynchronous functions: `createHblMasterBooking` (for single HBL master record creation) and `saveHblBooking` (for creating or updating more complex HBL booking entries, including associated routing, container, and PO lists). Both functions employ database transactions (`BEGIN`, `COMMIT`, `ROLLBACK`) and extensive data sanitization/formatting. `saveHblBooking` also logs old and new data into an `agent_booking_hbl_history` table during updates.
    *   **Timestamp: 11/21/2025, 3:13:11 PM**: Modified error handling in `createHblMasterBooking` to use `logger.error` instead of propagating an `HttpError` via `next()`.
    *   **Timestamp: 11/21/2025, 3:16:23 PM**: The `bookingdate` field in `saveHblBooking`'s `bookingInsertQuery` was made explicitly nullable (`payload.booking_date || null`).
    *   **Timestamp: 11/21/2025, 3:17:07 PM**: Similar change for `bookingdate` in `createHblMasterBooking`'s payload, making it nullable.
    *   **Timestamp: 11/21/2025, 3:19:06 PM**: The `bookingdate` field within the `payload` for `createHblMasterBooking` was commented out entirely.
    *   **Timestamp: 11/24/2025, 1:19:43 PM**: Changed the success response of `createHblMasterBooking` to return the full `rows` array instead of just `rows[0]`.
    *   **Timestamp: 11/24/2025, 1:23:51 PM**: **Major Refactor**: `createHblMasterBooking` was significantly rewritten to handle batch insertions of HBL entries via an array (`hbl_entries`) in the request body, using an `insertMany` helper function. Error handling was also enhanced to return a 500 status with a specific message.
    *   **Timestamp: 11/24/2025, 1:24:40 PM**: Commented out a `lastmodifieddate` field that was being mapped in the batch payload for `createHblMasterBooking`.
    *   **Timestamp: 11/24/2025, 1:26:39 PM - 1:29:01 PM**: A temporary, likely erroneous, change in `createHblMasterBooking` where `insertMany` was replaced with `insertQuery` while still passing an array, which is typically for single insertions.
    *   **Timestamp: 11/24/2025, 2:59:08 PM**: **Major Revert**: `createHblMasterBooking` was largely reverted to its state before the batch insertion refactor, once again handling single HBL master bookings and using `insertQuery` with a single payload.
    *   **Timestamp: 11/24/2025, 3:22:19 PM**: Added `console.log` for request body debugging in `createHblMasterBooking`.
    *   **Timestamp: 11/24/2025, 3:36:33 PM**: Added `transportaion_mode`, `customer`, and `description` fields to the `payload` in `createHblMasterBooking`.
    *   **Timestamp: 11/24/2025, 5:09:51 PM**: `createHblMasterBooking` function was commented out entirely. Within `saveHblBooking`, the `bookingdate` field in `bookingInsertQuery` and `agent_booking_id`, `location` fields in the `insertQuery` for new bookings were commented out.
    *   **Timestamp: 11/25/2025, 11:00:44 AM**: `createHblMasterBooking` was uncommented, reverting to its state as of 3:36:33 PM on 11/24. The commented-out fields in `saveHblBooking`'s new booking path (`bookingdate`, `agent_booking_id`, `location`) persisted.

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-backend\src\routes\hblEntry.route.ts`**
    *   **Timestamp: 11/21/2025, 3:11:42 PM**: Initial setup of routes: `POST /` for `saveHblBooking`, `GET /` for `fetchHblFormDetails`. Critically, `router.post("/")` was duplicated, pointing to `createHblMasterBooking` as well, which is an error in Express routing.
    *   **Timestamp: 11/21/2025, 3:19:52 PM**: Fixed the route duplication by assigning `createHblMasterBooking` to `POST /create`.
    *   **Timestamp: 11/24/2025, 5:10:21 PM**: The `POST /create` route for `createHblMasterBooking` was commented out.
    *   **Timestamp: 11/24/2025, 5:10:39 PM**: The import statement for `createHblMasterBooking` was removed, aligning with the commented-out route.
    *   **Timestamp: 11/25/2025, 11:00:51 AM**: The `createHblMasterBooking` import and `POST /create` route were uncommented, reverting the previous day's changes.

**Timestamps of significant changes:**

*   **11/21/2025, 10:07:54 AM**: Introduction of pagination logic for company details.
*   **11/21/2025, 11:40:37 AM**: Expansion of OTM BOL routes, including new functionality for payload fetching, XML generation, and sending to OTM.
*   **11/21/2025, 3:11:14 PM**: Initial comprehensive implementation of HBL booking creation and update logic.
*   **11/24/2025, 1:23:51 PM**: Major architectural shift in `createHblMasterBooking` towards batch HBL creation.
*   **11/24/2025, 2:59:08 PM**: Complete revert of the batch HBL creation in `createHblMasterBooking` back to single entry creation.
*   **11/24/2025, 5:09:51 PM - 11/25/2025, 11:00:44 AM**: Toggling (commenting/uncommenting) of `createHblMasterBooking` and its route, along with partial disabling of fields in `saveHblBooking`'s creation path, indicating experimental or unstable changes being introduced and reverted.

**Patterns or recurring elements:**

*   **Focus on HBL and Booking Management**: A large portion of the changes revolves around creating, updating, and managing HBL (House Bill of Lading) entries, including associated details like routing, containers, and purchase orders.
*   **Data Sanitization and Formatting**: The repeated use of `sanitizeString(req.body.field)` and `AppDateFormate(req.body.dateField, db_format)` highlights a consistent approach to data validation and preparation before database interaction.
*   **Transactional Database Operations**: All functions modifying the database (`insertQuery`, `updateQuery`, `insertMany`) are wrapped within `BEGIN`, `COMMIT`, and `ROLLBACK` transactions, ensuring data integrity.
*   **Logging for Debugging**: Frequent `logger.info` and `logger.error` statements, sometimes accompanied by `console.log`, indicate a practice of detailed logging for development and debugging purposes.
*   **API Route Volatility**: The `hblEntry.route.ts` file, in particular, shows initial route conflicts and subsequent commenting/uncommenting of routes, suggesting ongoing API design adjustments or feature development for HBL master bookings.
*   **Refactor and Revert Cycles**: The `hblEntry.controller.ts` file exhibits a clear pattern of introducing significant refactors (like batch inserts) only to revert them shortly after, possibly due to implementation issues, changing requirements, or feature branch merges.

## 11:27:47 AM
The provided code changes detail significant development within a React frontend application, primarily focusing on the introduction and refinement of House Bill of Lading (HBL) functionality, alongside updates to routing, API interactions, and analytics.

**File-Specific Updates:**

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\App.js` (Timestamp: 11/21/2025, 11:31:13 AM & 11:34:00 AM)**
    The main routing configuration file underwent minor updates. The `UserRoleEnum.ADMIN_V2` role was added to the `allowedRoles` for both the `/app/shipment_tracking` and `/app/booking` routes, expanding access control for this new administrative role. The file also shows a vast array of imported components, indicating a large, feature-rich application.

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\components\screen\analytics\MetricsBox.jsx` (Timestamp: 11/21/2025, 11:36:28 AM)**
    This component is responsible for rendering various analytical charts (Bar, Pie, Line, Stacked Bar, Gauge). It includes a toolbar for selecting chart views and a footer with an enlarge option. The component dynamically determines which chart to display based on `item.chartType` and handles cases where no data is available.

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\components\screen\booking\actions.js` (Timestamps: 11/24/2025, 2:52:57 PM - 11/25/2025, 11:05:42 AM)**
    This file, which defines booking-related actions, saw frequent updates centered around HBL.
    *   Initial refactoring separated actions into reusable arrays like `bookingActions`, `isfActions`, `hblAction`, `viewAction`, `updateLineBookingAction`, and `updateDOAction`.
    *   A `createHblAction` was introduced (11/24/2025, 2:53:07 PM), initially using an `<Edit />` icon, which was later changed to `<Create />` (11/24/2025, 3:43:34 PM). This "Create HBL" action was added to the agent and admin menus.
    *   A temporary label change for "Edit HBL" to "Edit HBL123" occurred (11/24/2025, 2:53:44 PM) before being reverted (11/24/2025, 2:56:17 PM).
    *   A `viewHblAction` for displaying HBL details was added (11/25/2025, 10:45:07 AM) and integrated into the admin and default access menus.
    *   A new export function `getHblActions` (initially `getHbActions`) was introduced (11/25/2025, 10:49:06 AM).
    *   The `onClick` handler for `createHblAction` was updated to include a console log (11/25/2025, 11:05:42 AM).

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\store\api\agentBookingApi.js` (Timestamp: 11/24/2025, 3:02:03 PM)**
    The Redux Toolkit Query API for `agentBooking` was substantially extended.
    *   New tag types `HBL` and `FormDetails` were added for caching management.
    *   Several new API endpoints were introduced: `saveHblBooking` for creating/updating HBLs, `fetchHblBookingFormDetails` for retrieving HBL form data, `updateCarrierBooking` for line booking updates, `updateDo` for delivery order updates, and `exportSprReport` for generating booking reports.
    *   Existing `saveBooking`, `fetchBookingDashboard`, and `fetchBookingFormDetails` endpoints were updated to invalidate or provide the new tag types where relevant.

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\components\screen\booking\hbl\HBLform.jsx` (Timestamps: 11/24/2025, 3:14:32 PM - 11/24/2025, 3:17:57 PM)**
    This component defines the form for HBL entry. It uses Formik for form management, integrates with Redux for state, and utilizes the `useSaveHblBookingMutation` hook. Keyboard shortcuts were implemented for common actions (Edit Party, View Parties, Add New Parties, Save, Focus Party). A minor but potentially impactful change was observed in how `agent_booking_id` is initialized, removing a conditional check for `formAction === "copy"`.

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\components\screen\booking\hbl\validation.js` (Timestamp: 11/24/2025, 3:20:42 PM)**
    This file provides Yup validation schemas specifically for the HBL form. It enforces required fields for key HBL details (e.g., ports, vessel, voyage, dates, client, consignee, shipper) and includes regular expression validations for MBL and HBL numbers. It also contains a reusable `generateAddressValidation` function for party addresses, ensuring consistency in address data.

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\pages\booking\BookingDashbaordScreenExtend.jsx` (Timestamps: 11/25/2025, 10:41:59 AM & 10:43:17 AM)**
    This dashboard component manages the display of booking data. A key change was the import of `HblListDetails` (11/25/2025, 10:43:17 AM), signaling the integration of a new modal view for HBL specifics. It also includes sections for booking statistics, filters, and rendering data in either a grid or card view, leveraging Redux for state and API hooks for data.

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\pages\booking\HBLListDetails.jsx` (Renamed/Moved to `src\components\screen\booking\hbl\HBLListDetails.jsx`, Timestamps: 11/25/2025, 10:42:56 AM - 11/25/2025, 11:08:06 AM)**
    This file underwent significant changes and a relocation.
    *   It was initially in `src\pages\booking` and named `HBLListDetails.jsx` (later `HblListDetails.jsx` with a case change).
    *   Its primary function shifted from displaying ISF dummy data with `ISF_COLUMNS` and `getISFActions` to displaying HBL data using `HBL_COLUMNS` and `getHblActions` (11/25/2025, 10:50:42 AM). This implies `HBL_COLUMNS` was defined in `agent.booking.js` around this time, though the log snapshot for that file doesn't explicitly show it.
    *   The file was moved to `src\components\screen\booking\hbl` (11/25/2025, 10:51:35 AM), necessitating numerous relative import path adjustments.
    *   The "New ISF" button was relabeled "New HBL" (11/25/2025, 10:55:10 AM) and its `onClick` handler was fully implemented to navigate to the HBL creation form (`/app/booking/hbl_form`) with the correct `formAction` (11/25/2025, 10:57:06 AM).

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\data\columns\agent.booking.js` (Timestamp: 11/25/2025, 10:45:56 AM)**
    This file defines various column configurations for different booking-related grids. At this timestamp, it includes columns for vessel, cargo, and dashboard views, using utilities like `appDateFormat` for consistent display. While `HBL_COLUMNS` is imported by `HBLListDetails.jsx` from this file, its definition is not present in the provided log snippet for this file, indicating a potential omission or a later, unlogged addition to the file.

**Patterns and Recurring Elements:**

1.  **HBL Feature Rollout:** The most striking pattern is the comprehensive implementation of an HBL (House Bill of Lading) feature. This involves:
    *   Adding dedicated HBL routes in `App.js`.
    *   Creating new API endpoints in `agentBookingApi.js` for HBL data.
    *   Developing specific UI actions (`Edit HBL`, `Create HBL`, `View Hbl Details`) in `actions.js`.
    *   Designing a dedicated HBL form (`HBLform.jsx`) with its own validation schema (`validation.js`).
    *   Integrating HBL list views into the booking dashboard (`BookingDashbaordScreenExtend.jsx` and `HBLListDetails.jsx`).
    *   Refactoring a generic "ISF list" component into a dedicated "HBL list" component.
2.  **Access Control (`ProtectedRoute`, `useAccess`):** The application consistently uses `ProtectedRoute` with `UserRoleEnum` and `useAccess` hook, demonstrating a strong emphasis on role-based access control. The addition of `ADMIN_V2` suggests ongoing role management.
3.  **Modularization and Reusability:** The code exhibits efforts towards modular design, with actions defined centrally (`actions.js`), column configurations in a dedicated file (`agent.booking.js`), and form validation schemas separate from the form components. The relocation of `HBLListDetails.jsx` from `pages` to `components/screen/booking/hbl` also aligns with component reusability.
4.  **Redux Toolkit Query:** The extensive use of Redux Toolkit Query for API interactions (`agentBookingApi.js`) highlights a modern approach to data fetching, caching, and state management in the application.
5.  **Form Management (Formik, Yup):** Formik and Yup are consistently used for form handling and validation, ensuring robust data input and error management across forms like the HBL form.
6.  **UI Consistency:** The use of `ThemeButton`, `OutlinedButton`, `ThemedGrid`, and `ThemeTabs` suggests a component library or design system for a consistent user interface.

## 12:42:16 PM
The provided log details a series of code changes primarily focused on enhancing and expanding the booking and House Bill of Lading (HBL) functionalities within a React-based frontend application. The changes span from November 21st to November 25th, 2025, indicating active development.

### File-Specific Updates:

1.  **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\App.js`**
    *   **Timestamp: 11/21/2025, 11:31:13 AM (and 11:34:00 AM)**
    *   This file saw a significant expansion of route definitions. Numerous new screens and pages were imported and integrated into the application's routing system, including `AddMtrForm`, `GetTruckingDetails`, `RailScreen`, `AgentBookingFormScreenExtend`, `AgentPoFormExtend`, `Dashboard7501Screen`, `ShipmentsScreen`, `CngBookingScreen`, `BookingDashbaordScreenExtend`, `CngBookingFormScreen`, `CngBookingScreenExtend`, `CityMaster`, `UploadOTMBOL`, `PortmasterScreen`, and `AirTrackingScreen`.
    *   The `/app` route explicitly lists new user roles like `ADMIN_V2` alongside existing ones, indicating evolving role-based access control.
    *   A `console.log` statement was added for testing flow, suggesting active debugging during development. The identical entry at 11:34:00 AM likely represents an automatic save without further code changes.

2.  **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\components\screen\analytics\MetricsBox.jsx`**
    *   **Timestamp: 11/21/2025, 11:36:28 AM**
    *   This file, responsible for displaying analytics metrics, underwent a refactor to enhance chart display.
    *   Imports for `PieChart` were corrected to use a capitalized 'Charts' directory.
    *   The `chartView` state initialization logic was updated to specifically handle 'StackBar' and 'Count' chart types, defaulting to 'stack' and 'gauge' respectively.
    *   A `genHeight` function was introduced for dynamic chart height calculation in full-screen mode, and `GaugeChart` was explicitly integrated for `Count` type charts.
    *   The `chartComponent` now initially displays a sliced subset of data (first 9 items), implying a summary view, with full data available on enlargement via `ThemedModal`.
    *   Styling for the root element was explicitly defined, including `boxShadow` and `height/width`.

3.  **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\components\screen\booking\actions.js`**
    *   **Timestamps: Multiple entries from 11/24/2025, 2:52:57 PM to 11/25/2025, 11:05:42 AM**
    *   This file defines role-based actions for booking management. Initially, a large commented-out section was replaced by a more modular approach using reusable action arrays.
    *   **11/24, 2:53:07 PM**: The `createHblAction` was logically updated to use `formAction: "add"` instead of `"edit"` for new HBL entries.
    *   **11/24, 2:53:44 PM**: `adminBookingMenu` was updated to include the `createHblAction`, enabling administrators to create HBLs.
    *   **11/24, 2:53:44 PM - 2:56:17 PM**: A temporary label change for "Edit HBL" to "Edit HBL123" was introduced and then reverted, suggesting a quick test or debug.
    *   **11/24, 3:43:34 PM**: The icon for `createHblAction` was changed from `Edit` to `Create`, providing a more semantically appropriate visual cue.
    *   **11/25, 10:45:07 AM**: A new `viewHblAction` was added, allowing users (specifically admins and default users) to view HBL details in a modal. A new `hblActions` array was also introduced (initially commented out) to encapsulate HBL-specific actions.
    *   **11/25, 10:49:06 AM (and 10:49:23 AM)**: The `hblActions` array was uncommented and exported as `getHblActions`, indicating preparation for a separate set of actions specifically for HBLs, although the contained "Edit ISF" action remained a placeholder with a `console.log`.
    *   **11/25, 11:05:42 AM**: A `console.log` was added to `createHblAction` for debugging `params`.

4.  **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\store\api\agentBookingApi.js`**
    *   **Timestamp: 11/24/2025, 3:02:03 PM**
    *   This API definition file saw significant expansion related to booking and HBL features.
    *   The `tagTypes` were extended to include `'FormDetails'`.
    *   New mutations and queries were added:
        *   `saveHblBooking`: For creating/updating HBLs.
        *   `fetchHblBookingFormDetails`: For retrieving HBL form data.
        *   `updateCarrierBooking`: For updating carrier booking information.
        *   `updateDo`: For updating delivery order (DO) information.
        *   `exportSprReport`: For exporting SPR booking reports.
    *   Associated `invalidatesTags` and `providesTags` were configured for caching mechanisms.
    *   **11/25/2025, 11:51:02 AM**: The URL for `saveHblBooking` mutation was updated from `/hblEntry/create` to `/hblEntry`.

5.  **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\components\screen\booking\hbl\HBLform.jsx`**
    *   **Timestamps: Multiple entries from 11/24/2025, 3:14:32 PM to 11/25/2025, 11:53:28 AM**
    *   This file defines the House Bill of Lading (HBL) form component.
    *   **Initial development (11/24, 3:14:32 PM)**: Introduced a comprehensive form using `Formik` and `Yup` for validation. It integrates various HBL-specific sub-components (e.g., `HblContainerDetailsForm`, `HblRoutingForm`, `HblHeaderForms`, `BasicPoForm`, `ConsigneeFormForHbl`). It included `handleSave` logic for API interaction and `handleEditParty`, `handleViewParties`, `handleAddNewParty` for party management. Extensive keyboard shortcuts were also implemented.
    *   **11/24, 3:17:51 PM**: Adjusted `agent_booking_id` initialization logic, possibly simplifying handling for "copy" actions.
    *   **11/25, 11:53:28 AM**: All previously commented-out `initialValues` properties within `Formik` were uncommented, enabling full initial data population for the HBL form. This is a crucial functional change, making the form fully operational with existing data.

6.  **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\components\screen\booking\hbl\validation.js`**
    *   **Timestamp: 11/24/2025, 3:20:42 PM**
    *   This file introduced a robust validation schema (`HBLvalidationSchema`) for the HBL form using `Yup`.
    *   New required fields were added, including `pol`, `pod`, `por`, `fpd`, `vessel`, `voyage`, `bookingdate`, `hbldate`, `client_name`, `cnee_name`, `ship_name`.
    *   `mblno` and `blno` fields were made required and received specific format validations (4 uppercase letters followed by 1-12 uppercase letters or numbers).
    *   A `generateAddressValidation` helper was created to dynamically apply address validation rules for common parties (shipper, consignee, notify), including conditional state validation.

7.  **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\pages\booking\BookingDashbaordScreenExtend.jsx`**
    *   **Timestamp: 11/25/2025, 10:41:59 AM (and 10:43:17 AM)**
    *   This file represents the extended booking dashboard, integrating the new HBL functionality.
    *   It imports `HblListDetails` (initially from `src\pages\booking`, later adjusted to `src\components\screen\booking\hbl`).
    *   It manages a `modal` state for various modal types, including `'view-hbl'`.
    *   `GridActions` are used with `getBookingActions` to provide context-sensitive actions for grid rows.
    *   The dashboard displays booking counts and status cards (New, Approved, Confirmed, Cancelled Bookings).
    *   A comprehensive `columns` array for data display and export was defined, including many booking-related fields.

8.  **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\pages\booking\HBLListDetails.jsx` (later moved to `src\components\screen\booking\hbl\HBLListDetails.jsx`)**
    *   **Timestamps: Multiple entries from 11/25/2025, 10:42:56 AM to 11/25/2025, 11:38:03 AM**
    *   This component, initially located in `src\pages\booking`, was refactored and moved to `src\components\screen\booking\hbl` around **11/25/2025, 10:51:35 AM**.
    *   Initially, it used `ISF_COLUMNS` and a "New ISF" button with dummy ISF data.
    *   **11/25, 10:43:04 AM**: Corrected the component export name from `HBListDetails` to `HblListDetails`.
    *   **11/25, 10:49:52 AM**: Updated to use `getHblActions` instead of `getISFActions` for grid actions.
    *   **11/25, 10:50:42 AM**: Crucially, the grid columns were changed from `ISF_COLUMNS` to `HBL_COLUMNS`, indicating a shift to displaying HBL-specific data. (Note: `HBL_COLUMNS` definition is not in the provided log for `agent.booking.js`).
    *   **11/25, 10:55:10 AM**: The "New ISF" button was renamed to "New HBL".
    *   **11/25, 10:57:06 AM**: The "New HBL" button's `onClick` handler was fully implemented to navigate to the HBL form for creation, passing the current `agent_booking_id`.
    *   **11/25, 11:38:03 AM**: A `console.log` was added for debugging the `data` prop.

9.  **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\data\columns\agent.booking.js`**
    *   **Timestamp: 11/25/2025, 10:45:56 AM**
    *   This file defines column configurations for various booking-related grids.
    *   It includes definitions for `BOOKING_VESSEL_COLUMN`, `BOOKING_VESSEL_COLUMN_CUSTOMER`, `BOOKING_CARGO_COLUMN`, `BOOKING_DASHBOARD_COLUMNS_GRID`, and `BOOKING_DASHBOARD_COLUMNS_CARDS`.
    *   Columns often use `appDateFormat` for date rendering and custom formatting for numerical values.
    *   Grid columns include fields like `booking_status` (with conditional chip styling), `agent_booking_id`, `bookingno`, `ready_date`, `total_wt`, `total_cbm`, `blno` (HBL), `mblno` (MBL), `ship_name`, and `customer`.

### Patterns and Recurring Elements:

*   **Focus on Booking and HBL**: The overarching theme of these changes is the extensive development and refinement of booking and House Bill of Lading (HBL) features, from API integration to UI components and validation.
*   **Role-Based Access Control**: `ProtectedRoute` and `useAccess` are consistently employed to manage user permissions for various actions and routes (e.g., `ADMIN`, `AGENT`, `CUSTOMER`, `ADMIN_V2`).
*   **React Component Structure**: The codebase follows a clear React component pattern, utilizing `useRef`, `useState`, `useReducer`, and `useSelector/useDispatch` for state and side effects.
*   **Form Management with Formik/Yup**: `Formik` is used for handling complex forms, complemented by `Yup` for robust schema validation, ensuring data integrity.
*   **Data Grid and Actions**: `ThemedGrid` is a common component for displaying tabular data, with `GridActions` providing a standardized way to attach context-sensitive actions (Edit, Copy, View).
*   **API Interaction with Redux Toolkit Query**: `createApi` from `@reduxjs/toolkit/query/react` is the chosen method for API interactions, providing efficient data fetching, caching, and mutation management.
*   **UI/UX Elements**: Material-UI components (`Box`, `Stack`, `Card`, `Typography`, `ThemeTabs`, `OutlinedButton`, `ThemeButton`, `CircularProgress`) are extensively used for building the user interface. `react-hot-toast` is used for user feedback.
*   **Debugging Practices**: Frequent `console.log` statements with descriptive messages indicate ongoing development and debugging efforts.
*   **Refactoring and Modularity**: The movement of `HBLListDetails.jsx` from `pages` to `components/screen/booking/hbl` demonstrates a commitment to a more modular and organized file structure. The restructuring of `getBookingActions` also shows a move towards more maintainable code.
*   **Rapid Iteration**: The close proximity of timestamps (multiple changes within minutes or hours) suggests rapid iteration and development cycles.

## 12:42:31 PM
The `c:\Users\ridap\OneDrive\Documents\T360_Api\t360-backend\src\controllers\company_details.controller.ts` file saw minor refinements in the `getAll` function on **11/21/2025, 10:07:54 AM** and **10:08:08 AM**. This function retrieves company names based on user role (`AGENT` or `CUSTOMER`), applying search and optional pagination for `CUSTOMER`s. The main change involved the `CUSTOMER` role's pagination logic, which was updated to include a total count query and `LIMIT/OFFSET` functionality. A subsequent update removed temporary `console.log` statements.

The `c:\Users\ridap\OneDrive\Documents\T360_Api\t360-backend\src\routes\otm_bol.route.ts` file, updated on **11/21/2025, 11:40:37 AM**, defines various API endpoints for OTM BOL (Bill of Lading) operations. It includes routes for fetching excel data, payload, specific BOLs, editing, generating XML, and sending to OTM. Notably, a `POST /upload` route for excel file uploads using `uploadMiddleware` was commented out, suggesting a change in how these uploads are handled or a shift to the `upload_save_edit` endpoint.

The `c:\Users\ridap\OneDrive\Documents\T360_Api\t360-backend\src\controllers\hblEntry.controller.ts` file underwent frequent and significant changes between **11/21/2025, 3:11:14 PM** and **11/25/2025, 11:00:44 AM**.
- Initially, it featured `createHblMasterBooking` for single HBL master record insertion and `saveHblBooking` for complex HBL entry creation/updates across multiple related tables (`agent_booking_entry`, `agent_booking_vessel`, `agent_booking_routing`, `agent_booking_container`, `agent_booking_hbl`, `agent_booking_po`, `agent_booking_hbl_history`). The `saveHblBooking` function employs a "delete-and-reinsert" strategy for associated child records during updates and tracks changes via an `agent_booking_hbl_history` table.
- Early changes involved minor debugging `console.log`s, tweaks to `bookingdate` nullability, and temporary removal of explicit `res.status(500)` in `createHblMasterBooking`'s error handling.
- On **11/24/2025, 1:23:51 PM**, `createHblMasterBooking` was significantly refactored to support **bulk insertion** of HBL master records by accepting an array (`hbl_entries`) and using `insertMany`. Error handling was also made more robust. This change was briefly reverted (`insertQuery` instead of `insertMany`) and then restored on **11/24/2025, 1:27:31 PM**.
- However, the bulk insertion feature for `createHblMasterBooking` was entirely **removed** on **11/24/2025, 2:59:08 PM**, reverting it to single-record insertion and simplifying its error handling. It was further updated on **11/24/2025, 3:36:33 PM** to include additional fields (`transportaion_mode`, `customer`, `description`) in its payload.
- A notable shift occurred on **11/24/2025, 5:09:51 PM**, when the `createHblMasterBooking` function was **commented out**, suggesting its functionality might have been integrated elsewhere or temporarily disabled. The `saveHblBooking` function's "add" path was also completed to include `hbl_master` insertion directly.
- Finally, on **11/25/2025, 11:00:44 AM**, `createHblMasterBooking` was **uncommented and restored**, indicating its reinstatement as a separate function, with its payload containing `transportaion_mode`, `customer`, and `description`.

The `c:\Users\ridap\OneDrive\Documents\T360_Api\t360-backend\src\routes\hblEntry.route.ts` file mirrored the changes in its corresponding controller.
- On **11/21/2025, 3:11:42 PM**, it initially had conflicting `POST /` routes.
- This conflict was resolved on **11/21/2025, 3:19:52 PM** by moving `createHblMasterBooking` to `POST /create`.
- The `POST /create` route was then commented out and its import removed on **11/24/2025, 5:10:21 PM** and **5:10:39 PM**, aligning with the function's commented status in the controller.
- On **11/25/2025, 11:00:51 AM**, the `POST /create` route and its import were **uncommented and restored**.

The `c:\Users\ridap\OneDrive\Documents\T360_Api\t360-backend\src\controllers\booking.controller.ts` file, changed on **11/25/2025, 11:40:20 AM**, defines `saveBooking` and `saveMaster` functions.
- The `saveBooking` function handles comprehensive booking creation and updates. For updates, it deletes existing cargo, container, vessel, and PO-related entries before re-inserting them. It calculates total CBM and weight, and handles various lists (cargo, vessel, inventory, basic PO, linked PO).
- The `saveMaster` function creates master account entries (`agent_po_account_master`), validating account types and generating unique account codes.
- Subsequent timestamps (**11:41:24 AM, 11:43:12 AM, 11:47:29 AM**) show no functional changes, indicating stability or minor saves without code modification.

**Overall Patterns:**
- **Rapid Iteration and Debugging:** The `hblEntry` files, both controller and route, show very frequent saves with minor tweaks, comments, and reverts within short periods, suggesting active development, testing, and debugging. `console.log` statements frequently appear and disappear.
- **Transactional Database Operations:** Consistent use of `BEGIN`, `COMMIT`, and `ROLLBACK` for ensuring data integrity during database operations.
- **Data Sanitization and Formatting:** Widespread application of `sanitizeString`, `sanitizeIntString`, and `AppDateFormate` to incoming request data, highlighting a focus on security and data consistency.
- **"Delete-and-Reinsert" Strategy:** A recurring pattern for updating child records associated with a main entity, where existing children are deleted and new ones are inserted.
- **Logging for Observability:** Extensive use of `logger.info` and `logger.error` throughout the controllers for operational insights and error tracking.

## 2:48:23 PM
The provided logs detail several code changes across a Node.js/TypeScript backend application, focusing on `company_details`, `otm_bol`, `hblEntry`, and `booking` functionalities.

**File-Specific Updates:**

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-backend\src\controllers\company_details.controller.ts`**
    *   **Timestamp: 11/21/2025, 10:07:54 AM:** The `getAll` controller function was significantly updated. It now differentiates between 'AGENT' and 'CUSTOMER' roles for fetching company names. For 'AGENT's, it queries `agent_po_account_master` for distinct `cname`. For 'CUSTOMER's, it queries `mtr_tracking_data` for distinct `account_name`, introducing robust pagination logic (with `page`, `perPage`, `offset`) and providing a total count if pagination is requested.
    *   **Timestamp: 11/21/2025, 10:08:08 AM:** Minor refinement: `console.log` statements for `totalResult` and `result` were removed from the customer pagination logic, and a `console.log("====total", total)` was added.

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-backend\src\routes\otm_bol.route.ts`**
    *   **Timestamp: 11/21/2025, 11:40:37 AM:** Several new API routes were introduced for OTM (Open Text Master) Bill of Lading operations. This includes GET routes for `excel_data`, `fetch_payload`, fetching by `:bol` number, and by `fetch/:common_key`. POST routes were added for `editOtmBol`, `upload_save_edit`, `generate_xml`, and `send_to_otm`. An existing `/upload` route that uses `uploadMiddleware` was commented out.

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-backend\src\controllers\hblEntry.controller.ts`**
    *   **Timestamp: 11/21/2025, 3:11:14 PM:** Initial or major update to `createHblMasterBooking` and `saveHblBooking` functions. `createHblMasterBooking` handles single HBL master creation. `saveHblBooking` supports both adding and updating HBL bookings, involving complex logic to fetch, delete, and re-insert associated routing, container, and PO data for updates, and generating a new booking ID for new entries. Database transactions (`BEGIN`/`COMMIT`/`ROLLBACK`) are used here.
    *   **Timestamp: 11/21/2025, 3:13:11 PM - 11/21/2025, 3:19:06 PM:** Minor adjustments to `createHblMasterBooking` and `saveHblBooking`, mainly around date field handling (`bookingdate` and `hbldate` defaulting to `null` or being commented out) and error logging.
    *   **Timestamp: 11/24/2025, 1:19:43 PM - 11/24/2025, 1:29:01 PM:** **Significant Refactoring:** The `createHblMasterBooking` function was refactored to handle multiple HBL entries (an array `hbl_entries`) via a single request. It now uses `insertMany` for batch insertion into `hbl_master` and returns an array of created data.
    *   **Timestamp: 11/24/2025, 2:59:08 PM - 11/24/2025, 3:36:33 PM:** `createHblMasterBooking` appears to revert from batch processing to handling a single HBL payload. New fields like `transportaion_mode`, `customer`, and `description` are added to its payload. Debug `console.log` statements are added.
    *   **Timestamp: 11/24/2025, 5:09:51 PM:** The `createHblMasterBooking` function was entirely commented out. In `saveHblBooking`, the `bookingdate` field in `bookingInsertQuery` was commented out.
    *   **Timestamp: 11/25/2025, 11:00:44 AM:** `createHblMasterBooking` was uncommented, reverting to its single-entry processing state (similar to 11/24/2025, 3:36:33 PM). A critical change in `saveHblBooking`'s `ADD` (new booking) logic: `insertQuery` now targets `hbl_master` instead of `agent_booking_entry`, and fields `agent_booking_id`, `location` were commented out from the payload. This indicates a potential mismatch or schema change.
    *   **Timestamp: 11/25/2025, 1:57:33 PM & 1:57:51 PM:** Minor adjustments in `createHblMasterBooking` to include `serial_id` from the request body as `booking_serial_id` when inserting into `hbl_master`.

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-backend\src\routes\hblEntry.route.ts`**
    *   **Timestamp: 11/21/2025, 3:11:42 PM:** Routes `POST /` (for `saveHblBooking` and `createHblMasterBooking`) and `GET /` (for `fetchHblFormDetails`) were defined. A potential conflict for `POST /` exists.
    *   **Timestamp: 11/21/2025, 3:19:52 PM:** The `createHblMasterBooking` route was moved to `POST /create`, resolving the `POST /` conflict.
    *   **Timestamp: 11/24/2025, 5:10:21 PM & 5:10:39 PM:** The `createHblMasterBooking` route was commented out, and its import statement was subsequently removed, aligning with the change in the controller file.
    *   **Timestamp: 11/25/2025, 11:00:51 AM:** The `createHblMasterBooking` route was uncommented and re-added as `POST /create`, along with its import.

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-backend\src\controllers\booking.controller.ts`**
    *   **Timestamp: 11/25/2025, 11:40:20 AM - 11/25/2025, 11:47:29 AM:** The `saveBooking` function handles booking creation and updates, employing a "delete-and-reinsert" strategy for associated lists (cargo, vessel, inventory, POs) during updates. New bookings generate unique `agent_booking_id`s. It collects extensive payload data and inserts into various tables (`agent_booking_entry`, `agent_booking_Cargolist`, `agent_booking_vessel`, `agent_booking_container_pre`, `agent_booking_po`, `agent_booking_linked_po`). Note that database transaction calls (`BEGIN`/`COMMIT`/`ROLLBACK`) are commented out in this function, which could indicate a transactional flaw. The `saveMaster` function handles creation of master accounts, validating account types and generating account codes.

**Timestamps of Significant Changes:**

*   **11/21/2025, 10:07:54 AM:** Major update to company details fetching with role-based logic and pagination.
*   **11/21/2025, 11:40:37 AM:** Addition of multiple OTM BOL API endpoints.
*   **11/21/2025, 3:11:14 PM:** Initial detailed implementation of HBL booking creation/update.
*   **11/24/2025, 1:23:51 PM:** Refactoring of `createHblMasterBooking` for batch HBL entries.
*   **11/24/2025, 2:59:08 PM:** Reversion of `createHblMasterBooking` from batch to single entry processing.
*   **11/24/2025, 5:09:51 PM:** Commenting out of `createHblMasterBooking` function in its controller.
*   **11/25/2025, 11:00:44 AM:** Uncommenting of `createHblMasterBooking` and a potential bug introduced in `saveHblBooking`'s new entry logic.
*   **11/25/2025, 11:40:20 AM:** Implementation of comprehensive `saveBooking` and `saveMaster` functions.

**Patterns and Recurring Elements:**

*   **Data Sanitization:** A consistent pattern of using `sanitizeString`, `sanitizeIntString`, and `AppDateFormate` is observed across multiple controllers (`hblEntry.controller.ts`, `booking.controller.ts`, `company_details.controller.ts`), indicating a strong focus on data validation and type consistency before database operations.
*   **Database Interactions:** The application heavily relies on `insertQuery`, `insertMany`, `updateQuery`, and `query` utilities for PostgreSQL database interactions. Database transactions (`BEGIN`, `COMMIT`, `ROLLBACK`) are frequently used in `hblEntry.controller.ts` for atomic operations, though notably commented out in `booking.controller.ts`'s `saveBooking` function, which might be a concern.
*   **Role-Based Logic:** User roles (e.g., 'AGENT', 'CUSTOMER', 'ADMIN') influence data fetching and location-based logic, as seen in `company_details.controller.ts` and `hblEntry.controller.ts`.
*   **Active Development/Iteration:** The `hblEntry.controller.ts` and `hblEntry.route.ts` files show a rapid cycle of adding new functionality (batch HBL creation), then seemingly reverting or redesigning it (back to single HBL, commenting out routes), and then re-enabling it. This suggests ongoing, iterative development, possibly with changing requirements or testing phases.
*   **Logging:** `logger.info` and `logger.error` are used extensively for debugging and monitoring, indicating good practice for tracking application flow and issues.
*   **Error Handling:** `try...catch` blocks are consistently used with custom `HttpError` and returning 500 status for internal server errors.
*   **Modular Architecture:** The codebase uses distinct controller files for different business domains (company details, OTM, HBL entry, general booking), adhering to a modular design.

## 2:48:47 PM
The code changes primarily focus on enhancing the booking management system, with a significant emphasis on developing and integrating House Bill of Lading (HBL) functionalities. There's also notable activity in route configuration, API integration, and UI component refinement across the application.

**File-Specific Updates:**

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\App.js`**
    *   **11/21/2025, 11:31:13 AM - 11:34:00 AM:** This file underwent a significant update to its routing configuration. It introduced a multitude of new page imports and routes, expanding the application's capabilities to manage various aspects like packing lists, service invoices, expense codes, destinations, vendors, PO orders, DSO orders, dashboards, user management, OTM BOLs, customer/party/agent codes, planboards, detention, commercial invoices, agent POs, CNG invoices, ALCs, shipping orders, container reports, and tracking screens (FCL, LCL, shipment tracking, MTR, trucking, rail, air). Key additions include `AgentBookingFormScreenExtend`, `BookingDashbaordScreenExtend`, `CngBookingScreenExtend`, `CityMaster`, `PortmasterScreen`, `AirTrackingScreen`, and `HblEntryFormScreen`. The access control for many routes was updated to include `UserRoleEnum.ADMIN_V2`.
    *   **11/25/2025, 2:19:41 PM - 2:19:55 PM:** `Auth0LogoutHandler` and `HblListDetails` components were imported. A new `/logout` route was added. Crucially, a new route `booking/hbl_form_screen` was introduced to render `HblListDetails`, while `booking/hbl_form` remained for `HblEntryFormScreen`, creating distinct paths for HBL form and list views.

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\components\screen\analytics\MetricsBox.jsx`**
    *   **11/21/2025, 11:36:28 AM:** This component, responsible for displaying various charts, was enhanced. It introduced the `GaugeChart` and `MetricFooter` components, and integrated `ThemedModal` to allow for full-screen viewing of charts. The chart rendering logic (`getChartComponent`) was updated to accommodate these new chart types and display options.

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\components\screen\booking\actions.js`**
    *   **11/24/2025, 2:52:57 PM:** The `getBookingActions` function was refactored significantly to improve maintainability. It transitioned from a monolithic conditional structure to defining reusable action arrays (e.g., `bookingActions`, `isfActions`, `hblAction`, `viewAction`, `updateLineBookingAction`, `updateDOAction`) that are then combined based on user roles (`access`). The `setModal` function was updated to accept a `type` parameter for better modal management.
    *   **11/24/2025, 2:53:07 PM - 2:56:17 PM:** Minor adjustments were made to the `createHblAction`, changing its `formAction` state from `"edit"` to `"add"`, and temporarily modifying the "Edit HBL" label before reverting it.
    *   **11/25/2025, 10:45:07 AM - 10:49:23 AM:** A new `viewHblAction` was added to allow users to view HBL details via a modal (`type: 'view-hbl'`). This action was integrated into the `adminBookingMenu` and the default fallback. A new `getHblActions` export was also introduced, initially containing a placeholder "Edit ISF" action.
    *   **11/25/2025, 11:05:42 AM:** The `createHblAction`'s `onClick` handler was updated to log "====serial" and to pass a `serial_id` from `params.row` to the `hbl_form` route.
    *   **11/25/2025, 2:06:40 PM - 2:07:46 PM:** The `createHblAction` had its icon changed from `Create` to `Contrast` and its label from "Create HBL" to "HBL". Its navigation target was also changed from `/app/booking/hbl_form` to `/app/booking/hbl_form_screen`, indicating a shift to displaying a list of HBLs rather than directly creating one.
    *   **11/25/2025, 2:27:20 PM:** The `getHblActions` function was updated to include an "Edit HBL" action. However, it incorrectly navigates to `/app/booking/isf_form` instead of an HBL-specific form, which could be a bug.

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\store\api\agentBookingApi.js`**
    *   **11/24/2025, 3:02:03 PM:** `HBL` was added as a new `tagType`. Two new API endpoints, `saveHblBooking` (mutation for POST to `/hblEntry/create`) and `fetchHblBookingFormDetails` (query for GET to `/hblEntry`), were introduced to manage HBL data.
    *   **11/25/2025, 11:51:02 AM:** The `saveHblBooking` mutation's URL was temporarily changed from `/hblEntry/create` to `/hblEntry`.
    *   **11/25/2025, 1:53:20 PM:** The `saveHblBooking` mutation's URL was reverted back to `/hblEntry/create`.

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\components\screen\booking\hbl\HBLform.jsx`**
    *   **11/24/2025, 3:14:32 PM - 3:17:57 PM:** This new HBL form component was introduced. It uses `Formik` and `Yup` for form management and validation, integrates Redux hooks, and provides keyboard shortcuts for common actions. Initial values in `Formik` were largely commented out in early versions.
    *   **11/25/2025, 11:53:28 AM:** A substantial portion of the `initialValues` in the `Formik` component, including shipment/move types, container/routing/PO lists, and various party/port details, were uncommented, making the form initialization more explicit and comprehensive.

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\components\screen\booking\hbl\validation.js`**
    *   **11/24/2025, 3:20:42 PM:** This new file was added to define the validation schema for HBL forms using `Yup`. It includes common validation arrays, a `textFilter` utility for error messages, and a `generateAddressValidation` helper for reusable address field validations. It defines required fields for ports, vessel, voyage, dates, and party names, along with specific regex for HBL/MBL numbers.

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\pages\booking\BookingDashbaordScreenExtend.jsx`**
    *   **11/25/2025, 10:41:59 AM:** This dashboard component uses Redux and RTK Query to fetch and display booking data, including status counts. It defines grid columns with actions, exports data to Excel, and integrates modals for updating line bookings and delivery orders.
    *   **11/25/2025, 10:43:17 AM:** The `HblListDetails` component was imported and integrated into a `ThemedModal` to be displayed when the `type: 'view-hbl'` is triggered, enabling the viewing of HBL lists directly from the booking dashboard.

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\pages\booking\HBLListDetails.jsx` (later moved to `src\components\screen\booking\hbl\HBLListDetails.jsx`)**
    *   **11/25/2025, 10:42:56 AM - 10:43:04 AM:** This file was initially created in the `pages` directory. It featured a basic layout with an "Agent Booking#" display and a "New ISF" button (later changed to "New HBL"). It used a dummy data array for a `ThemedGrid`.
    *   **11/25/2025, 10:49:52 AM - 10:55:10 AM:** Significant refactoring and corrections occurred:
        *   Import paths for `GridActions` and `getHblActions` were updated.
        *   The columns for the grid were changed from `ISF_COLUMNS` to the more appropriate `HBL_COLUMNS`.
        *   The "New ISF" button was correctly labeled "New HBL" and its `onClick` navigates to `hbl_form` with relevant data.
        *   The `useFetchCustomerApproveDetailsQuery` was commented out, implying the `data` prop would be the source of information.
    *   **11/25/2025, 10:51:35 AM:** The file was moved from `src\pages\booking` to `src\components\screen\booking\hbl`, indicating a component-level rather than page-level design.
    *   **11/25/2025, 10:57:06 AM - 11:38:03 AM:** The `onClick` for the "New HBL" button was refined to pass `agent_booking_id` from the `data` prop when navigating to the HBL form. A `console.log` was added for debugging the `data` prop.
    *   **11/25/2025, 2:23:23 PM - 2:24:35 PM:** The `useFetchCustomerApproveDetailsQuery` was permanently commented out, and the display of `data.agent_booking_id` was removed. The `serial_id` parameter was also commented out from the "New HBL" button's navigation state. This suggests the component is now primarily intended to receive data via props.
    *   **11/25/2025, 2:43:59 PM - 2:47:12 PM:** Layout adjustments were made within the component, specifically by wrapping the `ThemedGrid` in a `Card` with a `CardHeader` that includes an "Add HBL" button and an "Agent Booking ID:" label (which changed between `h2`, `h6`, and `h3` tags multiple times). The original top-level "Agent Booking#" display and "New HBL" button were eventually removed to avoid redundancy.

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\data\columns\agent.booking.js`**
    *   **11/25/2025, 10:45:56 AM:** A new `HBL_COLUMNS` export was added, defining the structure for displaying HBL data in a grid, including fields like agent booking ID, ETD, bill of lading, importer, status, and CBP responses. `BOOKING_DASHBOARD_COLUMNS_GRID` no longer takes `access` as a parameter.

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\components\screen\booking\hbl\HblEntryFormScreen.jsx`**
    *   **11/25/2025, 2:10:03 PM - 2:10:53 PM:** This component was updated to conditionally render either the `HBLForm` or `HblListDetails` based on the context. Initially, it rendered `HblListDetails` and passed `hblDetails?.data` to it. It also includes logic for exporting/importing parties and displays errors in a modal.
    *   **11/25/2025, 2:13:17 PM:** The component's default rendering was switched back to `HBLForm`, commenting out the `HblListDetails` component. This implies the primary purpose of this screen is to show the HBL form.

**Patterns and Recurring Elements:**

*   **HBL Feature Development:** The most dominant pattern is the comprehensive development of the HBL feature set. This includes new forms, lists, API endpoints, validation schemas, and corresponding UI actions and routes.
*   **Modularization:** The code shows a consistent effort to modularize features into separate components and files (e.g., dedicated HBL form, HBL list, validation schemas, and actions).
*   **Redux Toolkit Query (RTK Query):** This library is extensively used for managing API interactions, demonstrating a standardized approach to data fetching, caching, and invalidation (`tagTypes`, `providesTags`, `invalidatesTags`).
*   **Role-Based Access Control:** `ProtectedRoute` and `UserRoleEnum` are frequently used in `App.js` routes and action definitions in `actions.js`, ensuring proper permission handling for different user types.
*   **Form Handling with Formik/Yup:** `Formik` for state management and `Yup` for schema validation are consistently employed for forms, improving data integrity and user experience.
*   **UI/UX Enhancements:** The use of `ThemedModal` for secondary interactions (add/edit forms, detail views) and `useKeyboardShortcut` in `HBLform.jsx` highlights a focus on user experience and accessibility.
*   **Debugging Practices:** Numerous `console.log` statements with descriptive messages (e.g., "TEST on Flow", "Payload ::@@@@456", "dat=====jjjj") are scattered throughout the code, indicating active development and debugging.
*   **Dynamic UI Adjustments:** There are instances of UI elements and attributes (e.g., `h2` vs. `h3` vs. `h6` tags, conditional rendering) being changed multiple times within a short period, typical of UI refinement during development.
*   **State Management:** `useReducer` and `useSelector`/`useDispatch` from Redux are used for managing both local and global state.

## 3:48:27 PM
The code changes log reveals focused development across `company_details`, `otm_bol`, and `hblEntry` features, predominantly occurring between November 21st and November 25th, 2025.

**File: `c:\Users\ridap\OneDrive\Documents\T360_Api\t360-backend\src\controllers\company_details.controller.ts`**
*   **11/21/2025, 10:07:54 AM**: Significant updates to the `getAll` function, particularly for the 'CUSTOMER' role. It was enhanced to support pagination for fetching distinct `account_name` records from `mtr_tracking_data`, including a total count. The 'AGENT' role's data retrieval from `agent_po_account_master` remained simpler, limited to 10 distinct `cname` records.
*   **11/21/2025, 10:08:08 AM**: Removed several `console.log` statements that were likely used for debugging within the 'CUSTOMER' role's pagination logic.

**File: `c:\Users\ridap\OneDrive\Documents\T360_Api\t360-backend\src\routes\otm_bol.route.ts`**
*   **11/21/2025, 11:40:37 AM**: A set of new API routes for OTM Bill of Lading (BOL) operations were defined. These include endpoints for `GET` requests to retrieve Excel data, PO by BOL, fetch payload, and fetch by specific BOL number or common key. `POST` routes were added for editing BOLs, uploading/saving edits, generating XML, and sending data to OTM. A file upload route (`/upload`) using `uploadMiddleware` was present but commented out.

**File: `c:\Users\ridap\OneDrive\Documents\T360_Api\t360-backend\src\controllers\hblEntry.controller.ts`**
This file experienced frequent, iterative changes.
*   **11/21/2025, 3:11:14 PM**: Introduced `createHblMasterBooking` for single HBL master record creation and `saveHblBooking` for more extensive HBL CRUD operations (add/update). `saveHblBooking` implemented a complex update logic involving fetching old data, deleting and re-inserting multiple related lists (routing, container, PO), and logging changes.
*   **11/21/2025, 3:13:11 PM - 3:19:06 PM**: Minor refinements in `createHblMasterBooking`, including changes to error handling (from `next(new HttpError...)` to `logger.error`) and making `bookingdate` nullable, then entirely commenting out its processing in the payload.
*   **11/24/2025, 1:19:43 PM - 1:26:39 PM**: A significant, albeit short-lived, refactor in `createHblMasterBooking` to support bulk insertion of `hbl_entries` using `insertMany`. This change also added `lastmodifieddate` to the payload. However, this bulk insert logic was soon partially reverted by mistakenly calling `insertQuery` with an array.
*   **11/24/2025, 2:59:08 PM**: The bulk insertion logic in `createHblMasterBooking` was fully reverted, returning it to handle single HBL entries.
*   **11/24/2025, 3:22:19 PM - 3:36:33 PM**: Debugging `console.log` statements were added, and the payload for `createHblMasterBooking` was expanded to include `transportaion_mode`, `customer`, and `description`.
*   **11/24/2025, 5:09:51 PM**: The entire `createHblMasterBooking` function was commented out.
*   **11/25/2025, 11:00:44 AM**: `createHblMasterBooking` was uncommented. Critical changes were observed in `saveHblBooking`, where `bookingdate` in `bookingInsertQuery` was commented out, and fields (`agent_booking_id`, `location`) were commented out during new booking creation for an `hbl_master` table insertion, indicating potential misconfigurations or incomplete changes.
*   **11/25/2025, 1:57:33 PM - 3:39:48 PM**: Further adjustments in `createHblMasterBooking` to include `booking_serial_id` in the `hbl_master` payload, with a minor correction in the field name.

**File: `c:\Users\ridap\OneDrive\Documents\T360_Api\t360-backend\src\routes\hblEntry.route.ts`**
*   **11/21/2025, 3:11:42 PM**: Initial route definitions, including a conflicting `POST /` route for both `saveHblBooking` and `createHblMasterBooking`.
*   **11/21/2025, 3:19:52 PM**: The `createHblMasterBooking` route was corrected to `POST /create` to resolve the conflict.
*   **11/24/2025, 5:10:21 PM - 5:10:39 PM**: The `POST /create` route and its corresponding import for `createHblMasterBooking` were commented out, mirroring the change in the controller.
*   **11/25/2025, 11:00:51 AM**: Both the import and the `POST /create` route for `createHblMasterBooking` were uncommented, restoring this functionality.

**File: `c:\Users\ridap\OneDrive\Documents\T360_Api\t360-backend\src\controllers\booking.controller.ts`**
*   **11/25/2025, 11:40:20 AM**: Introduced `saveBooking` and `saveMaster` functions. `saveBooking` handles comprehensive booking management, including a "delete and re-insert" strategy for associated lists (cargo, vessel, inventory, POs) during updates, and generates new booking IDs for new entries. `saveMaster` manages the creation of master account entries into `agent_po_account_master`, validating account types and generating unique account codes.
*   **11/25/2025, 11:41:24 AM - 11:47:29 AM**: No functional changes, indicating stability or minor re-saves within this period.

**Patterns and Recurring Elements:**
*   **High Activity in HBL Entries**: The `hblEntry` controller and routes show the most frequent and experimental changes, including attempts at bulk inserts, temporary commenting out of features, and continuous payload adjustments.
*   **Database Interaction Focus**: Extensive use of `insertQuery`, `insertMany`, `updateQuery`, and explicit `BEGIN`/`COMMIT`/`ROLLBACK` transactions across all controllers.
*   **Data Sanitization and Formatting**: Consistent application of `sanitizeString`, `sanitizeIntString`, and `AppDateFormate` to ensure data integrity before database operations.
*   **Debugging Practices**: Frequent addition and removal of `console.log` and `logger.info` statements, indicating active debugging during development.
*   **Role-Based Logic**: Logic often incorporates `req.user.role` to determine specific behaviors or data access.
*   **Complex Payloads**: Booking and HBL entries involve rich, nested data structures with multiple sub-lists for related items like cargo, vessels, containers, and purchase orders.

## 6:05:38 PM
The provided log details code changes across a JavaScript-based frontend application, primarily focusing on booking management, specifically around House Bill of Lading (HBL) functionalities.

**File-Specific Updates:**

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\App.js`**:
    *   **11/21/2025, 11:31:13 AM - 11:34:00 AM**: No functional changes were observed. The content remains identical across these two timestamps, suggesting a possible re-save without modification or a formatting change not reflected in the provided diff. This file primarily handles routing configuration for various screens, including new additions like `AirTrackingScreen`, `CityMaster`, `CngBookingScreenExtend`, `Dashboard7501Screen`, `AgentPoFormExtend`, and `BookingDashbaordScreenExtend`. It also defines roles for `ProtectedRoute`s, including new roles like `ADMIN_V2`.
    *   **11/25/2025, 2:19:41 PM - 2:19:55 PM**:
        *   Introduced new routes: `/logout` pointing to `Auth0LogoutHandler` and `/login` to `LoginScreen`.
        *   Added a new route for HBL details: `/app/booking/hbl_form_screen` rendering `HblListDetails`, accessible by `AGENT`, `ADMIN`, `CUSTOMER`, and `SPR_CUSTOMER` roles. This indicates the introduction of a separate screen for viewing a list of HBLs associated with a booking.

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\components\screen\analytics\MetricsBox.jsx`**:
    *   **11/21/2025, 11:36:28 AM**: This file, responsible for displaying analytics metrics, shows no further changes in the log. It dynamically renders various chart types (Bar, Pie, Line, Stacked Bar, Gauge) based on `item.chartType` and `chartView`, including options for full-screen view and data slicing (showing only the first 9 items in the default view). It utilizes Redux for state management and includes a `MetricToolbar` for interactions.

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\components\screen\booking\actions.js`**:
    *   **11/24/2025, 2:52:57 PM - 2:53:07 PM**: The `createHblAction` label was changed from "Edit HBL" to "Create HBL", and its `formAction` state was updated from `"edit"` to `"add"`. This indicates a distinction between editing an existing HBL and creating a new one.
    *   **11/24/2025, 2:53:44 PM - 2:56:17 PM**: The label for `hblAction` was temporarily changed to "Edit HBL123" and then reverted to "Edit HBL".
    *   **11/24/2025, 3:43:34 PM - 3:43:58 PM**: The `createHblAction` icon was changed from `Edit` to `Create`, visually clarifying its purpose.
    *   **11/25/2025, 10:45:07 AM**: A new action `viewHblAction` was introduced with the label "View Hbl Details" to open a modal with type `'view-hbl'`. This action is added to the `adminBookingMenu` and as a fallback.
    *   **11/25/2025, 10:49:06 AM - 10:49:39 AM**: A new function `getHblActions` was introduced, which initially contained a commented-out "Edit ISF" action. The `getBookingActions` function was updated to include `viewHblAction` in the default (fallback) actions.
    *   **11/25/2025, 2:06:40 PM - 2:07:46 PM**: The `createHblAction`'s label was changed from "Create HBL" to simply "HBL", and its icon was updated from `Create` to `Contrast`. Crucially, in the `createHblAction`'s `onClick` handler, the `agent_booking_id` in the state passed to `/app/booking/hbl_form` was replaced with `serial_id`, and the navigation path was updated to `/app/booking/hbl_form_screen`. This suggests a shift in how new HBLs are initiated, potentially from a main booking screen to a dedicated HBL list screen, and the primary identifier for a new HBL might be `serial_id` rather than `agent_booking_id`.
    *   **11/25/2025, 3:30:59 PM - 3:31:27 PM**: The `createHblAction`'s `onClick` now passes both `agent_booking_id` and `booking_serial_id` from the `params.row` to the HBL form, clarifying the context for new HBL creation. The navigation target remains `/app/booking/hbl_form_screen`.
    *   **11/25/2025, 2:20:14 PM - 2:20:56 PM**: `createHblAction`'s `onClick` handler now navigates to `/app/booking/hbl_form_screen` and passes `agent_booking_id` from `params.row`.

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\store\api\agentBookingApi.js`**:
    *   **11/24/2025, 3:02:03 PM**: Added `HBL` to `tagTypes` for caching. Introduced `saveHblBooking` and `fetchHblBookingFormDetails` mutations/queries for HBL API interactions.
    *   **11/25/2025, 11:51:02 AM - 1:53:20 PM**: The URL for `saveHblBooking` was changed from `/hblEntry` to `/hblEntry/create`, indicating a specific endpoint for creation.

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\components\screen\booking\hbl\HBLform.jsx`**:
    *   **11/24/2025, 3:14:32 PM - 3:17:57 PM**: These multiple changes largely involve commenting out or uncommenting blocks of initial values within the `Formik` component, particularly for properties like `shipment_type`, `move_type`, `containerList`, `routingList`, `basicPoList`, and party-related address fields. This indicates iterative development, possibly enabling/disabling sections for testing or refactoring.
        *   Initial values are now consistently set to `initialValues?.property || ""` or `initialValues?.property?.length ? initialValues.property : []`.
        *   `agent_booking_id` initial value logic was adjusted to handle `"copy"` action.
    *   **11/25/2025, 11:53:28 AM**: A large block of commented-out `initialValues` related to various booking fields (shipment, move, containers, routing, parties, ports, HBL details) was uncommented. This means the form is now fully leveraging the `initialValues` prop for these fields.
    *   **11/25/2025, 3:27:42 PM - 3:27:56 PM**: Added `agent_booking_id :""` to the payload during `handleSave`, and changed the navigation target after successful save from `/app/booking` to `/app/booking/hbl_form_screen`.
    *   **11/25/2025, 3:28:53 PM**: Introduced `useLocation` hook to access `location.state` and added `agent_booking_id` and `booking_serial_id` from `location.state` to the payload for `saveBooking`. The post-save navigation was also changed back to `/app/booking`.
    *   **11/25/2025, 3:51:09 PM - 3:51:17 PM**: The payload for `saveBooking` now explicitly includes `booking_id` from `location.state.booking_id` (previously `agent_booking_id` with `booking_id` as the key) and `booking_serial_id` from `location.state.booking_serial_id`.
    *   **11/25/2025, 4:02:22 PM - 4:03:41 PM**: Added `vessel` and `voyage` to the payload of `handleSave`.

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\components\screen\booking\hbl\validation.js`**:
    *   **11/24/2025, 3:20:42 PM**: Introduced `HBLvalidationSchema` for validating HBL form fields, including required fields like `pol`, `pod`, `por`, `fpd`, `vessel`, `voyage`, `bookingdate`, `hbldate`, `client_name`, `cnee_name`, `ship_name`, and format validation for `mblno` and `blno`. Also added dynamic address validation for common parties (`ship`, `cnee`, `notify`).

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\pages\booking\BookingDashbaordScreenExtend.jsx`**:
    *   **11/25/2025, 10:41:59 AM**: Imported `HblListDetails` and conditionally rendered different modals (`BookingApproveContainer`, `UpdateLineBookingForm`, `UpdateDOForm`, `HblListDetails`) based on `modal.type`. This indicates a centralized modal management approach for various booking-related operations. The grid columns were updated to include a "HBL #" field and "HBL or MBL Issue Date."

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\pages\booking\HBLListDetails.jsx`**: (Note: This file was renamed to `src\components\screen\booking\hbl\HBLListDetails.jsx` around 11/25/2025, 10:51:35 AM)
    *   **11/25/2025, 10:42:56 AM - 10:43:04 AM**: Renamed the component from `HBListDetails` to `HblListDetails` and imported `getISFActions` from `./actions` (later corrected to `../../components/screen/booking/actions`).
    *   **11/25/2025, 10:50:13 AM - 10:50:42 AM**: Changed `ISF_COLUMNS` import to `HBL_COLUMNS` from the same file, indicating a shift to HBL-specific columns. The `getISFActions` function was replaced with `getHblActions`.
    *   **11/25/2025, 10:55:10 AM - 11:08:06 AM**: The "New ISF" button text was changed to "New HBL", and its `onClick` handler now navigates to `/app/booking/hbl_form` with `agent_booking_id` and `formAction: "add"`.
    *   **11/25/2025, 2:23:23 PM - 2:47:12 PM**: The `useFetchCustomerApproveDetailsQuery` hook was commented out, implying that `HblListDetails` no longer directly fetches `bookingData` using this query. Instead, `initialValues` is passed as an empty object in `Formik`. The `Agent Booking#` display was commented out. A `Card` and `CardHeader` were added, containing a title that was initially `<h2>Agent Booking ID:</h2>` and later changed to `<h3>Agent Booking ID:</h3>`. An "Add HBL" button was also added within this `CardHeader`.
    *   **11/25/2025, 2:47:58 PM - 2:59:23 PM**: `ScreenToolbar` and `ThemedBreadcrumb` components were added, suggesting integration into the standard screen layout. The "Agent Booking ID:" in the card header was dynamically updated to display the `agent_booking_id` from `location?.state`. The "Add HBL" button's `onClick` was updated to pass `agent_booking_id` from `location.state`.
    *   **11/25/2025, 3:31:59 PM**: The "Add HBL" button's `onClick` in `HblListDetails` now passes `booking_serial_id` and `agent_booking_id` (from `location.state`) to the HBL form when navigating.

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\data\columns\agent.booking.js`**:
    *   **11/25/2025, 10:45:56 AM**: Introduced `HBL_COLUMNS` with fields like `agent_booking_id`, `etd`, `bill_of_loading`, `importer`, `status`, `cbp_response`, `cbp_transaction`, and `lastmodifieddate`. This signifies dedicated column definitions for HBL lists.

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\components\screen\booking\hbl\HblEntryFormScreen.jsx`**:
    *   **11/25/2025, 2:10:03 PM - 2:13:17 PM**: Initially rendered `HblListDetails` but later switched back to rendering `HBLForm` directly, suggesting `HblListDetails` might serve as a sub-component or a different view. The `useFetchHblBookingFormDetailsQuery` now takes `agent_booking_id` from `state` as a parameter. It also initializes container, routing, and PO lists from `hblDetails?.data`.
    *   **11/25/2025, 2:10:53 PM**: The commented out `HBLForm` rendering was replaced by `HblListDetails` with `data={hblDetails?.data}`, indicating that `HblEntryFormScreen` can display a list of HBLs.

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\components\common\Breadcrumb.jsx`**:
    *   **11/25/2025, 2:48:39 PM - 2:49:23 PM**: Added `hbl_form_screen` to the `Routes` object with the label "HBL" and `disabled: false`, ensuring it appears correctly in the breadcrumbs.

**Patterns and Recurring Elements:**

1.  **HBL (House Bill of Lading) Feature Development**: A significant focus is on HBLs, including form creation (`HBLform.jsx`), a dedicated list screen (`HblListDetails.jsx`), API endpoints (`agentBookingApi.js`), and associated validation (`validation.js`).
2.  **Role-Based Access Control (RBAC)**: Many routes and grid actions utilize `ProtectedRoute` and `useAccess` hooks with `UserRoleEnum` (e.g., `ADMIN`, `AGENT`, `CUSTOMER`, `SPR_CUSTOMER`, `FRONTOFFICE`, `BACKOFFICE`, `CSF`, `ADMIN_V2`). This indicates a robust permission system.
3.  **Form Management with Formik**: `Formik` is consistently used for form handling, including `initialValues`, `validationSchema` (with `Yup`), and `onSubmit`.
4.  **Redux Toolkit Query (RTK Query)**: `agentBookingApi.js` extensively uses RTK Query for API interactions (`createApi`, `fetchBaseQuery`, `builder.mutation`, `builder.query`, `invalidatesTags`, `providesTags`). This suggests a modern approach to data fetching and caching.
5.  **Modal and UI Component Reusability**: `ThemedModal`, `ScreenToolbar`, `ThemedBreadcrumb`, `OutlinedButton`, `ThemeButton`, `ThemedGrid`, and `GridActions` are widely reused across different screens, promoting a consistent UI/UX and reducing code duplication.
6.  **Keyboard Shortcuts**: `useKeyboardShortcut` is implemented in `HBLform.jsx` for common actions like Edit, View, Add New Party, and Save, enhancing user efficiency.
7.  **Data Transformation and State Management**: Components frequently transform data fetched from APIs (e.g., `convertToArray` in `HblEntryFormScreen.jsx`) and manage local state (e.g., `useState`, `useReducer`) in conjunction with Redux for global state (`useSelector`, `useDispatch`).
8.  **Logging**: Frequent `console.log` statements (e.g., "TEST on Flow", "Payload ::@@@@456 ", "resp12345", "==params890", "dat=====jjjj", "locatioppppp") indicate ongoing debugging and development.
9.  **Date Formatting**: `appDateFormat` is used in column definitions for consistent date display.
10. **Refactoring and Code Cleanup**: The commenting out of large code blocks in `HBLform.jsx` (before uncommenting later) and the temporary naming changes (e.g., "Edit HBL123") suggest an active development process involving experimentation and refinement.
11. **Navigation State**: `useLocation` and `useNavigate` are used to manage routing and pass state between screens, crucial for form actions like 'edit', 'copy', and 'add'.

**Overall Summary:**

The changes depict a substantial development effort within the `t360-frontend` application, particularly enhancing the House Bill of Lading (HBL) functionality. This includes setting up new UI screens for HBL entry and listing, defining their routing, integrating them with backend APIs for data persistence and retrieval, implementing client-side validation, and ensuring proper role-based access. There's also a general pattern of UI component reuse and a strong focus on structured state management and API interaction using modern React and Redux practices. The presence of numerous `console.log` statements indicates active development and debugging during this period.

## 6:05:50 PM
The log details changes across three primary files: `company_details.controller.ts`, `otm_bol.route.ts`, `hblEntry.controller.ts`, and `booking.controller.ts`.

### File: `c:\Users\ridap\OneDrive\Documents\T360_Api\t360-backend\src\controllers\company_details.controller.ts`

**Timestamp: 11/21/2025, 10:07:54 AM & 11/21/2025, 10:08:08 AM**
These two entries for `company_details.controller.ts` are almost identical, suggesting minor or whitespace changes. The `getAll` function handles fetching company names based on user roles ('AGENT' or 'CUSTOMER').
- **Role 'AGENT'**: Fetches `cname` from `agent_po_account_master` with a `LIKE` search and a limit of 10.
- **Role 'CUSTOMER'**: Fetches `account_name` from `mtr_tracking_data`.
  - It supports pagination (`isPagination`) by calculating total count and applying `LIMIT` and `OFFSET`.
  - If not paginated, it limits results to 10.
- Both roles sanitize search input and map results to `{ value: string, label: string }` format.
- Error handling is implemented with `try-catch` blocks, returning 500 status on internal server errors.
- Logging (`logger.info`, `logger.error`) is used for debugging and operational insights.
- A `searchLower` variable was introduced and then commented out in the initial version for `CUSTOMER` role, before being reintroduced to form the `search` variable. A `console.log` statement for `totalResult` and `result` was also present and removed between the two entries.

### File: `c:\Users\ridap\OneDrive\Documents\T360_Api\t360-backend\src\routes\otm_bol.route.ts`

**Timestamp: 11/21/2025, 11:40:37 AM**
This entry shows changes to API routes related to OTM BOL (Bill of Lading).
- It defines several GET and POST routes for various BOL operations:
  - `/excel_data`: Exports excel data.
  - `/`: Retrieves PLPO by BOL.
  - `/fetch_payload`: Fetches payload.
  - `/:bol`: Fetches by BOL number.
  - `/fetch/:common_key`: Fetches by common key.
  - `/generate_xml`: Generates XML.
  - `/send_to_otm`: Sends data to OTM.
- A POST route for `/upload` which uses `uploadMiddleware` for handling file uploads (specifically `plFile` and `dutyFile`) is commented out.
- A new POST route `/upload_save_edit` is added, likely for handling uploads and edits.

### File: `c:\Users\ridap\OneDrive\Documents\T360_Api\t360-backend\src\controllers\hblEntry.controller.ts`

**Timestamps (multiple entries from 11/21/2025 to 11/25/2025):**
This file undergoes significant changes over several commits, focusing on `createHblMasterBooking` and `saveHblBooking` functions.
- **Initial State (11/21/2025, 3:11:14 PM):**
  - `createHblMasterBooking`: Creates a single HBL entry in `hbl_master` with many sanitized fields, wraps it in a transaction, and returns the first row. Includes basic error handling with `HttpError` and `ROLLBACK`.
  - `saveHblBooking`: Handles both ADD and UPDATE modes for HBL bookings. It's a complex function that performs numerous database operations within a transaction, including:
    - Sanitizing a large payload of HBL details (shipper, consignee, notify, cargo, etc.).
    - Determining `entryMode` (UPDATE if `agent_booking_id` exists, else ADD).
    - In UPDATE mode: Fetches current booking details (entry, vessel, routing, container, HBL, PO) before updating. Updates `agent_booking_entry` and `agent_booking_vessel`. Deletes and re-inserts `agent_booking_routing`, `agent_booking_container`, and `agent_booking_po` records. Logs old and new HBL details to `agent_booking_hbl_history`.
    - In ADD mode: Generates a new `booking_id` using `getAgentBookingCode`, then inserts into `agent_booking_entry`. The provided code snippet is truncated at this point, indicating further insertion logic for ADD mode.
    - Extensive logging (`logger.info`) is used throughout.
    - Error handling includes `ROLLBACK` on transaction failure and `HttpError`.

- **Changes between 11/21/2025, 3:11:14 PM and 11/21/2025, 3:13:11 PM:**
  - In `createHblMasterBooking`, the error handling changes from `next(new HttpError(error.message, 500))` to `logger.error(error);`, removing the explicit `HttpError` propagation for this function.

- **Changes between 11/21/2025, 3:13:11 PM and 11/21/2025, 3:16:23 PM:**
  - In `saveHblBooking`, the `bookingdate` field in `bookingInsertQuery` is changed from `payload.booking_date` to `payload.booking_date || null`.

- **Changes between 11/21/2025, 3:16:23 PM and 11/21/2025, 3:17:07 PM:**
  - In `createHblMasterBooking`, the `bookingdate` field in the payload definition is changed from `AppDateFormate(req.body.bookingdate, db_format)` to `AppDateFormate(req.body.bookingdate, db_format) || null`, allowing for null booking dates.

- **Changes between 11/21/2025, 3:17:07 PM and 11/21/2025, 3:19:06 PM:**
  - In `createHblMasterBooking`, the `bookingdate` field in the payload definition is commented out, meaning it is no longer collected from `req.body` or inserted into `hbl_master`.

- **Changes between 11/24/2025, 1:19:05 PM and 11/24/2025, 1:19:43 PM:**
  - In `createHblMasterBooking`, the `data` returned in the success response changes from `rows[0]` to `rows`. This indicates that the function might be intended to return all inserted HBLs rather than just the first one, hinting at a potential change from single insert to multiple inserts, though the `insertQuery` is still used.

- **Changes between 11/24/2025, 1:19:43 PM and 11/24/2025, 1:23:51 PM:**
  - `createHblMasterBooking` is significantly refactored:
    - It now expects an `hbl_entries` array in the request body.
    - It validates that `hbl_entries` is a non-empty array.
    - It uses `insertMany` to insert multiple HBL entries into `hbl_master`, based on `hbl_entries`.
    - `lastmodifieddate: "NOW()"` is commented out in the `payloadArray` mapping.
    - Error handling now explicitly returns a 500 status with an error message in case of failure.

- **Changes between 11/24/2025, 1:23:51 PM and 11/24/2025, 1:24:40 PM:**
  - In `createHblMasterBooking`, `lastmodifieddate: "NOW()"` is commented out in the `payloadArray` mapping for `hbl_master`. This change occurred already in the prior diff. No new functional change is visible in this specific diff concerning `createHblMasterBooking`. This is likely a re-save or an incremental change with no significant code difference for the first function.

- **Changes between 11/24/2025, 1:24:40 PM and 11/24/2025, 1:26:39 PM:**
  - In `createHblMasterBooking`, the `insertMany` call is changed back to `insertQuery(payloadArray, "hbl_master")`. This is a significant regression, as `insertQuery` typically handles single objects, while `payloadArray` is an array of objects, likely causing a runtime error or unexpected behavior if `insertQuery` isn't overloaded to handle arrays.

- **Changes between 11/24/2025, 1:26:39 PM and 11/24/2025, 2:59:08 PM:**
  - In `createHblMasterBooking`, the previous change `insertQuery(payloadArray, "hbl_master")` is reverted back to inserting a single `payload` object (`insertQuery(payload, "hbl_master")`) and the return `data` is back to `rows[0]`. The `hbl_entries` array processing logic is completely removed. This effectively reverts the multi-insert functionality.
  - The `bookingdate` field in `createHblMasterBooking`'s payload is commented out again.

- **Changes between 11/24/2025, 2:59:08 PM and 11/24/2025, 3:22:19 PM:**
  - A `console.log(req.body, "reqbody=====:")` is added at the beginning of `createHblMasterBooking`.

- **Changes between 11/24/2025, 3:22:19 PM and 11/24/2025, 3:36:33 PM:**
  - In `createHblMasterBooking`, new fields `transportaion_mode`, `customer`, and `description` are added to the `payload` object being inserted into `hbl_master`.

- **Changes between 11/24/2025, 3:36:33 PM and 11/24/2025, 3:54:18 PM:**
  - In `createHblMasterBooking`, the `serial_id` from `req.body` is passed as `booking_serial_id` when inserting into `hbl_master`.
  - In `saveHblBooking`, a `console.log(req.body, "reqpppppppp")` is added.

- **Changes between 11/24/2025, 5:09:51 PM and 11/25/2025, 1:57:33 PM:**
  - `createHblMasterBooking` is uncommented and reactivated after being commented out entirely in the previous version.
  - The new function now includes logic to insert into `agent_booking_vessel` after inserting into `hbl_master`, linking them via `hbl_master_id`. It expects `vessel` and `voyage` in `req.body`.
  - The response for `createHblMasterBooking` no longer returns `data: rows[0]`.

- **Changes between 11/25/2025, 1:57:33 PM and 11/25/2025, 1:57:51 PM:**
  - In `createHblMasterBooking`, the `serial_id` passed to the `hbl_master` insert query is changed from `serial_id:req.body.serial_id` to `booking_serial_id:req.body.serial_id`.

- **Changes between 11/25/2025, 3:35:06 PM and 11/25/2025, 3:39:48 PM:**
  - No significant functional changes. The `booking_serial_id` assignment in `createHblMasterBooking` for the `hbl_master` insert remains `req.body.booking_serial_id`.

- **Changes between 11/25/2025, 3:54:18 PM and 11/25/2025, 5:16:58 PM:**
  - In `createHblMasterBooking`, the `hbl_master_id` (from `insertdHbl[0]?.serial_id`) is now passed to the `agent_booking_vessel` insert query to link the two.
  - The `data: rows[0]` return in `createHblMasterBooking` is commented out.

- **Changes between 11/25/2025, 5:16:58 PM and 11/25/2025, 5:22:51 PM:**
  - In `createHblMasterBooking`, the `hbl_master_id` field is removed from the `agent_booking_vessel` insert query. This means `hbl_master` and `agent_booking_vessel` are no longer explicitly linked in this part of the code.

### File: `c:\Users\ridap\OneDrive\Documents\T360_Api\t360-backend\src\routes\hblEntry.route.ts`

**Timestamps (multiple entries from 11/21/2025 to 11/24/2025):**
This file defines routes for HBL entry.
- **Initial State (11/21/2025, 3:11:42 PM):**
  - Defines two POST routes: `/` for `saveHblBooking` and `/` for `createHblMasterBooking`. This is problematic as two identical paths with the same method lead to ambiguity.
  - Defines one GET route: `/` for `fetchHblFormDetails`.

- **Changes between 11/21/2025, 3:11:42 PM and 11/21/2025, 3:19:52 PM:**
  - The second POST route is changed from `/` to `/create`, resolving the route ambiguity.

- **Changes between 11/24/2025, 5:10:21 PM and 11/24/2025, 5:10:39 PM:**
  - The `/create` POST route for `createHblMasterBooking` is commented out, and `createHblMasterBooking` is removed from the import statement.

### File: `c:\Users\ridap\OneDrive\Documents\T360_Api\t360-backend\src\controllers\booking.controller.ts`

**Timestamps (multiple entries from 11/25/2025, 11:40:20 AM to 11/25/2025, 11:47:29 AM):**
These entries for `booking.controller.ts` are mostly identical across the timestamps, indicating no significant code changes in the provided snippets for this file within these specific timestamps. The file defines `saveBooking` and `saveMaster` functions.
- **`saveBooking`**:
  - Handles creation or update of booking information.
  - Determines `entryMode` based on `agent_booking_id`.
  - In UPDATE mode, it deletes existing related entries (cargolist, container_pre, vessel, po, linked_po) before re-inserting.
  - In ADD mode, it generates a new `agent_booking_id`.
  - Constructs a comprehensive `bookingInsertQuery` from the request payload.
  - Inserts into `agent_booking_entry`.
  - Conditionally inserts into multiple related tables (`agent_booking_Cargolist`, `agent_booking_vessel`, `agent_booking_container_pre`, `agent_booking_po`, `agent_booking_linked_po`) based on list lengths.
  - Uses `insertMany` for lists of items and `insertQuery` for single records.
  - Returns success message with `booking_id`.
  - Includes robust error handling with `try-catch`, `logger.error`, and 500 status.
- **`saveMaster`**:
  - Handles saving master account details.
  - Validates `account_type` against a predefined `poAccountMastertype` enum.
  - Generates an `acode` using `getAccountCode`.
  - Inserts into `agent_po_account_master`.
  - Uses a `switch` statement to determine `actype` based on `account_type`.

- **Changes between 11/25/2025, 11:47:29 AM and 11/25/2025, 11:50:39 AM (and subsequent `hblEntry.controller.ts` changes):**
  - In `hblEntry.controller.ts` `saveHblBooking` (the "New booking creation" block), the generation of `booking_id` using `getAgentBookingCode` and the logging of `New Booking Id Created` are commented out.
  - The subsequent `insertQuery` for `hbl_master` also has `agent_booking_id` and `location` commented out from the `bookingInsertQuery` spread, and the target table is changed from `agent_booking_entry` to `hbl_master`. This suggests a shift in how new HBL bookings are handled within this function, potentially indicating that this block is no longer for the primary booking entry but for an associated HBL record.
  - The code in the provided log for `booking.controller.ts` for this timestamp range is mostly identical to previous commits for this file, so the changes described above relate to the `hblEntry.controller.ts` file, not `booking.controller.ts`.

### Patterns and Recurring Elements:

1.  **Database Interaction**: Frequent use of `query`, `insertQuery`, and `updateQuery` from `../config/database` indicates heavy reliance on direct SQL operations within controllers, often wrapped in `BEGIN`/`COMMIT`/`ROLLBACK` transactions.
2.  **Request Handling**: All controllers use `AuthenticatedRequest` and `Response` from Express, indicating an authenticated API endpoint setup. `req.body` and `req.query` are heavily used to retrieve input.
3.  **Data Sanitization and Formatting**: The `sanitizeString`, `sanitizeIntString`, and `AppDateFormate` utility functions from `../utils/common` are consistently applied to request body fields before database interaction, ensuring data integrity and proper date formats.
4.  **Error Handling**: `try-catch` blocks are consistently used, often rolling back transactions on error. `logger.error` is used for logging errors, and `res.status(500).json({ error: 'Internal server error' })` or `next(new HttpError(...))` is used for sending error responses.
5.  **Logging**: `logger.info` is widely used for debugging and tracking execution flow, especially for generated IDs and intermediate data. `console.log` also appears for ad-hoc debugging.
6.  **Role-Based Logic**: `req.user.role` is used to differentiate logic, particularly for fetching data in `company_details.controller.ts` and determining `locationByRole` in `hblEntry.controller.ts` and `booking.controller.ts`.
7.  **Modular Design**: Controllers and routes are separated, following a common Node.js API structure. Utility functions (`getAgentBookingCode`, `AppDateFormate`, `sanitizeString`, `getAccountCode`, etc.) are imported from `../utils`.
8.  **HBL Entry Complexity**: The `hblEntry.controller.ts` `saveHblBooking` function is particularly complex, handling multiple related tables (entry, vessel, routing, container, hbl, po) for both creation and updates, including logging historical changes.
9.  **Route Changes for HBL**: The `hblEntry.route.ts` shows a pattern of fixing route conflicts and then temporarily commenting out a route (`/create`) for `createHblMasterBooking`. This suggests ongoing development and iteration on the HBL creation process.
10. **Dynamic Table Operations**: In `saveBooking` and `saveHblBooking`, there's a pattern of deleting all child records associated with a booking/HBL ID before re-inserting them during an update operation, rather than performing targeted updates. This could imply that child lists are treated as whole units.