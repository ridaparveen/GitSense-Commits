# Activity Summary for 11/25/2025

## 6:41:03 AM
The code changes primarily revolve around the `t360-frontend` application, showing a significant expansion of features related to booking, shipping, and analytics, along with enhancements in form management and user experience.

### File-Specific Updates:

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\App.js`**
    *   **11/21/2025, 11:31:13 AM:** This file underwent a major update, introducing a vast number of new imports for various screens and components. This indicates a substantial addition of new functionalities across the application, including:
        *   New domain-specific screens: `OtmBolScreen`, `CustomerScreen`, `PartyScreen`, `AgentScreen`, `BookingPlanBoardScreen`, `SPRPlanBoardScreen`, `LineWiseScreen`, `CIScreen`, `ISFEntryFormScreen`, `AlcScreen`, `ShippingOrdersScreen`, `ContainerReportScreen`, `PdfParserScreen`, `FCLScreen`, `LCLScreen`, `RailScreen`, `AirTrackingScreen`, `ShipmentTrackingScreen`, `Dashboard7501Screen`, `ShipmentsScreen`, `CngBookingScreen`, `CityMaster`, `PortmasterScreen`.
        *   New extended form and dashboard components: `AgentBookingFormScreenExtend`, `AgentPoFormExtend`, `BookingDashbaordScreenExtend`, `CngBookingFormScreen`, `CngBookingScreenExtend`.
        *   New administrative and reporting screens: `ReportSchedulerScreen`, `NewReportScreen`, `EditReportScreen`, `AlcExceptionDashboard`, `BackOfficeAdminTerminal`.
    *   The routing configuration was heavily expanded to incorporate these new screens, all protected by `ProtectedRoute` based on `UserRoleEnum` (e.g., ADMIN, CUSTOMER, AGENT, CSF, FRONTOFFICE, BACKOFFICE, SPR_CUSTOMER, ADMIN_V2).
    *   Routes for House Bill of Lading (HBL) forms (`booking/hbl_form`) were explicitly added.
    *   A development console log "TEST on Flow" was present.
    *   **11/21/2025, 11:34:00 AM:** A minor permission adjustment was made for the `shipment_tracking` route, removing `UserRoleEnum.ADMIN_V2` from the allowed roles.

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\components\screen\analytics\MetricsBox.jsx`**
    *   **11/21/2025, 11:36:28 AM:** This file was introduced or significantly updated to define the `MetricsBox` component for rendering analytics charts. It includes:
        *   Dynamic chart rendering (Bar, Pie, Line, Stacked Bar, Gauge) based on `chartType` and `chartView`.
        *   Integration with Redux (`useSelector`) for state management.
        *   Components for toolbar (`MetricToolbar`), footer (`MetricFooter`), and a modal for full-screen viewing (`ThemedModal`).
        *   A `NoDataAvailable` placeholder.

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\components\screen\booking\actions.js`**
    *   **11/24/2025, 2:52:57 PM:** The `getBookingActions` function was refactored. Instead of a single large conditional return, it now defines several reusable arrays of actions (`bookingActions`, `isfActions`, `hblAction`, `createHblAction`, `viewAction`, `updateLineBookingAction`, `updateDOAction`) and combines them based on user access roles. New actions to "Update Line Booking" and "Update DO" were added, which open modals.
    *   **11/24/2025, 2:53:07 PM:** The `formAction` for the `Create HBL` action was corrected from `"edit"` to `"add"`, aligning with its intended "create" functionality.
    *   **11/24/2025, 2:53:44 PM - 11/24/2025, 2:56:17 PM:** A temporary, likely debugging, change was made where the "Edit HBL" label was briefly altered to "Edit HBL123" and then reverted back.
    *   **11/24/2025, 3:43:34 PM:** The icon for the "Create HBL" action was updated from `<Edit />` to the more appropriate `<Create />` icon, enhancing clarity.
    *   **11/24/2025, 3:43:58 PM:** No functional changes observed.

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\store\api\agentBookingApi.js`**
    *   **11/24/2025, 3:02:03 PM:** This Redux Toolkit Query API file was extended with new `tagTypes` (`'FormDetails'`) and several new endpoints:
        *   `saveHblBooking` (mutation) to save House Bill of Lading details.
        *   `fetchHblBookingFormDetails` (query) to retrieve HBL form data.
        *   `updateCarrierBooking` (mutation) for carrier booking updates.
        *   `updateDo` (mutation) for Delivery Order updates, notably removing the `Content-Type` header for its request.
        *   `exportSprReport` (query) for SPR booking reports.
    *   Existing `saveBooking` and `fetchBookingFormDetails` endpoints were updated to invalidate/provide the new `'FormDetails'` tag.

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\components\screen\booking\hbl\HBLform.jsx`**
    *   **11/24/2025, 3:14:32 PM:** This file was introduced to create the `HBLForm` component, a complex form for managing House Bill of Lading entries. Key aspects include:
        *   Extensive form handling using `Formik` and `Yup` for validation, with specific HBL-related validation schema (`HBLvalidationSchema`).
        *   Integration with Redux (`useDispatch`, `useSelector`) to manage form state, routing, container, and PO lists.
        *   Dynamic party management features (edit, view, add new party) and state updates when changing party tabs.
        *   Keyboard shortcuts (`ctrl+u`, `ctrl+d`, `ctrl+a`, `ctrl+s`, `ctrl+p`) for improved user interaction.
        *   Error handling with `toast` notifications and an `AlertConfig` for displaying messages.
        *   **11/24/2025, 3:17:08 PM:** A minor refinement was made to the `agent_booking_id` initialization within `Formik`, simplifying the conditional logic for handling "copy" actions.
        *   Other timestamps between 3:15 PM and 3:17 PM indicate minor saves without functional changes.

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\components\screen\booking\hbl\validation.js`**
    *   **11/24/2025, 3:20:42 PM:** This new file was added to define the `HBLvalidationSchema` using `Yup`.
        *   It includes a `generateAddressValidation` function to create reusable validation schemas for address fields (e.g., `ship_add1`, `cnee_city`, `notify_country`) with specific format and length constraints.
        *   It defines comprehensive validation for core HBL fields such as `pol`, `pod`, `por`, `fpd`, `vessel`, `voyage`, `bookingdate`, `hbldate`, `client_name`, `cnee_name`, `ship_name`, and `blno` (which is now required).
        *   Custom validation tests are included for `mblno` and `blno` to enforce a specific alphanumeric format.
        *   Dynamic inclusion of address validations for `shipper`, `consignee`, and `notify` parties.

### Patterns and Recurring Elements:

*   **Feature-rich Expansion:** The log demonstrates a clear pattern of adding extensive new features and modules to the frontend, particularly in the areas of shipping, booking, analytics, and master data management.
*   **Role-Based Access Control:** The `App.js` file heavily utilizes `ProtectedRoute` and `UserRoleEnum` to enforce role-specific access to different parts of the application, suggesting a robust security and permissions model.
*   **Modular Architecture:** The codebase is being structured with a focus on modularity, evident from the refactoring of booking actions, the use of Redux Toolkit Query for API interactions, and dedicated validation schemas for complex forms.
*   **Form Management Consistency:** `Formik` and `Yup` are consistently used for form state management and validation across new complex forms like HBL, ensuring a standardized approach to data input and integrity.
*   **User Experience Enhancements:** Implementation of keyboard shortcuts for common form actions indicates an effort to improve the efficiency and usability for power users.
*   **Continuous Development & Refinement:** The presence of console logs, temporary label changes, and repeated save operations in the timestamps suggest an active and iterative development process.
*   **Focus on Shipping/Logistics:** A significant portion of the changes are concentrated on core logistics functionalities like packing lists, service invoices, expense codes, destinations, vendors, PO/DSO orders, OTM BOLs, HBLs, ISFs, and various tracking screens (FCL, LCL, Rail, Air, Shipment).

## 6:41:13 AM
The code changes primarily involve updates to two controller files (`company_details.controller.ts`, `hblEntry.controller.ts`) and their associated route files (`otm_bol.route.ts`, `hblEntry.route.ts`).

**File-Specific Updates:**

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-backend\src\controllers\company_details.controller.ts`**
    *   **11/21/2025, 10:07:54 AM**: The `getAll` function was updated to support fetching company names based on user roles (`AGENT` or `CUSTOMER`). For `CUSTOMER` role, new logic was introduced to handle pagination, fetching total counts and paginated results from `mtr_tracking_data`, replacing previously commented-out code. Temporary `console.log` statements were added for debugging.
    *   **11/21/2025, 10:08:08 AM**: The temporary `console.log` statements for debugging were removed, indicating a minor cleanup.

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-backend\src\routes\otm_bol.route.ts`**
    *   **11/21/2025, 11:40:37 AM**: Several new API routes were added for OTM (Open Text Message) Bill of Lading operations, including endpoints for saving/editing uploads (`/upload_save_edit`), fetching payload data (`/fetch_payload`), fetching by a common key (`/fetch/:common_key`), generating XML (`/generate_xml`), and sending data to OTM (`/send_to_otm`). A previous `/upload` route using `uploadMiddleware` was commented out.

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-backend\src\controllers\hblEntry.controller.ts`**
    *   **11/21/2025, 3:11:14 PM**: A new controller for HBL (House Bill of Lading) entry was introduced. It defines `createHblMasterBooking` for single HBL inserts into `hbl_master` and `saveHblBooking` for comprehensive HBL management. `saveHblBooking` supports both new booking creation and updates, involving fetching current data, updating multiple related tables (`agent_booking_entry`, `agent_booking_vessel`, `agent_booking_routing`, `agent_booking_container`, `agent_booking_hbl`, `agent_booking_po` by deleting and re-inserting list items), and logging changes to `agent_booking_hbl_history`. Both functions use database transactions and extensive input sanitization.
    *   **11/21/2025, 3:13:11 PM**: The error handling in `createHblMasterBooking` was changed from using `HttpError` to simply logging the error, potentially affecting client error responses.
    *   **11/21/2025, 3:16:23 PM - 3:19:06 PM**: Minor adjustments were made to the `bookingdate` field in both `createHblMasterBooking` and `saveHblBooking` to allow for null values or to be entirely commented out from the payload.
    *   **11/24/2025, 1:19:43 PM**: The response format for `createHblMasterBooking` was updated to return the full array of inserted rows (`rows`) instead of just the first element (`rows[0]`).
    *   **11/24/2025, 1:23:51 PM**: `createHblMasterBooking` underwent a major refactoring to support bulk creation of HBL entries. It now expects an array `hbl_entries` in the request body, maps it to a payload array, and uses an `insertMany` function for bulk insertion. Error handling was also updated to return a direct 500 response.
    *   **11/24/2025, 1:24:40 PM**: The `lastmodifieddate: "NOW()"` field, which was part of the bulk insert payload, was commented out.
    *   **11/24/2025, 1:26:39 PM**: The `insertMany` call in `createHblMasterBooking` was reverted to `insertQuery`, which might introduce a bug for bulk inserts if `insertQuery` is not designed for array input.
    *   **11/24/2025, 2:59:08 PM**: The `createHblMasterBooking` function was reverted back to its original single-HBL-creation logic, discarding the bulk creation feature and associated changes.
    *   **11/24/2025, 3:22:19 PM**: A `console.log` statement was added to `createHblMasterBooking` for debugging the request body.
    *   **11/24/2025, 3:36:33 PM**: The `payload` for `createHblMasterBooking` was expanded to include `transportaion_mode`, `customer` (aliased as `client_name`), and `description`.
    *   **11/24/2025, 5:09:51 PM**: The entire `createHblMasterBooking` function was commented out. Additionally, the `bookingdate` field was commented out from the `bookingInsertQuery` within `saveHblBooking`.

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-backend\src\routes\hblEntry.route.ts`**
    *   **11/21/2025, 3:11:42 PM**: Initial route setup included two `POST` routes on the same path (`/`), creating a routing conflict.
    *   **11/21/2025, 3:19:52 PM**: The routing conflict was resolved by assigning `createHblMasterBooking` to a new `"/create"` path.
    *   **11/24/2025, 5:10:21 PM - 5:10:39 PM**: The `router.post("/create", createHblMasterBooking);` route was commented out, and its import was removed, disabling this specific HBL creation endpoint.

**Timestamps of Significant Changes:**

*   **11/21/2025, 10:07:54 AM**: Introduction of pagination logic for customer company details.
*   **11/21/2025, 11:40:37 AM**: Expansion of OTM BOL module with multiple new routes.
*   **11/21/2025, 3:11:14 PM**: Initial creation and comprehensive logic for HBL entry (create and save/update).
*   **11/21/2025, 3:19:52 PM**: Resolution of routing conflict for HBL creation.
*   **11/24/2025, 1:23:51 PM**: Major refactoring of `createHblMasterBooking` for bulk HBL creation.
*   **11/24/2025, 2:59:08 PM**: Reversion of the bulk HBL creation logic back to single HBL creation.
*   **11/24/2025, 5:09:51 PM**: Disabling (commenting out) the `createHblMasterBooking` function and commenting out `bookingdate` in `saveHblBooking`.
*   **11/24/2025, 5:10:21 PM - 5:10:39 PM**: Disabling (commenting out) the corresponding HBL creation route.

**Patterns and Recurring Elements:**

*   **Rapid Development and Iteration**: The multiple changes to `hblEntry.controller.ts` in quick succession on 11/24/2025 (especially the introduction, modification, and subsequent reversion/disabling of bulk HBL creation) indicate an active development cycle with experimentation and refinement.
*   **Debugging Practices**: The insertion and removal of `console.log` statements in controllers signify standard debugging during development.
*   **Payload Sanitization**: Consistent use of `sanitizeString` for various request body fields across controllers points to an emphasis on data integrity and security.
*   **Database Transactions**: The recurring use of `BEGIN`, `COMMIT`, and `ROLLBACK` for database operations ensures data consistency, especially in complex update scenarios involving multiple tables within `saveHblBooking`.
*   **Modular API Structure**: Changes consistently appear in both controller and route files for specific modules, following a clear separation of concerns.
*   **Feature Management through Comments**: Commenting out code (e.g., the `/upload` route in `otm_bol.route.ts`, `createHblMasterBooking` function and its route in `hblEntry` files) is used to temporarily disable or defer features.