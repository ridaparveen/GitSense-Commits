# Activity Summary for 11/25/2025

## 6:41:03 AM
The code changes primarily revolve around the `t360-frontend` application, showing a significant expansion of features related to booking, shipping, and analytics, along with enhancements in form management and user experience.

### File-Specific Updates:

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\App.js`**
    *   **11/21/2025, 11:31:13 AM:** This file underwent a major update, introducing a vast number of new imports for various screens and components. This indicates a substantial addition of new functionalities across the application, including:
        *   New domain-specific screens: `OtmBolScreen`, `CustomerScreen`, `PartyScreen`, `AgentScreen`, `BookingPlanBoardScreen`, `SPRPlanBoardScreen`, `LineWiseScreen`, `CIScreen`, `ISFEntryFormScreen`, `AlcScreen`, `ShippingOrdersScreen`, `ContainerReportScreen`, `PdfParserScreen`, `FCLScreen`, `LCLScreen`, `RailScreen`, `AirTrackingScreen`, `ShipmentTrackingScreen`, `Dashboard7501Screen`, `ShipmentsScreen`, `CngBookingScreen`, `CityMaster`, `PortmasterScreen`.
        *   New extended form and dashboard components: `AgentBookingFormScreenExtend`, `AgentPoFormExtend`, `BookingDashbaordScreenExtend`, `CngBookingFormScreen`, `CngBookingScreenExtend`.
        *   New administrative and reporting screens: `ReportSchedulerScreen`, `NewReportScreen`, `EditReportScreen`, `AlcExceptionDashboard`, `BackOfficeAdminTerminal`.
    *   The routing configuration was heavily expanded to incorporate these new screens, all protected by `ProtectedRoute` based on `UserRoleEnum` (e.g., ADMIN, CUSTOMER, AGENT, CSF, FRONTOFFICE, BACKOFFICE, SPR_CUSTOMER, ADMIN_V2).
    *   Routes for House Bill of Lading (HBL) forms (`booking/hbl_form`) were explicitly added.
    *   A development console log "TEST on Flow" was present.
    *   **11/21/2025, 11:34:00 AM:** A minor permission adjustment was made for the `shipment_tracking` route, removing `UserRoleEnum.ADMIN_V2` from the allowed roles.

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\components\screen\analytics\MetricsBox.jsx`**
    *   **11/21/2025, 11:36:28 AM:** This file was introduced or significantly updated to define the `MetricsBox` component for rendering analytics charts. It includes:
        *   Dynamic chart rendering (Bar, Pie, Line, Stacked Bar, Gauge) based on `chartType` and `chartView`.
        *   Integration with Redux (`useSelector`) for state management.
        *   Components for toolbar (`MetricToolbar`), footer (`MetricFooter`), and a modal for full-screen viewing (`ThemedModal`).
        *   A `NoDataAvailable` placeholder.

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\components\screen\booking\actions.js`**
    *   **11/24/2025, 2:52:57 PM:** The `getBookingActions` function was refactored. Instead of a single large conditional return, it now defines several reusable arrays of actions (`bookingActions`, `isfActions`, `hblAction`, `createHblAction`, `viewAction`, `updateLineBookingAction`, `updateDOAction`) and combines them based on user access roles. New actions to "Update Line Booking" and "Update DO" were added, which open modals.
    *   **11/24/2025, 2:53:07 PM:** The `formAction` for the `Create HBL` action was corrected from `"edit"` to `"add"`, aligning with its intended "create" functionality.
    *   **11/24/2025, 2:53:44 PM - 11/24/2025, 2:56:17 PM:** A temporary, likely debugging, change was made where the "Edit HBL" label was briefly altered to "Edit HBL123" and then reverted back.
    *   **11/24/2025, 3:43:34 PM:** The icon for the "Create HBL" action was updated from `<Edit />` to the more appropriate `<Create />` icon, enhancing clarity.
    *   **11/24/2025, 3:43:58 PM:** No functional changes observed.

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\store\api\agentBookingApi.js`**
    *   **11/24/2025, 3:02:03 PM:** This Redux Toolkit Query API file was extended with new `tagTypes` (`'FormDetails'`) and several new endpoints:
        *   `saveHblBooking` (mutation) to save House Bill of Lading details.
        *   `fetchHblBookingFormDetails` (query) to retrieve HBL form data.
        *   `updateCarrierBooking` (mutation) for carrier booking updates.
        *   `updateDo` (mutation) for Delivery Order updates, notably removing the `Content-Type` header for its request.
        *   `exportSprReport` (query) for SPR booking reports.
    *   Existing `saveBooking` and `fetchBookingFormDetails` endpoints were updated to invalidate/provide the new `'FormDetails'` tag.

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\components\screen\booking\hbl\HBLform.jsx`**
    *   **11/24/2025, 3:14:32 PM:** This file was introduced to create the `HBLForm` component, a complex form for managing House Bill of Lading entries. Key aspects include:
        *   Extensive form handling using `Formik` and `Yup` for validation, with specific HBL-related validation schema (`HBLvalidationSchema`).
        *   Integration with Redux (`useDispatch`, `useSelector`) to manage form state, routing, container, and PO lists.
        *   Dynamic party management features (edit, view, add new party) and state updates when changing party tabs.
        *   Keyboard shortcuts (`ctrl+u`, `ctrl+d`, `ctrl+a`, `ctrl+s`, `ctrl+p`) for improved user interaction.
        *   Error handling with `toast` notifications and an `AlertConfig` for displaying messages.
        *   **11/24/2025, 3:17:08 PM:** A minor refinement was made to the `agent_booking_id` initialization within `Formik`, simplifying the conditional logic for handling "copy" actions.
        *   Other timestamps between 3:15 PM and 3:17 PM indicate minor saves without functional changes.

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\components\screen\booking\hbl\validation.js`**
    *   **11/24/2025, 3:20:42 PM:** This new file was added to define the `HBLvalidationSchema` using `Yup`.
        *   It includes a `generateAddressValidation` function to create reusable validation schemas for address fields (e.g., `ship_add1`, `cnee_city`, `notify_country`) with specific format and length constraints.
        *   It defines comprehensive validation for core HBL fields such as `pol`, `pod`, `por`, `fpd`, `vessel`, `voyage`, `bookingdate`, `hbldate`, `client_name`, `cnee_name`, `ship_name`, and `blno` (which is now required).
        *   Custom validation tests are included for `mblno` and `blno` to enforce a specific alphanumeric format.
        *   Dynamic inclusion of address validations for `shipper`, `consignee`, and `notify` parties.

### Patterns and Recurring Elements:

*   **Feature-rich Expansion:** The log demonstrates a clear pattern of adding extensive new features and modules to the frontend, particularly in the areas of shipping, booking, analytics, and master data management.
*   **Role-Based Access Control:** The `App.js` file heavily utilizes `ProtectedRoute` and `UserRoleEnum` to enforce role-specific access to different parts of the application, suggesting a robust security and permissions model.
*   **Modular Architecture:** The codebase is being structured with a focus on modularity, evident from the refactoring of booking actions, the use of Redux Toolkit Query for API interactions, and dedicated validation schemas for complex forms.
*   **Form Management Consistency:** `Formik` and `Yup` are consistently used for form state management and validation across new complex forms like HBL, ensuring a standardized approach to data input and integrity.
*   **User Experience Enhancements:** Implementation of keyboard shortcuts for common form actions indicates an effort to improve the efficiency and usability for power users.
*   **Continuous Development & Refinement:** The presence of console logs, temporary label changes, and repeated save operations in the timestamps suggest an active and iterative development process.
*   **Focus on Shipping/Logistics:** A significant portion of the changes are concentrated on core logistics functionalities like packing lists, service invoices, expense codes, destinations, vendors, PO/DSO orders, OTM BOLs, HBLs, ISFs, and various tracking screens (FCL, LCL, Rail, Air, Shipment).

## 6:41:13 AM
The code changes primarily involve updates to two controller files (`company_details.controller.ts`, `hblEntry.controller.ts`) and their associated route files (`otm_bol.route.ts`, `hblEntry.route.ts`).

**File-Specific Updates:**

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-backend\src\controllers\company_details.controller.ts`**
    *   **11/21/2025, 10:07:54 AM**: The `getAll` function was updated to support fetching company names based on user roles (`AGENT` or `CUSTOMER`). For `CUSTOMER` role, new logic was introduced to handle pagination, fetching total counts and paginated results from `mtr_tracking_data`, replacing previously commented-out code. Temporary `console.log` statements were added for debugging.
    *   **11/21/2025, 10:08:08 AM**: The temporary `console.log` statements for debugging were removed, indicating a minor cleanup.

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-backend\src\routes\otm_bol.route.ts`**
    *   **11/21/2025, 11:40:37 AM**: Several new API routes were added for OTM (Open Text Message) Bill of Lading operations, including endpoints for saving/editing uploads (`/upload_save_edit`), fetching payload data (`/fetch_payload`), fetching by a common key (`/fetch/:common_key`), generating XML (`/generate_xml`), and sending data to OTM (`/send_to_otm`). A previous `/upload` route using `uploadMiddleware` was commented out.

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-backend\src\controllers\hblEntry.controller.ts`**
    *   **11/21/2025, 3:11:14 PM**: A new controller for HBL (House Bill of Lading) entry was introduced. It defines `createHblMasterBooking` for single HBL inserts into `hbl_master` and `saveHblBooking` for comprehensive HBL management. `saveHblBooking` supports both new booking creation and updates, involving fetching current data, updating multiple related tables (`agent_booking_entry`, `agent_booking_vessel`, `agent_booking_routing`, `agent_booking_container`, `agent_booking_hbl`, `agent_booking_po` by deleting and re-inserting list items), and logging changes to `agent_booking_hbl_history`. Both functions use database transactions and extensive input sanitization.
    *   **11/21/2025, 3:13:11 PM**: The error handling in `createHblMasterBooking` was changed from using `HttpError` to simply logging the error, potentially affecting client error responses.
    *   **11/21/2025, 3:16:23 PM - 3:19:06 PM**: Minor adjustments were made to the `bookingdate` field in both `createHblMasterBooking` and `saveHblBooking` to allow for null values or to be entirely commented out from the payload.
    *   **11/24/2025, 1:19:43 PM**: The response format for `createHblMasterBooking` was updated to return the full array of inserted rows (`rows`) instead of just the first element (`rows[0]`).
    *   **11/24/2025, 1:23:51 PM**: `createHblMasterBooking` underwent a major refactoring to support bulk creation of HBL entries. It now expects an array `hbl_entries` in the request body, maps it to a payload array, and uses an `insertMany` function for bulk insertion. Error handling was also updated to return a direct 500 response.
    *   **11/24/2025, 1:24:40 PM**: The `lastmodifieddate: "NOW()"` field, which was part of the bulk insert payload, was commented out.
    *   **11/24/2025, 1:26:39 PM**: The `insertMany` call in `createHblMasterBooking` was reverted to `insertQuery`, which might introduce a bug for bulk inserts if `insertQuery` is not designed for array input.
    *   **11/24/2025, 2:59:08 PM**: The `createHblMasterBooking` function was reverted back to its original single-HBL-creation logic, discarding the bulk creation feature and associated changes.
    *   **11/24/2025, 3:22:19 PM**: A `console.log` statement was added to `createHblMasterBooking` for debugging the request body.
    *   **11/24/2025, 3:36:33 PM**: The `payload` for `createHblMasterBooking` was expanded to include `transportaion_mode`, `customer` (aliased as `client_name`), and `description`.
    *   **11/24/2025, 5:09:51 PM**: The entire `createHblMasterBooking` function was commented out. Additionally, the `bookingdate` field was commented out from the `bookingInsertQuery` within `saveHblBooking`.

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-backend\src\routes\hblEntry.route.ts`**
    *   **11/21/2025, 3:11:42 PM**: Initial route setup included two `POST` routes on the same path (`/`), creating a routing conflict.
    *   **11/21/2025, 3:19:52 PM**: The routing conflict was resolved by assigning `createHblMasterBooking` to a new `"/create"` path.
    *   **11/24/2025, 5:10:21 PM - 5:10:39 PM**: The `router.post("/create", createHblMasterBooking);` route was commented out, and its import was removed, disabling this specific HBL creation endpoint.

**Timestamps of Significant Changes:**

*   **11/21/2025, 10:07:54 AM**: Introduction of pagination logic for customer company details.
*   **11/21/2025, 11:40:37 AM**: Expansion of OTM BOL module with multiple new routes.
*   **11/21/2025, 3:11:14 PM**: Initial creation and comprehensive logic for HBL entry (create and save/update).
*   **11/21/2025, 3:19:52 PM**: Resolution of routing conflict for HBL creation.
*   **11/24/2025, 1:23:51 PM**: Major refactoring of `createHblMasterBooking` for bulk HBL creation.
*   **11/24/2025, 2:59:08 PM**: Reversion of the bulk HBL creation logic back to single HBL creation.
*   **11/24/2025, 5:09:51 PM**: Disabling (commenting out) the `createHblMasterBooking` function and commenting out `bookingdate` in `saveHblBooking`.
*   **11/24/2025, 5:10:21 PM - 5:10:39 PM**: Disabling (commenting out) the corresponding HBL creation route.

**Patterns and Recurring Elements:**

*   **Rapid Development and Iteration**: The multiple changes to `hblEntry.controller.ts` in quick succession on 11/24/2025 (especially the introduction, modification, and subsequent reversion/disabling of bulk HBL creation) indicate an active development cycle with experimentation and refinement.
*   **Debugging Practices**: The insertion and removal of `console.log` statements in controllers signify standard debugging during development.
*   **Payload Sanitization**: Consistent use of `sanitizeString` for various request body fields across controllers points to an emphasis on data integrity and security.
*   **Database Transactions**: The recurring use of `BEGIN`, `COMMIT`, and `ROLLBACK` for database operations ensures data consistency, especially in complex update scenarios involving multiple tables within `saveHblBooking`.
*   **Modular API Structure**: Changes consistently appear in both controller and route files for specific modules, following a clear separation of concerns.
*   **Feature Management through Comments**: Commenting out code (e.g., the `/upload` route in `otm_bol.route.ts`, `createHblMasterBooking` function and its route in `hblEntry` files) is used to temporarily disable or defer features.

## 9:15:14 AM
The code changes primarily revolve around expanding frontend routing, enhancing UI components, refactoring booking-related actions, and introducing a new House Bill of Lading (HBL) feature, along with new API endpoints.

**File-specific updates:**

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\App.js` (11/21/2025, 11:31:13 AM & 11:34:00 AM):**
    *   The application's routing expanded significantly with new imports and routes for various screens including FCL/LCL tracking, Rail and Air tracking, MTR forms, Dashboard 7501, Shipping Orders, CNG Booking, City Master, Portmaster, and extended versions of Agent Booking and Booking Dashboard forms.
    *   A new `UserRoleEnum.ADMIN_V2` role was introduced and added to the `allowedRoles` for several `ProtectedRoute` components, indicating an update to the access control system.
    *   The two entries for this file are identical, suggesting a non-functional save or an inconsequential change not captured in the log.

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\components\screen\analytics\MetricsBox.jsx` (11/21/2025, 11:36:28 AM):**
    *   Introduced functionality for viewing analytics charts in a full-screen modal. This involved adding `MetricFooter` and `ThemedModal` components.
    *   The `getChartComponent` function was updated to dynamically adjust chart height when enlarged, with a minimum height constraint.
    *   The default view of charts now displays only the first 9 data points (`item.data.slice(0, 9)`).

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\components\screen\booking\actions.js` (multiple timestamps on 11/24/2025):**
    *   The `getBookingActions` function was substantially refactored to use a modular approach, defining separate arrays for common actions (e.g., `bookingActions`, `isfActions`, `hblAction`, `createHblAction`, `viewAction`, `updateLineBookingAction`, `updateDOAction`).
    *   These action arrays are then combined conditionally based on the user's access role (`agentBookingMenu`, `customerBookingMenu`, `adminBookingMenu`).
    *   The `formAction` for `createHblAction` was initially set to `"edit"` and then quickly corrected to `"add"` (11/24/2025, 2:53:07 PM).
    *   A temporary label "Edit HBL123" was introduced for `hblAction` (11/24/2025, 2:53:44 PM) and then reverted back to "Edit HBL" (11/24/2025, 2:56:17 PM), indicating a testing phase.
    *   The `Create` icon was added and used for the "Create HBL" action (11/24/2025, 3:43:34 PM).
    *   The "Create HBL" action was explicitly included in the actions returned for `agentBookingMenu` and `adminBookingMenu` access (11/24/2025, 2:54:37 PM).

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\store\api\agentBookingApi.js` (11/24/2025, 3:02:03 PM):**
    *   The Redux Toolkit Query API (`agentBookingApi`) was extended to support House Bill of Lading (HBL) operations with new `saveHblBooking` and `fetchHblBookingFormDetails` endpoints.
    *   Additional mutations (`updateCarrierBooking`, `updateDo`) and a query (`exportSprReport`) were added to enhance booking management and reporting capabilities.
    *   A new `FormDetails` tag type was introduced to manage caching and invalidation for booking form details.

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\components\screen\booking\hbl\HBLform.jsx` (multiple timestamps on 11/24/2025):**
    *   This file details the development of the HBL form, integrating multiple sub-forms for container details, routing, header information, and POs.
    *   It utilizes `Formik` for form management, `useSaveHblBookingMutation` for data submission, and Redux for state management of party codes and tab selections.
    *   The form includes party management features (`Edit Party`, `View Parties`, `Add New Parties`) and implements keyboard shortcuts (`ctrl+u`, `ctrl+d`, `ctrl+a`, `ctrl+s`, `ctrl+p`) for improved user experience.
    *   Validation is enforced using `HBLvalidationSchema`.
    *   An initial value change for `agent_booking_id` was noted (11/24/2025, 3:17:51 PM), where it no longer conditionally clears for a "copy" action, suggesting potential changes in how form initialization for copying is handled.
    *   Multiple identical entries for this file suggest frequent saves during development.

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\components\screen\booking\hbl\validation.js` (11/24/2025, 3:20:42 PM):**
    *   A comprehensive `HBLvalidationSchema` was implemented using `Yup` for the HBL form.
    *   This schema includes required fields for origin/destination ports, vessel, voyage, dates, client, consignee, and shipper names.
    *   It also features sophisticated validation for `mblno` and `blno` (nullable vs. required, and specific alphanumeric patterns).
    *   Dynamic address validation is generated using a `generateAddressValidation` function, applying rules consistently across different party types (`ship`, `cnee`, `notify`).

**Patterns and Recurring Elements:**

*   **Feature-driven Development:** The log shows a clear focus on developing new features, specifically around House Bill of Lading (HBL) management and expanding tracking/booking capabilities.
*   **Modularization and Reusability:** The refactoring of `actions.js` demonstrates an effort to create more maintainable and reusable code components, especially for common UI actions.
*   **Redux Integration:** Redux (via `@reduxjs/toolkit/query/react` and `react-redux`) is consistently used for API interaction and global state management across different features.
*   **Form Management:** `Formik` and `Yup` are the chosen tools for form handling and validation, ensuring data integrity across various forms.
*   **User Experience Enhancements:** The addition of full-screen chart views in analytics and keyboard shortcuts in the HBL form indicates a focus on improving the user interface and interaction.
*   **Active Debugging/Testing:** The presence of `console.log` statements and temporary label changes suggests an active development environment with ongoing debugging and testing.
*   **Rapid Iteration:** Numerous small, consecutive changes, especially in `actions.js` and `HBLform.jsx` on 11/24/2025, indicate rapid iterative development or frequent saves.

## 9:15:16 AM
The log details code changes across three main files within the `T360_Api/t360-backend` project: `company_details.controller.ts`, `otm_bol.route.ts`, and `hblEntry.controller.ts`/`hblEntry.route.ts`. All recorded changes occurred between November 21st and November 24th, 2025, suggesting an active development period.

**File-Specific Updates:**

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-backend\src\controllers\company_details.controller.ts`**
    *   **Timestamp: 11/21/2025, 10:07:54 AM**
        *   The `getAll` function was established to fetch company names, differentiating logic based on user `role` (AGENT or CUSTOMER).
        *   For `AGENT`s, it queries `agent_po_account_master` for distinct `cname`s with a search filter and limit 10.
        *   For `CUSTOMER`s, it queries `mtr_tracking_data` for distinct `account_name`s, implementing pagination if `req.query.pagination` is "true", including total count. If no pagination, it defaults to a limit of 10.
        *   Initial version included several `console.log` statements for debugging `totalResult` and `result` arrays.
    *   **Timestamp: 11/21/2025, 10:08:08 AM**
        *   Minor cleanup: Removed `console.log("====totalResult",totalResult)` and `console.log("====result",result)` from the `CUSTOMER` pagination logic.

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-backend\src\routes\otm_bol.route.ts`**
    *   **Timestamp: 11/21/2025, 11:40:37 AM**
        *   This file defines routes for OTM (Open Transport Management) Bill of Lading (BOL) operations.
        *   It includes `GET` routes for fetching excel data, general BOLs, payload, and specific BOLs by number or common key.
        *   `POST` routes are defined for editing OTM BOL, uploading and saving edits, generating XML, and sending data to OTM.
        *   A `POST /upload` route utilizing `uploadMiddleware` and environment variables for file path was commented out.

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-backend\src\controllers\hblEntry.controller.ts`**
    *   **Timestamp: 11/21/2025, 3:11:14 PM**
        *   Introduced `createHblMasterBooking` and `saveHblBooking` functions.
        *   `createHblMasterBooking` handles creating a new HBL master entry, inserting data into the `hbl_master` table within a database transaction.
        *   `saveHblBooking` implements logic for both adding new and updating existing HBL bookings (`agent_booking_entry`). It manages associated data across multiple tables (`agent_booking_vessel`, `agent_booking_routing`, `agent_booking_container`, `agent_booking_hbl`, `agent_booking_po`), often deleting and re-inserting sub-list data (routing, containers, POs) during updates. This function also logs historical changes to `agent_booking_hbl_history`, storing both old and new payload states.
    *   **Timestamp: 11/21/2025, 3:13:11 PM**
        *   Error handling in `createHblMasterBooking` changed from propagating `HttpError` via `next` to directly logging the error.
        *   `booking_date` handling in `saveHblBooking` was adjusted to explicitly allow `null` values.
    *   **Timestamp: 11/21/2025, 3:16:23 PM**
        *   Minor fix in `saveHblBooking` payload for `hbldate` from string `'null'` to actual `null`.
    *   **Timestamp: 11/21/2025, 3:17:07 PM**
        *   `bookingdate` in `createHblMasterBooking` payload was updated to handle `null` values.
    *   **Timestamp: 11/21/2025, 3:19:06 PM**
        *   `bookingdate` field was commented out from the `createHblMasterBooking` payload.
    *   **Timestamp: 11/24/2025, 1:19:43 PM**
        *   `createHblMasterBooking` changed its successful response to return the entire `rows` array instead of just the first element (`rows[0]`).
    *   **Timestamp: 11/24/2025, 1:23:51 PM**
        *   Major refactoring of `createHblMasterBooking`: it was modified to handle *multiple* HBL entries via a `hbl_entries` array in the request body, utilizing an `insertMany` function for bulk insertion. The success message changed to reflect multiple entries.
    *   **Timestamp: 11/24/2025, 1:26:39 PM**
        *   The bulk insert (`insertMany`) in `createHblMasterBooking` was replaced with a call to `insertQuery`, potentially causing issues if `insertQuery` is not designed for array payloads.
    *   **Timestamp: 11/24/2025, 2:59:08 PM**
        *   The `createHblMasterBooking` function was reverted to its pre-bulk-insert state, handling a single HBL master entry via `insertQuery` and returning `rows[0]`.
    *   **Timestamp: 11/24/2025, 3:22:19 PM**
        *   A `console.log` was added to `createHblMasterBooking` for debugging the request body.
    *   **Timestamp: 11/24/2025, 3:36:33 PM**
        *   The `createHblMasterBooking` payload was expanded to include `transportaion_mode`, `customer`, and `description` fields.
    *   **Timestamp: 11/24/2025, 5:09:51 PM**
        *   The entire `createHblMasterBooking` function was commented out.
        *   The `bookingdate` field in `bookingInsertQuery` within `saveHblBooking` was commented out.

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-backend\src\routes\hblEntry.route.ts`**
    *   **Timestamp: 11/21/2025, 3:11:42 PM**
        *   Initial route setup for HBL entries: `POST /` for `saveHblBooking`, `GET /` for `fetchHblFormDetails`, and a conflicting second `POST /` for `createHblMasterBooking`.
    *   **Timestamp: 11/21/2025, 3:19:52 PM**
        *   The conflicting `POST /` route for `createHblMasterBooking` was moved to `POST /create`.
    *   **Timestamp: 11/24/2025, 5:10:21 PM**
        *   The `POST /create` route associated with `createHblMasterBooking` was commented out.
    *   **Timestamp: 11/24/2025, 5:10:39 PM**
        *   The import statement for `createHblMasterBooking` was removed, aligning with the commented-out route.

**Patterns and Recurring Elements:**

*   **Concentrated Development:** All changes fall within a short, three-day period (November 21-24, 2025), indicating intensive work on these features.
*   **Database Transaction Management:** The use of `await query("BEGIN")`, `await query("COMMIT")`, and `await query("ROLLBACK")` is prevalent in controller functions, ensuring data consistency for multi-step database operations.
*   **Input Validation/Sanitization:** A strong pattern of `sanitizeString()` for all incoming string data and `AppDateFormate()` for dates demonstrates a focus on data integrity and security.
*   **Debugging Practices:** Several `console.log` and `logger.info` statements were added and subsequently removed or retained for ongoing debugging.
*   **Feature Evolution and Reversion:** The `hblEntry.controller.ts` file shows a clear pattern of iterative development, with `createHblMasterBooking` undergoing significant changes to support bulk inserts, then reverting, and eventually being commented out, indicating potential redesign, de-prioritization, or issues with the bulk implementation.
*   **Commenting Out Code:** Both routes and controller functions are commented out, suggesting features are being temporarily disabled, re-evaluated, or are under construction.
*   **Role-Based Logic:** The `company_details.controller.ts` demonstrates conditional logic based on user roles (`AGENT`, `CUSTOMER`), suggesting a multi-user system with different data access patterns.
*   **Modular Design:** Routes and controllers are separated, adhering to a common backend architectural pattern.

## 11:27:25 AM
The log details a series of changes primarily focused on the `t360-backend` API, specifically concerning company details and HBL (House Bill of Lading) entry functionality.

**File-specific updates:**

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-backend\src\controllers\company_details.controller.ts`**
    *   **Timestamp: 11/21/2025, 10:07:54 AM**: The `getAll` function was updated to support fetching company names based on user `role` (AGENT or CUSTOMER). For AGENTs, it queries `agent_po_account_master`. For CUSTOMERs, it queries `mtr_tracking_data` and includes logic for optional pagination with `LIMIT` and `OFFSET` clauses, along with a total count.
    *   **Timestamp: 11/21/2025, 10:08:08 AM**: Minor refinement involved removing `console.log` statements from the CUSTOMER role's pagination logic.

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-backend\src\routes\otm_bol.route.ts`**
    *   **Timestamp: 11/21/2025, 11:40:37 AM**: This file defines API routes related to OTM BOL (Bill of Lading). A `POST /upload` route was commented out, which previously used `uploadMiddleware` for handling `plFile` and `dutyFile`. Several new `POST` and `GET` routes were added: `/upload_save_edit`, `/fetch/:common_key`, `/generate_xml`, and `/send_to_otm`, indicating expanded functionality for OTM BOL processing and data manipulation.

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-backend\src\controllers\hblEntry.controller.ts`**
    *   This file experienced significant and frequent modifications over the recorded period, indicating active development and refactoring.
    *   **Timestamp: 11/21/2025, 3:11:14 PM**: Introduced two main asynchronous functions: `createHblMasterBooking` (for single HBL master record creation) and `saveHblBooking` (for creating or updating more complex HBL booking entries, including associated routing, container, and PO lists). Both functions employ database transactions (`BEGIN`, `COMMIT`, `ROLLBACK`) and extensive data sanitization/formatting. `saveHblBooking` also logs old and new data into an `agent_booking_hbl_history` table during updates.
    *   **Timestamp: 11/21/2025, 3:13:11 PM**: Modified error handling in `createHblMasterBooking` to use `logger.error` instead of propagating an `HttpError` via `next()`.
    *   **Timestamp: 11/21/2025, 3:16:23 PM**: The `bookingdate` field in `saveHblBooking`'s `bookingInsertQuery` was made explicitly nullable (`payload.booking_date || null`).
    *   **Timestamp: 11/21/2025, 3:17:07 PM**: Similar change for `bookingdate` in `createHblMasterBooking`'s payload, making it nullable.
    *   **Timestamp: 11/21/2025, 3:19:06 PM**: The `bookingdate` field within the `payload` for `createHblMasterBooking` was commented out entirely.
    *   **Timestamp: 11/24/2025, 1:19:43 PM**: Changed the success response of `createHblMasterBooking` to return the full `rows` array instead of just `rows[0]`.
    *   **Timestamp: 11/24/2025, 1:23:51 PM**: **Major Refactor**: `createHblMasterBooking` was significantly rewritten to handle batch insertions of HBL entries via an array (`hbl_entries`) in the request body, using an `insertMany` helper function. Error handling was also enhanced to return a 500 status with a specific message.
    *   **Timestamp: 11/24/2025, 1:24:40 PM**: Commented out a `lastmodifieddate` field that was being mapped in the batch payload for `createHblMasterBooking`.
    *   **Timestamp: 11/24/2025, 1:26:39 PM - 1:29:01 PM**: A temporary, likely erroneous, change in `createHblMasterBooking` where `insertMany` was replaced with `insertQuery` while still passing an array, which is typically for single insertions.
    *   **Timestamp: 11/24/2025, 2:59:08 PM**: **Major Revert**: `createHblMasterBooking` was largely reverted to its state before the batch insertion refactor, once again handling single HBL master bookings and using `insertQuery` with a single payload.
    *   **Timestamp: 11/24/2025, 3:22:19 PM**: Added `console.log` for request body debugging in `createHblMasterBooking`.
    *   **Timestamp: 11/24/2025, 3:36:33 PM**: Added `transportaion_mode`, `customer`, and `description` fields to the `payload` in `createHblMasterBooking`.
    *   **Timestamp: 11/24/2025, 5:09:51 PM**: `createHblMasterBooking` function was commented out entirely. Within `saveHblBooking`, the `bookingdate` field in `bookingInsertQuery` and `agent_booking_id`, `location` fields in the `insertQuery` for new bookings were commented out.
    *   **Timestamp: 11/25/2025, 11:00:44 AM**: `createHblMasterBooking` was uncommented, reverting to its state as of 3:36:33 PM on 11/24. The commented-out fields in `saveHblBooking`'s new booking path (`bookingdate`, `agent_booking_id`, `location`) persisted.

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-backend\src\routes\hblEntry.route.ts`**
    *   **Timestamp: 11/21/2025, 3:11:42 PM**: Initial setup of routes: `POST /` for `saveHblBooking`, `GET /` for `fetchHblFormDetails`. Critically, `router.post("/")` was duplicated, pointing to `createHblMasterBooking` as well, which is an error in Express routing.
    *   **Timestamp: 11/21/2025, 3:19:52 PM**: Fixed the route duplication by assigning `createHblMasterBooking` to `POST /create`.
    *   **Timestamp: 11/24/2025, 5:10:21 PM**: The `POST /create` route for `createHblMasterBooking` was commented out.
    *   **Timestamp: 11/24/2025, 5:10:39 PM**: The import statement for `createHblMasterBooking` was removed, aligning with the commented-out route.
    *   **Timestamp: 11/25/2025, 11:00:51 AM**: The `createHblMasterBooking` import and `POST /create` route were uncommented, reverting the previous day's changes.

**Timestamps of significant changes:**

*   **11/21/2025, 10:07:54 AM**: Introduction of pagination logic for company details.
*   **11/21/2025, 11:40:37 AM**: Expansion of OTM BOL routes, including new functionality for payload fetching, XML generation, and sending to OTM.
*   **11/21/2025, 3:11:14 PM**: Initial comprehensive implementation of HBL booking creation and update logic.
*   **11/24/2025, 1:23:51 PM**: Major architectural shift in `createHblMasterBooking` towards batch HBL creation.
*   **11/24/2025, 2:59:08 PM**: Complete revert of the batch HBL creation in `createHblMasterBooking` back to single entry creation.
*   **11/24/2025, 5:09:51 PM - 11/25/2025, 11:00:44 AM**: Toggling (commenting/uncommenting) of `createHblMasterBooking` and its route, along with partial disabling of fields in `saveHblBooking`'s creation path, indicating experimental or unstable changes being introduced and reverted.

**Patterns or recurring elements:**

*   **Focus on HBL and Booking Management**: A large portion of the changes revolves around creating, updating, and managing HBL (House Bill of Lading) entries, including associated details like routing, containers, and purchase orders.
*   **Data Sanitization and Formatting**: The repeated use of `sanitizeString(req.body.field)` and `AppDateFormate(req.body.dateField, db_format)` highlights a consistent approach to data validation and preparation before database interaction.
*   **Transactional Database Operations**: All functions modifying the database (`insertQuery`, `updateQuery`, `insertMany`) are wrapped within `BEGIN`, `COMMIT`, and `ROLLBACK` transactions, ensuring data integrity.
*   **Logging for Debugging**: Frequent `logger.info` and `logger.error` statements, sometimes accompanied by `console.log`, indicate a practice of detailed logging for development and debugging purposes.
*   **API Route Volatility**: The `hblEntry.route.ts` file, in particular, shows initial route conflicts and subsequent commenting/uncommenting of routes, suggesting ongoing API design adjustments or feature development for HBL master bookings.
*   **Refactor and Revert Cycles**: The `hblEntry.controller.ts` file exhibits a clear pattern of introducing significant refactors (like batch inserts) only to revert them shortly after, possibly due to implementation issues, changing requirements, or feature branch merges.