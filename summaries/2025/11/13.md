# Activity Summary for 11/13/2025

## 10:42:51 AM
The changes primarily affect three core frontend files: `planboard-page.tsx`, `notification-page.tsx`, and `sidebar.tsx`, along with its associated configuration file, `menu.ts`. The updates span from minor text corrections to significant logic adjustments for user role-based access and data fetching.

**File-Specific Updates:**

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\pages\planboard\planboard-page.tsx`**
    *   **Timestamp: 11/13/2025, 9:46:03 AM & 9:46:25 AM**
    *   This component is responsible for displaying the booking planboard. It includes options for selecting a view (Year/Month) and a year, utilizing Redux for state management (`planboardBooking` slice). It dynamically renders `PlanboardCardView` and `MoreDetailsView` in a modal.
    *   A minor update was made to the fallback message displayed when no customer is selected. The text "Please select a customer to view booking data." was changed to "Please select a customer to view planboard data." for better accuracy.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\pages\notifications\notification-page.tsx`**
    *   **Timestamp: 11/13/2025, 9:47:43 AM, 9:47:50 AM & 9:51:35 AM**
    *   This page displays user notifications, fetching data via `useFetchNotificationDataQuery`. It supports different notification types with corresponding icons and allows navigation to shipment details.
    *   Initially, a typo in the "no customer selected" fallback message was corrected from "notficat data" to "notfication data".
    *   A more significant change occurred on **11/13/2025, 9:51:35 AM**, where the logic for determining the `CompanyName` parameter in the notification data query was simplified. It was changed from `CompanyName: selectedCustomer || localUser?.companyname` to `CompanyName: selectedCustomer || ""`. This removes the reliance on `localUser?.companyname` as a fallback, making `selectedCustomer` (or an empty string if `selectedCustomer` is null) the sole source for the company name in the API request. Accompanying `console.log` statements for `selectedCustomer` and `localUser` were also removed.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\components\core\sidebar.tsx`**
    *   **Timestamp: 11/13/2025, 10:20:29 AM, 10:20:38 AM, 10:29:48 AM, 10:30:26 AM & 10:32:57 AM**
    *   This component renders the application's sidebar navigation using configurations from `menu.ts`. It displays a logo, a customer selection panel (for `ADMIN_V2` roles), and various menu items.
    *   On **11/13/2025, 10:20:38 AM**, a minor typo was fixed: a superfluous "kk" suffix was removed from all `SidebarLabel` elements.
    *   Between **10:29:48 AM** and **10:32:57 AM**, there was an attempt to introduce logic for visually and functionally disabling sidebar items based on an `item.disabled` flag from `menu.ts`. This involved conditionally setting the `href` to `undefined`, preventing default navigation on click, and applying CSS classes for a disabled appearance. However, this change was subsequently **reverted** on **11/13/2025, 10:32:57 AM**, removing all `isDisabled` related logic and restoring the component to its previous state.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\config\menu.ts`**
    *   **Timestamp: 11/13/2025, 10:22:41 AM - 10:42:13 AM**
    *   This file defines the `sidebarMenu` structure, including labels, hrefs, and icons for navigation items. It also contains logic for conditional menu item display.
    *   There were multiple, often conflicting, changes regarding the "Preferences" menu item's visibility based on the user's role (`ADMIN_V2`).
        *   Initially, "Preferences" was always visible.
        *   An attempt on **10:24:09 AM** introduced `disabled?: boolean;` to `SidebarItemType` and removed "Preferences" if `userRole === "admin_v2"`.
        *   This change was quickly reverted at **10:24:31 AM**.
        *   Conditional removal of "Preferences" for `ADMIN_V2` was re-added at **10:26:22 AM** (using `localUser.role`).
        *   A new approach at **10:28:35 AM** added a mandatory `disabled: boolean;` property to `SidebarItemType` and explicitly set `disabled: localUser?.role === "ADMIN_V2"` for "Preferences," intending to disable it rather than remove it.
        *   However, this `disabled` property mechanism was then **reverted** at **10:34:59 AM**, bringing back the conditional *removal* of the "Preferences" item for `ADMIN_V2` users.
        *   The `userRole` variable was formally reintroduced at **10:38:26 AM** for this conditional logic.
    *   A typo in "Planbaord" was briefly corrected to "Planboard" at **10:24:09 AM** but then reverted back to "Planbaord" by **10:24:31 AM**.
    *   The "Analytics" menu item under "Reports" was uncommented and made visible at **10:41:03 AM**, but then commented out again and hidden at **10:42:13 AM**.
    *   The "Dev" section remains conditionally rendered based on `import.meta.env.VITE_MODE === 'DEV'`.

**Patterns and Recurring Elements:**

*   **Role-Based Access Control Fluctuation:** The most prominent pattern is the persistent effort to implement role-based access for the "Preferences" menu item. The implementation frequently switched between *removing* the item entirely for `ADMIN_V2` users and *disabling* it, with quick reverts and re-attempts, suggesting ongoing refinement or indecision on the best approach. The final state in the log shows it's conditionally removed.
*   **Dependency on `selectedCustomer`:** Both `planboard-page.tsx` and `notification-page.tsx` exhibit a strong dependency on the `selectedCustomer` from the Redux global state, displaying placeholder messages when it's not present.
*   **Minor Typo Corrections and Reverts:** Several small textual corrections (e.g., "notficat" to "notification", "Planbaord" to "Planboard") were made, often followed by quick reverts, indicating iterative development and potential collaboration conflicts or rapid iteration.
*   **Conditional "Dev" Features:** The sidebar menu consistently includes a "Dev" section that is conditionally rendered based on the `VITE_MODE` environment variable, a common practice for internal development features.
*   **Temporary `console.log` for Debugging:** Debugging `console.log` statements were added and later removed in `notification-page.tsx` when adjusting data fetching logic.

## 11:42:10 AM
The log details code changes across two files related to report scheduling and history, all occurring on November 13, 2025.

**File-Specific Updates:**

1.  **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-backend-v2\src\services\reports\scheduleReport.ts`**
    *   **11/13/2025, 10:50:09 AM:** This version established the core functionalities for managing scheduled reports. It includes:
        *   `setReport`: A function to insert new scheduled report configurations into the `v2_user_reports` table, covering details like `reportName`, `columns`, `description`, `schedule`, `time`, `date`, `week_day`, `month_day`, `email_ids`, and `timezone`.
        *   `fetchScheduledReports`: Retrieves active scheduled reports for a user, with optional filtering by `id` and `CompanyName` (mapped to `account_name`). It also includes a `timeZoneConverter` utility to adjust date and time based on the user's timezone.
        *   `editReport`: Allows updating an existing scheduled report based on its `id` and `user_id`, modifying various report parameters.
    *   **11/13/2025, 11:03:19 AM:** A temporary change was introduced in `fetchScheduledReports`. The `companyName` variable, intended to filter by `req.query.CompanyName`, was mistakenly assigned `req.query.id`. A `console.log` statement (`"===jjhhhh"`) was also added.
    *   **11/13/2025, 11:06:07 AM:** This change reverted the accidental bug introduced in the previous timestamp. The `companyName` variable in `fetchScheduledReports` was corrected back to `req.query.CompanyName`, ensuring proper filtering by company name. The `console.log` statement remained. This indicates a quick fix after an immediate detection of a regression.

2.  **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-backend-v2\src\services\reports\reportHistory.ts`**
    *   **11/13/2025, 11:21:33 AM:** This file was introduced, adding new functionalities for report history:
        *   `saveReportHistory`: A function to record the history of executed reports. It inserts comprehensive details into the `public.v2_report_history` table, including user ID, report ID, name, schedule parameters, timezone, email IDs, columns, date filters (`fromDate`, `toDate`), other filters (`filterByPeriod`, `filterByColumn`), sorting (`sortOrder`, `orderByColumn`), `accountName`, `includeZeroEta`, `status`, and `description`. It utilizes parameterized queries for secure database interaction.
        *   `getReportHistory`: A robust function to retrieve report history, supporting pagination (`page`, `limit`), sorting (`sort` by `sent_date`), and extensive filtering by `CompanyName` (mapped to `account_name`), `name`, `fromDate`, `toDate`, and `status`. It also employs parameterized queries to construct dynamic SQL queries safely.
    *   **11/13/2025, 11:22:34 AM:** A minor debugging `console.log` statement (`"====jhggggg@@@"`) was added within the `getReportHistory` function, likely for quick inspection of the `CompanyName` query parameter.

**Patterns and Recurring Elements:**

*   **Database Interaction:** Both files extensively use a `query` utility for interacting with a PostgreSQL database, executing `INSERT`, `UPDATE`, and `SELECT` statements.
*   **Logging:** `logger.info` and `logger.error` are consistently used for tracing execution flow, debugging parameters, and capturing errors, often serializing objects with `JSON.stringify`.
*   **Error Handling:** All main asynchronous functions are wrapped in `try...catch` blocks to handle potential errors during database operations or processing, returning `HttpStatusCodes.INTERNAL_SERVER_ERROR` in case of failure.
*   **Request/Response Handling:** The functions typically accept `IAuthReq` (authenticated request) and `IRes` (response) types, using `res.status().json()` or `res.status().send()` to send structured responses.
*   **Parameterized Queries:** `reportHistory.ts` specifically demonstrates the use of parameterized queries (`$1`, `$2`, etc.) for building dynamic SQL, which is a good practice for preventing SQL injection. While `scheduleReport.ts` uses string concatenation for query building, which is less secure, `reportHistory.ts` shows an improvement in this regard.
*   **Timestamps:** All recorded changes occurred on the same day (November 13, 2025) within a relatively short time frame, suggesting active development, refactoring, and debugging sessions.

## 11:43:09 AM
`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\pages\planboard\planboard-page.tsx` (between 11/13/2025, 9:46:03 AM and 9:46:25 AM): The page's placeholder text displayed when no customer is selected was updated for clarity, changing "view booking data" to "view planboard data".

`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\pages\notifications\notification-page.tsx` (between 11/13/2025, 9:47:43 AM and 9:51:35 AM): The `useFetchNotificationDataQuery` hook was refactored to consistently use `selectedCustomer` from the Redux global state for the `CompanyName` parameter, removing a previous fallback to `localStorage`'s `localUser?.companyname`. Debugging `console.log` statements were also removed. Minor text updates for the "no customer selected" message occurred.

`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\components\core\sidebar.tsx` (between 11/13/2025, 10:20:29 AM and 10:32:57 AM): A minor typo in a `SidebarLabel` was corrected. Functionality to dynamically disable sidebar menu items (by setting `href` to `undefined`, preventing default click behavior, and applying specific styling) was introduced, tested, and subsequently reverted. The component shows the `SelectCustomerPanel` only for `ADMIN_V2` roles.

`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\config\menu.ts` (between 11/13/2025, 10:22:41 AM and 11:33:16 AM): This configuration file for the sidebar menu saw frequent modifications.
*   A typo in "Planbaord" was corrected to "Planboard".
*   The "Preferences" menu item's visibility was repeatedly adjusted: it was conditionally hidden for `ADMIN_V2` roles, then temporarily given a `disabled` property (which was later removed from the type definition), before settling back to being conditionally hidden (excluded from the array) for `ADMIN_V2`.
*   The "Analytics" menu item under "Reports" was consistently commented out and then uncommented, finally remaining uncommented and visible in the last change.
*   The `localUser` object is parsed from `localStorage` to determine user roles for conditional menu item rendering.

`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\pages\reports\report-page.tsx` (between 11/13/2025, 10:52:47 AM and 11:31:18 AM): This page handles scheduling and viewing reports.
*   There were several attempts to modify how `useGetSavedReportsQuery` fetched data, oscillating between using `id`, `CompanyName`, or no specific parameters from `selectedCustomer`. It eventually stabilized to pass `CompanyName: selectedCustomer ?? undefined` to both `useGetSavedReportsQuery` and `useGetReportHistoryQuery`.
*   Conditional rendering was implemented to only display the "Recent Reports" section (or the entire page content) if a `selectedCustomer` is active, showing a "Please select a customer to view reports" message otherwise.
*   The placeholder text for the "no customer selected" message was updated from "booking" to "reports".

`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\store\api\reports.api.ts` (between 11/13/2025, 11:00:52 AM and 11:15:55 AM): The RTK Query API slice for reports underwent significant churn specifically for the `getSavedReports` endpoint.
*   Initially, it could take `id` or `CompanyName`.
*   It was then restricted to primarily use an `id` parameter.
*   A more flexible query logic was introduced to handle `id`, `CompanyName`, or both, with URL parameter encoding.
*   This flexible logic was subsequently reverted, making the query once again dependent solely on the `id` parameter, despite `CompanyName` remaining in its type definition. This indicates an evolving and somewhat inconsistent approach to querying saved reports.

`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\components\screen\analytics\AnalyticsToolbar.tsx` (at 11/13/2025, 11:34:25 AM): This file provides the analytics toolbar, including components for date range selection, dashboard view management, and a `downloadDashboardPDF` function. The PDF export function utilizes `jspdf` and `html2canvas-pro` to capture and generate a PDF of the dashboard, including a logo. It leverages a `useAccess` hook for permission checks on customer selection.

`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\components\screen\analytics\analyticsContainer.tsx` (at 11/13/2025, 11:35:56 AM): This component is responsible for arranging and managing metric boxes within the analytics dashboard using `react-dnd` for drag-and-drop. It includes functions to handle metric position (`moveItem`), size changes (`saveSize`), and view changes (`saveView`), persisting these updates via API calls. It fetches individual report data using `useLazyFetchReportQuery`.

`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\pages\analytics\analytics-page.tsx` (between 11/13/2025, 11:38:04 AM and 11:39:26 AM): This is the main analytics page.
*   The page title was corrected from "Analytics1" to "Analytics".
*   `useFetchDashboardsQuery` was updated to fetch dashboards based on the `selectedCustomer` from the global Redux state (`state.globalSlice.selectedCustomer`), rather than the component's internal `analyticSlice` state. However, subsequent calls to `fetchReport` within the `useEffect` still use `mainState.selectedCustomer`, creating a potential inconsistency in how the selected customer context is used for different API calls on this page.
*   The page displays a loader during data fetching and an alert if the user is an "ADMIN" and no customer is selected.

**Patterns and Recurring Elements:**

*   **Centralized Customer Selection**: A strong pattern observed is the continuous effort to integrate `selectedCustomer` from Redux's `globalSlice` across various pages and API calls, centralizing the customer context for data filtering and UI rendering.
*   **Conditional UI/Data Fetching**: Many components now include logic to conditionally render UI elements or trigger data fetches only when a `selectedCustomer` is available, displaying informative messages otherwise.
*   **API Endpoint Parameter Refinement**: There's a recurring theme of adjusting API query parameters (`id` vs. `CompanyName`) for different endpoints, suggesting ongoing development and alignment with backend API expectations.
*   **UI Text/Typo Corrections**: Several minor text corrections were made, indicating a focus on user experience and polish.
*   **Dynamic Menu Items**: The sidebar menu configuration frequently changes regarding the visibility and behavior of items like "Preferences" and "Analytics," often tied to user roles or development environment.
*   **Debugging via `console.log`**: Numerous `console.log` statements are present across files, indicating active debugging during these development iterations.