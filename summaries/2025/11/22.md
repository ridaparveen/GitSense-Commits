# Activity Summary for 11/22/2025

## 9:11:11 AM
The `usercard.tsx` file, updated on 11/21/2025, 10:15:47 AM, primarily refines the user logout mechanism and user display logic. The `handleLogout` function has been significantly modified:
- Previously, it conditionally removed user data and tokens after redirection/navigation.
- The updated logic for Auth0 users now clears `token`, `user`, and dispatches `auth/logout` **before** redirecting to the login page (`${link}/login`) instead of the logout endpoint (`${link}/logout`).
- For non-Auth0 users, the `token`, `user` are cleared, `auth/logout` dispatched, and then navigates to the root path (`/`).
The component displays the user's initials, first name, last name, and role, prioritizing `first_name` and `last_name` from a fetched user preference query (`data`) over local storage data.

The `layout.tsx` file, updated shortly after on 11/21/2025, 10:20:01 AM, introduces robust session management and role-based customer selection logic.
- It includes an `isTokenExpired` function to check if the `exp` timestamp in the `localUser` from `localStorage` has passed the current time.
- An `useEffect` hook runs on component mount to check for token expiration; if expired, it clears `user` and `token` from `localStorage` and redirects the user to the root path (`/`). If the token is valid, it dispatches `initializeSelectedCustomer()`.
- A second `useEffect` hook dynamically manages the `selectedCustomer` state based on the user's role:
    - If the user role is "CUSTOMER", it sets `selectedCustomer` to their `companyname` and stores it in `localStorage`.
    - If the user role is "ADMIN_V2", it clears `selectedCustomer` (sets to `null`) and removes it from `localStorage`.
- The layout conditionally renders an `Outlet` (for child routes) only if a `selectedCustomer` is present. Otherwise, if the user is an "ADMIN_V2", it displays a message prompting them to select a customer.

**Patterns and Recurring Elements:**
- **`localStorage` Dependency:** Both files extensively use `localStorage` to persist and retrieve user data (`user`, `token`, `authtype`) and `selectedCustomer` state across sessions.
- **Redux Integration:** Both components interact with a Redux store, using `useDispatch` for actions like `auth/logout`, `initializeSelectedCustomer`, and `setSelectedCustomer`, and `useSelector` to retrieve state (`selectedCustomer`).
- **`react-router-dom` for Navigation:** Both files utilize `useNavigate` for programmatic navigation, typically for redirection after login/logout or to specific routes.
- **Role-Based Logic:** Both components implement logic that varies based on the user's role (e.g., "CUSTOMER", "ADMIN_V2", "auth0" vs. normal logout).
- **Session Management:** The changes indicate a focus on improving user session management, including logout procedures and token expiration handling.
- **Timestamp Proximity:** The timestamps suggest these changes were made in a concentrated development effort, likely as part of a single feature or bug fix related to user authentication and session management.