# Activity Summary for 11/22/2025

## 9:11:11 AM
The `usercard.tsx` file, updated on 11/21/2025, 10:15:47 AM, primarily refines the user logout mechanism and user display logic. The `handleLogout` function has been significantly modified:
- Previously, it conditionally removed user data and tokens after redirection/navigation.
- The updated logic for Auth0 users now clears `token`, `user`, and dispatches `auth/logout` **before** redirecting to the login page (`${link}/login`) instead of the logout endpoint (`${link}/logout`).
- For non-Auth0 users, the `token`, `user` are cleared, `auth/logout` dispatched, and then navigates to the root path (`/`).
The component displays the user's initials, first name, last name, and role, prioritizing `first_name` and `last_name` from a fetched user preference query (`data`) over local storage data.

The `layout.tsx` file, updated shortly after on 11/21/2025, 10:20:01 AM, introduces robust session management and role-based customer selection logic.
- It includes an `isTokenExpired` function to check if the `exp` timestamp in the `localUser` from `localStorage` has passed the current time.
- An `useEffect` hook runs on component mount to check for token expiration; if expired, it clears `user` and `token` from `localStorage` and redirects the user to the root path (`/`). If the token is valid, it dispatches `initializeSelectedCustomer()`.
- A second `useEffect` hook dynamically manages the `selectedCustomer` state based on the user's role:
    - If the user role is "CUSTOMER", it sets `selectedCustomer` to their `companyname` and stores it in `localStorage`.
    - If the user role is "ADMIN_V2", it clears `selectedCustomer` (sets to `null`) and removes it from `localStorage`.
- The layout conditionally renders an `Outlet` (for child routes) only if a `selectedCustomer` is present. Otherwise, if the user is an "ADMIN_V2", it displays a message prompting them to select a customer.

**Patterns and Recurring Elements:**
- **`localStorage` Dependency:** Both files extensively use `localStorage` to persist and retrieve user data (`user`, `token`, `authtype`) and `selectedCustomer` state across sessions.
- **Redux Integration:** Both components interact with a Redux store, using `useDispatch` for actions like `auth/logout`, `initializeSelectedCustomer`, and `setSelectedCustomer`, and `useSelector` to retrieve state (`selectedCustomer`).
- **`react-router-dom` for Navigation:** Both files utilize `useNavigate` for programmatic navigation, typically for redirection after login/logout or to specific routes.
- **Role-Based Logic:** Both components implement logic that varies based on the user's role (e.g., "CUSTOMER", "ADMIN_V2", "auth0" vs. normal logout).
- **Session Management:** The changes indicate a focus on improving user session management, including logout procedures and token expiration handling.
- **Timestamp Proximity:** The timestamps suggest these changes were made in a concentrated development effort, likely as part of a single feature or bug fix related to user authentication and session management.

## 9:11:19 AM
**c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\App.js**
On 11/21/2025 at 11:31:13 AM and again at 11:34:00 AM, the `App.js` file was updated (or saved identically). This file serves as the central routing configuration for a large React application. It imports a vast array of screens and components, indicating a comprehensive system covering user management, supply chain logistics (e.g., packing lists, BOLs, POs, OTM BOLs), financial processes (e.g., service invoices, expense codes, commercial invoices, CNG invoices), planning (planboards), and various tracking functionalities (FCL, LCL, Rail, Air, Trucking). The application extensively uses `react-router-dom` for navigation, `ProtectedRoute` for role-based access control leveraging `UserRoleEnum` (roles include `ADMIN`, `CUSTOMER`, `AGENT`, `CSF`, `FRONTOFFICE`, `BACKOFFICE`, `SPR_CUSTOMER`, `ADMIN_V2`), and `AuthGuard` for initial authentication flows (login, callback, registration). The routes are deeply nested, following a pattern of listing pages and corresponding form screens (e.g., `/spr/packing_list` and `/spr/packing_list/form`). A debug console log `TEST on Flow` is present, indicating active development or testing. The content for both timestamps is identical, suggesting no functional changes were introduced between these two logged instances.

**c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\components\screen\analytics\MetricsBox.jsx**
On 11/21/2025 at 11:36:28 AM, the `MetricsBox.jsx` component was updated. This component is designed for displaying various analytical charts within the application. It imports multiple chart types (Pie, Bar, Line, Stacked Bar, Gauge) and related utility components (`MetricToolbar`, `MetricFooter`, `ThemedModal`, `NoDataAvailable`). The component dynamically renders different chart visualizations based on `item.chartType` and `chartView` state, supporting types like "General", "StackBar", "Transit", and "Count". It also includes functionality for displaying charts in a full-screen modal, dynamically adjusting chart height for larger views, and provides a toolbar for user interaction (e.g., changing chart views). Data for the initial chart render is limited to the first 9 entries, while the full-screen view utilizes all available data. The presence of `console.log` statements within the component suggests recent debugging activities.

**Patterns and Recurring Elements:**
*   **Extensive Role-Based Access Control:** The `App.js` file demonstrates a strong emphasis on security and authorization through the widespread use of `ProtectedRoute` and a detailed `UserRoleEnum`, covering a broad spectrum of user types within the system.
*   **Comprehensive Feature Set:** The sheer volume of routes and imported screens across different domains (user management, logistics, finance, planning, analytics, tracking) points to a large, enterprise-grade application with a rich feature set.
*   **Modular Component Architecture:** The application follows a component-based approach with React, organizing UI and functionality into distinct, reusable components, such as the `MetricsBox` for analytics.
*   **Debugging Practices:** `console.log` statements found in both `App.js` and `MetricsBox.jsx` indicate ongoing development, testing, or recent debugging sessions.
*   **Data Visualization Focus:** The `MetricsBox.jsx` component highlights a significant focus on data analytics and visualization, offering various chart types and interactive features for displaying metrics.
*   **Consistent Routing Structure:** Many routes follow a `/<feature>/<sub-feature>` or `/<feature>/<sub-feature>/form` pattern, suggesting a systematic approach to navigation for listing and editing data.