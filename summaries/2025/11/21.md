# Activity Summary for 11/21/2025

## 10:54:32 AM
The file `c:\Users\ridap\OneDrive\Documents\T360_Api\t360-backend\src\controllers\company_details.controller.ts` was updated twice in quick succession on 11/21/2025.

**Key Changes:**
*   Between 10:07:54 AM and 10:08:08 AM, two `console.log` statements were removed from the `getAll` function.
*   These removed statements were located within the `CUSTOMER` role logic, specifically when pagination (`isPagination`) is enabled:
    *   `console.log("====totalResult",totalResult)`
    *   `console.log("====result",result)`
*   A third `console.log("====total",total)` statement in the same block remains present in both versions.

**File-specific Updates:**
The updates pertain solely to the `company_details.controller.ts` file, indicating a minor code refinement, likely a removal of debugging statements after testing the pagination logic for 'CUSTOMER' role.

**Timestamps of Significant Changes:**
The changes occurred very close together: 11/21/2025, 10:07:54 AM and 11/21/2025, 10:08:08 AM.

**Patterns or Recurring Elements:**
The primary pattern observed is the removal of debugging `console.log` statements, suggesting a quick cleanup after verifying functionality. The core business logic for fetching company names based on `AGENT` (from `agent_po_account_master` table) or `CUSTOMER` (from `mtr_tracking_data` table with pagination support) remains consistent across both timestamps. Both roles filter by a search query and map results to `{ value, label }` format.

## 10:57:15 AM
The file `c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\components\core\usercard.tsx` was updated on **11/21/2025, 10:15:47 AM**. The primary change involves a refactor of the `handleLogout` function. Previously, `localStorage` items were cleared after redirection for Auth0 users, or after navigation for normal users. The updated logic now clears `token` and `user` from `localStorage` *before* initiating the redirect for Auth0 users. Additionally, the Auth0 logout redirection target was changed from a `/logout` endpoint to a `/login` endpoint. For non-Auth0 users, the logout process remains similar: `token` and `user` are removed from `localStorage`, and the user is navigated to the root path. Both logout paths dispatch an `auth/logout` action. The component displays user's first name, last name, and role, pulling data from `useFetchUserPreferenceQuery` or `localStorage`, and uses `Dropdown` components for user interaction.

The file `c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\components\core\layout.tsx` was modified on **11/21/2025, 10:20:01 AM**. This update focuses on managing user authentication and customer selection. A new `isTokenExpired` function was introduced to validate `localUser` and `localToken` against an expiration timestamp. An `useEffect` hook now checks for token expiration on component mount; if expired, it clears `user` and `token` from `localStorage` and redirects to the root path. Otherwise, `initializeSelectedCustomer` is dispatched. Another `useEffect` manages the `selectedCustomer` state based on the user's role: "CUSTOMER" roles automatically have their `companyname` set as the `selectedCustomer` (and stored in `localStorage`), while "ADMIN_V2" roles have the `selectedCustomer` cleared from both Redux state and `localStorage`. The component conditionally renders an `Outlet` only when a `selectedCustomer` is present; if not and the user is an "ADMIN_V2", it displays a message prompting them to select a customer.

**Recurring Patterns:**
Across both files, there's a consistent reliance on `localStorage` for managing user authentication tokens, user details (like `firstname`, `lastname`, `role`), and application-specific states such as `selectedCustomer` and `authtype`. Both components extensively use `react-redux` for state management (`useDispatch`, `useSelector`) and `react-router-dom` for navigation (`useNavigate`, `Outlet`). User roles (e.g., "CUSTOMER", "ADMIN_V2") are a central theme, dictating access, data presentation, and application flow. There's also a clear pattern of clearing `localStorage` items related to user sessions (`token`, `user`) upon logout or session expiration.

## 12:59:39 PM
The `usercard.tsx` file, updated on 11/21/2025, 10:15:47 AM, primarily focuses on the user display and logout functionality. The most significant change is within the `handleLogout` function. Previously, the logic for clearing `localStorage` items (`token`, `user`) for Auth0 users occurred after a redirect, and for normal users, it happened after a `setTimeout`. The updated `handleLogout` now clears `token` and `user` from `localStorage` *before* the redirect for Auth0 users, and crucially, the Auth0 redirect URL has changed from `${link}/logout` to `${link}/login`. For normal users, the `localStorage` items are cleared immediately before navigating to the root path. Both logout paths dispatch an `auth/logout` action. The `localStorage.removeItem('authtype');` line remains commented out in both the old and new `handleLogout` implementations. The component renders user details (first name, last name, role) retrieved from either a `useFetchUserPreferenceQuery` or `localStorage`, and displays them within a dropdown alongside an avatar and a sign-out option.

The `layout.tsx` file, updated shortly after on 11/21/2025, 10:20:01 AM, manages the overall application layout and session control. It includes logic to check for token expiration: if the `user` or `token` is missing from `localStorage`, or if the token's expiration timestamp (`localUser.exp`) is in the past, it clears `localStorage` and redirects the user to the root path. Otherwise, it dispatches `initializeSelectedCustomer()`. A separate `useEffect` hook handles customer selection based on the user's role: "CUSTOMER" roles automatically set their company name as the `selectedCustomer` in both Redux state and `localStorage`, while "ADMIN_V2" roles clear any `selectedCustomer` data. The layout conditionally renders child routes (`<Outlet />`) only if a `selectedCustomer` is present; otherwise, for "ADMIN_V2" users, it displays a message prompting them to select a customer.

Common patterns across both files include:
*   Extensive use of `localStorage` for storing `user` information (including `firstname`, `lastname`, `role`, `companyname`, and `exp`) and `token`.
*   Integration with `react-redux` (`useDispatch`, `useSelector`) for global state management.
*   Navigation control using `react-router-dom` (`useNavigate`, `Outlet`).
*   The `localStorage.removeItem('authtype');` line being consistently commented out suggests this particular piece of logic is either deprecated or not currently in use.

## 12:59:42 PM
The `c:\Users\ridap\OneDrive\Documents\T360_Api\t360-backend\src\controllers\company_details.controller.ts` file saw two updates on **11/21/2025**.
At **10:07:54 AM**, the `getAll` controller function was significantly modified to handle data retrieval based on user roles. For the 'AGENT' role, it fetches distinct company names (`cname`) from the `agent_po_account_master` table, applying a search filter and limiting results to 10. For the 'CUSTOMER' role, the logic was refactored to support conditional pagination. If pagination is enabled, it performs two database queries: one to count the total distinct `account_name`s and another to fetch paginated results from `mtr_tracking_data` using `LIMIT` and `OFFSET`. If pagination is disabled, it fetches 10 distinct `account_name`s. This update also included `console.log` statements for debugging `totalResult` and `result` within the paginated customer data retrieval.
A subsequent update at **10:08:08 AM** to the same file involved a minor cleanup, specifically removing the `console.log("====totalResult",totalResult)` and `console.log("====result",result)` debugging statements from the 'CUSTOMER' role's paginated logic, though `console.log("====total",total)` remained.

The `c:\Users\ridap\OneDrive\Documents\T360_Api\t360-backend\src\routes\otm_bol.route.ts` file was updated on **11/21/2025, 11:40:37 AM**. This update primarily focused on expanding the OTM BOL (Bill of Lading) API endpoints. New routes were added for:
*   `POST /upload_save_edit`
*   `GET /fetch/:common_key`
*   `POST /generate_xml`
*   `POST /send_to_otm`
Additionally, an existing `POST /upload` route, which previously handled file uploads using `uploadMiddleware` and referenced an environment variable for the upload path, was commented out.

**Patterns and Recurring Elements:**
All changes occurred on the same date, **11/21/2025**, indicating a focused development session. The updates demonstrate an ongoing enhancement of a backend API: one file (`company_details.controller.ts`) is improving data retrieval logic, particularly with pagination and role-based access, while the other (`otm_bol.route.ts`) is expanding functionality related to OTM, adding new capabilities for data manipulation and integration. The use of `logger.info` and `logger.error` is consistent in the controller for application logging. SQL queries involving `DISTINCT`, `ILIKE`, `LIMIT`, and `OFFSET` are common patterns for data fetching and filtering.

## 12:59:44 PM
The `App.js` file, timestamped 11/21/2025, 11:31:13 AM and 11:34:00 AM, serves as the main routing configuration for a React frontend application. This file imports a vast number of page components, indicating a comprehensive application with many distinct sections. These sections include user management, various administrative masters (expense codes, destinations, vendors, city master, portmaster), packing lists, service invoices, purchase and sales orders, analytics, settings, commercial invoices, booking, detention, reporting, and a wide array of tracking features (FCL, LCL, Rail, Air, MTR, Trucking details, Shipment Tracking). The application leverages `react-router-dom` for navigation, `@mui/material` for UI theming, and `react-hot-toast` for notifications. A central pattern is the extensive use of `ProtectedRoute` and `AuthGuard` components to implement role-based access control, with a `UserRoleEnum` defining various roles such as ADMIN, CUSTOMER, AGENT, CSF, FRONTOFFICE, BACKOFFICE, SPR\_CUSTOMER, and ADMIN\_V2. The core difference between the two timestamps for `App.js` is a minor adjustment made at 11:34:00 AM, where the `UserRoleEnum.ADMIN_V2` role was specifically removed from the `allowedRoles` array for the "shipment\_tracking" and "booking" routes, although it remains an allowed role for the broader `/app` route.

The `MetricsBox.jsx` file, timestamped 11/21/2025, 11:36:28 AM, defines a React component responsible for displaying various types of charts within an analytics section. This component dynamically renders Bar, Pie, Line, Stacked Bar, and Gauge charts based on the `chartType` property passed to it. It manages its display state, including a `chartView` for different chart types and an `enlarge` state for a full-screen modal view of the charts, utilizing `useState`. `MetricsBox` integrates with Redux via `useSelector` to access analytics-related state. It includes sub-components like `MetricToolbar` for filtering/options and `MetricFooter` for actions, wrapping the charts in a `ThemedModal` for enlarged views. The component also handles cases where no data is available for charting.

**Patterns and Recurring Elements:**

*   **Extensive Routing and Role-Based Access Control:** The application demonstrates a highly granular routing structure with a strong emphasis on `ProtectedRoute` and `UserRoleEnum` for managing user permissions across numerous features.
*   **Modularity and Component-Based Development:** The sheer number of imported screen components in `App.js` and the structure of `MetricsBox.jsx` (which imports multiple chart components and utility components) highlight a modular, component-driven approach to frontend development.
*   **Focus on Logistics and Analytics:** Many routes and components indicate functionality tailored for logistics or supply chain management (e.g., packing lists, BOLs, POs, DSO, container reports, various tracking screens) coupled with robust analytics and reporting capabilities.
*   **Master Data Management:** The presence of "code" screens (Customer, Party, Agent) points to dedicated sections for managing core business entities.
*   **Debugging Artifacts:** The `console.log` statements in `App.js` and `MetricsBox.jsx` suggest that the logs might capture in-development or recently updated code, where debugging statements are still present.

## 2:02:29 PM
The log details recent updates to frontend components related to user authentication, session management, and layout. The changes occurred on **11/21/2025**, with updates at **10:15:47 AM** and **10:20:01 AM**, suggesting a coordinated set of modifications.

### `c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\components\core\usercard.tsx` (Timestamp: 11/21/2025, 10:15:47 AM)

This file, responsible for the user card component, saw significant changes to its logout handling logic. The `handleLogout` function was refactored to ensure `localStorage` items (`token`, `user`) are cleared *before* redirection, especially for Auth0 authenticated users. The Auth0 logout redirect URL was updated from `/logout` to `/login`. The `setTimeout` call previously used for clearing `localStorage` in the "normal" logout path was removed, streamlining the process. The component continues to display user details fetched from both Redux (`useFetchUserPreferenceQuery`) and `localStorage`, and provides a dropdown with a "Sign out" option.

### `c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\components\core\layout.tsx` (Timestamp: 11/21/2025, 10:20:01 AM)

The `Layout` component received updates primarily focused on enforcing user authentication and managing customer selection based on user roles. A new `isTokenExpired` function was introduced to check for expired user tokens and `localStorage` user data, which, if found expired, triggers removal of user data and a redirection to the root path. This `useEffect` now also dispatches `initializeSelectedCustomer()` if the token is valid. Another `useEffect` was added to manage the `selectedCustomer` state: "CUSTOMER" roles automatically set their own `companyname` as the `selectedCustomer`, while "ADMIN_V2" roles clear any selected customer. The layout conditionally renders content based on whether a customer is selected, displaying a "Please select a customer" message for "ADMIN_V2" users if none is chosen.

### Recurring Elements and Patterns

Across both files, several patterns are evident:
*   **`localStorage` Usage**: Extensive use of `localStorage` for storing and retrieving user information (`user`, `token`, `authtype`) and user preferences (`selectedCustomer`).
*   **Redux Integration**: Both components leverage Redux for state management, using `useDispatch` to trigger actions and `useSelector` to access global state, and Redux Toolkit Query for data fetching (`useFetchUserPreferenceQuery`).
*   **React Router for Navigation**: `useNavigate` and `Outlet` from `react-router-dom` are used for programmatic navigation and rendering nested routes.
*   **Role-Based Logic**: Conditional logic frequently differentiates behavior based on user roles (e.g., "CUSTOMER" vs. "ADMIN_V2") for features like customer selection and logout redirects.
*   **Authentication Flow Management**: A strong focus on managing the user's authentication state, including token validation, logout procedures, and redirection after session expiry.

## 2:02:30 PM
The `company_details.controller.ts` file saw activity around 11/21/2025, 10:07:54 AM, with a minor follow-up change at 10:08:08 AM. This controller's `getAll` function is responsible for fetching company names based on the user's role.
*   **AGENT Role:** It queries the `agent_po_account_master` table, searching by `cname` with a `LIMIT 10`.
*   **CUSTOMER Role:** It fetches `account_name` from `mtr_tracking_data`. A significant update was made to introduce conditional pagination. If pagination is requested (`isPagination` is true), it now performs two database queries: first, a `COUNT` query to get the total number of distinct accounts, and then a paginated `SELECT DISTINCT` query using `LIMIT` and `OFFSET`. If pagination is false, it uses a `LIMIT 10` query. Both paginated and non-paginated results are formatted as `{ value: account_name, label: account_name }`. The second timestamp for this file indicates a minor cleanup, specifically removing a couple of `console.log` statements related to `totalResult` and `result` from the pagination logic, while retaining `console.log("====total",total)`.

The `otm_bol.route.ts` file was updated at 11/21/2025, 11:40:37 AM. This file defines API endpoints for managing OTM (Oracle Transportation Management) Bill of Lading operations.
*   The update introduced several new routes:
    *   `POST /upload_save_edit`: For saving edits after an upload.
    *   `GET /fetch/:common_key`: To fetch BOL data using a common key.
    *   `POST /generate_xml`: To generate XML data.
    *   `POST /send_to_otm`: To send data to the OTM system.
*   An existing `POST /upload` route, which used `uploadMiddleware` for "plFile" and "dutyFile" and referenced an environment variable for the upload path, remains commented out, suggesting it's either an alternative or an older implementation that has been superseded or disabled.

Across all changes, there's a consistent use of `logger.info` and `logger.error` for internal logging. Database queries are handled by a `query` utility, and API responses consistently return a JSON object with a `data` field for success or an `error` field for failures, along with appropriate HTTP status codes (200 for success, 500 for server errors). The use of `req.query` for filtering, searching, and pagination parameters is also a recurring pattern.

## 2:02:34 PM
The log primarily details updates to two frontend files: `App.js` and `MetricsBox.jsx`.

**c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\App.js**
(Timestamp: 11/21/2025, 11:31:13 AM and 11/21/2025, 11:34:00 AM)
The content of this file remained functionally unchanged between the two logged timestamps. This file serves as the main routing configuration for the React application. It includes a vast number of imports for various screens and components, indicating a comprehensive application with features across multiple domains:
*   **Core Functionality:** Login, Registration, Dashboard, Settings, User Management.
*   **Logistics & Operations:** Packing Lists, Service Invoices, Expense Codes, Destinations, Vendors, PO/DSO Orders, OTM BOL (Bill of Lading), Commercial Invoices, Agent POs, CNG Invoices, ALC (Automated Listing Compliance), Shipping Orders, Container Reports.
*   **Tracking:** FCL (Full Container Load), LCL (Less than Container Load), Rail, Air, MTR (Master Tracking Record), Trucking Details, Shipment Tracking.
*   **Management:** Customer, Party, Agent management (under `/code`), Portmaster, City Master.
*   **Planning & Analytics:** Planboards (Booking and SPR), Analytics, Report Scheduler, PDF Parser, ALC Exception/Cost Dashboards, ISF Dashboard.
*   **UI/UX:** Uses `@mui/material` for theming and `react-hot-toast` for notifications.
*   **Authentication & Authorization:** Employs `AuthGuard` for initial authentication and `ProtectedRoute` for role-based access control, leveraging `UserRoleEnum` (e.g., ADMIN, CUSTOMER, AGENT, CSF, FRONTOFFICE, BACKOFFICE, SPR_CUSTOMER, ADMIN_V2) to restrict access to almost every route.
*   **Development Notes:** There are commented-out routes (e.g., an alternative login, an older booking form) and a `console.log` for "TEST on Flow", suggesting active development and iteration. The presence of "Extend" suffixes (e.g., `AgentBookingFormScreenExtend`, `BookingDashbaordScreenExtend`) implies ongoing enhancements or refactoring of existing features.

**c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\components\screen\analytics\MetricsBox.jsx**
(Timestamp: 11/21/2025, 11:36:28 AM)
This file defines the `MetricsBox` component, responsible for displaying various types of analytical charts within the application. Key updates and features include:
*   **Dynamic Chart Rendering:** It dynamically renders `PieChart`, `BarChart`, `LineChart`, `StackedBarChart`, and `GaugeChart` components based on the `item.chartType` prop and a `chartView` state (e.g., `General` charts can be bar, pie, or line; `StackBar` uses `StackedBarChart`; `Count` uses `GaugeChart`).
*   **State Management:** Utilizes `useState` for managing the current `chartView` (e.g., 'bar', 'pie') and the `enlarge` state for a full-screen modal view of charts. It also uses `useSelector` from `react-redux` to access analytics state.
*   **Toolbar and Footer:** Integrates `MetricToolbar` for chart options and `MetricFooter` for actions like enlarging the chart.
*   **Full-Screen View:** Implements a full-screen chart display using a `ThemedModal` component, which includes logic (`genHeight`) to adjust chart height dynamically for better visualization in full-screen mode.
*   **Data Handling:** Checks if `item.data` is available and not empty; otherwise, it displays a `NoDataAvailable` component.
*   **Debugging:** Contains `console.log` statements for debugging purposes ("==data==jjj" and "===item===1234556").

**Patterns and Recurring Elements:**
*   **Modular Architecture:** The application demonstrates a highly modular architecture, with a dedicated component or screen for almost every distinct feature.
*   **Role-Based Access Control:** A consistent pattern of using `ProtectedRoute` and `UserRoleEnum` ensures granular access control across numerous application functionalities.
*   **CRUD-like Structure:** Many routes follow a pattern like `/<feature>` for listing and `/<feature>/form` for creation/editing, suggesting typical Create, Read, Update, Delete operations for various entities.
*   **Focus on Logistics and Analytics:** The extensive list of routes and the detailed analytics component indicate a strong emphasis on managing logistics operations and providing insightful data visualization.

## 3:06:52 PM
The `usercard.tsx` file, updated on 11/21/2025, 10:15:47 AM, primarily focuses on user display and logout functionality. The `handleLogout` function was significantly refactored. For Auth0 users, the previous logic involved a `setTimeout` before clearing local storage and redirecting to a `/logout` endpoint. The updated logic now clears `token` and `user` from local storage *before* dispatching a logout action and redirecting the user to the `VITE_UI_V1_BASE_URL/login` endpoint. For non-Auth0 users, the logout process remains largely the same: clearing local storage, dispatching a logout action, and navigating to the root (`/`). The component also uses `useFetchUserPreferenceQuery` to display user details (first name, last name, role), prioritizing fetched data over local storage. A `getInitials` utility function is included for avatar generation.

The `layout.tsx` file, updated shortly after on 11/21/2025, 10:20:01 AM, handles the overall application layout, user session validation, and customer selection logic. A new `isTokenExpired` function was introduced to check for the presence of `localUser` and `localToken`, and to verify if the token's expiration timestamp (`localUser.exp`) has passed. Upon component mount, a `useEffect` hook uses this function to determine if the user's session is valid. If expired, it clears `user` and `token` from `localStorage` and redirects the user to the root path (`/`); otherwise, it dispatches `initializeSelectedCustomer`. Another `useEffect` hook manages the `selectedCustomer` state based on the user's role: "CUSTOMER" users automatically have their `companyname` set as the `selectedCustomer`, while "ADMIN_V2" users have `selectedCustomer` cleared, removing any customer filter. The UI conditionally renders the main application `Outlet` only when a `selectedCustomer` is present; if no customer is selected and the user is an "ADMIN_V2", an informational message "Please select a customer." is displayed.

**Patterns and Recurring Elements:**
Both files heavily utilize `localStorage` for session management, storing and retrieving `user` and `token` information. `react-redux` is used in both for state dispatching (`dispatch`) and selection (`useSelector`), indicating a shared global state management approach. Similarly, `react-router-dom` is leveraged for navigation (`useNavigate`) and rendering child routes (`Outlet`). Both components perform checks related to user authentication or session validity, highlighting a centralized effort to secure the frontend. The close timestamps suggest these changes were part of a related update to core frontend functionalities, possibly enhancing authentication flow and user experience.

## 3:06:53 PM
The `c:\Users\ridap\OneDrive\Documents\T360_Api\t360-backend\src\controllers\company_details.controller.ts` file, specifically the `getAll` function, underwent two related updates. At 11/21/2025, 10:07:54 AM, significant changes were introduced to handle company data retrieval based on user roles (`AGENT` or `CUSTOMER`). For `AGENT`s, it queries `cname` from `agent_po_account_master` with a search filter. For `CUSTOMER`s, a more complex logic was implemented to fetch `account_name` from `mtr_tracking_data`, supporting both paginated and non-paginated requests. The paginated approach includes a count query to determine the total number of records, followed by a data query with `LIMIT` and `OFFSET`. This version also included `console.log` statements for debugging the pagination results. A subsequent update at 11/21/2025, 10:08:08 AM, refined this by removing the previously added `console.log` statements, suggesting a cleanup after testing the pagination implementation for `CUSTOMER`s. Both versions consistently use `logger.info` and `logger.error` for internal logging.

The `c:\Users\ridap\OneDrive\Documents\T360_Api\t360-backend\src\routes\otm_bol.route.ts` file, updated at 11/21/2025, 11:40:37 AM, defines various API endpoints related to OTM (Oracle Transportation Management) Bill of Lading. Key routes include:
*   GET endpoints for fetching Excel data, BOL details, payload information, and specific BOLs by number (`:bol`) or common key (`:common_key`).
*   POST endpoints for editing OTM BOLs, handling upload saves/edits, generating XML data, and sending data to OTM.
Notably, a previous `/upload` POST route that utilized `uploadMiddleware` for handling `plFile` and `dutyFile` uploads was commented out, indicating a potential change in the file upload process or its temporary deactivation.

Overall, the changes from 11/21/2025 demonstrate active development in the `t360-backend` project, focusing on both refining data retrieval logic (pagination, role-based access) in controllers and adjusting API route definitions, possibly including changes to file upload mechanisms. Both logs show a pattern of using `logger` for information and error reporting and standard database query interactions.

## 3:06:58 PM
The provided log details changes across two frontend files around November 21, 2025.

**File-Specific Updates:**

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\App.js` (Timestamp: 11/21/2025, 11:31:13 AM and 11/21/2025, 11:34:00 AM):**
    This file, the main application entry point, defines the comprehensive routing structure for the `t360-frontend` application. It imports a vast array of screen and form components, indicating a large application with many distinct functional areas. The routes are extensively protected using `ProtectedRoute` and `AuthGuard`, with access controlled by various `UserRoleEnum` values such as ADMIN, CUSTOMER, AGENT, CSF, FRONTOFFICE, BACKOFFICE, SPR_CUSTOMER, and ADMIN_V2. Key application sections routed include:
    *   Authentication and User Management (`/`, `/register_user`, `admin_master/user_management`, `admin_master/registered_users`)
    *   Dashboard and Tracking (`/app`, `shipment_tracking`, `dashboard_7501`, `tracking/fcl`, `tracking/lcl`, `tracking/rail`, `tracking/air`)
    *   Booking and ISF (`booking`, `booking/form`, `booking/isf_form`, `booking/hbl_form`, `isf_dashboard`)
    *   SPR-related features (Packing List, Service Invoice, Expense Code, Destination, Vendor, PO Orders, DSO Orders, OTM BOL, SPR Dashboard, SPR Invoice)
    *   Code Management (Customer, Party, Agent, City Master, Portmaster)
    *   Planboard (Booking Planboard, SPR Planboard)
    *   Detention Management (LineWise, CustomerWise)
    *   Commercial and CNG Invoicing (`commercial_invoice`, `cng_invoice`)
    *   Agent PO (`agent_po`)
    *   ALC (AlcScreen, SprAlcScreen, AlcGenerated, AlcExceptionDashboard, AlcDestinationCostRecord)
    *   Reporting (`report`, `report/scheduler`, `new_report`, `edit_report`)
    *   General Settings (`settings`)
    *   Utility screens like `PdfParserScreen` and `BackOfficeAdminTerminal`.
    The content is identical between the two timestamps, suggesting either a rapid series of saves without functional changes or an update that was not reflected in the provided log comparison, primarily reinforcing the current extensive routing configuration. A commented-out route for `Auth0Login` suggests an alternative or legacy authentication flow.

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\components\screen\analytics\MetricsBox.jsx` (Timestamp: 11/21/2025, 11:36:28 AM):**
    This file defines the `MetricsBox` React component, which is responsible for rendering and managing various analytics charts. It imports multiple chart types (PieChart, BarChart, LineChart, StackedBarChart, GaugeChart) and includes components for a toolbar (`MetricToolbar`), footer (`MetricFooter`), and a modal for full-screen viewing (`ThemedModal`). The component dynamically determines which chart to display based on `item.chartType` and `chartView` state, defaulting to 'bar' for 'General' type charts, 'stack' for 'StackBar', and 'gauge' for 'Count'. It also handles cases where no data is available and integrates with Redux (`useSelector`) to access analytics state.

**Timestamps of Significant Changes:**

All changes occurred on **November 21, 2025**, indicating a focused development period on that date.
*   The `App.js` file was observed at 11:31:13 AM and 11:34:00 AM, capturing its extensive routing configuration.
*   The `MetricsBox.jsx` file was updated shortly after at 11:36:28 AM, reflecting work on the analytics display component.

**Patterns or Recurring Elements:**

*   **Modular Architecture:** The application exhibits a strong modular structure, with pages and components grouped into distinct functional directories (e.g., `pages/users`, `pages/packing-list`, `pages/tracking`, `components/screen/analytics`).
*   **Role-Based Access Control:** A prevalent pattern across `App.js` is the consistent use of `ProtectedRoute` with explicit `allowedRoles` for nearly every route, indicating a robust and granular security model based on user roles.
*   **Comprehensive Feature Set:** The sheer number of routes and imported screens in `App.js` suggests a very large and feature-rich application, covering a wide range of logistics and administrative functions (packing lists, service invoices, booking, tracking, detention, analytics, user management, etc.).
*   **Analytics Components:** The `MetricsBox.jsx` file demonstrates a pattern of abstracting chart rendering and interactivity into a reusable component, supporting multiple chart types, view modes, and data handling (e.g., no data available, full-screen view).
*   **Theme Integration:** The `App.js` file uses `ThemeProvider` and `mainTheme` from `./config/theme`, indicating a consistent theming approach across the application.
*   **State Management:** The use of `react-redux` (`useSelector`) in `MetricsBox.jsx` points to Redux being the chosen state management solution for complex application states, particularly in the analytics section.

## 4:06:55 PM
The `usercard.tsx` file, updated on 11/21/2025, 10:15:47 AM, primarily refactors the `handleLogout` function. The previous implementation had different logic for clearing local storage and dispatching a logout action depending on whether the authentication type was "auth0" or not, with some operations happening after redirects. The updated `handleLogout` now consistently clears `token` and `user` from `localStorage`, and dispatches the `auth/logout` action **before** any redirects or navigations. Specifically for Auth0, the redirect URL has changed from a `/logout` endpoint to a `/login` endpoint on the `VITE_UI_V1_BASE_URL`. The component also displays user information like first name, last name, and role, pulling data from both a user preference query and local storage.

The `layout.tsx` file, updated shortly after on 11/21/2025, 10:20:01 AM, introduces robust authentication and customer management logic. It includes an `isTokenExpired` function that checks the expiration time stored in the local `user` object against the current time. An `useEffect` hook leverages this to automatically remove expired tokens and user data from `localStorage` and navigate the user to the root path (`/`). Another `useEffect` dynamically manages the `selectedCustomer` state based on the logged-in `localUser`'s role: if the user is a "CUSTOMER", their company name is set as the `selectedCustomer`; if the user is "ADMIN_V2", the `selectedCustomer` is cleared. The component conditionally renders the main application `Outlet` only if a `selectedCustomer` is present, otherwise, it displays an informational message for `ADMIN_V2` users prompting them to select a customer.

**Patterns and Recurring Elements:**

*   **Local Storage Interaction:** Both files extensively interact with `localStorage` to retrieve and remove user data, tokens, and authentication types, indicating a reliance on client-side storage for session management.
*   **Redux for State Management:** Both components utilize `react-redux` (`useDispatch`, `useSelector`) to manage application state, specifically for authentication (`auth/logout`) and global settings like `selectedCustomer`.
*   **React Router for Navigation:** `useNavigate` from `react-router-dom` is consistently used across both files for programmatic navigation within the application.
*   **Role-Based Logic:** User roles (`CUSTOMER`, `ADMIN_V2`) are central to the logic in both files, dictating logout behavior, customer selection, and UI rendering.
*   **Closely Timed Updates:** The timestamps for both files are very close (within 5 minutes on the same day), suggesting that these changes were part of a single, coordinated development effort to enhance user experience and authentication flow.