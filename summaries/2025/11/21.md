# Activity Summary for 11/21/2025

## 10:54:32 AM
The file `c:\Users\ridap\OneDrive\Documents\T360_Api\t360-backend\src\controllers\company_details.controller.ts` was updated twice in quick succession on 11/21/2025.

**Key Changes:**
*   Between 10:07:54 AM and 10:08:08 AM, two `console.log` statements were removed from the `getAll` function.
*   These removed statements were located within the `CUSTOMER` role logic, specifically when pagination (`isPagination`) is enabled:
    *   `console.log("====totalResult",totalResult)`
    *   `console.log("====result",result)`
*   A third `console.log("====total",total)` statement in the same block remains present in both versions.

**File-specific Updates:**
The updates pertain solely to the `company_details.controller.ts` file, indicating a minor code refinement, likely a removal of debugging statements after testing the pagination logic for 'CUSTOMER' role.

**Timestamps of Significant Changes:**
The changes occurred very close together: 11/21/2025, 10:07:54 AM and 11/21/2025, 10:08:08 AM.

**Patterns or Recurring Elements:**
The primary pattern observed is the removal of debugging `console.log` statements, suggesting a quick cleanup after verifying functionality. The core business logic for fetching company names based on `AGENT` (from `agent_po_account_master` table) or `CUSTOMER` (from `mtr_tracking_data` table with pagination support) remains consistent across both timestamps. Both roles filter by a search query and map results to `{ value, label }` format.

## 10:57:15 AM
The file `c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\components\core\usercard.tsx` was updated on **11/21/2025, 10:15:47 AM**. The primary change involves a refactor of the `handleLogout` function. Previously, `localStorage` items were cleared after redirection for Auth0 users, or after navigation for normal users. The updated logic now clears `token` and `user` from `localStorage` *before* initiating the redirect for Auth0 users. Additionally, the Auth0 logout redirection target was changed from a `/logout` endpoint to a `/login` endpoint. For non-Auth0 users, the logout process remains similar: `token` and `user` are removed from `localStorage`, and the user is navigated to the root path. Both logout paths dispatch an `auth/logout` action. The component displays user's first name, last name, and role, pulling data from `useFetchUserPreferenceQuery` or `localStorage`, and uses `Dropdown` components for user interaction.

The file `c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\components\core\layout.tsx` was modified on **11/21/2025, 10:20:01 AM**. This update focuses on managing user authentication and customer selection. A new `isTokenExpired` function was introduced to validate `localUser` and `localToken` against an expiration timestamp. An `useEffect` hook now checks for token expiration on component mount; if expired, it clears `user` and `token` from `localStorage` and redirects to the root path. Otherwise, `initializeSelectedCustomer` is dispatched. Another `useEffect` manages the `selectedCustomer` state based on the user's role: "CUSTOMER" roles automatically have their `companyname` set as the `selectedCustomer` (and stored in `localStorage`), while "ADMIN_V2" roles have the `selectedCustomer` cleared from both Redux state and `localStorage`. The component conditionally renders an `Outlet` only when a `selectedCustomer` is present; if not and the user is an "ADMIN_V2", it displays a message prompting them to select a customer.

**Recurring Patterns:**
Across both files, there's a consistent reliance on `localStorage` for managing user authentication tokens, user details (like `firstname`, `lastname`, `role`), and application-specific states such as `selectedCustomer` and `authtype`. Both components extensively use `react-redux` for state management (`useDispatch`, `useSelector`) and `react-router-dom` for navigation (`useNavigate`, `Outlet`). User roles (e.g., "CUSTOMER", "ADMIN_V2") are a central theme, dictating access, data presentation, and application flow. There's also a clear pattern of clearing `localStorage` items related to user sessions (`token`, `user`) upon logout or session expiration.

## 12:59:39 PM
The `usercard.tsx` file, updated on 11/21/2025, 10:15:47 AM, primarily focuses on the user display and logout functionality. The most significant change is within the `handleLogout` function. Previously, the logic for clearing `localStorage` items (`token`, `user`) for Auth0 users occurred after a redirect, and for normal users, it happened after a `setTimeout`. The updated `handleLogout` now clears `token` and `user` from `localStorage` *before* the redirect for Auth0 users, and crucially, the Auth0 redirect URL has changed from `${link}/logout` to `${link}/login`. For normal users, the `localStorage` items are cleared immediately before navigating to the root path. Both logout paths dispatch an `auth/logout` action. The `localStorage.removeItem('authtype');` line remains commented out in both the old and new `handleLogout` implementations. The component renders user details (first name, last name, role) retrieved from either a `useFetchUserPreferenceQuery` or `localStorage`, and displays them within a dropdown alongside an avatar and a sign-out option.

The `layout.tsx` file, updated shortly after on 11/21/2025, 10:20:01 AM, manages the overall application layout and session control. It includes logic to check for token expiration: if the `user` or `token` is missing from `localStorage`, or if the token's expiration timestamp (`localUser.exp`) is in the past, it clears `localStorage` and redirects the user to the root path. Otherwise, it dispatches `initializeSelectedCustomer()`. A separate `useEffect` hook handles customer selection based on the user's role: "CUSTOMER" roles automatically set their company name as the `selectedCustomer` in both Redux state and `localStorage`, while "ADMIN_V2" roles clear any `selectedCustomer` data. The layout conditionally renders child routes (`<Outlet />`) only if a `selectedCustomer` is present; otherwise, for "ADMIN_V2" users, it displays a message prompting them to select a customer.

Common patterns across both files include:
*   Extensive use of `localStorage` for storing `user` information (including `firstname`, `lastname`, `role`, `companyname`, and `exp`) and `token`.
*   Integration with `react-redux` (`useDispatch`, `useSelector`) for global state management.
*   Navigation control using `react-router-dom` (`useNavigate`, `Outlet`).
*   The `localStorage.removeItem('authtype');` line being consistently commented out suggests this particular piece of logic is either deprecated or not currently in use.