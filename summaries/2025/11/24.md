# Activity Summary for 11/24/2025

## 9:15:44 AM
The provided code changes primarily involve frontend components related to user authentication, session management, and role-based access.

**File-specific Updates:**

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\components\core\usercard.tsx`** (Timestamp: 11/21/2025, 10:15:47 AM)
    *   The `handleLogout` function has been significantly refactored to modify the logout flow.
    *   For users authenticated via "auth0," `localStorage` items (`token` and `user`) are now explicitly removed *before* initiating the redirect. The redirect target has also changed from `VITE_UI_V1_BASE_URL/logout` to `VITE_UI_V1_BASE_URL/login`.
    *   For other authentication types, `localStorage` items are also cleared before dispatching the `auth/logout` action and navigating to the root (`/`).
    *   The component continues to display user information (name, role) from `user` data retrieved from `localStorage` or `useFetchUserPreferenceQuery`, and provides a "Sign out" dropdown item.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\components\core\layout.tsx`** (Timestamp: 11/21/2025, 10:20:01 AM)
    *   This layout component introduces robust session management and role-based content display.
    *   An `isTokenExpired` function was added to check the validity of the user's session based on `localUser` and `localToken` from `localStorage` and a timestamp (`exp`).
    *   Upon component mount, a `useEffect` hook checks for token expiration: if expired, it clears `user` and `token` from `localStorage` and redirects to the root (`/`); otherwise, it dispatches `initializeSelectedCustomer()`.
    *   Another `useEffect` hook manages the `selectedCustomer` state based on the user's role: "CUSTOMER" roles automatically set their company as the `selectedCustomer`, while "ADMIN_V2" roles clear any `selectedCustomer` filter. This state is synchronized with Redux and `localStorage`.
    *   The `Outlet` (main content) is only rendered if a `selectedCustomer` is present. "ADMIN_V2" users without a selected customer are shown a prompt to select one.

**Timestamps of Significant Changes:**
The two changes occurred in close succession on **11/21/2025** at **10:15:47 AM** and **10:20:01 AM**, suggesting a coordinated effort to update authentication and session handling logic across the frontend application.

**Patterns and Recurring Elements:**

*   **Reliance on `localStorage`:** Both files heavily utilize `localStorage` to store and retrieve user authentication tokens (`token`), user details (`user`), and authentication type (`authtype`). This is also central to clearing session data during logout or expiration.
*   **Redux for State Management:** `react-redux` (`useDispatch`, `useSelector`) is consistently used for managing global application state, specifically for handling logout actions (`auth/logout`) and customer selection (`setSelectedCustomer`, `initializeSelectedCustomer`).
*   **Role-based Logic:** The application implements different behaviors and UI elements based on the user's role (e.g., "CUSTOMER" vs. "ADMIN_V2"), particularly in how customer filters are applied and how content is displayed.
*   **Authentication and Session Control:** There's a strong focus on ensuring authenticated access and managing session validity, including token expiration checks and consistent logout procedures.
*   **Navigation:** `react-router-dom`'s `useNavigate` hook is used for programmatically redirecting users after logout or session expiration.