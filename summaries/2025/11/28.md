# Activity Summary for 11/28/2025

## 4:30:48 AM
The recent changes focus on refining the HBL (House Bill of Lading) creation and update functionality within the `t360-backend` application.

**File-Specific Updates:**

1.  **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-backend\src\controllers\hblEntry.controller.ts`**
    *   **11/26/2025, 12:21:43 PM - 12:30:44 PM:** The `createHblMasterBooking` function was primarily responsible for inserting a new HBL master record and its associated details (vessel, HBL-specific data, routing, containers, purchase orders) into various database tables (`hbl_master`, `agent_booking_vessel`, `agent_booking_hbl`, `agent_booking_routing`, `agent_booking_container`, `agent_booking_po`). It leveraged database transactions (BEGIN, COMMIT, ROLLBACK) for data integrity. A `saveHblBooking` function existed but its update logic was incomplete, mainly fetching data.
    *   **11/26/2025, 2:32:34 PM:** Minor adjustments were made to the `bookingInsertQuery` within `createHblMasterBooking` to explicitly include `bookingdate` and `transport_mode` fields.
    *   **11/26/2025, 4:41:31 PM - 6:04:47 PM:** An attempt was made to merge create and update logic into `createHblMasterBooking` by checking for `serial_id` (initially from `req.query`, then `req.body`). This interim state introduced a conditional flow where, if `serial_id` was present, it would try to update `hbl_master` and `agent_booking_vessel`, but incorrectly attempted to *insert* into other detail tables or had incorrect update conditions for `agent_booking_hbl`. This logic was inconsistent and likely buggy, leading to the next set of changes.
    *   **11/27/2025, 10:12:30 AM - 10:42:33 AM:** The problematic merged logic in `createHblMasterBooking` was removed, reverting it to solely handle the creation of new HBL records. The `saveHblBooking` function was commented out entirely, indicating a decision to separate creation and update operations.
    *   **11/27/2025, 10:54:16 AM:** A significant improvement was made to `createHblMasterBooking`. After inserting into `hbl_master`, the returned `serial_id` (aliased as `hbl_master_id`) is now correctly captured and used to link all subsequent related insertions (vessel, HBL details, routing, containers, POs) to this newly created master record. `booking_serial_id` was also introduced in `hbl_master` insert, retrieved from `agent_booking_entry` to link HBL to a main booking.
    *   **11/27/2025, 11:05:47 AM:** A new, dedicated function `updateHblMasterBooking` was introduced. This function explicitly handles updating an existing HBL record identified by `serial_id` (from `req.body`). It performs direct `UPDATE` queries for `hbl_master`, `agent_booking_vessel`, and `agent_booking_hbl`. For lists like `agent_booking_routing`, `agent_booking_container`, and `agent_booking_po`, it adopts a "delete all, then insert new" strategy to manage changes effectively.
    *   **11/27/2025, 11:24:27 AM - 3:11:54 PM:** Continued refinement, ensuring `hbl_master_id` is consistently passed and used for all associated sub-records during creation. The `hbldate` in `bookingInsertQuery` and `hblDeatailsCount` was made nullable.
    *   **11/27/2025, 3:24:58 PM - 3:30:57 PM:** A brief regression occurred where `hbldate` and `marks` were removed from `updateHblMasterBooking`'s update queries, but this was quickly rectified in the following commit, restoring the ability to update these fields.

2.  **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-backend\src\routes\hblEntry.route.ts`**
    *   **11/27/2025, 10:18:23 AM:** The route `router.post("/",saveHblBooking)` was commented out, aligning with the removal of the `saveHblBooking` function from the controller.
    *   **11/27/2025, 12:21:23 PM:** A new route `router.post("/update",updateHblMasterBooking)` was added, explicitly mapping to the newly introduced update controller function.

**Timestamps of Significant Changes:**

*   **11/26/2025, 4:41:31 PM:** Initial attempt to merge create/update logic in `createHblMasterBooking`.
*   **11/27/2025, 10:12:30 AM:** `createHblMasterBooking` reverts to create-only, `saveHblBooking` commented out.
*   **11/27/2025, 10:54:16 AM:** Correct `hbl_master_id` linking established in `createHblMasterBooking`.
*   **11/27/2025, 11:05:47 AM:** Introduction of `updateHblMasterBooking` for dedicated update logic.
*   **11/27/2025, 12:21:23 PM:** Corresponding `/update` route added for `updateHblMasterBooking`.
*   **11/27/2025, 3:30:57 PM:** Final correction to `updateHblMasterBooking` to correctly include `hbldate` and `marks` in update queries.

**Patterns and Recurring Elements:**

*   **Data Sanitization:** All incoming string payload fields are consistently sanitized using `sanitizeString()`.
*   **Date Formatting:** Dates are formatted to `YYYY-MM-DD` using `AppDateFormate()` before database insertion/update, often allowing `null` values.
*   **Database Transactions:** All major write operations (`createHblMasterBooking`, `updateHblMasterBooking`) are wrapped in `BEGIN`, `COMMIT`, and `ROLLBACK` for transactional integrity.
*   **Complex Data Structures:** HBLs are complex entities, reflected in the large `hblEntryPayloadTypes` object and the need to interact with multiple related database tables (master, vessel, HBL details, routing, containers, POs).
*   **List Management Strategy:** For child lists, the update strategy involves a complete replacement: `DELETE` all existing related records, then `INSERT MANY` the new list items from the request payload.
*   **Error Handling:** Robust error checking is in place after each database operation (`if (!rowCount) throw new HttpError(...)`) to catch failures and trigger transaction rollbacks.
*   **API Refactoring:** There's a clear evolution from a potentially merged/confused create/update function (`saveHblBooking`) towards distinct, clearer API endpoints and controller functions (`createHblMasterBooking` and `updateHblMasterBooking`) for better maintainability and clarity.

## 5:30:45 AM
The changes primarily focus on the `hblEntry.controller.ts` file, responsible for managing House Bill of Lading (HBL) entries, and its corresponding route definitions in `hblEntry.route.ts`. The significant changes occurred across November 26-27, 2025.

**File-Specific Updates:**

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-backend\src\controllers\hblEntry.controller.ts`**
    *   **November 26, 2025 (12:21 PM - 12:30 PM)**: Initial implementation and minor internal tweaks to `createHblMasterBooking` and `saveHblBooking`. `createHblMasterBooking` was designed for inserting new HBL records across several database tables (e.g., `hbl_master`, `agent_booking_vessel`, `agent_booking_hbl`, `agent_booking_routing`, `agent_booking_container`, `agent_booking_po`). `saveHblBooking` contained logic for fetching existing booking data, suggesting an update intent, though its implementation was incomplete or problematic.
    *   **November 26, 2025 (2:32 PM)**: The `bookingdate` field was uncommented and `transport_mode` was added to the `bookingInsertQuery` in `createHblMasterBooking`.
    *   **November 26, 2025 (4:41 PM - 6:04 PM)**: Multiple changes experimented with combining create and update logic within `createHblMasterBooking` by checking for a `serial_id` from either `req.query` or `req.body`. This resulted in confused logic where updates were attempted, but often followed by re-insertions into sub-tables, indicating an unstable implementation of the update flow.
    *   **November 27, 2025 (10:12 AM - 10:18 AM)**: The `if (serial_id)` and `else` blocks in `createHblMasterBooking` were removed, effectively reverting `createHblMasterBooking` to solely handle creation (insert operations). Crucially, the `saveHblBooking` function was entirely commented out, signifying a redesign of the update process.
    *   **November 27, 2025 (10:54 AM - 11:05 AM)**: `createHblMasterBooking` was refined to correctly retrieve the `serial_id` generated by the `hbl_master` insertion and use this `hbl_master_id` to link all related records (vessel, HBL details, routing, containers, POs), ensuring data integrity.
    *   **November 27, 2025 (11:24 AM)**: A query to find `booking_serial_id` from `agent_booking_entry` was added to `createHblMasterBooking`, and `hbl_master_id` linking was expanded to `agent_booking_routing`, `agent_booking_container`, and `agent_booking_po` during creation.
    *   **November 27, 2025 (12:19 PM)**: A new, dedicated `updateHblMasterBooking` function was introduced. This function takes `serial_id` from `req.body` to identify the HBL record. It performs direct `UPDATE` queries for `hbl_master`, `agent_booking_vessel`, and `agent_booking_hbl`. For associated lists (routing, containers, POs), it implements a "delete and insert" pattern: existing records linked to the `hbl_master_id` are deleted, and new ones from the request payload are inserted.
    *   **November 27, 2025 (12:22 PM - 12:26 PM)**: Minor corrections were made to the `updateHblMasterBooking` SQL update statements, specifically re-adding and ensuring correct parameter mapping for fields like `hbldate` and `marks`.
    *   **November 27, 2025 (3:12 PM)**: Defaulting for `bookingdate` and `hbldate` in the payload construction and database inserts was improved to explicitly allow `null` values instead of `'null'` strings.

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-backend\src\routes\hblEntry.route.ts`**
    *   **November 26, 2025 (2:49 PM)**: Initial routes were defined for `POST /` (for `saveHblBooking`), `GET /` (for `fetchHblFormDetails`), `GET /get-hbl`, and `POST /create` (for `createHblMasterBooking`).
    *   **November 27, 2025 (10:18 AM)**: The `router.post("/",saveHblBooking);` route was commented out, and `saveHblBooking` was removed from the imports.
    *   **November 27, 2025 (12:21 PM)**: `updateHblMasterBooking` was imported, and a new route `router.post("/update",updateHblMasterBooking);` was added.

**Patterns and Recurring Elements:**

*   **Data Sanitization**: The `sanitizeString` utility is consistently applied to almost all string-based fields from the request body to prevent potential security vulnerabilities.
*   **Date Formatting**: The `AppDateFormate` utility is uniformly used to convert date strings from the request body into a `YYYY-MM-DD` database format, with explicit handling for `null` values.
*   **Database Transactions**: All significant database operations within both `createHblMasterBooking` and `updateHblMasterBooking` are wrapped in explicit SQL transactions (`BEGIN`, `COMMIT`, `ROLLBACK`) to ensure data consistency and atomicity.
*   **Error Handling**: A custom `HttpError` is consistently used to signal specific issues (e.g., "Unable to save HBL.") during database operations, facilitating structured error responses.
*   **Multi-Table Persistence**: Both creation and update of HBL records involve interacting with a core `hbl_master` table and several associated detail tables (`agent_booking_vessel`, `agent_booking_hbl`, `agent_booking_routing`, `agent_booking_container`, `agent_booking_po`), reflecting a normalized database schema.
*   **Update Strategy for Lists**: For one-to-many relationship lists (routing, containers, basic POs), the common update pattern is to delete all existing child records for a given `hbl_master_id` and then insert all the new child records provided in the request payload.

## 9:08:13 AM
The provided log details changes primarily focused on the "House Bill of Lading" (HBL) functionality within a frontend application, specifically concerning booking and HBL management.

### File-Specific Updates:

**`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\store\api\agentBookingApi.js`**
*   **11/26/2025, 2:53:21 PM**: This file, responsible for Redux Toolkit Query API definitions related to agent bookings, saw significant expansion. New endpoints for HBL management were added: `saveHblBooking` (POST to `/hblEntry/create`) and `fetchHblBookingFormDetails` (GET to `/hblEntry`). It also included `getHblDashboard` (GET to `/hblEntry/get-hbl`). Existing endpoints for booking, ISF, and customer approval were also present, indicating a comprehensive API for booking-related operations.
*   **11/26/2025, 5:48:11 PM**: The `saveHblBooking` mutation's URL was changed from `/hblEntry/create` to `/hblEntry`, suggesting a potential simplification or consolidation of the HBL creation endpoint.
*   **11/27/2025, 10:17:24 AM**: The `saveHblBooking` mutation's URL was reverted back to `/hblEntry/create`.
*   **11/27/2025, 2:40:18 PM**: A new mutation `updateHblBooking` was added, pointing to `/hblEntry/update`, expanding the HBL API to support updates. The exported hooks were also updated to include `useUpdateHblBookingMutation`.

**`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\components\screen\booking\hbl\HBLListDetails.jsx`**
*   **11/26/2025, 2:57:40 PM**: Introduced the `HblListDetails` component, likely a dashboard or list view for HBLs. It imports `useGetHblDashboardQuery` to fetch data and `HBL_COLUMNS` for grid definitions. It includes an "Add HBL" button that navigates to `/app/booking/hbl_form`. The component initially used `isfDummyData`.
*   **11/26/2025, 2:58:49 PM**: The `ThemedGrid` component was updated to use `hblData?.data` instead of `isfDummyData` and changed the `uniqueId` prop from `agent_booking_id` to `serial_id`. This indicates the integration of live HBL data from the API.
*   **11/26/2025, 6:03:04 PM**: The `useGetHblDashboardQuery` hook was updated to accept `agent_booking_id` from the `location.state`, enabling filtering of HBLs specific to a particular booking.
*   **11/27/2025, 10:25:36 AM**: Added `console.log("dat=====location====", location);` for debugging purposes.
*   **11/27/2025, 2:56:44 PM**: The navigation state for "Add HBL" button was updated to explicitly pass `agent_booking_id` from `location.state`, ensuring consistency when creating new HBLs linked to an existing booking.

**`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\data\columns\agent.booking.js`**
*   **11/26/2025, 3:01:38 PM**: The file defines column configurations for various booking-related grids, including `BOOKING_VESSEL_COLUMN`, `BOOKING_CARGO_COLUMN`, and `BOOKING_DASHBOARD_COLUMNS_GRID`. The `renderCell` functions frequently use `appDateFormat` for date formatting and `Chip` components for status display.
*   **11/27/2025, 11:03:09 AM**: No functional changes were observed, indicating consistent column definitions for booking-related displays.

**`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\components\screen\booking\actions.js`**
*   **11/26/2025, 3:13:47 PM**: This file defines various actions (Edit, Copy, View) for booking, ISF, and HBL entities, dynamically generated based on user access roles (agent, customer, admin). It introduced `getHblActions` to specifically handle HBL-related actions, initially containing only an "Edit HBL" action which navigates to `/app/booking/hbl_form`.
*   **11/26/2025, 5:33:49 PM**: The `getHblActions` function was updated to pass `agent_booking_id` in the navigation state for "Edit HBL".
*   **11/26/2025, 5:35:42 PM**: The `getHblActions` function's "Edit HBL" navigation state was further refined to include `serial_id` alongside `agent_booking_id`. This implies that HBLs are uniquely identified by `serial_id`.

**`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\components\screen\booking\hbl\HBLform.jsx`**
*   **11/26/2025, 5:55:57 PM**: This is the initial creation of the `HBLForm` component. It uses Formik for form management, Redux for state, and several internal components (`HblHeaderForms`, `HblContainerDetailsForm`, `HblRoutingForm`, `BasicPoForm`, party-related forms). It handles saving HBL data via `useSaveHblBookingMutation` and includes logic to process form values, especially parsing "name~code" strings for various parties and locations. It also incorporates keyboard shortcuts for common actions. Navigation after a successful save directs to `/app/booking`.
*   **11/26/2025, 6:11:50 PM**: Added `serial_id:location.state?.serial_id || "",` to the payload for `handleSave`, indicating that `serial_id` is now part of the HBL data being submitted.
*   **11/27/2025, 10:20:17 AM**: Modified the success navigation path from `/app/booking` to `/app/booking/hbl_form_screen` and removed `agent_booking_id` from the state object on success, which was likely a bug or an interim change.
*   **11/27/2025, 10:23:28 AM**: Re-added `agent_booking_id` to the success navigation state, drawing it from `resp.data.agent_booking_id`.
*   **11/27/2025, 10:29:45 AM**: Changed how `agent_booking_id` is determined in the success navigation, prioritizing `location.state.booking_id` if available, otherwise falling back to `resp.data.agent_booking_id`. This ensures the correct booking context is maintained after an HBL save.
*   **11/27/2025, 10:58:43 AM**: Commented out `serial_id:location.state?.serial_id || "",` from the payload, suggesting that `serial_id` might be passed differently or not directly in the payload for certain operations.
*   **11/27/2025, 10:59:07 AM**: Commented out both `booking_serial_id` and `serial_id` from the payload, implying these might be derived or passed via other means in the API calls. Also removed `agent_booking_id` from the payload for the save, which might be an oversight if it's needed for linking.
*   **11/27/2025, 2:44:36 PM**: Integrated `useUpdateHblBookingMutation` and implemented conditional logic within `handleSave` to call either `updateHblBooking` (if `formAction` is "edit" and `serial_id` exists in `location.state`) or `saveBooking`. This is a crucial change for enabling HBL editing. The payload for `saveBooking` was incorrectly left as an empty call (should have been `saveBooking(payload)`).
*   **11/27/2025, 2:44:56 PM**: Corrected the call to `saveBooking` to `saveBooking(payload)` when not in "edit" mode.
*   **11/27/2025, 2:52:40 PM**: Refined the `handleSave` logic:
    *   Explicitly defined `agent_booking_id` for the success navigation state, prioritizing `location.state.agent_booking_id` (if available from parent) or `resp?.data?.agent_booking_id`.
    *   Added error handling to explicitly check for a missing `agent_booking_id` after save.
    *   The `agent_booking_id` for the *payload* was also refined, using `location.state.agent_booking_id` primarily, but `booking_serial_id` was still commented out.
*   **11/27/2025, 2:56:53 PM**: In the `handleSave` function, the payload's `agent_booking_id` was again set, this time using `location.state.agent_booking_id || ""`, which is more consistent with how it's handled in the success navigation.
*   **11/27/2025, 3:26:27 PM**: Changed initial values for `hbldate` and `bookingdate` to `null` if undefined, instead of an empty string, likely for date picker compatibility.
*   **11/27/2025, 3:30:00 PM**: Adjusted how `agent_booking_id` is set in the payload during `handleSave`, now checking `location.state.booking_id || location.state.agent_booking_id || ""` to ensure the correct ID is passed for association.
*   **11/27/2025, 3:33:27 PM**: Reverted `agent_booking_id` logic in `handleSave` payload to `location.state.booking_id || ""` and updated success navigation to `location.state.agent_booking_id || resp.data.agent_booking_id`. This indicates an ongoing refinement of how booking IDs are passed between components and API calls.
*   **11/27/2025, 3:49:59 PM**: In `handleSave`, the `saveBooking` mutation for "add" now explicitly passes the payload including `agent_booking_id` from `location.state`. This fixes a previous potential issue where `agent_booking_id` was not being correctly associated with new HBLs.

**`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\pages\booking\HblEntry.jsx`**
*   **11/27/2025, 12:05:38 PM**: This file imports and uses `HblEntryForm` (which is likely `HBLform` renamed or an alias). It fetches HBL details using `useFetchHblBookingFormDetailsQuery` based on `agent_booking_id` from `useLocation` state. It also includes `useEffect` hooks to initialize Redux lists (`containerList`, `routingList`) and reset state on unmount.
*   **11/27/2025, 12:07:36 PM**: No functional changes were observed.

**`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\components\screen\booking\hbl\HblEntryFormScreen.jsx`**
*   **11/27/2025, 12:07:51 PM**: This new component acts as a wrapper for `HBLForm`, handling the data fetching for HBL details based on `agent_booking_id` from `location.state`. It also manages modals for adding/viewing parties and error popups. It dispatches actions (`initializeLists`, `resetHblEntryForm`) to Redux store. There was a commented-out section for a `hblDetails` query, followed by an active one.
*   **11/27/2025, 12:08:00 PM**: No functional changes were observed.
*   **11/27/2025, 12:08:31 PM**: The `useFetchHblBookingFormDetailsQuery` was updated to fetch HBL details using `serial_id` instead of `agent_booking_id` when `state` is present, suggesting a shift to using `serial_id` as the primary identifier for fetching HBL forms.
*   **11/27/2025, 12:08:43 PM**: Corrected the variable name for fetched HBL data from `hblBbookingDetails` to `hblDetails`.
*   **11/27/2025, 3:11:16 PM**: The query for `useFetchHblBookingFormDetailsQuery` was changed back to use `state.booking_serial_id` when `isEdit` is true, but then immediately reverted this change in the next log entry. This indicates some back-and-forth or experimentation with the key used for fetching HBL details.
*   **11/27/2025, 3:12:29 PM**: The query for `useFetchHblBookingFormDetailsQuery` was changed back to use `state.serial_id` when `isEdit` is true. This confirms `serial_id` is the intended primary key for editing existing HBLs.
*   **11/27/2025, 3:20:00 PM**: The `useFetchHblBookingFormDetailsQuery` was further refined to explicitly check `isEdit && state?.serial_id` before attempting to fetch, ensuring the query is only made when an HBL is being edited.

### Timestamps of Significant Changes:

*   **11/26/2025, 2:53:21 PM**: Initial major update to `agentBookingApi.js` for HBL functionality.
*   **11/26/2025, 2:57:40 PM**: Introduction of `HBLListDetails.jsx`.
*   **11/26/2025, 2:58:49 PM**: `HBLListDetails.jsx` started using live HBL data.
*   **11/26/2025, 3:13:47 PM**: `actions.js` updated to include HBL-specific actions.
*   **11/26/2025, 5:55:57 PM**: Initial creation of `HBLform.jsx`, a core component for HBL entry.
*   **11/27/2025, 10:59:07 AM**: Significant changes in `HBLform.jsx` regarding payload structure.
*   **11/27/2025, 12:07:51 PM**: Introduction of `HblEntryFormScreen.jsx` to wrap `HBLForm` with data fetching and modal logic.
*   **11/27/2025, 2:40:18 PM**: `agentBookingApi.js` updated to include `updateHblBooking` mutation, enabling editing of HBLs.
*   **11/27/2025, 2:44:36 PM** and **2:44:56 PM**: `HBLform.jsx` integrated the `updateHblBooking` mutation, distinguishing between create and update operations.
*   **11/27/2025, 3:20:00 PM**: `HblEntryFormScreen.jsx` improved data fetching logic for HBL editing.
*   **11/27/2025, 3:49:59 PM**: Final refinement in `HBLform.jsx` for passing `agent_booking_id` during HBL creation.

### Patterns and Recurring Elements:

*   **HBL Feature Development**: The changes clearly indicate a concentrated effort to implement or refine the House Bill of Lading (HBL) feature, covering API endpoints, list views, and detailed forms.
*   **Redux Toolkit Query (RTK Query)**: All API interactions are handled using RTK Query (`createApi`, `fetchBaseQuery`, `builder.mutation`, `builder.query`, `invalidatesTags`, `providesTags`), demonstrating a consistent pattern for data fetching and state management in the frontend.
*   **`useLocation` for State Passing**: Navigation and data passing between components heavily rely on `useLocation().state`, especially for `agent_booking_id`, `serial_id`, and `formAction` (add/edit/copy). This pattern is used to maintain context across different screens.
*   **`formAction` Prop**: The `formAction` prop (values like "add", "edit", "copy") is a recurring pattern used to control the behavior and initial values of forms, like `HBLForm`.
*   **Data Transformation for Forms/APIs**: There's a consistent pattern of transforming data, especially for party and location fields (e.g., `recoverValue` function splitting "name~code" strings), before sending it to the API. Similarly, fetched data is transformed (`convertToArray`, remapping field names) for display in forms.
*   **Conditional Data Fetching with `skipToken`**: The `skipToken` from RTK Query is frequently used to prevent queries from firing when necessary parameters (like `agent_booking_id` or `serial_id`) are not yet available, optimizing network requests.
*   **Error Handling and User Feedback**: `toast` notifications and `setAlertConfig` for modal error messages are consistently used to provide user feedback on API call results.
*   **Keyboard Shortcuts**: The use of `useKeyboardShortcut` hook for actions like edit, view, add party, and save indicates an emphasis on improving user experience and efficiency.
*   **`serial_id` vs. `agent_booking_id`**: There's an evolving understanding and consistent refinement of whether `serial_id` or `agent_booking_id` is the primary identifier for HBL-related operations, particularly for fetching and updating HBL forms. `serial_id` seems to be becoming the specific identifier for an HBL record, while `agent_booking_id` links it to a broader booking context.
*   **Console Logging for Debugging**: Frequent `console.log` statements throughout the code changes suggest active debugging during development.

## 9:08:25 AM
The provided log details changes across two files related to HBL (House Bill of Lading) entry management.

**File: `c:\Users\ridap\OneDrive\Documents\T360_Api\t360-backend\src\controllers\hblEntry.controller.ts`**

This file, central to HBL booking logic, saw extensive and iterative development between November 26 and 27, 2025.
Initially, it contained two main asynchronous functions: `createHblMasterBooking` for creating new HBL entries and `saveHblBooking` which seemed intended for a combined create/update flow, often commented out or partially implemented.

Significant changes to `createHblMasterBooking` include:

*   **11/26/2025, 2:32:34 PM**: The `bookingInsertQuery` for `hbl_master` was updated to explicitly include `bookingdate` (previously commented out) and a new `transport_mode` field.
*   **11/26/2025, 2:49:21 PM - 11/26/2025, 6:04:47 PM**: This period shows a fluctuating attempt to incorporate update logic directly into `createHblMasterBooking` using a `req.query.serial_id` or `req.body.serial_id` condition. This conditional logic led to inconsistent behavior, sometimes attempting updates for `hbl_master` and `agent_booking_vessel` but still inserting into `agent_booking_hbl` and associated lists (routing, container, PO). The `serial_id` source also shifted between `req.query` and `req.body`.
*   **11/27/2025, 10:12:30 AM**: The attempt to merge update logic into `createHblMasterBooking` was abandoned, and the function was refactored to focus solely on **creating** new HBL master bookings. The `serial_id` extraction from `req.body` became redundant and was later removed from being used in the insert call.
*   **11/27/2025, 10:37:01 AM - 11/27/2025, 11:05:47 AM**: The creation flow was refined to correctly obtain the `hbl_master_id` from the initial `hbl_master` insertion result and use it to link all subsequent related entries (vessel, HBL details, routing, containers, POs) into their respective tables, ensuring proper foreign key relationships. A `SELECT` query was also introduced to find an existing `booking_serial_id` from `agent_booking_entry` before inserting into `hbl_master`.
*   **11/27/2025, 12:19:04 PM**: A new, dedicated function `updateHblMasterBooking` was introduced. This function robustly handles updates for HBL records by performing direct `UPDATE` SQL queries for `hbl_master`, `agent_booking_vessel`, and `agent_booking_hbl`. For linked data (routing, containers, POs), it implements a "delete and insert" strategy: existing records are first deleted, and then new records are inserted from the request payload. The previously problematic `saveHblBooking` function was removed.
*   **11/27/2025, 12:26:39 PM - 11/27/2025, 3:09:00 PM**: There was a brief change to reduce the fields updated in `hbl_master` and `agent_booking_hbl` during an update, which was then reverted to include more comprehensive field updates in the `updateHblMasterBooking` function.
*   **11/27/2025, 3:24:58 PM**: Date fields (`bookingdate`, `hbldate`) in `createHblMasterBooking` were made more robust by explicitly handling `null` values using `payload.field || null`.

**File: `c:\Users\ridap\OneDrive\Documents\T360_Api\t360-backend\src\routes\hblEntry.route.ts`**

This file defines the API endpoints for HBL operations.

*   **11/26/2025, 2:49:43 PM**: A new POST route `/create` was added, mapping to the `createHblMasterBooking` controller function.
*   **11/27/2025, 10:18:23 AM**: The original root POST route (`/`) associated with `saveHblBooking` was commented out, reflecting the consolidation of creation logic into `createHblMasterBooking`.
*   **11/27/2025, 12:21:23 PM**: A new POST route `/update` was added, mapping to the newly introduced `updateHblMasterBooking` controller function.

**Patterns and Recurring Elements:**

*   **Modular Database Interactions**: The code consistently uses `insertMany`, `insertQuery`, `query`, and `updateQuery` from a `database` configuration, indicating a structured approach to database operations.
*   **Transactional Integrity**: Both creation and update operations are wrapped in database transactions (`BEGIN`, `COMMIT`, `ROLLBACK`) to ensure data consistency across multiple table modifications.
*   **Input Sanitization**: Almost all incoming request body parameters are sanitized using `sanitizeString`, demonstrating a strong emphasis on security.
*   **Date Formatting**: Dates from the request body are consistently formatted to a `YYYY-MM-DD` database format using `AppDateFormate`.
*   **Clear Separation of Concerns**: Over time, the logic evolved from a mixed create/update function (`saveHblBooking` and early `createHblMasterBooking`) to distinct functions (`createHblMasterBooking` and `updateHblMasterBooking`), improving code organization and maintainability.
*   **Multi-Table Operations**: HBL data is stored across several related tables (`hbl_master`, `agent_booking_vessel`, `agent_booking_hbl`, `agent_booking_routing`, `agent_booking_container`, `agent_booking_po`), and both create and update functions manage these interconnected records.

## 10:11:50 AM
The code changes primarily revolve around implementing and refining House Bill of Lading (HBL) functionality within a booking system, likely an agent-facing frontend application. This includes API integrations, UI components, and data handling.

### File-Specific Updates:

**1. `c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\store\api\agentBookingApi.js`**

*   **11/26/2025, 2:53:21 PM**: Introduction of HBL-related API endpoints.
    *   `saveHblBooking`: A new `POST` mutation endpoint for creating HBLs, hitting `/hblEntry/create`.
    *   `fetchHblBookingFormDetails`: A new `GET` query endpoint for fetching HBL form details, hitting `/hblEntry`.
    *   `getHblDashboard`: A new `GET` query endpoint for fetching HBL dashboard data, hitting `/hblEntry/get-hbl`.
    *   The `agentBookingApi` also supports existing booking, ISF, carrier booking, and DO update functionalities.
*   **11/26/2025, 5:48:11 PM**: The `saveHblBooking` endpoint's URL was changed from `/hblEntry/create` to `/hblEntry`. This suggests a potential simplification or consolidation of the HBL creation API.
*   **11/27/2025, 10:17:24 AM**: Reverted the `saveHblBooking` URL back to `/hblEntry/create`. This indicates the `/create` suffix was indeed intended or required.
*   **11/27/2025, 2:40:18 PM & 2:41:28 PM**: Introduction of a new mutation endpoint `updateHblBooking` (POST to `/hblEntry/update`) to handle updates for HBLs. This suggests a clear separation between create and update operations for HBLs. The exported hooks were also updated to include `useUpdateHblBookingMutation`.

**2. `c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\components\screen\booking\hbl\HBLListDetails.jsx`**

*   **11/26/2025, 2:57:40 PM**: Initial creation of `HblListDetails` component.
    *   Imports `useGetHblDashboardQuery` for fetching HBL data and `HBL_COLUMNS` for grid definition.
    *   Includes an "Add HBL" button that navigates to `/app/booking/hbl_form` with `booking_serial_id`, `booking_id`, and `formAction: "add"` in the state.
    *   The `ThemedGrid` uses `isfDummyData` for display.
*   **11/26/2025, 2:58:49 PM**: Significant update to `HblListDetails`.
    *   The `ThemedGrid` now uses `hblData?.data` (fetched from `useGetHblDashboardQuery`) instead of `isfDummyData`.
    *   The `uniqueId` prop for `ThemedGrid` was changed from `agent_booking_id` to `serial_id`. This is crucial for correctly identifying rows in the HBL list.
*   **11/26/2025, 6:03:04 PM**: `useGetHblDashboardQuery` is updated to accept `agent_booking_id` from `location.state`, allowing the HBL list to display records specific to a particular booking.
*   **11/27/2025, 10:25:36 AM**: Added another `console.log` for `location`.
*   **11/27/2025, 2:56:44 PM**: The "Add HBL" button's `onClick` handler was updated to pass `agent_booking_id` from `location.state` when navigating to the HBL form, ensuring new HBLs are associated with the correct booking.

**3. `c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\data\columns\agent.booking.js`**

*   **11/26/2025, 3:01:38 PM & 11/26/2025, 3:10:12 PM**: No functional changes, identical content. This likely represents a re-save or formatting change. The file defines various column configurations for tables, including `BOOKING_VESSEL_COLUMN`, `BOOKING_CARGO_COLUMN`, and `BOOKING_DASHBOARD_COLUMNS_GRID`. The `HBL_COLUMNS` mentioned in `HBLListDetails.jsx` is implied to be defined within this file as well, though its specific content isn't fully logged.
*   **11/27/2025, 11:03:09 AM**: No functional changes, identical content.

**4. `c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\components\screen\booking\actions.js`**

*   **11/26/2025, 3:13:47 PM**: Introduction of `getHblActions` which defines an "Edit HBL" action. This action navigates to `/app/booking/hbl_form` with `agent_booking_id` and `formAction: "edit"`. Also, a new `createHblAction` is added to `getBookingActions` to navigate to `hbl_form_screen`.
*   **11/26/2025, 5:33:49 PM**: No functional change.
*   **11/26/2025, 5:35:42 PM**: The `getHblActions` for "Edit HBL" is updated to pass `serial_id` (from `params.row.serial_id`) instead of `agent_booking_id` to `/app/booking/hbl_form`. This implies that HBLs are uniquely identified by `serial_id` for editing. It also passes `agent_booking_id` along.

**5. `c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\components\screen\booking\hbl\HBLform.jsx`**

*   **11/26/2025, 5:55:57 PM**: Initial creation of `HBLForm` component.
    *   Uses `Formik` for form management and `useSaveHblBookingMutation` to save HBL data.
    *   Handles various HBL details (parties, routing, containers, POs).
    *   Initial values are populated from `initialValues` and `location.state`.
    *   The `handleSave` function constructs a payload and calls `saveBooking`.
    *   Includes party management actions (Edit, View, Add New Party) with keyboard shortcuts.
    *   Navigation after successful save points to `/app/booking`.
*   **11/26/2025, 6:11:50 PM**: The `serial_id` is now explicitly added to the payload for `saveBooking` if the `formAction` is "edit". This confirms that `serial_id` is crucial for distinguishing between new and existing HBLs.
*   **11/27/2025, 10:20:17 AM**: The success navigation after saving an HBL is changed from `/app/booking` to `/app/booking/hbl_form_screen`, retaining `agent_booking_id` and `formAction: "edit"`. This suggests a workflow where saving an HBL might lead back to its parent booking's HBL list/view.
*   **11/27/2025, 10:23:28 AM**: Removed `agent_booking_id` from the navigation state upon successful save, keeping only `formAction: "edit"`.
*   **11/27/2025, 10:29:45 AM**: Reintroduced `agent_booking_id` to the navigation state upon successful save, conditionally using `location.state.booking_id` or `resp.data.agent_booking_id`. This implies the need to persist the context of the parent booking.
*   **11/27/2025, 10:58:43 AM & 11:03:09 AM**: The `serial_id` is removed from the payload of `saveBooking` (commented out), suggesting that for `saveBooking` it is not needed as it's a creation endpoint. However, this is immediately followed by a change that re-adds it.
*   **11/27/2025, 10:59:07 AM**: `booking_serial_id` and `agent_booking_id` are removed from the payload for `saveBooking`, relying on the parent `agent_booking_id` from `location.state` only for navigation.
*   **11/27/2025, 2:44:36 PM, 2:44:56 PM, 2:52:40 PM, 2:54:59 PM, 2:56:53 PM, 3:26:27 PM, 3:30:00 PM, 3:33:27 PM, 3:35:15 PM, 3:49:59 PM**: These changes specifically address the logic within `handleSave` to differentiate between "add" and "edit" modes for HBLs using the `formAction` from `location.state`.
    *   It now conditionally calls `updateHblBooking` if `formAction` is "edit" (passing `serial_id` in the payload) or `saveHblBooking` otherwise.
    *   There's also logic to ensure the correct `agent_booking_id` is used for navigation after a successful save, preferring `location.state.agent_booking_id` if available, or `resp.data.agent_booking_id`.
    *   The `hbldate` and `bookingdate` initial values are explicitly set to `null` if undefined, rather than an empty string, suggesting a type consistency improvement for date fields.

**6. `c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\pages\booking\HblEntry.jsx`**

*   **11/27/2025, 12:05:38 PM & 12:07:36 PM**: This file imports `HblEntryForm` (which seems to be an alias for `HBLForm` based on other logs). It handles fetching HBL booking details and initializing Redux lists (`containerList`, `routingList`) for the form.
    *   The `useFetchHblBookingFormDetailsQuery` is called with `agent_booking_id` from `location.state`.
    *   It sets `formAction` based on `location.state` (copy/edit).
    *   There's a significant refactoring of how `containerList` items are mapped and added to the Redux store, including renaming `container_type` to `containerType`, `no_of_container` to `containerno`, etc.

**7. `c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\components\screen\booking\hbl\HblEntryFormScreen.jsx`**

*   **11/27/2025, 12:07:51 PM, 12:08:00 PM, 12:08:31 PM, 12:08:43 PM, 3:11:16 PM, 3:12:29 PM, 3:20:00 PM**: This component acts as a wrapper for `HBLForm`, handling initial data fetching for HBL details.
    *   Initially, `useFetchHblBookingFormDetailsQuery` was called with `agent_booking_id`.
    *   **11/27/2025, 12:08:31 PM**: This query parameter for `useFetchHblBookingFormDetailsQuery` was changed from `agent_booking_id` to `serial_id`, suggesting that HBL details are primarily fetched using their unique `serial_id`, not the parent booking ID. The previous variable `hblBbookingDetails` was also renamed to `hblDetails` for consistency.
    *   **11/27/2025, 3:20:00 PM**: The query is made conditional: `isEdit && state?.serial_id ? { serial_id: state.serial_id } : skipToken`. This ensures that data is only fetched for existing HBLs when in "edit" mode and a `serial_id` is available. For new HBLs (`formAction: "add"`), the query is skipped.
    *   It initializes Redux lists (`containers`, `routing`, `po`) based on the fetched `hblDetails`.
    *   Provides functionality for party management (Export, Import, Add, View).

### Patterns and Recurring Elements:

*   **Redux Toolkit Query (RTK Query)**: The application heavily uses RTK Query for API interactions, defining `createApi`, `mutation` and `query` endpoints, `reducerPath`, `baseQuery`, `tagTypes`, `providesTags`, and `invalidatesTags`. This indicates a well-structured and performant data fetching and caching layer.
*   **HBL Focus**: A significant portion of the changes revolves around the "House Bill of Lading" (HBL) feature, including its API, UI components (`HBLListDetails`, `HBLForm`), data structures, and actions.
*   **Form Management**: `Formik` is consistently used for handling form state, validation (`HBLvalidationSchema`), and submission.
*   **Routing and State Management**: `react-router-dom`'s `useLocation` and `useNavigate` hooks are frequently used to pass `state` between routes, especially for `formAction` (add, edit, copy), `agent_booking_id`, and `serial_id`.
*   **Data Transformation**: The `recoverValue` helper function is used to parse string values (e.g., "name~code") into their constituent parts, indicating a common pattern for handling combined ID/name inputs.
*   **UI Components**: Consistent use of `@mui/material` components (Box, Card, Stack, Typography, Button, Chip) and custom components like `ThemedGrid`, `ScreenToolbar`, `ThemedBreadcrumb`, `ThemedModal`, and `AddMasterForm`.
*   **Loading and Error Handling**: `isLoading` and `isFetching` flags from RTK Query are used to display a `Loader` component, and `alertConfig` state is used to display error messages for API failures.
*   **Access Control**: The `useAccess` hook suggests a role-based access control system influencing available actions and UI elements.
*   **Keyboard Shortcuts**: `useKeyboardShortcut` is used to enhance user experience by providing quick access to common actions within forms.
*   **Console Logging**: Numerous `console.log` statements are present throughout the code, indicating active development and debugging. These often display `params`, `values`, `payload`, `resp`, `hblData`, and `location.state`.

In summary, the changes show a robust development effort to integrate and enhance HBL management within the T360 booking application. This involves defining API endpoints, building UI for listing and editing HBLs, handling complex form states, and ensuring proper data flow and error handling. The frequent adjustments to `agent_booking_id` and `serial_id` in navigation and API calls highlight the ongoing refinement of how HBLs are linked and managed relative to their parent bookings.

## 2:57:32 PM
The following log details changes to a single file: `c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\components\screen\code\party\PartyForm.jsx`. All modifications occur within the `onSubmit` function, specifically targeting the post-submission logic when `formAction` is "add" and the `pathname` is `HBL_SCREEN`.

**File-Specific Updates:**

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\components\screen\code\party\PartyForm.jsx`**
    *   **Initial State (11/28/2025, 2:05:41 PM):** The `onSubmit` success block for `HBL_SCREEN` (when `formAction === "add"`) included calls to `setPartyPageModal` to close a modal and `partyDispatch(setCreatedPartyData)` to update the Redux store with the newly created party's data. This was consistent with the logic for `ISF_SCREEN`.
    *   **First Change (11/28/2025, 2:07:11 PM):** The logic for `HBL_SCREEN` (`formAction === "add"`) was altered to remove the `setPartyPageModal` and `partyDispatch` calls, replacing them with a simple `toast.success("Party Saved Successfully")` message.
    *   **Second Change (11/28/2025, 2:08:11 PM):** The previous changes were largely reverted. The `setPartyPageModal` and `partyDispatch` calls were re-introduced for `HBL_SCREEN` (`formAction === "add"`). Additionally, `onCloseForBooking()` was added, and the `toast.success` message was removed.
    *   **Final Change (11/28/2025, 2:08:52 PM):** The `onCloseForBooking()` call, which was added in the immediate previous commit, was removed from the `HBL_SCREEN` (`formAction === "add"`) block. The state of this specific code block returned to its initial configuration from the 2:05:41 PM timestamp, including `setPartyPageModal` and `partyDispatch(setCreatedPartyData)`.

**Timestamps of Significant Changes:**

*   **11/28/2025, 2:07:11 PM:** Introduction of a change that removed state management and dispatch calls, simplifying the success handling to just a toast message.
*   **11/28/2025, 2:08:11 PM:** Reversal of the previous change, bringing back state management and dispatch, and introducing `onCloseForBooking()`.
*   **11/28/2025, 2:08:52 PM:** A minor adjustment by removing `onCloseForBooking()`, effectively reverting the `HBL_SCREEN` "add" action success handling to its original implementation.

**Patterns or Recurring Elements:**

The changes demonstrate a rapid iteration and refinement process within a short timeframe (approximately 3 minutes). The focus was solely on the post-submission success handling for adding a new party from the `HBL_SCREEN`. There's a pattern of code being added, then removed, and then re-added (or slightly modified) in consecutive commits, indicating an active attempt to find the correct flow for this specific use case, ultimately returning to the initial implementation.

## 3:57:34 PM
The log details a concentrated set of changes primarily impacting the HBL (House Bill of Lading) entry functionality, focusing on both the data processing logic in the controller and the API routing. All significant updates occurred on **November 28, 2025**, within a short span, indicating focused development.

### File-Specific Updates:

1.  **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-backend\src\controllers\hblEntry.controller.ts` (Timestamp: 11/28/2025, 3:24:38 PM)**
    *   This entry introduces or heavily refines two core functions: `createHblMasterBooking` and `updateHblMasterBooking`.
    *   **`createHblMasterBooking`**: Handles the creation of new HBL records. It extracts and sanitizes a comprehensive set of data from the request body, including details for shipper, consignee, notify parties, vessel, voyage, containers, and routing. It orchestrates a database transaction, performing multiple inserts into `hbl_master`, `agent_booking_vessel`, and `agent_booking_hbl` tables. It also conditionally inserts related data into `agent_booking_routing`, `agent_booking_container`, and `agent_booking_po` if provided in the payload.
    *   **`updateHblMasterBooking`**: Manages updates for existing HBL records, identified by `serial_id`. Similar to creation, it processes extensive payload data. It updates the `hbl_master`, `agent_booking_vessel`, and `agent_booking_hbl` tables. For dynamic lists like `routingList` and `containerList`, it employs a "delete all then re-insert new" strategy to manage changes effectively. Both functions include robust error handling and database transaction management (BEGIN/COMMIT/ROLLBACK).

2.  **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-backend\src\routes\hblEntry.route.ts` (Multiple timestamps)**
    *   **11/28/2025, 3:25:07 PM**: This is the initial or baseline definition of HBL API routes. It sets up endpoints for fetching (`GET /` and `GET /get-hbl`), creating (`POST /create`), updating (`POST /update`), and deleting (`DELETE /delete`) HBL records, mapping them to their respective controller functions. No authentication middleware is applied at this point.
    *   **11/28/2025, 3:32:50 PM**: A significant change occurs here with the introduction and application of `authMiddleware`. It is specifically added to the `DELETE` route, which is also updated to `DELETE /delete/:serial_id`, indicating that the `serial_id` for deletion is expected as a URL parameter.
    *   **11/28/2025, 3:36:05 PM**: The `DELETE` route is modified again. While `authMiddleware` remains applied, the `serial_id` is removed from the URL path, reverting the route to `DELETE /delete`. This suggests a change in how the `serial_id` for deletion might be passed (e.g., in the request body or query parameters) or an adjustment in the `deleteHblForm` controller's expectation.

### Patterns and Recurring Elements:

*   **Timeliness:** All changes are clustered within a short timeframe on the same date, indicating active and focused development on the HBL feature.
*   **Data Integrity & Formatting:** The controller consistently uses `sanitizeString()` for all string inputs and `AppDateFormate()` with a `YYYY-MM-DD` format (`db_format`) for dates, ensuring data consistency and preventing common database issues.
*   **Transactional Database Operations:** Both `create` and `update` operations in the controller are wrapped in database transactions (`query('BEGIN')`, `query('COMMIT')`, `query('ROLLBACK')`), ensuring atomicity and data consistency across multiple table interactions.
*   **Dynamic List Handling:** For nested data structures like routing and container lists during updates, a "delete existing, then insert new" pattern is observed, which is a common approach to manage child records efficiently.
*   **Security Integration:** The iterative changes in the routing file demonstrate an evolving approach to security, specifically by introducing and then refining the application of `authMiddleware` to the `DELETE` endpoint.

## 3:57:43 PM
The provided logs show a series of changes across two files: `PartyForm.jsx` and `agent.booking.js`, and `HBLListDetails.jsx`. The changes are predominantly related to UI components, API integrations, and data table configurations within a React application.

**File: `c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\components\screen\code\party\PartyForm.jsx`**
*   **Timestamp: 11/28/2025, 2:05:41 PM to 11/28/2025, 2:08:52 PM**
    *   This file, `PartyForm.jsx`, is a React component for managing party details, used in ISF, ADMIN, and BOOKING modules.
    *   It imports various UI components (e.g., `Box`, `Checkbox`, `InputBox`, `AppAutocomplete`, `ThemedMultiselect`), form management tools (`useFormik`, `Yup` for validation), state management (`useEffect`, `useReducer`, `useState`, `useSelector`, `useDispatch`), API hooks (`useAddPartyMutation`), and navigation utilities (`useNavigate`, `useLocation`, `toast`).
    *   It defines constants for different application screens (`ISF_SCREEN`, `BOOKING_SCREEN`, `HBL_SCREEN`, `CNG_BOOKING_SCREEN`) and party types (`DestinationPartyTypes`, `OriginPartyType`).
    *   A `reducer` is used to manage options for `city`, `country`, `state`, `customBroker`, and `bondHolder`.
    *   The `formik` instance is configured with initial values (including `atype` dynamically set based on `formAction` and `isfSelector.selectedISFTab`).
    *   **Validation Logic:** The `validationSchema` uses `Yup.lazy` and includes complex validation for `atype` (ensuring a minimum of one type and preventing selection of both origin and destination party types simultaneously), and specific length/format validations for `addressl1`, `city`, `state`, `zipcode`, and `country`. Notably, validation for `custom_broker_list` and `bond_holder_conf` is commented out, with a note explaining an issue where "HBL entry team is not able to save the party".
    *   **Submission Logic:** The `onSubmit` function constructs a `payload` for `addParty` mutation, mapping `custom_broker_list` items to their `acode` and including a `config` object for `bondHolder` and `customBroker` if the party type includes `IMPORTER` or `CONSIGNEE`.
    *   **Navigation and State Updates post-submission:** After successful party saving, a `toast.success` message is shown. Depending on the current `pathname` (e.g., `BOOKING_SCREEN`, `HBL_SCREEN`, `ISF_SCREEN`), different actions are performed:
        *   `onCloseForBooking()` is called for `BOOKING_SCREEN` or `CNG_BOOKING_SCREEN`.
        *   For `HBL_SCREEN` and `ISF_SCREEN`, if `formAction` is "add", `setPartyPageModal` is closed and `setCreatedPartyData` is dispatched with the new party data. If `formAction` is "direct-edit" or other, `setPartyPageModal` is closed or `setToggleScreen` is updated, and `setUpdatedPartyData` is called.
        *   Otherwise, the user navigates to `/app/code/party`.
    *   Error handling includes `toast.error` for API failures.
    *   `handleOptionChange` and `handleCitySelect` functions assist in populating form fields based on user selections from autocompletes.
    *   A `detectGroup` function is partially shown, likely to classify selected party types into "destination" or "origin" groups.
    *   The changes in these entries are minor tweaks to the `onSubmit` logic, specifically for the `HBL_SCREEN` conditional. In the entry from **2:07:11 PM**, a `toast.success` message was added inside the `formAction === "add"` block for `HBL_SCREEN`. This was then reverted/removed in the entry from **2:08:11 PM**, and `onCloseForBooking()` and `setPartyPageModal` are called instead, aligning the behavior more consistently with `ISF_SCREEN`. The latest change at **2:08:52 PM** seems to revert the removal of `onCloseForBooking()` for HBL add action, restoring consistency with the initial `BOOKING_SCREEN` flow.

**File: `c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\data\columns\agent.booking.js`**
*   **Timestamp: 11/28/2025, 3:00:04 PM to 11/28/2025, 3:16:46 PM**
    *   This file defines column configurations for various data grids related to agent bookings, including `BOOKING_VESSEL_COLUMN`, `BOOKING_VESSEL_COLUMN_CUSTOMER`, `BOOKING_CARGO_COLUMN`, `BOOKING_DASHBOARD_COLUMNS_GRID`, and `BOOKING_DASHBOARD_COLUMNS_CARDS`.
    *   These column definitions specify `field`, `headerName`, `width`, `headerAlign`, `align`, `flex`, `renderCell` for custom rendering (e.g., date formatting using `appDateFormat`, fixed-point number formatting, displaying `Chip` components for status), and `renderHeader` for action columns (e.g., `AddCircleOutlined` to open a modal).
    *   **Consistent pattern:** Most columns include `headerAlign: "center"` and `align: "center"`, indicating a preference for centered text in table headers and cells. Date fields consistently use `appDateFormat`. Numerical fields like `length`, `breadth`, `height`, `calculated_wt`, and `calculated_cbm` often include `toFixed(2)` for two decimal places.
    *   **Notable changes:**
        *   **3:00:04 PM:** Initial state, `AddCircleOutlined` is present as `renderHeader` in `BOOKING_VESSEL_COLUMN`.
        *   **3:00:54 PM:** `Edit` icon import and `ThemeButton` import were added, though not immediately used in the visible snippets.
        *   **3:02:46 PM:** `Delete` icon import was added, again not immediately used.
        *   **3:09:09 PM:** A `nav` constant was added using `useNavigate()` directly in the module scope, which is an incorrect usage as hooks can only be called inside React functional components. This was likely an attempt to make navigation available to column definitions. This specific usage was removed in later commits.
        *   **Other changes within this timestamp range are mostly minor, such as re-saving without significant content diffs, likely due to IDE auto-formatting or minor unnoticed edits.** The `useNavigate` import and declaration at the top level in the 3:09:09 PM entry is the most significant, and also a problematic one for React.

**File: `c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\components\screen\booking\hbl\HBLListDetails.jsx`**
*   **Timestamp: 11/28/2025, 3:01:48 PM to 11/28/2025, 3:30:22 PM**
    *   This file, `HBLListDetails.jsx`, displays a list of HBL (House Bill of Lading) details for a specific agent booking.
    *   It imports `useLocation`, `useNavigate` for routing, `useGetHblDashboardQuery` for fetching HBL data, and `HBL_COLUMNS` for grid configuration.
    *   A `Formik` wrapper is used, although the form itself appears minimal in this component, primarily displaying a grid.
    *   **Data Fetching:** It fetches HBL data using `useGetHblDashboardQuery`, filtered by `agent_booking_id` from `location.state`.
    *   **Add HBL Button:** A "Add HBL" button is present in the `CardHeader`, which navigates to `/app/booking/hbl_form` with `booking_serial_id`, `agent_booking_id`, and `formAction: "add"` in the state.
    *   The `ThemedGrid` component displays the HBL data.
    *   **Notable changes:**
        *   **3:06:34 PM:** The `COLUMNS_GRID` was updated to pass `nav` as a parameter to `HBL_COLUMNS(access, nav)`. This suggests an intent to enable navigation actions directly within the column definitions.
        *   **3:12:49 PM:** The `access` parameter was removed from `HBL_COLUMNS(nav)`.
        *   **3:29:54 PM:** Significant functional change:
            *   `useDeleteHblBookingMutation` was imported and used to add `handleDelete` functionality.
            *   `toast` import was added to support success/error messages for deletion.
            *   The `handleDelete` function now confirms deletion, calls `deleteHblForm`, shows a toast message, and crucially **`refetch()`** is called to update the grid after deletion.
            *   `COLUMNS_GRID` now passes `nav` and `handleDelete` to `HBL_COLUMNS(nav, handleDelete)`. This makes the delete functionality available for actions within the grid.
        *   **3:30:05 PM:** `toast` import was explicitly added, indicating it was likely missing or implicitly available before but made explicit here.
        *   **3:30:22 PM:** The `refetch` function was extracted from `useGetHblDashboardQuery` destructuring, making it available for use in `handleDelete` to refresh the HBL list after a successful deletion.

**File: `c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\store\api\agentBookingApi.js`**
*   **Timestamp: 11/28/2025, 3:26:56 PM to 11/28/2025, 3:40:07 PM**
    *   This file defines an RTK Query API slice for `agentBookingApi`, managing various API endpoints related to bookings, ISF, and HBL.
    *   **Consistent pattern:** All API calls use `fetchBaseQuery` with `API_BASE_URL` and `getAppHeaders()`. `invalidatesTags` and `providesTags` are consistently used for cache invalidation and data re-fetching.
    *   **Endpoints:** The API includes mutations for `saveBooking`, `saveISF`, `saveBookingStatus`, `isfDescXmlCreate`, `isfDescXmlUpload`, `createBookingXml`, `uploadBookingXml`, `saveHblBooking`, `updateCarrierBooking`, `updateDo`, `updateHblBooking`, and `deleteHblBooking`. It also includes queries for `fetchBookingDashboard`, `fetchBookingDetails`, `fetchBookingFormDetails`, `fetchISFDetails`, `fetchCustomerApproveDetails`, `exportSprReport`, and `getHblDashboard`, `fetchHblBookingFormDetails`.
    *   **HBL API additions/modifications:**
        *   **3:26:56 PM:** Introduces `saveHblBooking`, `fetchHblBookingFormDetails`, `getHblDashboard`, `updateHblBooking`, and `deleteHblBooking`. The `deleteHblBooking` mutation initially had a `DELETE` method but used `body: params` which is less common for DELETE and its URL was `/hblEntry/update`.
        *   **3:28:35 PM:** The `deleteHblBooking` mutation was changed to use a more conventional DELETE endpoint with a query parameter for `serial_id`: `url: /hbl/delete?serial_id=${serial_id}`, and the `headers` property was removed for this specific mutation.
        *   **3:33:10 PM:** The `deleteHblBooking` mutation was slightly adjusted again, changing the URL path from `/hbl/delete` to `/hblEntry/delete` and re-adding `headers: getAppHeaders()`.
        *   **3:40:07 PM:** A commented-out `deleteApiKey` mutation (not related to HBL) suggests potential previous or planned functionality.

**Patterns and Recurring Elements:**

*   **Date Formatting:** The `appDateFormat` utility is consistently applied across various date-related columns in `agent.booking.js`.
*   **Centralized API Management:** The `agentBookingApi` slice in `agentBookingApi.js` demonstrates a structured approach to API interactions using RTK Query, including `tagTypes` for efficient caching.
*   **UI Component Reusability:** Custom components like `InputBox`, `AppAutocomplete`, `ThemedMultiselect`, `ThemeButton`, `OutlinedButton`, `ThemedGrid`, `ScreenToolbar`, `ThemedBreadcrumb` are used across different parts of the application, especially `PartyForm.jsx` and `HBLListDetails.jsx`.
*   **Modal Usage:** The `setModal({ open: true })` pattern is used in `BOOKING_VESSEL_COLUMN` to open modals.
*   **Conditional Rendering/Logic:** `PartyForm.jsx` shows conditional logic based on `formAction` and `pathname` for initial values, validation, and post-submission actions.
*   **Grid Column Configuration:** `agent.booking.js` extensively uses an array-of-objects structure to define data grid columns, including custom `renderCell` functions for display logic.
*   **Error and Success Toasts:** The `react-hot-toast` library is used consistently to provide user feedback for API operations.
*   **Navigation State:** `useLocation().state` is used to pass data between screens during navigation, like `agent_booking_id` and `booking_serial_id`.

In summary, the changes reflect ongoing development in areas of party management, HBL listing, and booking-related API interactions. The primary focus for `PartyForm.jsx` was refining post-submission flow and validation logic, particularly concerning party type grouping. For the `agent.booking.js` column definitions, the evolution includes adding action icons and attempting to integrate `useNavigate` (with an initial incorrect implementation). Finally, `HBLListDetails.jsx` underwent updates to incorporate HBL data fetching, display it in a grid, and implement delete functionality with API integration and UI feedback.

## 5:06:40 PM
The log details changes across two files related to HBL (House Bill of Lading) entry management.

### File: `c:\Users\ridap\OneDrive\Documents\T360_Api\t360-backend\src\controllers\hblEntry.controller.ts`

**Timestamp: 11/28/2025, 3:24:38 PM**

This update introduces and significantly develops the backend logic for managing HBL entries.
*   **`createHblMasterBooking` function:** This new asynchronous function handles the creation of a master HBL booking. It performs extensive data sanitization using `sanitizeString` for numerous fields from the request body and formats dates using `AppDateFormate`. It then initiates a database transaction (`BEGIN`) and inserts data into multiple related tables:
    *   `hbl_master`
    *   `agent_booking_vessel`
    *   `agent_booking_hbl`
    *   `agent_booking_routing` (if `routingList` is provided)
    *   `agent_booking_container` (if `containerList` is provided)
    *   `agent_booking_po` (if `basicPoList` is provided)
    The function commits the transaction on success (`COMMIT`) and rolls back on error (`ROLLBACK`).
*   **`updateHblMasterBooking` function:** This function is introduced for updating existing HBL master bookings. It also uses a database transaction (`BEGIN`). The update process involves:
    *   Updating the `hbl_master` table with a comprehensive set of fields.
    *   Updating `agent_booking_vessel` with vessel and voyage information.
    *   Updating `agent_booking_hbl` with HBL details.
    *   For `agent_booking_routing` and `agent_booking_container`, it employs a "delete and re-insert" strategy: all existing entries associated with the `hbl_master_id` are deleted, and then new entries from the payload are inserted. This approach ensures that updates to these lists fully reflect the current payload.

### File: `c:\Users\ridap\OneDrive\Documents\T360_Api\t360-backend\src\routes\hblEntry.route.ts`

This file defines the API endpoints for HBL operations.

**Timestamp: 11/28/2025, 3:25:07 PM**
*   Initial setup of HBL routes:
    *   `GET /`: Maps to `fetchHblFormDetails`.
    *   `GET /get-hbl`: Maps to `getHbl`.
    *   `POST /create`: Maps to `createHblMasterBooking`.
    *   `POST /update`: Maps to `updateHblMasterBooking`.
    *   `DELETE /delete`: Maps to `deleteHblForm`.

**Timestamp: 11/28/2025, 3:32:50 PM**
*   The `DELETE /delete` route is updated to include `authMiddleware` for authentication and specify `serial_id` as a URL parameter: `router.delete("/delete/:serial_id", authMiddleware, deleteHblForm);`.

**Timestamp: 11/28/2025, 3:36:05 PM**
*   The `DELETE /delete` route is modified again. The `serial_id` URL parameter is removed, but `authMiddleware` is retained: `router.delete("/delete", authMiddleware, deleteHblForm);`. This suggests a change in how the ID for deletion is expected, possibly moving it to the request body or query parameters instead of a path parameter.

### Key Patterns and Recurring Elements:

*   **Transactional Integrity:** Both `createHblMasterBooking` and `updateHblMasterBooking` heavily utilize database transactions (`BEGIN`, `COMMIT`, `ROLLBACK`) to ensure data consistency across multiple related table operations.
*   **Data Hygiene:** The `hblEntry.controller.ts` file consistently applies `sanitizeString` to almost all incoming string data and `AppDateFormate` for date fields, indicating a focus on preventing SQL injection and maintaining data format consistency.
*   **Dynamic List Updates:** For child entities like routing, containers, and POs, the `updateHblMasterBooking` function adopts a "delete all, then insert new" strategy.
*   **Role-Based Data Handling:** The `createHblMasterBooking` function determines `locationByRole` based on the authenticated user's role (`AGENT` vs. other roles), influencing data saved in `agent_booking_po`.
*   **Route Security Evolution:** The `hblEntry.route.ts` shows a rapid iteration on the `DELETE` endpoint, first adding authentication middleware and a path parameter for the ID, then removing the path parameter while keeping the middleware, indicating ongoing refinements in API design and security.

## 5:06:42 PM
The provided log details changes across two main files: `PartyForm.jsx` and `agent.booking.js`, with a related update in `HBLListDetails.jsx`.

**File: `c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\components\screen\code\party\PartyForm.jsx`**

*   **Timestamps:** 11/28/2025, 2:05:41 PM to 11/28/2025, 2:08:52 PM.
*   **Key Changes:**
    *   **Consistent updates to form submission logic, particularly for HBL and ISF screens.** The `onSubmit` handler in the `PartyForm` component has been refined across several commits.
    *   **Refinements in handling `formAction` ("add", "direct-edit") for HBL and ISF modules.** This includes setting `partyPageModal` and dispatching `setCreatedPartyData` or `setUpdatedPartyData` based on the action and pathname.
    *   Specifically, a `toast.success("Party Saved Successfully")` was added for `HBL_SCREEN` when `formAction` is "add" (2:07:11 PM).
    *   Later, the `onCloseForBooking()` and `setPartyPageModal` calls were aligned for `HBL_SCREEN`'s "add" action to match the ISF screen's logic (2:08:11 PM).
    *   Overall, these changes indicate an ongoing effort to standardize and improve the user experience and data handling after a party form submission, especially in the context of HBL and ISF modules.

**File: `c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\data\columns\agent.booking.js`**

*   **Timestamps:** 11/28/2025, 3:00:04 PM to 11/28/2025, 3:16:46 PM.
*   **Key Changes:**
    *   **Minor, repetitive modifications across multiple commits.** The content of this file remained largely the same throughout the provided log entries.
    *   **Introduction of `Edit` and `Delete` icons:** At 3:00:54 PM, `Edit` icon was imported. At 3:02:46 PM, `Delete` icon was imported. This suggests plans to add editing and deletion functionality to the data tables defined in this file.
    *   **Removal of `useNavigate` import:** At 3:09:09 PM, `useNavigate` was imported but then immediately removed in subsequent commits (3:09:47 PM onwards). This indicates a temporary, likely erroneous, addition or an abandoned approach to navigation directly within the column definition file.
    *   The continuous series of identical or nearly identical commits within a short timeframe (3:00 PM to 3:16 PM) suggests either automated saves, minor whitespace/formatting changes not captured by the log, or repeated attempts to commit without substantial code alterations. The actual functional changes (icon imports) are minimal compared to the number of log entries.

**File: `c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\components\screen\booking\hbl\HBLListDetails.jsx`**

*   **Timestamps:** 11/28/2025, 3:01:48 PM to 11/28/2025, 3:30:22 PM.
*   **Key Changes:**
    *   **Modification of `HBL_COLUMNS` parameter passing:** Initially, `COLUMNS_GRID` was assigned `HBL_COLUMNS(access)` (3:01:48 PM). This was changed to `HBL_COLUMNS(access, nav)` at 3:06:34 PM, indicating that the `nav` object (from `useNavigate`) is now being passed to the column definition function.
    *   **Introduction of HBL deletion functionality:**
        *   At 3:29:54 PM, `useDeleteHblBookingMutation` was imported and used to add a `handleDelete` function. This function confirms deletion, calls the `deleteHblForm` mutation, shows a toast notification, and attempts to `refetch()` the HBL data.
        *   The `COLUMNS_GRID` assignment was further updated to `HBL_COLUMNS(nav, handleDelete)`, passing the `handleDelete` function to the column definitions, implying that delete actions will be triggered from within the table.
        *   At 3:30:05 PM, `toast` import was moved into the component for the `handleDelete` function.
        *   At 3:30:22 PM, `refetch` was deconstructed from `useGetHblDashboardQuery` to be used in `handleDelete` to update the list after deletion.

**File: `c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\store\api\agentBookingApi.js`**

*   **Timestamps:** 11/28/2025, 3:26:56 PM to 11/28/2025, 3:40:07 PM.
*   **Key Changes:**
    *   **Enhancement of HBL API endpoints:**
        *   The `deleteHblBooking` mutation was initially defined to use a `/hblEntry/update` endpoint with a `DELETE` method and a `body` parameter (3:26:56 PM).
        *   This was corrected at 3:28:35 PM to use a dedicated `/hblEntry/delete?serial_id=${serial_id}` endpoint with a `DELETE` method and accept `serial_id` directly, aligning with RESTful practices for deletion by ID.
        *   At 3:40:07 PM, the `getAppHeaders()` function was added to the `deleteHblBooking` mutation, ensuring proper authorization for the delete request.
    *   A commented-out `deleteApiKey` mutation was observed, indicating exploration or prior implementation of API key management that is currently not active.

**Patterns and Recurring Elements:**

*   **Date Formatting:** The `appDateFormat` utility function is consistently used across multiple column definitions in `agent.booking.js` to format various date fields (e.g., `docs_cutoff`, `cy_cutoff`, `etd`, `eta`).
*   **Centralized Column Definitions:** The application uses dedicated files like `agent.booking.js` to define column configurations for different tables, promoting reusability and separation of concerns.
*   **RTK Query Usage:** The `agentBookingApi.js` file demonstrates heavy use of Redux Toolkit Query for data fetching and mutations, with clear `tagTypes` and `invalidatesTags`/`providesTags` for cache invalidation.
*   **MUI Component Usage:** Material-UI components like `Chip`, `IconButton`, `Tooltip`, `AddCircleOutlined`, `Edit`, and `Delete` are frequently used for UI elements and actions, as seen in `agent.booking.js` column definitions.
*   **Formik for Form Management:** `PartyForm.jsx` and `HBLListDetails.jsx` both utilize Formik for handling form state, validation, and submission, indicating a consistent approach to form management.
*   **Toast Notifications:** `react-hot-toast` is used to provide user feedback for successful operations (e.g., "Party Saved Successfully", "HBL deleted successfully") and error handling.
*   **Navigation and State Management:** `useNavigate`, `useLocation` (React Router), `useSelector`, and `useDispatch` (React Redux) are routinely employed for navigation and global state management, especially in `PartyForm.jsx` and `HBLListDetails.jsx`.
*   **Repetitive Commits:** There's a notable pattern of very frequent, almost identical commits for `src\data\columns\agent.booking.js` in a short time frame, potentially indicating automated save behavior or minor, unlogged changes.

## 7:05:14 PM
The provided log details changes primarily within the `t360-backend` service, specifically affecting the handling of House Bill of Lading (HBL) entries.

**File: `c:\Users\ridap\OneDrive\Documents\T360_Api\t360-backend\src\controllers\hblEntry.controller.ts`**
*   **Timestamp:** 11/28/2025, 3:24:38 PM
*   This file introduces two major asynchronous functions: `createHblMasterBooking` and `updateHblMasterBooking`.
*   **`createHblMasterBooking`**: This function is responsible for creating a new HBL master booking. It performs extensive data processing:
    *   It determines `locationByRole` based on the authenticated user's role.
    *   It constructs a comprehensive `payload` object from the request body, applying `sanitizeString` to numerous fields to clean input and `AppDateFormate` for date consistency.
    *   It initiates a database transaction (`BEGIN`).
    *   It first checks for an existing `agent_booking_id` in `agent_booking_entry`.
    *   It then inserts data into multiple related tables: `hbl_master`, `agent_booking_vessel`, and `agent_booking_hbl`.
    *   Crucially, it handles associated lists (`routingList`, `containerList`, `basicPoList`) by using `insertMany` to add multiple entries into `agent_booking_routing`, `agent_booking_container`, and `agent_booking_po` tables, respectively, if these lists are present in the payload.
    *   The transaction is committed (`COMMIT`) upon success, or rolled back (`ROLLBACK`) in case of an error, which is then logged.
*   **`updateHblMasterBooking`**: This function is designed to update an existing HBL master booking identified by `serial_id`.
    *   It also determines `locationByRole` and initiates a database transaction.
    *   It updates the `hbl_master` table using a large, explicit SQL `UPDATE` statement covering many fields.
    *   It similarly updates the `agent_booking_vessel` and `agent_booking_hbl` tables.
    *   For lists like `routingList` and `containerList`, it employs a "delete-then-insert" strategy: existing entries for the given `hbl_master_id` are deleted from `agent_booking_routing` and `agent_booking_container`, and then new entries from the payload are inserted using `insertMany`. The code snippet for `containerList` update is truncated but implies the same pattern.
*   Both functions demonstrate robust error handling with `HttpError` and database transaction management to ensure data integrity.

**File: `c:\Users\ridap\OneDrive\Documents\T360_Api\t360-backend\src\routes\hblEntry.route.ts`**
*   **Initial state (11/28/2025, 3:25:07 PM):**
    *   This file defines the API endpoints for HBL entries, importing controller functions for fetching, creating, getting a specific HBL, updating, and deleting.
    *   Routes include `/` (GET for `fetchHblFormDetails`), `/get-hbl` (GET for `getHbl`), `/create` (POST for `createHblMasterBooking`), `/update` (POST for `updateHblMasterBooking`), and `/delete` (DELETE for `deleteHblForm`).
*   **First update (11/28/2025, 3:32:50 PM):**
    *   A significant change occurred here: `authMiddleware` was imported and applied to the `DELETE /delete` route.
    *   The `DELETE` route path was modified to `delete/:serial_id`, making `serial_id` a URL parameter for deletion. This indicates an enhancement in security (requiring authentication for deletion) and a change in API design for deleting specific resources.
*   **Second update (11/28/2025, 3:36:05 PM):**
    *   Shortly after, the `DELETE` route path was reverted from `delete/:serial_id` back to `/delete`.
    *   However, `authMiddleware` remains applied to this route, suggesting that while authentication is still required, the `serial_id` for deletion is now expected to be passed via the request body or query parameters rather than as part of the URL path.

**Patterns and Recurring Elements:**

*   **Database Transaction Management:** The controller consistently uses `BEGIN`, `COMMIT`, and `ROLLBACK` for complex database operations involving multiple table modifications, ensuring atomicity and data integrity.
*   **Data Sanitization and Formatting:** The `sanitizeString` and `AppDateFormate` utility functions are heavily applied to incoming request data, indicating a strong focus on data quality and security (preventing injection attacks) across all HBL-related data.
*   **CRUD Operations:** The changes clearly define and implement the Create, Read (fetch/get), Update, and Delete operations for HBL master bookings and their associated details.
*   **Modular Design:** There's a clear separation between route definitions (`hblEntry.route.ts`) and the business logic/database interactions (`hblEntry.controller.ts`).
*   **Evolving Security:** The introduction and subsequent path adjustment of `authMiddleware` on the `DELETE` route demonstrates an iterative approach to securing API endpoints.
*   **Dynamic Sub-List Handling:** For associated records like routing and containers, the strategy for updates involves clearing existing data and re-inserting the complete new list, which is a common pattern for managing child records.

## 7:05:19 PM
The provided log details changes across two main files: `PartyForm.jsx` and `agent.booking.js` (and one instance of `HBLListDetails.jsx`). The timestamps indicate that all changes occurred on 11/28/2025, with several quick, iterative updates around 2:00 PM and 3:00 PM.

### File-Specific Updates:

#### `c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\components\screen\code\party\PartyForm.jsx` (multiple updates between 2:05:41 PM and 2:08:52 PM)

*   **Initial Change (2:05:41 PM):**
    *   The `PartyForm` component, used across ISF, Admin, and Booking modules, was present.
    *   It included extensive form validation using `formik` and `Yup`, particularly for `cname`, `atype`, `addressl1`, `city`, `state`, `zipcode`, and `country`.
    *   Conditional validation for `state` was present, skipping it for "Origin Party Types".
    *   There were commented-out validation rules for `custom_broker_list` and `bond_holder_conf`, indicating a previous issue where HBL entry teams couldn't save parties with these validations enabled.
    *   The `onSubmit` logic handled saving party data and included specific navigation/state updates based on the current `pathname` (BOOKING_SCREEN, HBL_SCREEN, ISF_SCREEN, ISF_DASHBOARD_SCREEN). It also set `payload.config` for `IMPORTER` or `CONSIGNEE` party types.
*   **Subsequent Changes (2:07:11 PM, 2:08:11 PM, 2:08:52 PM):**
    *   These entries show very minor, almost imperceptible changes, typically limited to whitespace or truncated lines, suggesting saving the file after very small edits or perhaps an IDE auto-save.
    *   A notable change at **2:08:11 PM** added `onCloseForBooking()` and `setPartyPageModal({open : false, type : "", data : {}})` for the `HBL_SCREEN` add action, indicating a refinement in how the form closes and clears modal state after adding an HBL-related party.

#### `c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\data\columns\agent.booking.js` (multiple updates between 3:00:04 PM and 3:16:46 PM)

*   **Initial Change (3:00:04 PM):**
    *   This file defines column configurations for various booking-related tables, including `BOOKING_VESSEL_COLUMN`, `BOOKING_VESSEL_COLUMN_CUSTOMER`, `BOOKING_CARGO_COLUMN`, `BOOKING_DASHBOARD_COLUMNS_GRID`, and `BOOKING_DASHBOARD_COLUMNS_CARDS`.
    *   The `BOOKING_VESSEL_COLUMN` already included an "Action" column with an `AddCircleOutlined` icon to open a modal.
    *   Date formatting (`appDateFormat`) was consistently used across date fields.
    *   Cargo dimensions (`length`, `breadth`, `height`) were formatted to two decimal places.
*   **Subsequent Changes (3:00:54 PM to 3:16:46 PM):**
    *   The primary change visible is the addition of `Edit` and `Delete` icons to the imports from `@mui/icons-material` at **3:00:54 PM**.
    *   However, these new icons are not immediately used in the column definitions themselves in this log, suggesting preparation for future functionality or removal of existing unused imports.
    *   Most other changes across these timestamps are minor, similar to the `PartyForm.jsx` pattern, mainly involving whitespace or slight reformatting without significant functional impact on the provided code snippets.
    *   A notable change around **3:09:09 PM** involved importing `useNavigate` directly into `agent.booking.js` and immediately declaring `const nav = useNavigate();` at the top level. This is generally an incorrect usage as hooks (`useNavigate`) must be called inside a functional component body. The subsequent updates (e.g., at 3:09:47 PM) then removed this incorrect `useNavigate` import and declaration, suggesting a quick revert or refactoring. This was fixed by passing `nav` as a parameter to `HBL_COLUMNS`.

#### `c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\components\screen\booking\hbl\HBLListDetails.jsx` (multiple updates between 3:01:48 PM and 3:30:22 PM)

*   **Initial Change (3:01:48 PM):**
    *   The `HBLListDetails` component fetched HBL dashboard data using `useGetHblDashboardQuery`.
    *   It displayed HBLs in a `ThemedGrid` using `HBL_COLUMNS`.
    *   An "Add HBL" button allowed navigation to the HBL form with specific state.
*   **Key Changes:**
    *   At **3:06:34 PM**, the `HBL_COLUMNS` was updated to receive `nav` as a parameter: `const COLUMNS_GRID = HBL_COLUMNS(access, nav);`. This corrects the issue identified in `agent.booking.js` by passing the `navigate` function down to the column definition where it might be used (e.g., for edit actions).
    *   At **3:29:54 PM**, significant new functionality was introduced:
        *   `useDeleteHblBookingMutation` was imported and used to add HBL deletion capability.
        *   A `handleDelete` function was implemented, confirming deletion with the user, calling `deleteHblForm`, showing toast messages, and `refetching` the HBL dashboard data.
        *   The `COLUMNS_GRID` was updated to pass `handleDelete` as a parameter: `COLUMNS_GRID = HBL_COLUMNS(nav, handleDelete);`.
    *   At **3:30:05 PM**, `toast` was explicitly imported.
    *   At **3:30:22 PM**, the `refetch` function from `useGetHblDashboardQuery` was de-structured and then called within `handleDelete` to refresh the grid after a successful deletion.

#### `c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\store\api\agentBookingApi.js` (multiple updates between 3:26:56 PM and 3:40:07 PM)

*   **Initial Change (3:26:56 PM):**
    *   This RTK Query API slice included mutations for saving/updating bookings, ISF, HBL, and queries for fetching dashboards and details.
    *   It already defined `saveHblBooking`, `fetchHblBookingFormDetails`, `getHblDashboard`, and `updateHblBooking`.
    *   A `deleteHblBooking` mutation was defined with a URL using `/hblEntry/update` and a `DELETE` method, but its `query` implementation was missing the `headers` property.
*   **Key Changes:**
    *   At **3:28:35 PM**, the `deleteHblBooking` mutation's URL was corrected to `/hbl/delete?serial_id=${serial_id}` and the `headers` property was added to the query object.
    *   At **3:33:10 PM**, the `deleteHblBooking` mutation's URL was changed back to `/hblEntry/delete?serial_id=${serial_id}` and `headers: getAppHeaders()` was explicitly added to the delete request.
    *   At **3:40:07 PM**, a commented-out `deleteApiKey` mutation was added, suggesting exploration of or preparation for an API key deletion feature, but it was not integrated into the active code.

### Patterns and Recurring Elements:

*   **Consistent Timestamp Grouping:** Changes occur in bursts around specific times (early 2 PM for `PartyForm.jsx` and early 3 PM for `agent.booking.js` and `HBLListDetails.jsx`), indicating focused work sessions on particular features.
*   **Feature Development:** The changes predominantly revolve around the "Party" and "HBL" (House Bill of Lading) functionalities, including form validation, data saving, display in grids, and deletion.
*   **Refinement of HBL Features:** There's a clear progression in HBL-related changes:
    1.  Adding an HBL list display.
    2.  Passing `useNavigate` to column definitions for navigation from the grid.
    3.  Implementing HBL deletion functionality (mutation, handler, UI integration).
    4.  Refining the HBL deletion API endpoint and request headers.
*   **React/Redux Toolkit Query Usage:** The codebase heavily uses React hooks (`useState`, `useEffect`, `useReducer`, `useLocation`, `useNavigate`), Formik for form management, Yup for validation, and Redux Toolkit Query for API interaction (`useAddPartyMutation`, `useGetHblDashboardQuery`, `useDeleteHblBookingMutation`).
*   **UI Components:** Frequent imports from `@mui/material` and custom common components like `InputBox`, `AppAutocomplete`, `ThemeButton`, `ThemedGrid`, `ScreenToolbar`, `ThemedBreadcrumb` suggest a consistent UI library and component structure.
*   **Date Formatting:** The `appDateFormat` utility is consistently applied for displaying date fields across various grid columns.
*   **Error Handling and User Feedback:** `toast.success` and `toast.error` (from `react-hot-toast`) are used for providing user feedback on API operations.
*   **Conditional Logic and Enums:** `BookingAtypeEnum` is used in `PartyForm.jsx` for conditional logic related to party types and their associated configurations.
*   **Console Logging:** Extensive `console.log` statements are present, suggesting active debugging during development.