# Activity Summary for 11/17/2025

## 10:45:45 AM
The provided log details changes to a single file: `c:\Users\ridap\OneDrive\Documents\T360-V2\t360-backend-v2\src\services\notificationService.ts`. All modifications focus on the `getNotificationDetails` asynchronous function within this service, indicating active development or debugging related to notification retrieval logic.

**File-specific updates for `src/services/notificationService.ts`:**

*   **11/17/2025, 9:57:34 AM:**
    *   The initial version of the `getNotificationDetails` function is shown. It fetches user-specific event preferences (`t49_cont_emptyout_date`, etc.) from `public.v2_user_details` based on `usercode`.
    *   It then filters these preferences to get `trueFields` (event types the user wants notifications for).
    *   An `auditEventSql` query is constructed using these `trueFields` in an `IN` clause to fetch audit log notifications from `public.v2_notification_log`.
    *   `auditParams` is set using `req?.user?.companyname`.
    *   The function also fetches message notifications from `shipment_tracking_message`.
    *   Both audit and message notifications are merged, sorted by `lastmodifieddate`, and limited by `pageSize`.

*   **11/17/2025, 9:59:36 AM:**
    *   **Introduced a SQL safety fix:** A new variable `safeFields` was added. This variable ensures that if `trueFields` (from user event preferences) is empty, the `field_id in (...)` clause in `auditEventSql` doesn't become `IN ()`, which would cause a SQL error. Instead, it defaults to `["__no_match__"]` if `trueFields` is empty.
    *   `auditParams` was updated to use the `companyName` variable (which is derived from `req.query.CompanyName` or `req.user?.companyname`) instead of directly `req?.user?.companyname`.
    *   A large commented-out block of the original `auditEventSql` was added, reflecting the change.

*   **11/17/2025, 10:36:22 AM:**
    *   **Reverted the SQL safety fix:** The `safeFields` variable and its usage in `auditEventSql` were removed, returning to directly using `trueFields` which could potentially lead to the `IN ()` SQL error if `trueFields` is empty.
    *   The large commented-out `auditEventSql` block was also removed.

*   **11/17/2025, 10:38:58 AM:**
    *   **Re-introduced the SQL safety fix:** The `safeFields` variable was added back, along with the `// FIX: prevent SQL error IN ()` comment, re-implementing the protection against empty `IN ()` clauses in the `auditEventSql`.
    *   There was a temporary code duplication: the lines defining `userEvents` and `trueFields` were commented out and then re-declared right below, with the `safeFields` logic inserted after the duplicated block. This appears to be a copy-paste artifact during the re-introduction of the fix.

*   **11/17/2025, 10:41:34 AM:**
    *   **Code cleanup and minor addition:** The duplicate and commented-out `userEvents`/`trueFields` declarations were removed, streamlining the code. The `safeFields` logic remained correctly in place.
    *   A `console.log("====name",companyName);` statement was added after the `companyName` variable declaration, likely for debugging the company name value.

*   **11/17/2025, 10:42:10 AM:**
    *   **Company Name Case Handling Change:** The logic for determining `companyName` from `req.query.CompanyName` was modified. It now converts the decoded query parameter to `toUpperCase().trim()` instead of `toLowerCase().trim()`. The fallback from `req.user?.companyname` still uses `toLowerCase().trim()`. This change suggests an adjustment in how company names are matched or stored in the database (e.g., if the `account_name` in `v2_notification_log` is stored in uppercase).

**Patterns and Recurring Elements:**

*   **Focus on `getNotificationDetails`:** All changes are concentrated in this single function, indicating it's a critical or frequently modified part of the application.
*   **SQL `IN ()` Clause Safety:** A significant recurring theme is the introduction, removal, and re-introduction of a fix to prevent SQL errors when a dynamic list of `field_id` values might be empty for the `IN` clause. This highlights a robustification effort for database queries.
*   **Debugging Statements:** The repeated addition and removal of `console.log` statements for variables like `pageSize`, `usercode`, and `companyName` suggest an iterative debugging process.
*   **Company Name Handling:** Adjustments to how the `companyName` is derived and its case (specifically the change from `toLowerCase()` to `toUpperCase()` for the query parameter) indicate ongoing refinement of data processing and consistency with database schemas.
*   **Timestamp Proximity:** The rapid sequence of changes (all within less than an hour on the same day) points to an intense, focused session of development and testing for this particular service.

## 11:54:53 AM
The `cng-batches/config/config.js` file, timestamped 11/17/2025, 10:56:35 AM, defines application configurations for both `development` and `production` environments, with the active configuration determined by an `environment` variable.

Key updates and differences between environments include:

*   **Database Settings**: Distinct database credentials, user accounts, hostnames, and database names are configured for development (local PostgreSQL instance named `Rida_Database`) and production (an AWS RDS instance named `insproject`).
*   **File Paths**: A comprehensive list of file system paths for various operations (e.g., XML, Excel, CSV handling, and archives) is defined. These paths show a clear distinction, with `development` using Windows-style local drive paths (`D:/Files`, `D:/Office`) and `production` utilizing Linux-style server paths (`/home/node/batches`, `/var/efs`). Specifically, `googleTokenPath` also differs across environments.
*   **Email Configuration**: While the email service, sender's user, and sending password (for `cr@transmodalscoreboard.com`) remain consistent, the recipient lists for various reports and notifications (e.g., `all`, `office`, `execptionMailList`, `isfTeam`, `isf24HrReport`, `isfNotMatchReport`, `doBatchReport`, `openFileEmail`, `air_data_pulling_failure`) are significantly different. The `development` environment lists primarily include specific personal email addresses for testing, whereas `production` features a much broader and more formal distribution list of Transmodal employees.
*   **SFTP Private Key Path**: The path to the SFTP private key (`privateKey`) differs between environments, reflecting the respective operating system file structures.
*   **T360 Credentials**: The `username` and associated `password` for the `t360` service are distinct for development and production, while the `baseUrl` remains `http://localhost:8080` in both.

**Configurations that remain consistent across both environments include:**

*   **`cngIntegration`**: Settings for an OTM integration service, including the username, password, and `sentXmlUrl`, are identical.
*   **`sftpConfig7501`**: Host, port, username, and password for `ftp.iesltd.com` are the same for both development and production.
*   **`t360Url`**: The URL `https://transmodal360.com/app/admin_master/registered_users` is constant.
*   **`alc_7501_xml_validation` and `alcTolerance`**: These specific settings are identical.
*   **`mtr_air_config`**: The `schema` is set to `public` in both environments.

The overall pattern indicates a well-defined separation of configuration for development and production, essential for managing different operational contexts, local testing versus live deployment, and varying security and distribution requirements.