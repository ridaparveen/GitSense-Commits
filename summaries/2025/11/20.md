# Activity Summary for 11/20/2025

## 12:22:51 AM
The provided log entry is for the file `c:\Users\ridap\OneDrive\Documents\T360_Api\t360-backend\.env`. As per the instructions, sensitive files such as `.env` files, which may store keys or other confidential information, will not be summarized.

## 12:23:28 AM
Over the course of November 19, 2025, the codebase saw several focused updates primarily affecting booking actions, the booking dashboard, and the introduction/refinement of an ISF (Importer Security Filing) list view.

**File-Specific Updates:**

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\components\screen\booking\actions.js`**
    *   **11:48:44 AM**: Underwent a significant refactoring of the `getBookingActions` function. The original complex nested ternary logic for role-based actions was replaced with a more modular approach, defining reusable action arrays (`bookingActions`, `isfActions`, `hblAction`, `viewAction`, `updateLineBookingAction`, `updateDOAction`) and dynamically combining them based on user access. New "Update Line Booking" and "Update DO" actions were introduced. A temporary label change for "View Details" to "View Details123" was also noted.
    *   **11:49:42 AM**: An action "View ISF List" was added to the `isfActions` array, and the "View Details" label was reverted to its original text.
    *   **11:50:13 AM**: The icon for the "View ISF List" action was changed to `RemoveRedEyeOutlined`.
    *   **11:52:06 AM**: The modal type for the "View ISF List" action was made more specific, changing from `'view'` to `'view-isf'`.
    *   **4:35:35 PM**: A new `getISFActions` function was introduced, initially defining an "Edit ISF" action and incorrectly defaulting to returning `viewAction`.
    *   **4:36:26 PM**: The `getISFActions` function was corrected to return `isfActions` by default.
    *   **4:37:36 PM & 4:37:44 PM**: The navigation logic within the "Edit ISF" action of `getISFActions` was temporarily commented out, replaced by a `console.log` for debugging purposes.

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\pages\booking\BookingDashbaordScreenExtend.jsx`**
    *   **11:51:49 AM**: Several new imports were added, including components for updating line bookings and delivery orders, and utilities for Excel reporting. The component sets up a dashboard with various booking statistics and configures grid columns with actions managed by `getBookingActions`.
    *   **11:55:12 AM**: The `ISFListDetails` component was imported, indicating an integration point for ISF-related features into the dashboard.
    *   **11:56:31 AM & 11:57:14 AM**: Minor case correction for the `ISFListDetails` import (`IsfListDetails` to `ISFListDetails`).

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\components\screen\booking\IsfListDetails.jsx`**
    *   **11:55:02 AM**: This new component was introduced, initially designed as a form for approving/cancelling ISF with PO, inventory, and vessel details.
    *   **12:03:06 PM**: The component was significantly stripped down, removing detailed forms and shifting towards a more focused ISF list view.
    *   **12:04:58 AM**: A "New ISF" button was added, configured to navigate to the booking form.
    *   **12:12:22 PM**: The component transformed into primarily displaying a `ThemedGrid` for an ISF list. All previous approval logic and related UI components (dynamic tables, radio select, reason input) were removed.
    *   **12:29:09 PM**: Dummy data (`isfDummyData`) was introduced to populate the `ThemedGrid`. The component started utilizing `useAccess` and `GridActions` for column configuration, specifically setting the last column's `renderCell` to display actions via `getBookingActions`.
    *   **4:26:46 PM**: The `useNavigate` hook was imported and initialized, resolving a scope issue for `nav` within `GridActions`. The `setModal` parameter was removed from the `getBookingActions` call in `GridActions`.
    *   **4:36:38 PM**: The `GridActions` component was updated to use the newly created `getISFActions` instead of `getBookingActions`, specifically for the ISF list.

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\components\screen\booking\card\BookingCardItemExtend.jsx`**
    *   **11:59:00 AM**: This component was added to display detailed booking cards, featuring status badges, expandable cargo and container details via `AppPopover`, and an action menu (`NewTMenu`).
    *   **11:59:10 AM**: A minor typo "Container Details :1" was corrected to "Container Details :".

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\data\columns\agent.booking.js`**
    *   **12:17:56 PM**: The `ISF_COLUMNS` definition was added (though its content is not explicitly provided in the log for this file, its import in `IsfListDetails.jsx` implies its existence). This change supports the new ISF listing functionality.
    *   **General**: This file consistently defines various column configurations for different booking-related tables, using `appDateFormat` for date rendering and conditional action columns.

**Patterns and Recurring Elements:**

*   **Modularity and Role-Based Access**: There's a clear move towards more modular code, particularly in `actions.js`, by separating actions into reusable arrays and then combining them based on `access` roles (agent, customer, admin), enhancing maintainability.
*   **Modal Interactions**: A consistent pattern of using `setModal({ open: true, type: '...', data: params.row })` is observed for triggering specific modal views with context.
*   **Grid-Based Data Display**: The introduction of `ThemedGrid` and specific column definitions (`BOOKING_DASHBOARD_COLUMNS_GRID`, `ISF_COLUMNS`) for various data types indicates a strong preference for tabular data presentation.
*   **Feature-Specific Action Functions**: The creation of `getISFActions` distinct from `getBookingActions` highlights an effort to encapsulate and manage actions relevant to specific modules or features (e.g., ISF vs. general bookings).
*   **Debugging and Iteration**: Minor UI adjustments, placeholder data, commented-out navigation, and label changes ("View Details123" then reverted) suggest an active development process involving frequent testing and refinement.

## 7:59:31 AM
No summary can be generated as the provided log entry is for an `.env` file, which typically stores sensitive keys and environment variables, and such files are excluded from the summarization process.

## 7:59:42 AM
The primary focus of these changes is on refining the authentication flow within the T360 frontend application, specifically in two key pages: `connector-page.tsx` and `login-page.tsx`. The changes involve token verification, user persistence, and navigation logic.

**File-specific updates:**

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\pages\auth\connector-page.tsx`**
    *   **11/20/2025, 1:07:19 AM**: This file implements a `ConnectorPage` component responsible for handling login from an external T360 source. It extracts a `token` and `authtype` from URL parameters. Upon loading, an `useEffect` hook attempts to verify the token by making a GET request to `ENDPOINTS.VERIFY_TOKEN()`. If successful, the `token`, `user` data, and `authtype` are stored in `localStorage`, a success toast is displayed, and the user is redirected to `/app`. If verification fails or no token is present, a `toLoginPage()` function is called. This function dispatches a `logout` action and redirects the user to `VITE_UI_V1_BASE_URL`, defaulting to the root path (`/`). The UI displays a "Signing in to your account..." message with a spinner if a token is present, and a "Go Back To Login Page" button.
    *   **11/20/2025, 1:08:09 AM**: A minor debugging `console.log("path====",path);` was added within the `toLoginPage` function to inspect the calculated redirection path.
    *   **11/20/2025, 1:10:54 AM**: Another minor debugging `console.log("authtype===",authtype);` was added at the component's top level to check the `authtype` URL parameter.
    *   **11/20/2025, 1:12:04 AM**: A significant functional change occurred in the `toLoginPage()` function's redirection logic. The `path` variable was updated to conditionally redirect to `/login` if `authtype` is not `'auth0'`, making the redirection more specific for non-Auth0 login failures or logouts. The previous logic always redirected to `/`.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\pages\auth\login-page.tsx`**
    *   **11/20/2025, 1:13:48 AM**: This introduces a new `LoginPage` component for traditional username/password authentication. It uses `useState` hooks for `username`, `password`, and `error` states. Crucially, the previously common `useEffect` block containing the token verification logic (as seen in `connector-page.tsx`) is entirely commented out, indicating that this page is not intended for direct token-based URL logins. The `handleLogin` function is implemented to send a POST request to `ENDPOINTS.LOGIN()` with user credentials. On successful login, `token`, `user`, and `authtype` (received from the API response) are stored in `localStorage`, and the user is navigated to `/app`. Error messages are displayed if login fails. The UI includes input fields for username and password, and a login button.
    *   **11/20/2025, 1:17:14 AM**: A minor debugging `console.log("==authtypepp",authtype);` was added at the component's top level, similar to the `connector-page.tsx` changes.

**Patterns and Recurring Elements:**

*   **Authentication-focused Development**: All changes are centered around user authentication, including token verification, direct login, and logout/redirection logic.
*   **State Management and API Interaction**: Both components extensively use React hooks (`useNavigate`, `useEffect`, `useState`, `useDispatch`) and interact with a backend API using `fetch` to `API_BASE_URL` and `ENDPOINTS`.
*   **Local Storage for Session Management**: A consistent pattern is observed in both components to store `token`, `user` data, and `authtype` in `localStorage` after successful authentication.
*   **Toast Notifications**: Both components utilize `react-hot-toast` to provide user feedback (e.g., "Login successful!").
*   **UI Consistency**: Both pages use `AuthLayout` from `../../components/kit/auth-layout`, `Button`, and `Heading` components, suggesting a shared UI design system.
*   **Debugging via `console.log`**: There are recurring instances of adding `console.log` statements for debugging purposes, particularly for `authtype` and redirection paths.
*   **`authtype` Parameter/Header**: The `authtype` value is consistently extracted from URL parameters or stored in `localStorage` and sent as a header in API calls or used in conditional logic for redirection, indicating different authentication mechanisms (e.g., 'auth0' vs. 'normal').
*   **Conditional Navigation**: Redirection logic (`nav("/app")`, `window.location.href`) is a core part of both components' post-authentication or error handling flows.

## 7:59:46 AM
The changes log details a concentrated effort on developing and refining notification features within a backend service, all occurring on November 20, 2025.

### File-Specific Updates:

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-backend-v2\src\routes\NotificationRoutes.ts`**
    *   **Timestamp: 11/20/2025, 12:23:53 AM**
    *   This file establishes the API routes for notification functionality. It defines two GET endpoints: `/notifications` (mapped to `getNotificationDetails`) and `/notifications/recent` (mapped to `getRecentUpdateDetails`), utilizing Express Router. This appears to be the initial setup of these routes.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-backend-v2\src\services\notificationService.ts`**
    *   This file underwent several iterations, primarily focusing on the `getNotificationDetails` function.
    *   **Timestamp: 11/20/2025, 12:35:28 AM**
        *   Initial implementation of `getNotificationDetails` and `getRecentUpdateDetails`.
        *   `getNotificationDetails` is designed to fetch combined audit and message notifications. It dynamically determines `trueFields` (event types) based on user preferences stored in `v2_user_details`. If user preferences are not found, it defaults to a predefined set of `RecentUpdateNotificationFieldIds`. It then queries `v2_notification_log` for audit events and `shipment_tracking_message` for messages, processes them into a standardized format, and merges/sorts the results. Descriptions are generated based on `field_id` using a `switch` statement.
        *   `getRecentUpdateDetails` fetches recent (last 10 days) updates from `v2_notification_log` and `mtr_tracking_data`, focusing on `RecentUpdateNotificationFieldIds`. It aggregates container counts and generates descriptive update messages.
        *   Both functions include error handling and extensive logging.
    *   **Timestamp: 11/20/2025, 12:41:52 AM**
        *   A key modification was made in the `getNotificationDetails` function's `auditEventSql` query. The `WHERE` clause for `field_id` was enhanced to include a fallback.
            *   Previously: `WHERE field_id in (...)`
            *   Now: `WHERE ( field_id IN (...) OR field_id = ANY($2) )`
        *   This change ensures that `RecentUpdateNotificationFieldIds` are always considered, in addition to any user-specific `trueFields`, by passing `RecentUpdateNotificationFieldIds` as a second parameter (`$2`) to the SQL query.
    *   **Timestamp: 11/20/2025, 12:54:18 AM**
        *   No significant functional changes are apparent in the provided code snippet compared to the previous version. This might indicate a minor reformatting or saving without functional alteration.
    *   **Timestamp: 11/20/2025, 1:02:32 AM**
        *   The logic within `getNotificationDetails` for determining `trueFields` was refined and made more explicit.
            *   The condition for using user-specific `trueFields` now explicitly checks if `userEvents` exists and if the user's company name matches the requested company name (`req.user?.companyname?.toLowerCase().trim() === companyName`).
            *   More descriptive console logs (`=== User-specific fields:` vs. `=== Using default company fields:`) were added to clarify which set of `trueFields` is being used. This improves clarity and robustness in handling user-specific versus default notification preferences.

### Patterns and Recurring Elements:

*   **Focused Development:** All changes occurred within a short time frame on the same date (11/20/2025), indicating a dedicated development session on the notification feature.
*   **Notification Feature Focus:** The entire log is centered around creating and refining backend logic for notifications, involving routes and service implementations.
*   **Database Interaction:** Both `getNotificationDetails` and `getRecentUpdateDetails` heavily interact with a PostgreSQL database, querying tables like `v2_notification_log`, `v2_user_details`, `shipment_tracking_message`, and `mtr_tracking_data`.
*   **Dynamic Querying:** SQL queries are often dynamically constructed or utilize parameterized queries (`$1`, `$2`, `ANY($2)`) to fetch data based on user input, company names, and specific field IDs.
*   **Data Transformation:** Both notification functions involve significant data transformation, mapping raw database rows to a more structured and human-readable format, including generating descriptive strings (`description`) and calculating time differences (`timeAgo`).
*   **User Preferences:** There's a clear pattern of trying to tailor notifications based on user-specific event preferences (`v2_user_details`) while also providing a default or fallback set of notification types.
*   **Error Handling and Logging:** Both service functions consistently use `try...catch` blocks for robust error handling and `logger.info`/`logger.error` for comprehensive logging of API calls, query details, and error messages.
*   **Common Utilities:** The code consistently imports and uses utility functions like `formatDate` and `timeAgo`, as well as `HttpStatusCodes` for consistent API responses.

## 8:00:11 AM
**File: `c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\components\screen\booking\actions.js`**

*   **11/19/2025, 11:48:44 AM**: This file underwent a significant refactoring of the `getBookingActions` function. Previously, actions were defined within a complex, deeply nested ternary operator structure based on user roles (`agentBookingMenu`, `customerBookingMenu`, `adminBookingMenu`). The update modularized these actions into reusable constants like `bookingActions`, `isfActions`, `hblAction`, `viewAction`, `updateLineBookingAction`, and `updateDOAction`. These reusable blocks are then combined conditionally based on user access roles using clearer `if` statements. New actions for "Update Line Booking" and "Update DO" were introduced, both triggering modals with specific types (`'line-entry'`, `'update-do'`). Minor detail: the "View Details" label was temporarily changed to "View Details123". Debugging `console.log` statements were removed.
*   **11/19/2025, 11:49:42 AM**: An action named "View ISF List" was added to the `isfActions` array, and the "View Details123" label was reverted to "View Details".
*   **11/19/2025, 11:50:13 AM**: The icon for the "View ISF List" action was changed from `Edit` to `RemoveRedEyeOutlined`.
*   **11/19/2025, 11:52:06 AM**: The modal `type` for the "View ISF List" action was made more specific, changing from `'view'` to `'view-isf'`.
*   **11/19/2025, 4:35:35 PM**: A new exported function, `getISFActions`, was introduced. It initially defined an "Edit ISF" action, but incorrectly defaulted to returning `viewAction`.
*   **11/19/2025, 4:36:26 PM**: The `getISFActions` function was corrected to return its own `isfActions` instead of `viewAction`.
*   **11/19/2025, 4:37:36 PM & 4:37:44 PM & 4:38:35 PM**: The `onClick` handler for the "Edit ISF" action within `getISFActions` was commented out and replaced with a `console.log` for debugging purposes, indicating a temporary pause or investigation into its navigation logic.

**File: `c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\pages\booking\BookingDashbaordScreenExtend.jsx`**

*   **11/19/2025, 11:51:49 AM**: This file saw several updates, including the addition of imports for `UpdateLineBookingForm`, `UpdateDOForm`, `ExcelJS`, `saveAs`, and `moment`. Commented-out imports related to XML mutations were removed. The component now initializes a `modal` state with a default `type` of "view". `GridActions` are configured for the last column of `COLUMNS_GRID`, dynamically fetching actions via `getBookingActions`. Statistics cards for booking counts (New, Approved, Confirmed, Cancelled) were also defined, linking to booking data changes.
*   **11/19/2025, 11:55:12 AM**: The `ISFListDetails` component was imported.
*   **11/19/2025, 11:56:31 AM**: The import path for `ISFListDetails` was corrected for case sensitivity.
*   **Subsequent timestamps (11:57:14 AM to 4:40:53 PM)** for this file show no functional code changes, only save operations of the existing state.

**File: `c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\components\screen\booking\IsfListDetails.jsx`**

*   **11/19/2025, 11:55:02 AM**: The `ISFListDetails` component was introduced. It initially supported displaying PO, Inventory, and Vessel details using `DynamicEditableTable` and `RadioSelectTable`, handling booking approvals, and featured a stepper for tracking details. It integrated `useFetchCustomerApproveDetailsQuery` and `useSaveBookingStatusMutation` for data interaction.
*   **11/19/2025, 12:03:06 PM**: The component was drastically simplified. Most of the form-related UI elements (Cards for PO, Inventory, Vessel, Routing, and the approval buttons/reason input) were removed, hinting at a shift in its purpose or a development phase.
*   **11/19/2025, 12:03:39 PM**: The UI was further streamlined, replacing the `AppStepper` and agent booking ID display with a basic `Button` for "New ISF".
*   **11/19/2025, 12:04:10 PM**: The "New ISF" `Button` was updated to include a `type='primary'` prop (likely a styling-related attribute).
*   **11/19/2025, 12:04:58 PM**: The "New ISF" button was changed to a `ThemeButton` with an `Add` icon, and its `onClick` was set to navigate to `"/app/booking/form"`.
*   **11/19/2025, 12:05:17 PM**: The navigation functionality of the "New ISF" button's `onClick` handler was temporarily disabled by setting it to an empty function `() => {}`.
*   **11/19/2025, 12:05:31 PM to 12:09:06 PM**: Minor layout adjustments were made to the header `Stack` and `Box` containing the Agent Booking# and "New ISF" button, primarily concerning `justifyContent`, `gap`, and `padding`.
*   **11/19/2025, 12:12:22 PM**: A `ThemedGrid` component was introduced to display a list of ISFs below the header, using `BOOKING_DASHBOARD_COLUMNS_GRID` and placeholder data.
*   **11/19/2025, 12:12:45 PM**: The `paginationModel` prop for `ThemedGrid` was changed from `selector.pagination` to a placeholder `"data"`.
*   **11/19/2025, 12:29:09 PM**: The component was further simplified, removing several unused imports and initial `Formik` values. It now primarily focuses on rendering the ISF list using `ThemedGrid` with dummy `isfDummyData`.
*   **11/19/2025, 4:25:49 PM**: Imports for `useAccess`, `GridActions`, and `getBookingActions` were added. The `ThemedGrid` columns are now configured dynamically using `ISF_COLUMNS(access)`, and `GridActions` are used for the last column, though `nav` and `setModal` were not yet in scope.
*   **11/19/2025, 4:26:46 PM**: The `useNavigate` hook was added, and `nav` was correctly initialized. The `GridActions` now correctly pass `nav` and `access` to `getBookingActions` (though `setModal` was still missing).
*   **11/19/2025, 4:36:38 PM**: The `getISFActions` function was imported and is now used to define the actions for `GridActions` in the ISF list, replacing `getBookingActions`.

**File: `c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\components\screen\booking\card\BookingCardItemExtend.jsx`**

*   **11/19/2025, 11:59:00 AM & 11:59:10 AM**: A minor textual change was made from "Container Details :1" to "Container Details :". No other functional changes.

**File: `c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\data\columns\agent.booking.js`**

*   **11/19/2025, 12:17:42 PM**:
    *   `BOOKING_CARGO_COLUMN`: An optional "Action" column was added, which renders an `AddCircleOutlined` icon in the header to trigger a modal via `setModal({ open: true })`, visible only if `setModal` is provided to the column definition.
    *   `BOOKING_DASHBOARD_COLUMNS_GRID`: Significant structural changes were made:
        *   Columns were reordered, with "Status" (`booking_status`) moved to the first position.
        *   The "Status" column now renders `Chip` components with color-coded labels (success for 'Approved', error for 'Cancelled', primary otherwise).
        *   `cellType` properties for date and custom format fields were explicitly added.
        *   "Ready Date" now references `params.row.bookingdate` for its value.
        *   "ETD" and "ETA" columns were commented out.
        *   "Shipper" column received a `flex` property, and "Consignee" was commented out.
*   **Subsequent timestamps (12:31:13 PM to 4:40:43 PM)** for this file show no functional code changes, only save operations. The `ISF_COLUMNS` definition, referenced in `IsfListDetails.jsx`, is implicitly present in this file by the time it's imported there but its direct introduction or modification is not captured in this log snippet.

**Patterns and Recurring Elements:**

*   **Modularization**: A strong pattern of refactoring and modularizing code is evident, particularly in `actions.js`, moving from monolithic conditional logic to reusable action groups.
*   **ISF-Specific Development**: There's a clear focus on introducing and refining functionality related to Importer Security Filing (ISF), including new components (`IsfListDetails.jsx`), dedicated actions (`getISFActions`), and implied specific column definitions (`ISF_COLUMNS`).
*   **UI Iteration**: The `IsfListDetails.jsx` component underwent rapid design changes, simplifying its initial complex form layout to a more focused grid display with a "New ISF" button.
*   **Dynamic UI Elements**: The use of `GridActions` and dynamic column definitions based on user `access` is a recurring pattern, indicating role-based access control for actions and content display.
*   **Modal Management**: The `setModal` function is widely used to trigger various specialized modals throughout the booking screen.
*   **Date Formatting**: `appDateFormat` is consistently used across components for standardized date display.
*   **Rapid Development Cycle**: The timestamps, all on the same day (11/19/2025) and clustered in two distinct periods, suggest active and iterative development within a short timeframe.

## 9:36:26 AM
The provided log entry is for an `.env` file (`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-backend\.env`). As per the instructions, summaries for files containing sensitive information like environment variables are not to be generated. Therefore, no summary will be provided for this log.

## 9:36:37 AM
**File: `c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\pages\auth\connector-page.tsx`**

This file is responsible for handling a specific login flow where an authentication token (`token`) and `authtype` are received via URL parameters.
*   **Initial State (11/20/2025, 1:07:19 AM):** The component retrieves `token` and `authtype` from the URL. An `useEffect` hook verifies the token by making a GET request to `VERIFY_TOKEN()`. If successful, the token, user data, and authtype are stored in `localStorage`, a success toast is shown, and the user is redirected to `/app`. If verification fails or no token is found, a `toLoginPage()` function is called. The `toLoginPage()` function dispatches a logout action and redirects the browser to a base URL (derived from `VITE_UI_V1_BASE_URL`) plus a root path (`/`).
*   **Minor Updates (11/20/2025, 1:08:09 AM & 1:10:54 AM):** Minor `console.log` statements were added to log the `path` within `toLoginPage` and the `authtype` at the component's start for debugging purposes. These changes did not alter functionality.
*   **Significant Update (11/20/2025, 1:12:04 AM):** The `toLoginPage()` function was functionally modified. The redirection logic for the `path` variable was changed from always redirecting to `/` to redirecting to `/login` if `localStorage.getItem('authtype')` is not `'auth0'`. This ensures that non-Auth0 users are directed to the standard login page upon logout or token verification failure.

**File: `c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\pages\auth\login-page.tsx`**

This file was initially structured similarly to `connector-page.tsx` but was significantly refactored to support traditional username and password authentication.
*   **Significant Update (11/20/2025, 1:13:48 AM):** The `useEffect` block responsible for verifying URL parameter tokens (similar to `connector-page.tsx`) was completely commented out, indicating a pivot from URL-based authentication for this page. New `useState` hooks were introduced for `username`, `password`, and `error` states. A `handleLogin` function was added to manage the login process: it sends a POST request with the provided username and password to the `LOGIN()` endpoint, stores the returned token, user data, and authtype in `localStorage` on success, displays a toast, and navigates to `/app`. Error messages are displayed on the form. The UI was updated to include input fields for username and password, an error display, and a login button.
*   **Minor Update (11/20/2025, 1:17:14 AM):** A `console.log("==authtypepp",authtype);` statement was added for debugging purposes, without affecting functionality.

**Patterns and Recurring Elements:**

*   **Authentication Focus:** Both files are central to user authentication, handling tokens, user data, and redirection after login or logout.
*   **`localStorage` Usage:** Both consistently use `localStorage` to persist `token`, `user` data (serialized JSON), and `authtype` across sessions.
*   **API Interactions:** Both make use of `fetch` for API calls, referencing `API_BASE_URL` and `services/Endpoints`.
*   **UI Components:** There's a recurring pattern of importing and using shared UI components like `AuthLayout`, `Button`, `Heading`, and `Spinner`, promoting a consistent look and feel.
*   **Navigation:** Both rely on `react-router-dom`'s `useNavigate` hook for in-app navigation and `window.location.href` for full page redirects (e.g., to an external login page or a different application version).
*   **Debugging:** Frequent use of `console.log` for tracing variable values (`token`, `authtype`, `domain`, `path`, API responses) is evident across changes.
*   **Error and Success Feedback:** `react-hot-toast` is consistently used for user feedback on successful operations, while `alert` or state-managed error messages handle failures.

## 9:36:41 AM
The changes log details updates across two files related to a notification system.

### File-Specific Updates:

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-backend-v2\src\routes\NotificationRoutes.ts` (Timestamp: 11/20/2025, 12:23:53 AM)**:
    *   This file establishes the API endpoints for notification services. It defines two GET routes: one for general notification details (`/get`) and another for recent update details (`/recent-update`), mapping them to `getNotificationDetails` and `getRecentUpdateDetails` functions, respectively, from the `notificationService`.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-backend-v2\src\services\notificationService.ts` (Multiple Timestamps)**:
    *   This file contains the core logic for fetching and processing notification data.
    *   **Initial Implementation (11/20/2025, 12:35:28 AM)**:
        *   Introduced `NotificationRow` and `NotificationResp` interfaces.
        *   Defined `StatusMap` to translate database `field_id` values into human-readable statuses (e.g., "Empty out", "Full return").
        *   Implemented `getNotificationDetails` to retrieve a combination of audit logs (from `v2_notification_log`) and user messages (from `shipment_tracking_message`). It included initial logic to fetch user-specific notification preferences from `v2_user_details` and default to `RecentUpdateNotificationFieldIds` if none were found.
        *   Implemented `getRecentUpdateDetails` to fetch recent shipment status updates, enriching them with container counts and descriptive actions.
    *   **SQL Query Refinement (11/20/2025, 12:41:52 AM)**:
        *   The `auditEventSql` query in `getNotificationDetails` was modified to allow filtering by user-specific `trueFields` OR a predefined `RecentUpdateNotificationFieldIds` array using `field_id = ANY($2)`. The `trueFields` variable type was also corrected from `{}` to `[]`.
    *   **Minor Parameter Update (11/20/2025, 12:54:18 AM)**:
        *   The `auditParams` in `getNotificationDetails` were explicitly defined to pass `companyName` and `RecentUpdateNotificationFieldIds` to the SQL query, clarifying the parameter structure.
    *   **Enhanced User Preference Logic (11/20/2025, 1:02:32 AM)**:
        *   The logic for determining `trueFields` in `getNotificationDetails` was significantly improved. It now specifically checks if `userEvents` exist AND if the user's `companyname` matches the requested `companyName` before applying user-specific notification preferences. If these conditions are not met, it gracefully falls back to using the default `RecentUpdateNotificationFieldIds`. Optional chaining (`?.`) was added for safer access to `userEvents`.

### Timestamps of Significant Changes:

*   **11/20/2025, 12:23:53 AM**: Initial definition of notification API routes.
*   **11/20/2025, 12:35:28 AM**: First full implementation of the notification service, introducing core data structures and logic for retrieving various notification types.
*   **11/20/2025, 12:41:52 AM**: A key structural change to the SQL query for audit events, making the filtering more flexible and robust.
*   **11/20/2025, 1:02:32 AM**: A significant logical improvement in handling user-specific notification preferences, ensuring data accuracy and secure access.

### Patterns and Recurring Elements:

*   **Notification-Centric Development**: All changes revolve around building and refining a comprehensive notification system for shipment tracking.
*   **User-Specific Customization**: A recurring theme is the effort to provide personalized notifications based on user preferences stored in the database, with continuous refinement of the logic to determine these preferences.
*   **Database Interaction and Query Refinement**: The service layer heavily relies on SQL queries (`query` function) to fetch data from `v2_notification_log`, `shipment_tracking_message`, `v2_user_details`, and `mtr_tracking_data`. There's a pattern of iterative refinement of these SQL queries for improved functionality and parameter handling.
*   **Data Transformation and Enrichment**: Raw database results are consistently processed and transformed (e.g., using `formatDate`, `timeAgo`, `StatusMap`, `actionMap`) to create user-friendly descriptions and structured notification objects.
*   **Robust Error Handling and Logging**: Both primary functions (`getNotificationDetails`, `getRecentUpdateDetails`) consistently use `try-catch` blocks and a `logger` to manage errors and log API activity, query details, and processing steps.
*   **Pagination and Filtering**: The services support pagination (`pageSize`) and filtering by `companyName` and specific `field_id`s.

## 9:37:00 AM
The changes log details a concentrated development effort on November 19, 2025, focusing on the booking dashboard and ISF (Importer Security Filing) features within the `t360-frontend` application.

**File-Specific Updates:**

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\components\screen\booking\actions.js`**
    *   **Initial Refactoring (11:48:44 AM)**: The `getBookingActions` function underwent a significant rewrite. It moved from a complex, nested ternary structure to a more modular approach using distinct arrays for common actions (`bookingActions`, `isfActions`, `hblAction`, `viewAction`) and newly introduced actions (`updateLineBookingAction`, `updateDOAction`). These arrays are then combined based on user access roles (`agentBookingMenu`, `customerBookingMenu`, `adminBookingMenu`). The "View Details" label was temporarily altered to "View Details123" but quickly reverted.
    *   **ISF Action Enhancement (11:49:42 AM, 11:50:13 AM)**: A "View ISF List" action was added to the `isfActions` array, and its modal type was specifically set to `'view-isf'`, indicating a dedicated UI for ISF list viewing.
    *   **New ISF Actions Function (4:35:35 PM - 4:38:35 PM)**: A new export function `getISFActions` was introduced to provide actions specifically for ISF records. Initially, it included an "Edit ISF" action with its navigation logic commented out and replaced by a `console.log` statement, suggesting it was under active development or debugging. The default return for `getISFActions` was also corrected from `viewAction` to `isfActions` to provide relevant ISF operations.

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\pages\booking\BookingDashbaordScreenExtend.jsx`**
    *   **Component Integration and Action Mapping (11:51:49 AM)**: This file saw the import of new components like `UpdateLineBookingForm`, `UpdateDOForm`, and `ISFListDetails`. Crucially, it updated the `COLUMNS_GRID` to dynamically render actions using `GridActions` and the `getBookingActions` function, enabling role-based action buttons on the booking dashboard grid.
    *   **Minor Fixes (11:55:12 AM)**: A capitalization error in the `ISFListDetails` import was corrected.

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\components\screen\booking\IsfListDetails.jsx`**
    *   **Initial Development (11:55:02 AM)**: A new `ISFListDetails` component was created, initially containing a complex form with editable tables for PO details, inventory, and vessel selection, along with approval/cancellation logic. It fetched data using `useFetchCustomerApproveDetailsQuery`.
    *   **Simplification & UI Iteration (12:03:06 PM - 12:09:06 PM)**: The component was significantly simplified. Most form elements (PO, inventory, vessel tables, reason input, approval buttons) were removed from the render, streamlining its purpose. A "New ISF" button was added, initially without a function, then given a navigation link to a generic booking form, and finally, its `onClick` was disabled (empty function) while visual styling was adjusted.
    *   **Grid Integration and Data Shift (12:12:22 PM - 12:29:09 PM)**: The component was refactored to incorporate `ThemedGrid` to display ISF data. It shifted from using complex form data to using `isfDummyData` (mock data), indicating a focus on displaying a list of ISF records rather than an approval form. Most data fetching/saving logic was removed.
    *   **Action Integration (4:25:49 PM - 4:36:38 PM)**: `useAccess` and `GridActions` were imported. The component attempted to integrate `getBookingActions` and later correctly `getISFActions` to render actions in the `ThemedGrid` for ISF records. A potential bug exists where `setModal` is expected by `getISFActions` but is not passed from this component's scope.

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\data\columns\agent.booking.js`**
    *   **Column Definitions (12:17:42 PM)**: This file primarily defines various column sets for different booking-related grids (`BOOKING_VESSEL_COLUMN`, `BOOKING_CARGO_COLUMN`, `BOOKING_DASHBOARD_COLUMNS_GRID`, etc.).
    *   **New ISF Columns (4:27:58 PM)**: A new `ISF_COLUMNS` definition was added, specifically for displaying ISF-related data in a grid, including fields like `etd`, `bill_of_loading`, `importer`, `status`, `cbp_response`, `cbp_transaction`, and an "Action" column.

**Timestamps of Significant Changes:**

*   **11/19/2025, 11:48:44 AM**: Major refactoring of `getBookingActions` for modularity.
*   **11/19/2025, 11:50:13 AM**: Introduction of a dedicated modal type (`'view-isf'`) for ISF list viewing.
*   **11/19/2025, 11:51:49 AM**: Integration of `GridActions` into the booking dashboard grid, making actions dynamic based on roles.
*   **11/19/2025, 12:29:09 PM**: `ISFListDetails.jsx` drastically simplified, moving from a complex form to a grid display with mock data.
*   **11/19/2025, 4:27:58 PM**: New `ISF_COLUMNS` defined in `agent.booking.js`.
*   **11/19/2025, 4:35:35 PM**: Introduction of `getISFActions` for ISF-specific actions.
*   **11/19/2025, 4:36:38 PM**: `ISFListDetails.jsx` correctly uses `getISFActions` for grid actions.

**Patterns and Recurring Elements:**

*   **Modularization and Reusability**: The `actions.js` file shows a clear pattern of breaking down action definitions into smaller, reusable arrays and then combining them based on user access roles.
*   **ISF Feature Development**: A prominent theme is the rapid development and iteration of the ISF feature, encompassing new components, dedicated columns, and specific action handlers. The shift in `ISFListDetails.jsx` from a detailed form to a simplified grid with dummy data suggests an evolutionary development process, possibly for an initial display of ISF records before building full CRUD functionality into the modal.
*   **Role-Based Access Control**: The `access` object is consistently used across multiple files (`actions.js`, `BookingDashbaordScreenExtend.jsx`, `IsfListDetails.jsx`) to control which actions and columns are visible or applicable to different user roles, such as agents, customers, or admins.
*   **Modal-Driven Interactions**: Many actions trigger modals (`setModal({ open: true, type: '...', data: params.row })`) with different types (`'view'`, `'line-entry'`, `'update-do'`, `'view-isf'`), indicating a standardized approach for displaying detailed information or forms.
*   **Grid Component Reliance**: The application heavily utilizes a `ThemedGrid` component for displaying tabular data, which supports dynamic columns, pagination, and action rendering.
*   **Debugging and Iteration**: The presence of commented-out code, `console.log` statements for debugging, and rapid changes to the `ISFListDetails.jsx` component illustrate an active and iterative development cycle. There's an unaddressed bug where `setModal` is expected by `getISFActions` but not passed from `ISFListDetails.jsx`.
*   **Styling Adjustments**: Minor layout and styling adjustments within components (e.g., `Box` and `Stack` properties) are common, indicating attention to UI/UX.

## 10:36:29 AM
The file `c:\Users\ridap\OneDrive\Documents\T360_Api\t360-backend\src\types\user.types.ts` was updated on 11/20/2025, 10:28:11 AM. This update focuses on defining core data structures related to user management within the application.

Specifically, it introduces three key types:
1.  **`User` Interface**: This interface outlines the structure of a user object, including fields such as `usercode`, `userid`, `firstname`, `lastname`, `emailid`, `role`, `lastmodifieddate`, `lastlogin`, `status`, `companyname`, `lastmodifiedby`, `filter_movetype`, `filter_scac_code`, `send_etachange_alert`, `send_pan_alert`, `show_booking`, and `account_master_cid`. Several fields like `lastmodifiedby`, `send_etachange_alert`, `send_pan_alert`, `show_booking`, and `account_master_cid` are defined as potentially nullable strings.
2.  **`QueryType` Interface**: This interface defines parameters used for querying user data. It includes fields for pagination (`page`, `perPage`), filtering by `roles`, `status`, `userid`, `firstname`, `lastname`, `emailid`, `companyname`, and an `orderBy` field for sorting results.
3.  **`UserRole` Enum**: This enumeration lists various roles a user can have within the system. The defined roles are `ADMIN`, `AGENT`, `BACKOFFICE`, `CUSTOMER`, `FRONTOFFICE`, `SALES`, and notably, a new role `ADMIN_V2` has been added.

The changes indicate a clear structuring of user-related data, query capabilities, and role definitions, with a specific expansion of available user roles.

## 10:36:35 AM
The changes primarily involve two authentication-related files: `connector-page.tsx` and `login-page.tsx`, both within the `t360-frontend-v2/src/pages/auth` directory.

**File: `c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\pages\auth\connector-page.tsx`**

*   **Initial State (11/20/2025, 1:07:19 AM):** This file implements a "connector page" designed to handle login callbacks, specifically receiving a `token` and `authtype` from URL parameters (presumably from a T360 authentication flow). It uses a `useEffect` hook to:
    *   Verify the received token by making a GET request to `ENDPOINTS.VERIFY_TOKEN()`, passing the token in the `Authorization` header and `authtype`.
    *   Upon successful verification, it stores the `token`, `user` data, and `authtype` in `localStorage`, displays a success toast, and navigates the user to `/app`.
    *   If token verification fails or no token is present, it invokes a `toLoginPage()` function.
    *   The `toLoginPage()` function dispatches a Redux `auth/logout` action and redirects the user to a V1 UI base URL, with the path currently set to `'/'` regardless of the `authtype`.
    *   The UI displays a "Signing in to your account..." message with a spinner if a token is present, and a button to go back to the login page.

*   **Minor Debugging Changes (11/20/2025, 1:08:09 AM & 1:10:54 AM):** Small `console.log` statements were added to log the `path` within `toLoginPage` and the `authtype` at the component's top level, indicating debugging efforts.

*   **Significant Update (11/20/2025, 1:12:04 AM):** The `toLoginPage()` function was modified. The logic for determining the redirect `path` was updated from always `'/`' to now redirect to `'/login'` if `localStorage.getItem('authtype')` is not `'auth0'`. If it is `'auth0'`, it still redirects to `'/'`. This change introduces conditional redirection based on the authentication type for returning to the login page.

**File: `c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\pages\auth\login-page.tsx`**

*   **Initial State (11/20/2025, 1:13:48 AM):** This file introduces a standard username/password login page.
    *   It uses `useState` for `username`, `password`, and `error` management.
    *   The `handleLogin` function sends a POST request to `ENDPOINTS.LOGIN()` with the provided credentials.
    *   On successful login, it stores the received `token`, `user` data, and `authtype` in `localStorage`, displays a success toast, and navigates to `/app`.
    *   Error messages from the API are displayed to the user.
    *   A notable section is a large, commented-out `useEffect` block that mirrors the token verification logic found in `connector-page.tsx`. This suggests that the direct token-based login flow was initially considered or present here but was ultimately separated into `connector-page.tsx`, leaving `login-page.tsx` for traditional credential-based login.
    *   The UI provides input fields for username and password, an error display area, and a "Login" button.

*   **Minor Debugging Change (11/20/2025, 1:17:14 AM):** A `console.log("==authtypepp",authtype);` statement was added, likely for debugging the `authtype` parameter which is still read from the URL in this component (though the token verification `useEffect` is commented out).

**Patterns and Recurring Elements:**

*   **Authentication Focus:** Both files are central to the application's authentication, handling different login scenarios (token-based external login vs. credential-based internal login).
*   **Token Management:** `localStorage` is consistently used across both components to store authentication `token`, `user` information, and the `authtype` after successful login.
*   **API Interaction:** Both components perform `fetch` requests to specific authentication endpoints (`VERIFY_TOKEN`, `LOGIN`) defined in `services/Endpoints`.
*   **Navigation:** `react-router-dom`'s `useNavigate` is used for internal application navigation (`/app`), while `window.location.href` is used for full page redirects, particularly for returning to login states.
*   **`authtype` Parameter:** The `authtype` URL parameter is consistently read and used, both in API headers for verification and in `localStorage`, influencing subsequent logic (e.g., redirect paths).
*   **Debugging:** Frequent addition of `console.log` statements indicates active debugging during development.
*   **UI Consistency:** Both pages utilize `AuthLayout` and common UI components (`Button`, `Heading`, `Spinner`) for a consistent authentication experience.

## 10:36:48 AM
**File-Specific Updates:**

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-backend-v2\src\routes\NotificationRoutes.ts` (Timestamp: 11/20/2025, 12:23:53 AM):** This file defines the API endpoints for notification-related functionalities. It exposes `/notification` for general notification details and `/notification/recentUpdate` for recent update details, delegating to corresponding service functions. This routing configuration remains unchanged throughout the logs.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-backend-v2\src\services\notificationService.ts` (Multiple timestamps):** This file undergoes significant, iterative changes focused on fetching and processing notifications.
    *   **Initial Implementation (11/20/2025, 12:35:28 AM):** The `getNotificationDetails` function is introduced to retrieve a combined list of audit and message notifications. It attempts to fetch user-specific event preferences from `v2_user_details` or defaults to `RecentUpdateNotificationFieldIds`. Notifications are formatted, merged, sorted, and limited. The `getRecentUpdateDetails` function is also introduced to fetch recent shipment status updates within a 10-day window, enriching the data with descriptive action texts.
    *   **Audit Query Enhancement (11/20/2025, 12:41:52 AM):** The `auditEventSql` within `getNotificationDetails` is updated. It now fetches records that match either the user's specific notification preferences *or* a predefined list of "recent update" notification field IDs, ensuring a baseline of important notifications is always included.
    *   **User Preference Logic Refinement (11/20/2025, 1:02:32 AM):** The determination of `trueFields` (user-specific notification preferences) in `getNotificationDetails` is made more robust. It explicitly checks for the existence of user event data and if the user's company name matches the requested company before applying user-defined filters, otherwise defaulting to a predefined set. Debugging `console.log` statements are added around this logic.
    *   **Temporary Role-Based Logic and Reversion (11/20/2025, 9:51:44 AM - 9:54:38 AM):** An `else if` condition was briefly added to `getNotificationDetails` to apply `RecentUpdateNotificationFieldIds` as `trueFields` specifically for `ADMIN_V2` users when their company name matched the query. This change, along with a type annotation for `trueFields` (`any[]`), was reverted almost immediately (by 9:54:38 AM), restoring the user preference logic to its previous state.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-backend-v2\src\models\User.ts` (Timestamp: 11/20/2025, 9:50:05 AM):** This file defines the `UserType` interface and the `UserRole` enum. A notable update is the addition of `ADMIN_V2` to the `UserRole` enum, indicating the introduction of a new administrative role within the system. The file also includes validation utilities for user objects.

**Timestamps of Significant Changes:**

*   **11/20/2025, 12:23:53 AM:** Notification API routes are established.
*   **11/20/2025, 12:35:28 AM:** Initial comprehensive implementation of notification fetching services.
*   **11/20/2025, 12:41:52 AM:** Audit event query expanded to include default fields.
*   **11/20/2025, 1:02:32 AM:** User-specific notification preference handling is improved for accuracy.
*   **11/20/2025, 9:50:05 AM:** The `ADMIN_V2` role is added to the user model.
*   **11/20/2025, 9:51:44 AM and 9:54:38 AM:** A short-lived modification and subsequent reversion of logic related to `ADMIN_V2` role handling in `notificationService.ts`.

**Patterns or Recurring Elements:**

*   **Notification Management:** The logs primarily track the development and refinement of notification retrieval and presentation logic, with a clear separation into general notifications and recent updates.
*   **Dynamic User Preferences:** There's a consistent effort to implement a system where notification preferences can be customized per user, with robust fallback mechanisms for default settings or when user-specific data is unavailable.
*   **Extensive Database Interaction:** Both `getNotificationDetails` and `getRecentUpdateDetails` involve complex SQL queries to various PostgreSQL tables (`v2_notification_log`, `v2_user_details`, `shipment_tracking_message`, `mtr_tracking_data`), demonstrating a data-intensive backend operation.
*   **Data Transformation and Formatting:** Functions like `formatDate` and `timeAgo`, along with `StatusMap` and `actionMap` constants, are repeatedly used to transform raw database values into user-friendly descriptions and relative timestamps.
*   **Debugging Practices:** Frequent `console.log` statements for variables like `companyName`, `pageSize`, `usercode`, `req?.user`, `trueFields`, and `SQL Queries/Params` indicate an active debugging and development process, especially within the `notificationService.ts` file.
*   **Role-Based Access/Configuration:** The introduction of `ADMIN_V2` role in `User.ts` and its brief appearance in `notificationService.ts` suggests ongoing work to define and integrate different user roles with specific application behaviors or data visibility.

## 10:37:06 AM
The changes primarily revolve around enhancing and refactoring the booking and ISF (Importer Security Filing) features within a frontend application, specifically concerning action menus, dashboard displays, and a new ISF list detail view.

**File-Specific Updates:**

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\components\screen\booking\actions.js`**
    *   **11/19/2025, 11:48:44 AM:** The `getBookingActions` function was refactored for better modularity. Previously, it used a deeply nested conditional structure to define actions based on user roles (`agentBookingMenu`, `customerBookingMenu`, `adminBookingMenu`). This was replaced by defining separate, reusable arrays of actions (e.g., `bookingActions`, `isfActions`, `hblAction`, `viewAction`, `updateLineBookingAction`, `updateDOAction`), which are then combined based on the user's access. New `updateLineBookingAction` and `updateDOAction` were introduced.
    *   **11/19/2025, 11:49:42 AM:** A "View ISF List" action was added to the `isfActions` array. The label of the general `viewAction` was also corrected from a temporary "View Details123" back to "View Details".
    *   **11/19/2025, 11:50:13 AM:** The icon for the "View ISF List" action was corrected from `Edit` to `RemoveRedEyeOutlined`.
    *   **11/19/2025, 11:52:06 AM:** The modal `type` for the "View ISF List" action was specifically set to `'view-isf'` to differentiate its purpose.
    *   **11/19/2025, 4:35:35 PM:** A new exportable function, `getISFActions`, was introduced, initially containing only an "Edit ISF" action and incorrectly defaulting to `viewAction`.
    *   **11/19/2025, 4:36:26 PM:** The default return for `getISFActions` was corrected to return `isfActions`.
    *   **11/19/2025, 4:37:36 PM:** The navigation logic (`nav(...)`) within the "Edit ISF" action of `getISFActions` was commented out and replaced with a `console.log`, possibly for debugging or temporary disabling.

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\pages\booking\BookingDashbaordScreenExtend.jsx`**
    *   **11/19/2025, 11:51:49 AM:** This file received a substantial update. It imported new components (`UpdateLineBookingForm`, `UpdateDOForm`, `ISFListDetails`) and utilities for Excel export. The `COLUMNS_GRID` for the main dashboard was updated to dynamically render `GridActions` based on the `getBookingActions` function. The component also introduced a structured way to display booking counts and comparisons, and defined a very extensive `columns` array for export purposes, although many fields were placeholders.
    *   **11/19/2025, 11:56:31 AM:** The import path for `ISFListDetails` was updated for consistent casing.

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\components\screen\booking\IsfListDetails.jsx`**
    *   **11/19/2025, 11:55:02 AM:** This new component, `ISFListDetails`, was introduced. It's built with `Formik` and includes sections for PO Details, Inventory Required, and Vessel Details using editable tables and radio select tables. It also features logic for approving/cancelling bookings and providing a reason.
    *   **11/19/2025, 12:03:06 PM:** The UI of `ISFListDetails` was significantly simplified, removing most of the interactive tables and approval buttons, leaving primarily the header with "Agent Booking#" and an `AppStepper`.
    *   **11/19/2025, 12:03:39 PM:** A "New ISF" button was added to the header.
    *   **11/19/2025, 12:04:58 PM:** The "New ISF" button was styled using `ThemeButton` and configured to navigate to the booking form, though this navigation was temporarily disabled shortly after.
    *   **11/19/2025, 12:09:06 PM:** Styling for the header layout was refined to use `display="flex"` and `justifyContent="space-between"` on the outer `Stack`.
    *   **11/19/2025, 12:12:22 PM:** `ThemedGrid` was integrated into the `ISFListDetails` component, intended to display ISF data in a tabular format, using `BOOKING_DASHBOARD_COLUMNS_GRID` as a placeholder for columns.
    *   **11/19/2025, 12:17:22 PM:** Significant cleanup occurred, removing unused state, refs, functions (`reasonFlag`, `handleApproval`), and the editable table components, simplifying `ISFListDetails` to primarily contain the `Formik` context, basic header, and `ThemedGrid`.
    *   **11/19/2025, 12:29:09 PM:** `isfDummyData` was introduced to populate the `ThemedGrid`, and the columns were explicitly set to `ISF_COLUMNS`.
    *   **11/19/2025, 4:25:49 PM:** `useAccess`, `GridActions`, and `getBookingActions` were integrated into `ISFListDetails` to dynamically render actions for the `ThemedGrid` columns, with `nav` and `setModal` being called but not yet defined in this component.
    *   **11/19/2025, 4:26:46 PM:** `useNavigate` was imported and initialized as `nav` within `ISFListDetails`, and the `GridActions` call was updated to use `getBookingActions(nav, access)`.
    *   **11/19/2025, 4:36:38 PM:** The `GridActions` within `ISFListDetails` were updated to specifically use the newly introduced `getISFActions(nav, access)` instead of `getBookingActions`.

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\data\columns\agent.booking.js`**
    *   **11/19/2025, 12:17:42 PM:** New column definitions were added: `BOOKING_DASHBOARD_COLUMNS_GRID` for the booking dashboard (including status, IDs, dates, weights, HBL/MBL, shipper, client) and `BOOKING_DASHBOARD_COLUMNS_CARDS` for card views. The `BOOKING_CARGO_COLUMN` was also updated to optionally include an "Action" column with an "Add Vessel" button.

**Patterns and Recurring Elements:**

*   **Modularization:** There's a clear move towards breaking down large functions (like `getBookingActions`) and components into smaller, reusable units, making the codebase more maintainable.
*   **Role-Based Access Control (RBAC):** The `access` object is consistently used across components (`actions.js`, `BookingDashbaordScreenExtend.jsx`, `ISFListDetails.jsx`) to control the display of actions and content based on user roles (`agentBookingMenu`, `customerBookingMenu`, `adminBookingMenu`).
*   **Dynamic UI with `setModal`:** The `setModal` function is widely used to trigger modal windows with varying content (`type: 'view'`, `'line-entry'`, `'update-do'`, `'view-isf'`), indicating a flexible modal system.
*   **Grid and Card Displays:** The application utilizes both `ThemedGrid` and `BookingCardView` with distinct column definitions (`BOOKING_DASHBOARD_COLUMNS_GRID`, `BOOKING_DASHBOARD_COLUMNS_CARDS`) for presenting data, suggesting different visualization preferences.
*   **ISF Feature Development:** A strong focus on ISF management is evident with the creation of dedicated ISF actions, an `ISFListDetails` component, and `ISF_COLUMNS`.
*   **Date Formatting:** Dates are consistently formatted using `appDateFormat` in column `renderCell` functions.
*   **Styling Consistency:** Extensive use of Material-UI components (`Box`, `Stack`, `Card`, `Chip`, `Button`, `Typography`, `Grid`) and inline `sx` properties for styling and layout.
*   **State Management with Redux Toolkit Query and Formik:** API interactions are handled via Redux Toolkit Query hooks (`useFetchCustomerApproveDetailsQuery`, `useSaveBookingStatusMutation`), and forms are managed using `Formik`.
*   **Refactoring and Cleanup:** Several entries show removal of commented-out code and unused imports, indicating ongoing code hygiene.
*   **Incremental Development:** Changes often introduce new features (like `ISFListDetails` or `getISFActions`) and then iterate on their implementation and integration in subsequent commits (e.g., button functionality, column definitions, API calls).
*   **Redundant Log Entries:** Several timestamps for the same file show identical code, suggesting frequent saves or a logging tool that records minor, non-functional changes.

## 11:36:29 AM
The `user.types.ts` file, last updated on 11/20/2025 at 10:28:11 AM, defines several interfaces and an enum crucial for user management within the application.

It includes a comprehensive `User` interface that specifies user attributes such as `usercode`, `userid`, `firstname`, `lastname`, `emailid`, `role`, `lastmodifieddate`, `lastlogin`, `status`, and `companyname`. It also details fields for tracking modifications (`lastmodifiedby`), filtering capabilities (`filter_movetype`, `filter_scac_code`), and notification preferences (`send_etachange_alert`, `send_pan_alert`, `show_booking`, `account_master_cid`).

A `QueryType` interface is defined for structuring queries related to user data, including parameters for pagination (`page`, `perPage`), filtering by roles, status, user details, company name, and ordering (`orderBy`).

Finally, a `UserRole` enum lists distinct user roles within the system: `ADMIN`, `AGENT`, `BACKOFFICE`, `CUSTOMER`, `FRONTOFFICE`, `SALES`, and `ADMIN_V2`. The presence of `ADMIN_V2` suggests a potential evolution or new iteration of the administrative role.

The overall pattern indicates a well-structured approach to defining user data, roles, and querying mechanisms, suggesting a robust user management system.

## 11:36:43 AM
## File: `src\pages\auth\connector-page.tsx`

This file handles the login flow for users redirected from a T360 external authentication system, specifically for verifying a token received via URL parameters.

*   **11/20/2025, 1:07:19 AM:** The initial version of the `ConnectorPage` component was introduced. It retrieves `token` and `authtype` from URL search parameters. A `useEffect` hook performs an asynchronous API call to `VERIFY_TOKEN` using the received token. If the token is valid, it stores the `token`, `user` data, and `authtype` in `localStorage`, displays a success toast, and navigates the user to `/app`. Error cases (invalid token or API failure) trigger an alert and redirect to a login page via the `toLoginPage` function. The `toLoginPage` function dispatches a Redux `auth/logout` action and redirects the browser to the `VITE_UI_V1_BASE_URL` at the root path (`/`). The UI displays a "Signing in to your account..." message with a spinner if a token is present, and a "Go Back To Login Page" button.
*   **11/20/2025, 1:08:09 AM:** A minor debugging statement (`console.log("path====",path);`) was added within the `toLoginPage` function.
*   **11/20/2025, 1:10:54 AM:** Another minor debugging statement (`console.log("authtype===",authtype);`) was added at the beginning of the `ConnectorPage` component.
*   **11/20/2025, 1:12:04 AM:** A significant functional change was implemented in the `toLoginPage` function. The redirection path was updated from always `/` to a conditional path: `localStorage.getItem('authtype') === 'auth0' ? '/' : '/login'`. This means users with an 'auth0' authtype will be redirected to the root, while others will be sent to the `/login` path upon logout or failed verification.

## File: `src\pages\auth\login-page.tsx`

This file implements a traditional username and password login interface.

*   **11/20/2025, 1:13:48 AM:** The initial version of the `LoginPage` component was created. It includes state for `username`, `password`, and `error`. A large commented-out `useEffect` block, resembling the token verification logic from `connector-page.tsx`, indicates a potential earlier iteration or a separation of concerns. The core `handleLogin` function performs a `POST` request to the `LOGIN` API endpoint with provided credentials. On successful login, it stores `token`, `user`, and `authtype` from the API response into `localStorage`, shows a success toast, and navigates to `/app`. Error messages are displayed using `setError`. The UI provides input fields for username and password, an error display, and a login button.
*   **11/20/2025, 1:17:14 AM:** A debugging statement (`console.log("==authtypepp",authtype);`) was added at the component's start.
*   **11/20/2025, 10:37:17 AM:** Several improvements were made to the `handleLogin` function:
    *   The event type for `handleLogin` was refined to `React.FormEvent<HTMLFormElement>`.
    *   Basic client-side validation was added to ensure both `username` and `password` are provided before making the API call.
    *   The parsing of the API response (`response.json()`) was made more robust with a `try...catch` block to handle potential "Invalid server response."
    *   Error messages in the `catch` block were improved to provide a generic "Something went wrong" if no specific message is available.
    *   When storing data in `localStorage`, nullish coalescing operators (`??`) were introduced for `data.token`, `data.user`, and `data.authtype` to provide default values (empty string, empty object, "normal") if the API response fields are undefined, enhancing data integrity.

## File: `src\components\core\sidebar.tsx`

This file defines the application's sidebar navigation component.

*   **11/20/2025, 11:33:11 AM:** The `SideBar` component was introduced, featuring sections, headings, and items for navigation. It integrates `react-router-dom` for highlighting the current active link. Redux (`useSelector`, `useDispatch`) is used to manage and display the `selectedCustomer` and allows dispatching actions to update it. It dynamically retrieves the `localUserRole` from `localStorage`. If the user role is "ADMIN_V2", a `SelectCustomerPanel` component is rendered. The sidebar menu items are mapped from a `sidebarMenu` configuration, with a specific logic to disable the "Preferences" item if the `localUserRole` is "ADMIN_V2". Styling uses `clsx` for conditional classes. A `UserCard` is included in the sidebar footer. A debugging `console.log` statement was added for `localUserRole`.

## Patterns and Recurring Elements:

*   **Authentication & State Management:** A strong pattern revolves around user authentication, involving token verification (`connector-page.tsx`) and credential-based login (`login-page.tsx`). Both extensively use `localStorage` to persist user session data (`token`, `user`, `authtype`). Redux (`useDispatch`) is employed in `connector-page.tsx` for logout and in `sidebar.tsx` for global state management (like `selectedCustomer`).
*   **API Interaction:** Both `connector-page.tsx` and `login-page.tsx` make `fetch` API calls to backend endpoints, using `API_BASE_URL` and `ENDPOINTS`, and include `try...catch` blocks for error handling.
*   **Navigation:** `react-router-dom`'s `useNavigate` is used for internal application routing, while `window.location.href` is used for full page redirects, particularly for returning to login pages or other external URLs.
*   **UI Components:** There's a consistent use of shared UI components like `AuthLayout`, `Button`, `Heading` across the authentication pages, indicating a component-driven design.
*   **Debugging Practices:** Multiple `console.log` statements were added across different timestamps, indicating active debugging during development.
*   **Defensive Programming:** The `login-page.tsx` updates specifically show an emphasis on robust error handling, input validation, and safe data assignment (e.g., using `??` for `localStorage` values).

## 12:36:31 PM
The `src\types\user.types.ts` file, last updated on 11/20/2025 at 10:28:11 AM, defines crucial type definitions for user management within the system.

Specifically, it includes:
*   An `User` interface that outlines a comprehensive user profile structure. This includes personal identifiers (`usercode`, `userid`, `firstname`, `lastname`, `emailid`), organizational and status details (`role`, `companyname`, `status`), timestamps (`lastmodifieddate`, `lastlogin`), and various flags or preferences (`filter_movetype`, `filter_scac_code`, `send_etachange_alert`, `send_pan_alert`, `show_booking`, `account_master_cid`). Several fields are explicitly nullable.
*   A `QueryType` interface designed for handling user queries, incorporating parameters for pagination (`page`, `perPage`), filtering by multiple user attributes (`roles`, `status`, `userid`, `firstname`, `lastname`, `emailid`, `companyname`), and sorting (`orderBy`).
*   A `UserRole` enum that enumerates distinct user roles, such as `ADMIN`, `AGENT`, `BACKOFFICE`, `CUSTOMER`, `FRONTOFFICE`, `SALES`, and `ADMIN_V2`.

The recurring pattern in this file is the use of TypeScript interfaces and enums to establish clear, type-safe data structures for user-related entities and operations, ensuring data consistency across the application.

## 12:36:40 PM
The provided log details changes across three primary files: `connector-page.tsx`, `login-page.tsx`, and `sidebar.tsx`, all occurring on 11/20/2025.

**File-Specific Updates:**

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\pages\auth\connector-page.tsx`**
    *   **Initial Setup (1:07:19 AM):** This file was set up to handle authentication via a token passed in URL parameters. It uses `useEffect` to verify the token with an API call (`ENDPOINTS.VERIFY_TOKEN`), stores user data (`token`, `user`, `authtype`) in `localStorage` upon success, and navigates to `/app`. If token verification fails or the token is missing, it dispatches an `auth/logout` action and redirects to a login page.
    *   **Minor Debugging (1:08:09 AM, 1:10:54 AM, 12:18:39 PM):** Several minor `console.log` statements were added to debug the `authtype` and redirection `path`.
    *   **Login Redirection Logic Refinement (1:12:04 AM):** A significant change was introduced in the `toLoginPage` function. The redirection path for non-'auth0' authentication types was explicitly changed from always `/` to `/login`, ensuring that users are directed to the correct login page if not using Auth0.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\pages\auth\login-page.tsx`**
    *   **Component Creation (1:13:48 AM):** This file was created to implement a standard username/password login form. It manages `username`, `password`, and `error` states. A `handleLogin` function sends a `POST` request to `ENDPOINTS.LOGIN()`, stores authentication data in `localStorage` on success, and navigates to `/app`. It includes a commented-out `useEffect` block that appears to be leftover token verification logic, indicating an initial idea or code transfer that was not fully implemented here.
    *   **Minor Debugging (1:17:14 AM, 12:29:09 PM, 12:30:01 PM):** Similar to `connector-page.tsx`, `console.log` statements were added and modified to debug `authtype` and API response data.
    *   **Login Logic Enhancement (10:37:17 AM):** The `handleLogin` function received notable improvements:
        *   Client-side validation was added to ensure both username and password fields are not empty.
        *   Robust error handling was introduced for API responses, including a `try-catch` block around `response.json()` to manage invalid server responses.
        *   `localStorage.setItem` calls were made safer by providing default empty string/object values (`?? ""`, `?? {}`) to prevent storing `null` or `undefined`.
        *   A more generic "Something went wrong" error message was added for unhandled exceptions.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\components\core\sidebar.tsx`**
    *   **Initial Implementation (11:33:11 AM):** This file introduced the `SideBar` component, responsible for the application's navigation. Key features include:
        *   Integration with Redux for managing `selectedCustomer`.
        *   Dynamically disabling menu items, specifically "Preferences" for users with the "ADMIN_V2" role, based on user data retrieved from `localStorage`.
        *   Conditional rendering of a `SelectCustomerPanel` only for "ADMIN_V2" users.
        *   Uses `react-router-dom` for navigation and `clsx` for styling.

**Patterns and Recurring Elements:**

*   **Authentication Flow:** A consistent pattern across `connector-page.tsx` and `login-page.tsx` is the handling of user authentication: retrieving tokens, verifying credentials via API calls, storing `token`, `user`, and `authtype` in `localStorage`, and redirecting to the `/app` route upon successful login. Both files also include error handling and user feedback (toasts, alerts).
*   **Redux Integration:** Redux (`useDispatch`, `useSelector`) is used in `connector-page.tsx` (for logout) and `sidebar.tsx` (for global state management like `selectedCustomer`).
*   **Environment Variables:** While `.env` files are excluded from the summary content, the code snippets show a reliance on `import.meta.env.VITE_UI_V1_BASE_URL` which indicates the use of environment variables for dynamic configuration, particularly for base URLs.
*   **Debugging Practices:** Frequent use of `console.log` for debugging `authtype`, token status, and API responses is a recurring theme across the authentication-related files.
*   **UI Component Usage:** Both `connector-page.tsx` and `login-page.tsx` leverage common UI components like `AuthLayout`, `Button`, `Heading`, and `Spinner`/`InputBox`, suggesting a shared component library.

## 12:36:51 PM
The log details recent development on notification and reporting functionalities, predominantly within the `t360-backend-v2` project.

### `c:\Users\ridap\OneDrive\Documents\T360-V2\t360-backend-v2\src\routes\NotificationRoutes.ts`
*   **Timestamp:** 11/20/2025, 12:23:53 AM
*   **Updates:** This file defines the Express router for notification-related API endpoints. It establishes two GET routes: `/notifications` for `getNotificationDetails` and `/notifications/recentupdate` for `getRecentUpdateDetails`, importing these services from `notificationService`.

### `c:\Users\ridap\OneDrive\Documents\T360-V2\t360-backend-v2\src\services\notificationService.ts`
This file undergoes numerous modifications throughout the log, primarily focusing on the `getNotificationDetails` function.
*   **Timestamp:** 11/20/2025, 12:35:28 AM
    *   **Initial State:** Introduces `NotificationRow` and `NotificationResp` interfaces. Defines `StatusMap` for event descriptions and `RecentUpdateNotificationFieldIds` for default updates.
    *   `getNotificationDetails`: Implements logic to fetch notifications, determining `companyName` and `pageSize`. It queries `v2_user_details` for user-specific notification preferences (`trueFields`) or defaults to `RecentUpdateNotificationFieldIds`. It then performs two main queries: one for `v2_notification_log` (audit events) and another for `shipment_tracking_message` (message events). Results are enhanced with formatted descriptions and time-ago strings, merged, sorted by `lastmodifieddate`, and limited by `pageSize`.
    *   `getRecentUpdateDetails`: Fetches recent updates from `v2_notification_log` and `mtr_tracking_data` within the last 10 days, filtering by `RecentUpdateNotificationFieldIds`. It aggregates container counts (`uniqueContnos`) for similar shipments and generates descriptive text using `StatusMap` and an `actionMap`.
*   **Timestamp:** 11/20/2025, 12:41:52 AM
    *   **Change in `getNotificationDetails`:** The SQL query for audit events (`auditEventSql`) is modified to explicitly include `field_id = ANY($2)` alongside the `field_id IN (...)` clause. This ensures that a predefined set of `RecentUpdateNotificationFieldIds` is always considered, even if user-specific `trueFields` are absent or restricted.
*   **Timestamp:** 11/20/2025, 12:54:18 AM
    *   **No functional changes** detected compared to the previous version.
*   **Timestamp:** 11/20/2025, 1:02:32 AM
    *   **Change in `getNotificationDetails`:** Refined the logic for determining `trueFields`. It now robustly checks if `userEvents` (from `v2_user_details`) exists and if the user's `companyname` matches the requested `companyName` before applying user-specific filters. If not, it defaults to `RecentUpdateNotificationFieldIds`. Introduced clearer console logging for which `trueFields` path is taken.
*   **Timestamp:** 11/20/2025, 9:43:17 AM
    *   **Change in `getNotificationDetails`:** Added `console.log("*****req?.user****:", req?.user);` for debugging user information. The handling of `userEvents` reverts to directly accessing `getEventNotification[0]`, potentially introducing a vulnerability if `getEventNotification` is empty (whereas the 1:02:32 AM version used optional chaining `?.[0]`).
*   **Timestamp:** 11/20/2025, 9:45:58 AM
    *   **No functional changes** detected compared to the previous version.
*   **Timestamp:** 11/20/2025, 9:51:44 AM
    *   **Change in `getNotificationDetails`:** Introduces a new `else if` condition for `trueFields` assignment. Specifically, if the `CompanyName` in the query matches the user's company and the user's `role` is `ADMIN_V2`, `trueFields` will explicitly be set to `RecentUpdateNotificationFieldIds`, overriding other user-specific preferences.
*   **Timestamp:** 11/20/2025, 9:54:38 AM
    *   **Change in `getNotificationDetails`:** The `else if` condition for the `ADMIN_V2` role introduced in the previous change is removed, reverting the `trueFields` logic to a simpler `if/else` block based on user-specific settings or the default `RecentUpdateNotificationFieldIds`.
*   **Timestamp:** 11/20/2025, 9:55:17 AM
    *   **No functional changes** detected compared to the previous version.

### `c:\Users\ridap\OneDrive\Documents\T360-V2\t360-backend-v2\src\models\User.ts`
*   **Timestamp:** 11/20/2025, 9:50:05 AM
    *   **Updates:** Defines the `UserType` interface, including fields like `usercode`, `firstname`, `lastname`, `role`, `userid`, `emailid`, `companyname`, and an optional `location`. A `UserRole` enum is added, including a new `ADMIN_V2` role. Validation functions (`parseUser`, `__new__`, `test`) using `jet-validators` are set up to handle user objects.
*   **Timestamp:** 11/20/2025, 10:29:31 AM
    *   **No functional changes** detected compared to the previous version.

### `c:\Users\ridap\OneDrive\Documents\T360-V2\t360-backend-v2\src\routes\shipmentRoutes.ts`
*   **Timestamp:** 11/20/2025, 10:48:45 AM
*   **Updates:** This file defines various routes for shipment tracking. It includes routes for getting all shipments, shipment cards, details (both general and air), milestones (general and air), sending messages, getting messages, deleting documents, and fetching uploaded documents. The `uploadDocuments` route using `uploadMiddleware` is present but commented out in the provided code snippet.

### `c:\Users\ridap\OneDrive\Documents\T360-V2\t360-backend-v2\src\services\reports\triggers.ts`
*   **Timestamp:** 11/20/2025, 10:55:47 AM
*   **Updates:** This file contains functions (`activeScheduledForSDT`, `activeScheduledForDaily`, `activeScheduledForWeekly`, `activeScheduledForMonthly`) to check and trigger various types of scheduled reports.
    *   Each function queries `v2_user_reports` for active schedules based on a specific frequency (SDT, Daily, Weekly, Monthly) and checks if the current time/day matches the schedule.
    *   `schedulerFunc.scheduleReport` introduces a random delay before calling `triggerReport`.
    *   `triggerReport` dynamically constructs SQL queries based on report columns, including special handling for `pl_no` and booking reports, and applies ETA filters. It fetches data, sends reports via email (`sendReportMail`), saves report execution history to `report_history`, and deactivates non-repetitive schedules.
    *   **Pattern:** There are multiple commented-out lines related to `filterObject`, suggesting a refactor where filtering parameters are now passed individually to `schedulerFunc.scheduleReport` instead of as an object. Duplicate `if (!scheduledTime) return;` statements are present in `activeScheduledForSDT`.

**Overall Patterns and Recurring Elements:**
*   **Notification Logic Iteration:** The `notificationService.ts` file, particularly the `getNotificationDetails` function, is a recurring point of change. The logic for determining user-specific notification preferences (`trueFields`) and its fallback mechanisms is repeatedly refined and adjusted.
*   **API Structure:** Consistent use of Express routers and service functions for API endpoint definitions.
*   **Database Interaction:** Frequent use of a `query` utility for PostgreSQL database operations, with detailed SQL queries.
*   **Logging and Error Handling:** `logger.info` is widely used for operational logging (API calls, queries, data counts), and `logger.error` for robust error capture and response.
*   **Timestamp Consistency:** All changes occurred on the same date, 11/20/2025, indicating a focused development session.

## 12:37:05 PM
The code changes primarily focus on refactoring action definitions, enhancing dashboard functionalities, and introducing a new ISF (Importer Security Filing) listing component.

**File: `c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\components\screen\booking\actions.js`**
*   **11/19/2025, 11:48:44 AM:** The `getBookingActions` function was significantly refactored. Instead of nested ternary operators, distinct action arrays (`bookingActions`, `isfActions`, `hblAction`, `viewAction`, `updateLineBookingAction`, `updateDOAction`) were introduced and then combined based on user access roles. New "Update Line Booking" and "Update DO" actions were added. The "View Details" label was temporarily changed to "View Details123" and `setModal` calls started including a `type` property.
*   **11/19/2025, 11:49:42 AM:** A "View ISF List" action was added to `isfActions` with a modal `type` of 'view', and the "View Details123" label was corrected back to "View Details".
*   **11/19/2025, 11:50:13 AM:** The modal `type` for the "View ISF List" action was made more specific, changing from 'view' to 'view-isf'.
*   **11/19/2025, 4:35:35 PM:** A new export function `getISFActions` was added, initially defining an "Edit ISF" action. The default return was erroneously set to `viewAction`, and the "Edit ISF" `onClick` was commented out and replaced with a `console.log` for debugging.
*   **11/19/2025, 4:36:26 PM:** The default return for `getISFActions` was corrected to return its own defined actions (`isfActions`).
*   **11/19/2025, 4:37:36 PM, 4:37:44 PM, 4:38:35 PM:** These entries confirm the continued presence of the `console.log` and commented-out navigation for the "Edit ISF" action within `getISFActions`, indicating ongoing debugging or temporary feature disabling.

**File: `c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\pages\booking\BookingDashbaordScreenExtend.jsx`**
*   **11/19/2025, 11:51:49 AM:** Several imports related to form extensions (`UpdateLineBookingForm`, `UpdateDOForm`) and Excel export (`ExcelJS`, `saveAs`) were added. The dashboard stats now include "Confirmed Bookings". A comprehensive `columns` array was introduced, likely for report generation. `updateLineBookingAction` and `updateDOAction` were integrated into the dashboard's grid actions for relevant user roles.
*   **11/19/2025, 11:55:12 AM:** The `ISFListDetails` component was imported, signaling its integration into the booking dashboard.
*   **11/19/2025, 11:56:31 AM, 11:57:14 AM, 4:38:54 PM, 4:39:05 PM, 4:39:43 PM:** These timestamps reflect minor updates like casing changes for `ISFListDetails` import, but no substantial functional code changes.

**File: `c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\components\screen\booking\IsfListDetails.jsx`**
*   **11/19/2025, 11:55:02 AM:** This new file was created to display ISF list details. It initially included form sections for PO, Inventory, and Vessel details with approval/cancellation functionality, using `Formik`, `DynamicEditableTable`, and `RadioSelectTable`.
*   **11/19/2025, 12:03:06 PM:** The component's UI was drastically simplified, removing most form sections (PO, Inventory, Vessel details) and the approval/rejection logic.
*   **11/19/2025, 12:03:39 PM - 12:05:17 PM:** A "New ISF" button was added and refined, changing from a generic `Button` to `ThemeButton`, and its navigation `onClick` was briefly configured then temporarily disabled.
*   **11/19/2025, 12:06:41 PM - 12:09:06 PM:** Minor styling and layout adjustments were made to the header section of the component, specifically for the "Agent Booking#" display and the "New ISF" button placement.
*   **11/19/2025, 12:12:22 PM:** The component underwent a major transformation, removing all previous form-related states and functions (reasonFlag, handleApproval, etc.). It was refactored to primarily display data using `ThemedGrid` and intended to use `BOOKING_DASHBOARD_COLUMNS_GRID` for its columns. Placeholder data ("data") was used for the grid.
*   **11/19/2025, 12:12:45 PM:** The `paginationModel` prop for `ThemedGrid` was changed to a placeholder string "data".
*   **11/19/2025, 12:17:56 PM:** The `ThemedGrid` in this component was updated to use the dedicated `ISF_COLUMNS` from `agent.booking.js` instead of general booking dashboard columns.
*   **11/19/2025, 12:29:09 PM:** Further simplification occurred, removing remaining `Card` components and form-related imports. `isfDummyData` was added to provide mock data for the `ThemedGrid`.
*   **11/19/2025, 4:25:49 PM:** `useAccess`, `GridActions`, and `getBookingActions` were imported to enable role-based actions within the `ThemedGrid` of the ISF list. Action buttons for each row of the ISF grid were set up using `getBookingActions`, with a potential scope issue for `nav` and `setModal`.
*   **11/19/2025, 4:26:46 PM:** `useNavigate` was imported to resolve the `nav` scope, and `setModal` was removed from `GridActions` props as it was not needed by `getBookingActions` in its current form.
*   **11/20/2025, 11:39:32 AM:** The `GridActions` in this component were updated to use `getISFActions(nav, access)` instead of `getBookingActions`, specifically tailoring the actions for ISF entries.

**File: `c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\data\columns\agent.booking.js`**
*   **11/19/2025, 12:17:42 PM:** A new `ISF_COLUMNS` array was defined, providing a specific set of columns for displaying ISF data, including `agent_booking_id`, `etd`, `bill_of_loading`, `importer`, `status`, `cbp_response`, `cbp_transaction`, `lastmodifieddate`, and an `action` column placeholder. Minor adjustments were also made to `BOOKING_DASHBOARD_COLUMNS_GRID` (removing redundant `id` fields and correcting a `renderCell` for `ready_date`).
*   **11/19/2025, 12:31:13 PM - 4:40:43 PM:** These entries show no functional changes in the column definitions.

**File: `c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\components\screen\booking\card\BookingCardItemExtend.jsx`**
*   **11/19/2025, 11:59:00 AM:** A minor text correction was made to the title of the "Container Details" popover.
*   **11/19/2025, 11:59:10 AM:** No functional changes.

**File: `c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\App.js`**
*   **11/20/2025, 12:05:18 PM:** A `console.log` statement was added for testing purposes, and a duplicate root route for `<LoginScreen />` was briefly introduced as a commented-out section.
*   **11/20/2025, 12:08:07 PM:** The commented-out duplicate root route for `LoginScreen` was further refined to avoid confusion with `Auth0Login`.
*   **11/20/2025, 12:16:05 PM:** The `ADMIN_V2` user role was added to the `allowedRoles` for the main `/app` protected route, expanding access for this new role.

**Patterns and Recurring Elements:**
*   **Modularization of Actions:** The `actions.js` file consistently shows a pattern of breaking down action definitions into smaller, role-specific arrays for better organization and reusability.
*   **Role-Based Access Control:** The application heavily relies on `useAccess` and `ProtectedRoute` components with `UserRoleEnum` to manage and enforce permissions for various features and actions.
*   **Dynamic Data Grids:** `ThemedGrid` is a central component for displaying data, often combined with specialized column definitions from `agent.booking.js` and dynamic row actions via `GridActions`.
*   **Modal Usage with `type`:** The `setModal` function frequently receives a `type` property, indicating a pattern for context-aware modal content rendering.
*   **Component Refactoring/Specialization:** The `ISFListDetails.jsx` file demonstrates a common development pattern where a component starts with complex functionality (forms, approval flow) and then refactors to a more specialized role (data listing) as other dedicated components are introduced or existing ones evolve.
*   **Debugging Practices:** The presence of `console.log` statements and commented-out code segments reflects active development and debugging phases.

## 2:09:53 PM
The `src/types/user.types.ts` file, last modified on 11/20/2025 at 10:28:11 AM, defines several core data structures related to user management.

Specifically, it includes:
*   An `User` interface that outlines the properties of a user, such as `usercode`, `userid`, `firstname`, `lastname`, `emailid`, `role`, `status`, `companyname`, and various `filter_` and `send_` preferences (`filter_movetype`, `filter_scac_code`, `send_etachange_alert`, `send_pan_alert`, `show_booking`). It also includes fields for tracking modifications and login (`lastmodifieddate`, `lastlogin`, `lastmodifiedby`) and an `account_master_cid`.
*   A `QueryType` interface designed for filtering and pagination, specifying fields like `page`, `perPage`, `roles`, `status`, `userid`, `firstname`, `lastname`, `emailid`, `companyname`, and `orderBy`.
*   A `UserRole` enum, which enumerates distinct user roles within the system: `ADMIN`, `AGENT`, `BACKOFFICE`, `CUSTOMER`, `FRONTOFFICE`, `SALES`, and a new `ADMIN_V2` role, indicating potential evolution or differentiation in administrative access levels.

The changes focus on standardizing user data representation and query parameters, along with a clear definition of user roles, suggesting a structured approach to user management within the backend system.

## 2:10:18 PM
The code changes primarily focus on authentication, user session management, and role-based access control within a frontend application. All modifications occurred on 11/20/2025, indicating a concentrated period of development.

### File-Specific Updates:

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\pages\auth\connector-page.tsx`**
    *   **Early Morning (1:07 AM - 1:12 AM):** This file, responsible for verifying an authentication token received via URL parameters (presumably from an external T360 system), storing user data in local storage, and redirecting to the `/app` page, saw initial development and minor debugging. A significant functional update at **1:12:04 AM** changed the logout redirection path: previously, all users were redirected to the root (`/`), but this was modified to redirect non-Auth0 users specifically to `/login` when `toLoginPage()` is called. Subsequent changes involved minor adjustments to `console.log` statements for debugging `authtype` and `path`.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\pages\auth\login-page.tsx`**
    *   **Early Morning (1:13 AM - 1:17 AM):** This file was introduced or heavily modified to implement a standard username and password login form. It handles form submission, makes an API call to log in, and stores authentication details (token, user, authtype) in local storage, then navigates to `/app`. An initially commented-out `useEffect` block hints at an alternative token verification flow.
    *   **Later Morning (10:37 AM):** A significant update at **10:37:17 AM** improved the login functionality by:
        *   Adding basic client-side validation to ensure both username and password are provided.
        *   Enhancing error handling for server responses, including a fallback for invalid JSON.
        *   Making local storage assignments safer by using nullish coalescing (`??`) to prevent storing `undefined` values.
        *   Refining the generic error message.
    *   **Afternoon (12:29 PM - 12:31 PM):** Subsequent changes were primarily minor `console.log` additions and removals, likely for debugging the `authtype` and API response data.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\components\core\sidebar.tsx`**
    *   **Later Morning (11:33 AM):** At **11:33:11 AM**, the `SideBar` component was updated to include role-based access control. It now retrieves the user's role from local storage and conditionally disables the "Preferences" menu item for users with the "ADMIN_V2" role. Additionally, a `SelectCustomerPanel` component is now conditionally rendered and visible only to "ADMIN_V2" users, allowing them to select a customer.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\components\core\usercard.tsx`**
    *   **Afternoon (1:21 PM):** A significant refactor of the `handleLogout` function occurred at **1:21:18 PM**. The updated logic ensures that authentication tokens and user data are cleared from local storage, and a Redux logout action is dispatched, *before* any redirection. For Auth0 users, the logout now redirects to the `/login` path of the `VITE_UI_V1_BASE_URL` (instead of a separate `/logout` endpoint as in the previously commented-out code), while other users are redirected to the application's root (`/`).

### Patterns and Recurring Elements:

*   **Authentication and Session Management:** A dominant theme across multiple files is the handling of user authentication, including token verification, storing user data (`token`, `user`, `authtype`) in `localStorage`, and managing login/logout flows.
*   **Redirection Logic:** Both `react-router-dom`'s `useNavigate` and direct `window.location.href` are used for navigating users after authentication events, often conditionally based on `authtype`.
*   **API Interaction:** `fetch` requests are consistently used for communicating with a backend API, utilizing `API_BASE_URL` and specific `ENDPOINTS`.
*   **Redux Integration:** `react-redux` (`useDispatch`, `useSelector`) is used for global state management, specifically for authentication logout actions and selecting customer data.
*   **Role-Based Logic:** There's a clear pattern of implementing conditional logic and rendering based on the user's `authtype` (e.g., 'auth0' vs. 'normal') and `role` (e.g., 'ADMIN_V2'), which suggests robust access control mechanisms.
*   **Debugging via Console Logs:** Frequent additions and minor modifications to `console.log` statements appear throughout the log, indicating active debugging during the development process.
*   **Error Handling:** `try...catch` blocks are consistently used around API calls for error management, providing user feedback via `toast` or `alert`.

## 2:10:21 PM
**File: `c:\Users\ridap\OneDrive\Documents\T360-V2\t360-backend-v2\src\routes\NotificationRoutes.ts`**
*   **Timestamp: 11/20/2025, 12:23:53 AM**
    *   This file establishes the API routes for notification-related functionalities.
    *   It defines two GET endpoints: `/notification/get` which maps to `getNotificationDetails`, and `/notification/recent` which maps to `getRecentUpdateDetails`.

**File: `c:\Users\ridap\OneDrive\Documents\T360-V2\t360-backend-v2\src\services\notificationService.ts`**
*   **Timestamp: 11/20/2025, 12:35:28 AM**
    *   Initial implementation of `getNotificationDetails` and `getRecentUpdateDetails` functions.
    *   **`getNotificationDetails`**:
        *   Retrieves user-specific notification preferences from `v2_user_details` based on `usercode`.
        *   If user preferences are found and match the company, it filters notifications based on these preferences; otherwise, it defaults to a predefined set of `RecentUpdateNotificationFieldIds`.
        *   Fetches `audit` type notifications from `v2_notification_log` and `message` type notifications from `shipment_tracking_message`.
        *   Enriches `audit` notifications with descriptive messages based on `field_id` (e.g., ETA changes, status updates for empty out/full return).
        *   Merges and sorts all notifications by `lastmodifieddate`, then applies a `pageSize` limit.
    *   **`getRecentUpdateDetails`**:
        *   Queries `v2_notification_log` and `mtr_tracking_data` to fetch recent updates (within the last 10 days) for a given company.
        *   Aggregates and describes status updates for containers, indicating the count of `cont_type` containers that performed a specific action (e.g., "Empty out", "Vessel departed") at a `pol` bound for `pod`.
*   **Timestamp: 11/20/2025, 12:41:52 AM**
    *   In `getNotificationDetails`, the `auditEventSql` query's `WHERE` clause was updated to include both user-specific `trueFields` and the general `RecentUpdateNotificationFieldIds` as fallback or additional filters using `OR field_id = ANY($2)`. The `auditParams` array was also adjusted to pass `RecentUpdateNotificationFieldIds` as a parameter.
*   **Timestamp: 11/20/2025, 1:02:32 AM**
    *   Refined the logic within `getNotificationDetails` for determining `trueFields`. Explicit conditional comments were added to distinguish between using user-specific settings (if user found and company matches) and falling back to default `RecentUpdateNotificationFieldIds` otherwise.
*   **Timestamp: 11/20/2025, 9:43:17 AM**
    *   Added `console.log("*****req?.user****:", req?.user);` for debugging purposes in `getNotificationDetails`.
*   **Timestamp: 11/20/2025, 9:51:44 AM**
    *   Introduced a new condition in `getNotificationDetails` to handle `ADMIN_V2` users. If the queried `CompanyName` matches the user's company and their role is `ADMIN_V2`, `trueFields` are set to `RecentUpdateNotificationFieldIds`. This suggests a specific notification view for administrators.
*   **Timestamp: 11/20/2025, 9:54:38 AM**
    *   The `else if` condition for `ADMIN_V2` users introduced at 9:51:44 AM was reverted, simplifying the `trueFields` determination logic back to user-specific preferences or a general fallback.

**File: `c:\Users\ridap\OneDrive\Documents\T360-V2\t360-backend-v2\src\models\User.ts`**
*   **Timestamp: 11/20/2025, 9:50:05 AM**
    *   This file defines the `UserType` interface, outlining user properties like `usercode`, `firstname`, `lastname`, `role`, `userid`, `emailid`, `companyname`, and an optional `location`.
    *   It introduces the `UserRole` enum, expanding the possible roles to include `ADMIN_V2`.
    *   A `parseUser` function is set up for validating `UserType` objects.

**File: `c:\Users\ridap\OneDrive\Documents\T360-V2\t360-backend-v2\src\routes\shipmentRoutes.ts`**
*   **Timestamp: 11/20/2025, 10:48:45 AM**
    *   This log entry shows the existing API routes related to shipment tracking, including endpoints for fetching shipment details, milestones, messages, and document management (upload, delete, fetch). No functional code changes were introduced in this specific log entry.

**File: `c:\Users\ridap\OneDrive\Documents\T360-V2\t360-backend-v2\src\services\reports\triggers.ts`**
*   **Timestamp: 11/20/2025, 10:55:47 AM**
    *   This file introduces a comprehensive system for scheduling and triggering reports based on different frequencies (SDT, Daily, Weekly, Monthly).
    *   Functions like `activeScheduledForSDT`, `activeScheduledForDaily`, `activeScheduledForWeekly`, and `activeScheduledForMonthly` query the `v2_user_reports` table for active schedules.
    *   These functions use time comparisons (`convertToUTC`, `timeStringToUnixTimestamp`) to determine when a scheduled report should be executed.
    *   `schedulerFunc.scheduleReport` initiates the report generation with a random delay to prevent concurrent processing.
    *   `schedulerFunc.triggerReport` is the core logic for generating reports:
        *   It fetches the company name for the user.
        *   Dynamically constructs SQL queries to fetch report data, handling specific conditions like `pl_no` inclusion, booking reports, and ETA filtering (`includeZeroEta`).
        *   Filters report data by date.
        *   Sends the generated report via email (`sendReportMail`).
        *   Records the report generation event and its status (Success/Failed) in `report_history`.
        *   Deactivates one-time (non-repetitive) scheduled reports.

**Patterns and Recurring Elements:**

*   **Consistent Logging:** The `logger.info` is frequently used across all service files to log API entry points, query details, and important process steps, aiding in debugging and monitoring.
*   **Error Handling:** All asynchronous service functions (`getNotificationDetails`, `getRecentUpdateDetails`, `triggerReport`) consistently wrap their logic in `try...catch` blocks, returning `HttpStatusCodes.INTERNAL_SERVER_ERROR` upon failure.
*   **Dynamic Company Name Retrieval:** `companyName` is consistently derived from either query parameters (decoded and trimmed to lowercase) or the authenticated user's session (`req?.user?.companyname`).
*   **Database Interactions:** The `query` utility is central to interacting with the PostgreSQL database for fetching data (`v2_user_details`, `v2_notification_log`, `shipment_tracking_message`, `mtr_tracking_data`, `v2_user_reports`, `mtr_user_master`).
*   **Utility Functions:** `formatDate` and `timeAgo` are commonly used for standardizing and displaying date/time information in a user-friendly format.
*   **User-Specific Customization:** There's a recurring pattern in `notificationService.ts` to fetch and apply user-specific preferences (e.g., notification fields) from `v2_user_details`, falling back to general configurations if user settings are not available or applicable.
*   **Status Mapping:** `StatusMap` is a constant used across notification services to translate technical `field_id` values into human-readable status descriptions.

## 2:10:29 PM
The code changes primarily focus on refining and extending the booking and ISF (Importer Security Filing) functionalities within the T360-frontend application.

**File-specific updates:**

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\components\screen\booking\actions.js`**
    *   **(11/19/2025, 11:48:44 AM - 11:52:06 AM)** The `getBookingActions` function underwent significant refactoring. It transitioned from a monolithic conditional structure to a modular design, defining separate reusable arrays for booking, ISF, HBL, view, update line booking, and update DO actions. These arrays are then combined dynamically based on the user's access roles (agent, customer, admin).
    *   Specific actions like "View Details" had their labels and modal types (`type: 'view'`) adjusted. An "Update Line Booking" and "Update DO" action were introduced.
    *   The "View ISF List" action was added, initially with an `Edit` icon, then changed to `RemoveRedEyeOutlined` and its modal type was specifically set to `type: 'view-isf'`.
    *   **(11/19/2025, 4:35:35 PM - 4:38:35 PM)** A new export function `getISFActions` was introduced to provide actions specifically for ISF entries, initially containing only an "Edit ISF" action that logs parameters. It was later corrected to return `isfActions` defined locally within the function.

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\pages\booking\BookingDashbaordScreenExtend.jsx`**
    *   **(11/19/2025, 11:51:49 AM)** This file was extended to import `UpdateLineBookingForm` and `UpdateDOForm`. The `COLUMNS_GRID` was configured to use `GridActions` with `getBookingActions`. It also added several `StatsCard` components for "New Bookings", "Approved Bookings", "Confirmed Bookings", and "Cancelled Bookings" counts, and defined a comprehensive list of columns for potential detailed views or exports.
    *   **(11/19/2025, 11:55:12 AM - 11:57:14 AM)** `ISFListDetails` was imported, indicating integration of a new component for ISF management.

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\components\screen\booking\IsfListDetails.jsx`**
    *   **(11/19/2025, 11:55:02 AM)** This component was initially created to display PO, Inventory, and Vessel details, offering approval/cancellation functionality via `Formik`.
    *   **(11/19/2025, 12:03:06 PM - 12:08:53 PM)** The component underwent substantial changes, transitioning from a detailed form/approval interface to a simpler view. Most form-related elements like `DynamicEditableTable`, `RadioSelectTable`, reason input, and approval buttons were removed or replaced. A "New ISF" button was added and styled. Layout adjustments were made using flexbox properties (`justifyContent`, `gap`).
    *   **(11/19/2025, 12:12:22 PM - 12:29:09 PM)** The component was further simplified, removing almost all form-related state and functions. It now primarily serves to display a `ThemedGrid` of ISF data, using `BOOKING_DASHBOARD_COLUMNS_GRID` (later changed to `ISF_COLUMNS`) and dummy data. Unused imports were cleaned up.
    *   **(11/19/2025, 4:25:49 PM - 4:36:38 PM)** Integrations for `useAccess`, `GridActions`, `useNavigate` were added. The `ThemedGrid`'s action column was configured to use `GridActions` with `getBookingActions`, later specifically switching to `getISFActions` for ISF-related actions.

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\components\screen\booking\card\BookingCardItemExtend.jsx`**
    *   **(11/19/2025, 11:59:00 AM)** This new component was introduced to render individual booking items as cards, featuring tracking details (`AppStepperExtend`), key booking fields (`CardField`), status badges (`Chip` with dynamic styling), and popovers for "Cargo Details" and "Container Details". Actions are provided via a `NewTMenu`.
    *   **(11/19/2025, 11:59:10 AM)** A minor label correction was made for the "Container Details" popover.

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\data\columns\agent.booking.js`**
    *   **(11/19/2025, 12:17:42 PM)** A new `BOOKING_DASHBOARD_COLUMNS_GRID` constant was added, defining a standard set of columns for displaying booking information in a grid. The `BOOKING_CARGO_COLUMN` was updated to accept a `displayFormat` function for `Weight` and `CBM` fields and to conditionally include an "Action" column with an "Add Vessel" button.
    *   **(11/19/2025, 12:17:56 PM)** `ISF_COLUMNS` was imported, implying the definition of ISF-specific columns elsewhere (not shown in this log, but used in `IsfListDetails`).

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\App.js`**
    *   **(11/20/2025, 12:08:07 PM - 12:13:10 PM)** There were changes in authentication routing, with `/` initially pointing to `<Auth0Login />` and then `<LoginScreen />` being restored and moved to the `/login` path.
    *   **(11/20/2025, 12:16:05 PM)** The `UserRoleEnum.ADMIN_V2` was added to the allowed roles for the main `/app` protected route, expanding access for a new admin role.

**Patterns and Recurring Elements:**

*   **Modularization of UI Actions:** A strong pattern is the decomposition of UI actions into separate, reusable functions (`getBookingActions`, `getISFActions`) and arrays, which are then dynamically applied based on user roles and context. This improves maintainability and scalability of the action menus.
*   **ISF Feature Development:** There's a clear development trajectory for ISF-related features, including dedicated components (`ISFListDetails`), specific columns (`ISF_COLUMNS`), and actions (`getISFActions`), suggesting a significant focus on enhancing ISF management.
*   **Data Grid and Card Views:** The application extensively uses data grids (`ThemedGrid`) and card views (`BookingCardItemExtend`) for displaying lists of data, with dynamic column definitions and action buttons.
*   **Role-Based Access Control (RBAC):** `ProtectedRoute` and `UserRoleEnum` are consistently used to enforce role-based access for various routes and functionalities, ensuring users only interact with permitted parts of the application.
*   **Navigation and Modal Interactions:** Actions frequently involve programmatic navigation (`nav`) to different forms (e.g., `/app/booking/form`, `/app/booking/isf_form`) with state, and opening `ThemedModal` components with specific `type` and `data` for various detail views or entry forms.
*   **Styling Consistency:** The use of `Box`, `Stack`, and `Grid` with `sx` props for layout and styling (e.g., `backgroundColor: "azure"`, `borderRadius`, `boxShadow`) indicates an effort to maintain a consistent visual theme.

## 3:09:54 PM
The changes primarily focus on refining user authentication, token handling, and logout processes within the T360 frontend application, all occurring on 11/20/2025.

**File-specific updates:**

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\pages\auth\connector-page.tsx`**
    *   **Initial Functionality (1:07:19 AM):** This component was introduced to handle token-based logins. It extracts `token` and `authtype` from URL parameters, verifies the token via a GET API call, and stores the token, user data, and `authtype` in `localStorage` upon success, redirecting to `/app`. On failure or missing token, it dispatches a Redux logout action and redirects to a login page (initially `/`).
    *   **Minor Debugging and Redirection Fixes (1:08:09 AM - 12:18:44 PM):** Several `console.log` statements were added or modified to trace `authtype` and redirection paths. Crucially, at **1:12:04 AM**, the `toLoginPage` function's redirection logic was updated to send "normal" authtype users to `/login` instead of the root path, ensuring correct navigation post-logout or on login errors.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\pages\auth\login-page.tsx`**
    *   **Initial Traditional Login (1:13:48 AM):** This page was set up for username/password-based login. It manages state for `username`, `password`, and `error`, and includes a `handleLogin` function that sends credentials to a `LOGIN` API endpoint. On successful authentication, it stores the received `token`, `user` data, and `authtype` in `localStorage` and navigates to `/app`. A commented-out `useEffect` block suggested a previous or potential token verification mechanism that was disabled.
    *   **Login Logic Enhancements (1:17:14 AM - 12:31:47 PM):**
        *   At **10:37:17 AM**, significant improvements were made to the `handleLogin` function: client-side validation for `username` and `password` was added, error handling for parsing server responses was made more robust, and nullish coalescing operators were introduced when setting `localStorage` items to prevent `null`/`undefined` values.
        *   Minor debugging `console.log` statements were added for `authtype` and API response data at subsequent timestamps.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\components\core\sidebar.tsx`**
    *   **Sidebar Configuration (11:33:11 AM):** This component was updated to dynamically configure its menu based on the user's role. It fetches the `localUserRole` from `localStorage`, and specifically disables the "Preferences" menu item for "ADMIN_V2" roles. It also integrates a `SelectCustomerPanel` for admin roles and displays user information.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\components\core\usercard.tsx`**
    *   **Logout Mechanism Refinement (1:21:18 PM):** The `handleLogout` function underwent a critical modification. Previously, `auth0` logouts would redirect to `/logout`. The updated logic now ensures that `localStorage` items (`token`, `user`) are explicitly cleared and a Redux logout action is dispatched *before* redirecting. For `auth0` users, the redirection is now to `${link}/login` instead of `/logout`, while for "normal" authtypes, it navigates to `/`.

**Patterns and Recurring Elements:**

*   **Authentication Flow Focus:** The changes consistently address various aspects of user authentication, including token verification (ConnectorPage), traditional login (LoginPage), and logout procedures (UserCard).
*   **`localStorage` for Session Management:** `localStorage` is extensively used across components to store user tokens, user details, and the `authtype` for persistent session management.
*   **Conditional Logic based on `authtype`:** The `authtype` (e.g., "auth0" vs. "normal") is a recurring element, dictating different redirection paths and logout behaviors.
*   **API Interaction:** `fetch` API calls are a common pattern for authentication-related endpoints (`VERIFY_TOKEN`, `LOGIN`).
*   **Debugging with `console.log`:** Numerous `console.log` statements were added throughout the files, indicating an active debugging phase during these changes.
*   **Redux Integration:** `useDispatch` and `useSelector` hooks are used in `ConnectorPage`, `Sidebar`, and `UserCard`, signifying the use of Redux for global state management, especially for authentication status (`auth/logout`).
*   **Consistent UI Kit Usage:** Components like `AuthLayout`, `Button`, `Heading`, `Spinner`, `InputBox`, `Sidebar`, `Dropdown`, and `Avatar` are used across pages and components, indicating a structured design system.

## 3:10:11 PM
The `NotificationRoutes.ts` file saw an update on **11/20/2025, 12:23:53 AM**, which involved setting up GET endpoints for fetching notification details (`/notifications`) and recent update details (`/notifications/recent-updates`), mapping them to corresponding service functions.

The `notificationService.ts` file underwent several rapid iterations:
*   **11/20/2025, 12:35:28 AM**: Initial implementation of `getNotificationDetails` and `getRecentUpdateDetails`. `getNotificationDetails` retrieves user-specific or default notification preferences from `v2_user_details`, queries `v2_notification_log` for audit events, and `shipment_tracking_message` for user messages. It then processes and formats these into a combined, sorted list. `getRecentUpdateDetails` fetches recent updates for a company within the last 10 days, aggregates container details, and generates descriptive summaries.
*   **11/20/2025, 12:41:52 AM**: The `auditEventSql` query within `getNotificationDetails` was modified to broaden its scope. It now *always* includes the `RecentUpdateNotificationFieldIds` through an `ANY($2)` clause, in addition to any user-specific `trueFields`, potentially increasing the range of audit notifications.
*   **11/20/2025, 1:02:32 AM**: The logic for determining user-specific `trueFields` in `getNotificationDetails` was refined. It now explicitly checks if `userEvents` are returned and if the user's `companyname` matches the queried `companyName` before applying personalized preferences, otherwise defaulting to a broader set of fields. Optional chaining (`?.`) was also introduced for safer access to `getEventNotification[0]`.
*   **11/20/2025, 9:43:17 AM**: The optional chaining (`?.`) on `getEventNotification[0]` in `getNotificationDetails` was removed, making the access direct. A new debug `console.log` was added for `req?.user`.
*   **11/20/2025, 9:51:44 AM**: An `else if` condition was added to `getNotificationDetails` to specifically assign `RecentUpdateNotificationFieldIds` if the user is an `ADMIN_V2` and the queried company matches their own. The `trueFields` variable was also given an explicit `any[]` type.
*   **11/20/2025, 9:54:38 AM**: The `else if` condition for `ADMIN_V2` roles, introduced at 9:51:44 AM, was removed, reverting the `trueFields` determination logic. The `trueFields` type declaration also reverted. These indicate a brief experimental change that was then rolled back.
*   **11/20/2025, 9:55:17 AM**: This was a minor change, likely a re-save, with no functional differences from the 9:54:38 AM version.

The `User.ts` file was updated on **11/20/2025, 9:50:05 AM** and re-saved at **11/20/2025, 10:29:31 AM**. The significant change was the addition of `ADMIN_V2` to the `UserRole` enum, introducing a new user role into the system.

The `shipmentRoutes.ts` file, updated on **11/20/2025, 10:48:45 AM**, introduced new routes for document management within shipments. Specifically, endpoints for deleting (`deleteDocument`) and fetching (`fetchUploadedDoc`) documents were added. The route for uploading documents was present but commented out.

The `reports/triggers.ts` file, modified on **11/20/2025, 10:55:47 AM**, saw a major expansion of functionality. It now contains functions (`activeScheduledForSDT`, `activeScheduledForDaily`, `activeScheduledForWeekly`, `activeScheduledForMonthly`) to check for and activate various types of scheduled reports. The `schedulerFunc.triggerReport` function was implemented to dynamically construct SQL queries for `mtr_tracking_data` (and `agent_booking_entry` for booking reports), handle report column selections (including special logic for `pl_no` and ETA filtering), send reports via email, and log report history in `v2_user_reports_history`, deactivating one-time schedules as needed.

**Recurring Elements and Patterns:**
*   All changes occurred on **11/20/2025**, suggesting a period of intense, focused development on notification and reporting features.
*   The `notificationService.ts` file experienced frequent and iterative changes, primarily focused on refining notification filtering logic and user preference handling.
*   Both notification and report services extensively interact with a PostgreSQL database using a shared `query` utility, retrieving user details, audit logs, messages, and tracking data based on `usercode`, `companyName`, and specific `field_id`s.
*   Comprehensive logging (`logger.info`, `console.log`) is consistently used across the services for debugging and operational insights.
*   Error handling with `try...catch` blocks is prevalent in service functions, ensuring robust API responses.
*   Many functions utilize `companyName` from user context or query parameters, indicating a strong emphasis on multi-tenancy or company-specific data access.

## 4:12:21 PM
The file `c:\Users\ridap\OneDrive\Documents\T360_Api\t360-backend\src\types\user.types.ts` was updated on 11/20/2025, 10:28:11 AM.

This update introduces or refines several type definitions:

*   **`User` interface**: Defines the structure for user objects, including `usercode`, `userid`, `firstname`, `lastname`, `emailid`, `role`, `lastmodifieddate`, `lastlogin`, `status`, `companyname`. It also includes several fields that can be `null`, such as `lastmodifiedby`, `send_etachange_alert`, `send_pan_alert`, `show_booking`, and `account_master_cid`. Additionally, `filter_movetype` and `filter_scac_code` are defined as strings.
*   **`QueryType` interface**: Specifies the structure for query parameters, including pagination (`page`, `perPage`), filtering by `roles`, `status`, `userid`, `firstname`, `lastname`, `emailid`, `companyname`, and an `orderBy` field.
*   **`UserRole` enum**: Enumerates various user roles within the system, including `ADMIN`, `AGENT`, `BACKOFFICE`, `CUSTOMER`, `FRONTOFFICE`, `SALES`, and notably introduces a new role, `ADMIN_V2`.

## 4:12:33 PM
The code changes primarily focus on authentication and UI adjustments within a frontend application named T360-V2. Key updates occurred in files related to user authentication flows (`connector-page.tsx`, `login-page.tsx`), sidebar navigation (`sidebar.tsx`), and user profile management (`usercard.tsx`).

### File-Specific Updates:

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\pages\auth\connector-page.tsx`**
    *   **Timestamp: 11/20/2025, 1:07:19 AM**: This file was introduced or significantly updated to handle login via URL parameters (`token`, `authtype`). It verifies the token using an API call, stores user data and the token in local storage, and then redirects to `/app`. If verification fails or no token is found, it logs out the user via Redux and redirects to a login page, dynamically determining the path (`/` for 'auth0', `/` for 'normal' initially).
    *   **Timestamps: 11/20/2025, 1:08:09 AM, 1:10:54 AM, 12:18:39 PM**: Minor debugging additions, mainly `console.log` statements for `path` and `authtype`.
    *   **Timestamp: 11/20/2025, 1:12:04 AM**: The logout redirection logic was updated in the `toLoginPage` function; for non-'auth0' users, the redirection path changed from `/` to `/login`.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\pages\auth\login-page.tsx`**
    *   **Timestamp: 11/20/2025, 1:13:48 AM**: This component handles traditional username/password login. It includes a `handleLogin` function that makes a POST request to a login endpoint, stores `token`, `user`, and `authtype` in local storage upon successful login, and navigates to `/app`. A previously present `useEffect` block for URL token verification was commented out, indicating a separation of concerns with `connector-page.tsx`.
    *   **Timestamp: 11/20/2025, 1:17:14 AM**: Added a `console.log` for `authtype`.
    *   **Timestamp: 11/20/2025, 10:37:17 AM**: Significant enhancements were made to the `handleLogin` function: form event type was specified (`React.FormEvent<HTMLFormElement>`), basic validation for username/password was added, error handling for JSON parsing was improved, and `localStorage.setItem` calls were made more robust with default empty values.
    *   **Timestamps: 11/20/2025, 12:29:09 PM, 12:30:01 PM, 12:31:47 PM**: There appears to be a partial revert or copy-paste issue where the `handleLogin` function returned to an earlier state (e.g., `React.FormEvent` without `HTMLFormElement`, simpler error handling) compared to the 10:37:17 AM version. Minor debugging `console.log` statements for `authtype` and `data` were added during these timestamps.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\components\core\sidebar.tsx`**
    *   **Timestamp: 11/20/2025, 11:33:11 AM**: The sidebar component was configured to dynamically disable the "Preferences" menu item for users with the "ADMIN_V2" role. It also conditionally renders a `SelectCustomerPanel` if the user is an "ADMIN_V2", integrating Redux for customer selection.
    *   **Timestamp: 11/20/2025, 3:41:41 PM**: The condition for displaying the `SelectCustomerPanel` was broadened to include both "ADMIN_V2" and "ADMIN" roles (`localUserRole === "ADMIN_V2" || localUserRole === "ADMIN"`).
    *   **Timestamp: 11/20/2025, 3:47:09 PM**: The logical grouping for the `SelectCustomerPanel` display condition was corrected to `(localUserRole === "ADMIN_V2" || localUserRole === "ADMIN") && (...)` to ensure proper evaluation.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\components\core\usercard.tsx`**
    *   **Timestamp: 11/20/2025, 1:21:18 PM**: The `handleLogout` function was refactored. The new implementation now clears `token` and `user` from local storage *before* initiating redirection. For 'auth0' users, it redirects to the login page (`/login`) of the V1 UI, while for 'normal' users, it navigates to `/`. The `auth/logout` Redux action is consistently dispatched for both authentication types.

### Patterns and Recurring Elements:

*   **Authentication and Session Management**: A strong focus on handling user authentication, token verification, and session persistence using `localStorage` for `token`, `user`, and `authtype`.
*   **Redux Integration**: Consistent use of `useDispatch` for dispatching logout actions and `useSelector` in `sidebar.tsx` for global state (e.g., `selectedCustomer`), indicating Redux is a central state management tool.
*   **Role-Based UI/Access**: Logic to differentiate user experiences based on roles (e.g., "ADMIN_V2", "ADMIN") is implemented in the sidebar to control menu item visibility and functionality.
*   **Debugging Practices**: Frequent addition of `console.log` statements across different files, especially during initial development and modification of authentication flows, suggests an iterative debugging approach.
*   **Conditional Redirection**: The application implements conditional redirection logic based on `authtype` (Auth0 vs. normal) for both login and logout flows, often leveraging `import.meta.env.VITE_UI_V1_BASE_URL` for dynamic URL construction.
*   **API Interactions**: Both `connector-page.tsx` and `login-page.tsx` demonstrate interaction with backend APIs (`ENDPOINTS.VERIFY_TOKEN()`, `ENDPOINTS.LOGIN()`) for authentication.

## 4:12:42 PM
The changes primarily focus on enhancing notification functionality and introducing a comprehensive report scheduling system, alongside minor updates to user roles and shipment routes.

**File-Specific Updates:**

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-backend-v2\src\routes\NotificationRoutes.ts`**
    *   **Timestamp: 11/20/2025, 12:23:53 AM**
    *   This file was updated to define two new GET routes for notification retrieval: `/api/notification/get` mapping to `getNotificationDetails` and `/api/notification/recent-update` mapping to `getRecentUpdateDetails`.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-backend-v2\src\services\notificationService.ts`**
    *   **Timestamp: 11/20/2025, 12:35:28 AM**
        *   Initial implementation of `getNotificationDetails` and `getRecentUpdateDetails`.
        *   `getNotificationDetails` retrieves both audit logs (`v2_notification_log`) and user messages (`shipment_tracking_message`), combines, sorts, and limits them. It incorporates dynamic field selection based on user preferences from `v2_user_details` or a default set. Notification descriptions are generated based on `StatusMap` and specific event types.
        *   `getRecentUpdateDetails` fetches recent (last 10 days) notification logs, processes them to count unique container numbers, and generates consolidated descriptions for status updates like "Empty out" or "Vessel arrived".
        *   Common constants like `StatusMap` and `RecentUpdateNotificationFieldIds` are introduced.
    *   **Timestamp: 11/20/2025, 12:41:52 AM**
        *   The `auditEventSql` query in `getNotificationDetails` was modified to include a broader filter: `field_id IN (...) OR field_id = ANY($2)`, allowing both user-specific and a predefined set of fields (`RecentUpdateNotificationFieldIds`) to be considered.
    *   **Timestamp: 11/20/2025, 1:02:32 AM**
        *   Refined the logic within `getNotificationDetails` for determining `trueFields`. It now explicitly checks for a match between `req.user?.companyname` and the queried `companyName` to prioritize user-specific notification preferences, falling back to default company fields otherwise. Added console logs for debugging this logic.
    *   **Timestamp: 11/20/2025, 9:43:17 AM**
        *   A debugging line `console.log("*****req?.user****:", req?.user);` was added to `getNotificationDetails`.
    *   **Timestamp: 11/20/2025, 9:51:44 AM**
        *   Further refined the `trueFields` logic in `getNotificationDetails` to include an `else if` condition. This new condition specifically assigns `RecentUpdateNotificationFieldIds` if `req.query.CompanyName` matches `companyName` and the user's role is `ADMIN_V2`.
    *   **Timestamp: 11/20/2025, 9:54:38 AM** and **11/20/2025, 9:55:17 AM**
        *   The `else if` condition for `ADMIN_V2` added at 9:51:44 AM appears to have been reverted or not saved consistently in these subsequent log entries for the same file, as the code reverts to the previous `if/else` structure for `trueFields`.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-backend-v2\src\models\User.ts`**
    *   **Timestamp: 11/20/2025, 9:50:05 AM** and **11/20/2025, 10:29:31 AM**
    *   The `UserRole` enum was updated to include a new role: `ADMIN_V2`. No other functional changes were noted.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-backend-v2\src\routes\shipmentRoutes.ts`**
    *   **Timestamp: 11/20/2025, 10:48:45 AM**
    *   A line related to `uploadDocuments` using `uploadMiddleware` was commented out, effectively disabling that specific document upload route.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-backend-v2\src\services\reports\triggers.ts`**
    *   **Timestamp: 11/20/2025, 10:55:47 AM**
    *   This file introduces a new report scheduling system.
    *   Functions `activeScheduledForSDT`, `activeScheduledForDaily`, `activeScheduledForWeekly`, and `activeScheduledForMonthly` are implemented. These check for active schedules in `v2_user_reports` based on their respective frequencies and trigger reports if the scheduled time/day matches the current UTC time.
    *   The `schedulerFunc.scheduleReport` function is responsible for initiating a report after a short, random delay.
    *   The core logic resides in `schedulerFunc.triggerReport`, which dynamically constructs SQL queries based on report columns, handles special cases like `pl_no` and "booking reports," applies ETA filtering, fetches data, sends reports via email, and logs the report history. Non-repetitive reports are deactivated after execution.

**Timestamps of Significant Changes:**

*   **11/20/2025, 12:35:28 AM:** Initial comprehensive implementation of notification services.
*   **11/20/2025, 1:02:32 AM:** Refinement of user-specific notification preferences logic in `notificationService.ts`.
*   **11/20/2025, 9:50:05 AM:** Addition of the `ADMIN_V2` user role.
*   **11/20/2025, 10:55:47 AM:** Introduction of the complete report scheduling and generation system.

**Patterns and Recurring Elements:**

*   **Iterative Development on Notification Service:** The `notificationService.ts` file saw frequent updates and refinements within a short time frame, suggesting active development, debugging, and iteration on how notifications are fetched and personalized.
*   **Database-Centric Operations:** A strong pattern is the extensive use of direct SQL queries via a `query` utility, indicating a backend heavily reliant on relational database interactions. Tables like `v2_notification_log`, `v2_user_details`, `shipment_tracking_message`, `mtr_tracking_data`, and `v2_user_reports` are frequently accessed.
*   **User Context and Personalization:** Logic in `notificationService.ts` for `trueFields` consistently attempts to personalize notification content based on the logged-in user's `usercode` and `companyname`, falling back to default settings when specific preferences are not found.
*   **Structured Error Handling and Logging:** Both notification and report services consistently use `try...catch` blocks for error management and `logger.info`/`logger.error` for operational logging, including logging SQL queries and parameters.
*   **Complex Business Logic:** The `notificationService.ts` file involves intricate logic for merging different types of notifications, generating human-readable descriptions, and dynamic SQL query construction. Similarly, `reports/triggers.ts` demonstrates complex scheduling, dynamic query building based on report configurations, and external integrations (emailing).
*   **Timestamp Inconsistencies:** Multiple log entries for `notificationService.ts` have identical code content at slightly different timestamps, or show a change that is then seemingly reverted in the immediate next log entry, which could indicate frequent saving, reformatting, or transient code changes not fully committed.

## 4:13:03 PM
The provided log details recent development activities across several frontend components, primarily focusing on booking management and user administration.

**File-Specific Updates and Significant Changes:**

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\components\screen\booking\actions.js`**
    *   **11/19/2025, 11:48:44 AM**: Underwent a major refactoring. The monolithic `getBookingActions` function, previously using deeply nested ternary operators for role-based actions, was broken down into smaller, reusable action arrays (`bookingActions`, `isfActions`, `hblAction`, `viewAction`, `updateLineBookingAction`, `updateDOAction`). These arrays are now conditionally spread into the returned action list based on user access (`access?.agentBookingMenu`, `access?.customerBookingMenu`, `access?.adminBookingMenu`), significantly improving readability and modularity. New `updateLineBookingAction` and `updateDOAction` sets were introduced for agent and admin roles.
    *   **11/19/2025, 11:49:42 AM**: Added a "View ISF List" action to `isfActions`.
    *   **11/19/2025, 11:52:06 AM**: The "View ISF List" action's icon was changed from `<Edit />` to `<RemoveRedEyeOutlined />`, and its modal `type` was updated to `'view-isf'`.
    *   **11/19/2025, 4:35:35 PM**: A new export function `getISFActions` was introduced, initially defining an "Edit ISF" action and returning a generic `viewAction`.
    *   **11/19/2025, 4:36:26 PM**: The `getISFActions` function was immediately updated to correctly return the specific `isfActions` instead of the generic `viewAction`, indicating an intention for distinct ISF-related functionalities.
    *   **11/19/2025, 4:37:36 PM - 4:38:35 PM**: The `onClick` handler for "Edit ISF" within `getISFActions` was temporarily commented out and replaced with a `console.log` statement, likely for debugging purposes.

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\pages\booking\BookingDashbaordScreenExtend.jsx`**
    *   **11/19/2025, 11:51:49 AM**: Integrates new UI components (`UpdateLineBookingForm`, `UpdateDOForm`). It dynamically configures grid and card columns using the `getBookingActions` function from `actions.js` for role-based actions. The file also shows an expansion of displayed `columns` data, including many new fields as placeholders.
    *   **11/19/2025, 11:55:12 AM - 11:57:14 AM**: Imports and correctly case-corrects `ISFListDetails`, signaling its upcoming or ongoing integration.

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\components\screen\booking\IsfListDetails.jsx`**
    *   **11/19/2025, 11:55:02 AM**: Initial creation of the `ISFListDetails` component. It was designed as a Formik-based form to display and manage PO, Inventory, and Vessel details, including approval/cancellation logic.
    *   **11/19/2025, 12:03:06 PM - 12:03:39 PM**: The main form sections (PO, Inventory, Vessel, Reason) were removed, and a "New ISF" button was added, transforming the component's focus from a detailed approval form to more of a list/overview page.
    *   **11/19/2025, 12:04:58 PM**: The "New ISF" button was converted to a custom `ThemeButton` with an `<Add />` icon.
    *   **11/19/2025, 12:06:41 PM - 12:09:06 PM**: Minor layout adjustments were made to the header section using MUI `Box` and `Stack` properties for spacing and alignment.
    *   **11/19/2025, 12:12:22 PM**: Introduced `ThemedGrid` to display a list of ISF data, replacing placeholder data with `isfDummyData`.
    *   **11/19/2025, 12:17:22 PM**: Significant cleanup removed many unused imports and component instances (e.g., `DynamicEditableTable`, `RadioSelectTable`, approval logic components) that were part of its original form-centric design, streamlining it for its new list-view purpose.
    *   **11/19/2025, 12:17:56 PM**: The `ThemedGrid` was configured to use `ISF_COLUMNS` for its column definitions, aligning with the component's role as an ISF list.
    *   **11/19/2025, 4:25:49 PM - 4:26:46 PM**: Integrated `useAccess`, `GridActions`, and `getBookingActions` (later `getISFActions`) to enable dynamic, role-based actions for each row in the `ThemedGrid`. `useNavigate` was also added to correctly handle navigation within these actions.
    *   **11/19/2025, 4:36:38 PM**: Switched `GridActions` to use the newly created `getISFActions` from `actions.js`, ensuring specific ISF actions are available for the grid rows.

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\data\columns\agent.booking.js`**
    *   Throughout the log (11/19/2025, 12:17:42 PM - 4:40:43 PM), this file appears to remain largely static, defining standard column configurations for various booking-related tables like `BOOKING_VESSEL_COLUMN`, `BOOKING_CARGO_COLUMN`, and `BOOKING_DASHBOARD_COLUMNS_GRID`. There is a notable discrepancy where `IsfListDetails.jsx` attempts to import `ISF_COLUMNS` at 11/19/2025, 12:17:56 PM, but the provided log content for `agent.booking.js` at subsequent timestamps does not explicitly define `ISF_COLUMNS`.

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\components\screen\booking\card\BookingCardItemExtend.jsx`**
    *   **11/19/2025, 11:59:00 AM**: Enhanced data display with the `useFormat` hook for consistent formatting of weight and CBM values. Minor cleanups included removing commented-out `CardField` elements and a numerical suffix from a `Typography` label.

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\App.js`**
    *   **11/20/2025, 12:08:07 AM**: Initial state shows a comprehensive routing setup with `ProtectedRoute` for role-based access.
    *   **11/20/2025, 12:08:07 AM**: The root path `/` for `LoginScreen` was commented out, directing the root to `Auth0Login`, indicating a shift to Auth0 as the primary authentication method.
    *   **11/20/2025, 12:13:10 PM**: The `LoginScreen` route was reactivated at `/login`, allowing both Auth0 and a traditional login flow.
    *   **11/20/2025, 12:16:05 PM**: The `UserRoleEnum.ADMIN_V2` role was added to the `allowedRoles` for the main `/app` protected route, granting it general application access.
    *   **11/20/2025, 2:11:09 PM**: `UserRoleEnum.ADMIN_V2` was temporarily commented out from the main `/app` protected route.
    *   **11/20/2025, 3:29:26 PM**: `UserRoleEnum.ADMIN_V2` was specifically added to the `allowedRoles` for the `/app/booking` route, granting this new role access to the booking dashboard while potentially remaining restricted from other `/app` sections.

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\components\screen\user-management\UserForm.jsx`**
    *   **11/20/2025, 2:45:19 PM**: Logic for `payload.module_config` for ISF roles and permissions was introduced. A switch for "Enable New Customer Dashboard (T360 V2)" was included for `CUSTOMER` and `ADMIN_V2` roles (initially with a logical error in the condition).
    *   **11/20/2025, 2:51:42 PM**: The logical error in the V2 dashboard switch condition was corrected by separating the `ADMIN_V2` condition into its own block.
    *   **11/20/2025, 3:02:16 PM - 3:13:56 PM**: `console.log` statements were added for debugging form values and payload. Logic to explicitly set `payload.v2_flag = true` for `ADMIN_V2` roles was introduced and then frequently debated/reverted/re-added in subsequent commits.
    *   **11/20/2025, 3:17:17 PM - 3:27:26 PM**: There was a back-and-forth in handling the `v2_flag` for `ADMIN_V2`. Initially, an attempt to force `v2_flag = true` via the `onChange` handler was made (3:17:17 PM), which was then reverted (3:17:40 PM). A `useEffect` hook was added (3:21:47 PM) to set `v2_flag` to `true` when the role is `ADMIN_V2`, and the UI switch for `ADMIN_V2` was made `checked={true}` and `disabled={true}` to reflect this enforced state. The logic to set `payload.v2_flag = true` in `onSubmit` was eventually removed (3:27:26 PM), solidifying the `useEffect` and UI state as the source of truth for this flag.

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\components\screen\user-management\menu-permissions\MenuPermission.jsx`**
    *   **11/20/2025, 3:48:53 PM**: Initial creation. This component fetches and displays menu permissions based on a user's role and their already assigned menus from the backend. It uses `TreeViewContianer` to render these permissions, indicating a granular control system for user interfaces.

**Patterns and Recurring Elements:**

1.  **Role-Based Access Control (RBAC)**: A dominant theme across all modified files. User roles (`UserRoleEnum`) extensively dictate available actions, UI components, and routing, emphasizing a fine-grained permission system.
2.  **Modularity and Refactoring**: The `actions.js` file shows a strong pattern of breaking down complex logic into smaller, reusable functions and data structures. This improves maintainability and readability.
3.  **Dynamic UI Rendering**: Components frequently adjust their display or behavior based on user roles or specific data (e.g., dynamic action buttons in grids, conditional form fields).
4.  **Form Management with Formik**: `UserForm.jsx` heavily leverages Formik for handling form state, validation, and submission, indicating a consistent approach to forms.
5.  **State Management**: Extensive use of React's `useState` and Redux Toolkit Query for managing local and global application state, including loading indicators (`isLoading`, `isFetching`).
6.  **Navigation**: `useNavigate` from `react-router-dom` is frequently used to handle programmatic navigation within the application, often passing state parameters.
7.  **"T360 V2" Feature Flag**: The repeated addition, removal, and refinement of the `v2_flag` for the "Enable New Customer Dashboard (T360 V2)" feature across `App.js` and `UserForm.jsx` highlights an ongoing development or rollout of a new version of the customer dashboard, with specific access rules being implemented for `CUSTOMER` and `ADMIN_V2` roles.
8.  **Debugging Practices**: Several `console.log` statements appear and disappear throughout the log, indicating active development and debugging.
9.  **Component Reusability**: Custom components like `InputBox`, `SelectBox`, `ThemeButton`, `AppAutocomplete`, `ThemedGrid`, and `ChipAutocomplete` are consistently used, promoting a cohesive UI and reducing code duplication.

## 5:12:22 PM
The file `c:\Users\ridap\OneDrive\Documents\T360_Api\t360-backend\src\types\user.types.ts` was updated on 11/20/2025, 10:28:11 AM.

This update focuses on defining data structures related to user management within the application:
*   **`User` interface:** This interface outlines the comprehensive structure of a user object, including personal details (`firstname`, `lastname`, `emailid`), account information (`usercode`, `userid`, `companyname`), role (`role`), timestamps (`lastmodifieddate`, `lastlogin`), status, and various filter and alert preferences (`filter_movetype`, `filter_scac_code`, `send_etachange_alert`, `send_pan_alert`, `show_booking`, `account_master_cid`). Notably, some fields like `lastmodifiedby`, `send_etachange_alert`, `send_pan_alert`, and `show_booking` are explicitly typed to allow `null` values.
*   **`QueryType` interface:** This interface defines the expected parameters for querying users, allowing filtering and pagination based on `page`, `perPage`, `roles`, `status`, `userid`, `firstname`, `lastname`, `emailid`, `companyname`, and `orderBy`.
*   **`UserRole` enum:** This enumeration lists distinct user roles supported by the system: `ADMIN`, `AGENT`, `BACKOFFICE`, `CUSTOMER`, `FRONTOFFICE`, `SALES`, and `ADMIN_V2`. The inclusion of `ADMIN_V2` suggests a recent expansion or refinement of administrative user classifications.

The overall pattern indicates a clear focus on robust type definitions for user data and user-related queries, essential for maintaining data consistency and facilitating development in a TypeScript environment.

## 5:12:46 PM
This log details a day's worth of changes, all occurring on November 20, 2025, primarily focusing on authentication flows and sidebar functionality within a T360 frontend application.

**File-Specific Updates:**

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\pages\auth\connector-page.tsx`**
    *   **Timestamp Highlights:** Changes observed between 1:07 AM and 12:18 PM.
    *   This file handles the logic for connecting to the application via a token received from URL parameters, likely from an external authentication provider like T360.
    *   **Key Changes:**
        *   Initial implementation focused on verifying the token via an API call, storing the token and user data in `localStorage`, and redirecting to the `/app` route on successful login (1:07 AM).
        *   An explicit logout function, `toLoginPage`, was added, which dispatches a Redux logout action and redirects the user to a base URL (1:07 AM).
        *   The redirection path within `toLoginPage` was updated from always ` /` to `/login` for non-Auth0 authentication types, while keeping `/` for Auth0 (1:12 AM).
        *   Multiple `console.log` statements were added/repositioned for debugging `authtype` and the redirection `path` throughout the day (1:08 AM, 1:10 AM, 12:18 PM).

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\pages\auth\login-page.tsx`**
    *   **Timestamp Highlights:** Changes observed between 1:13 AM and 12:31 PM.
    *   This file implements a traditional username and password login form.
    *   **Key Changes:**
        *   The component was set up with state for username, password, and error messages, and a `handleLogin` function to perform a POST request to the login API endpoint (1:13 AM).
        *   Upon successful login, the received token, user data, and `authtype` are stored in `localStorage`, and the user is navigated to `/app` (1:13 AM).
        *   A significant update added basic client-side validation for username and password, improved API response parsing to handle invalid JSON, and made `localStorage` assignments safer by providing default empty values (10:37 AM).
        *   Similar to `connector-page.tsx`, `console.log` statements were added and removed for debugging purposes, primarily for `authtype` and API response data (1:17 AM, 12:29 PM, 12:30 PM).
        *   An extensive `useEffect` block, possibly related to an old token-based login flow, was commented out, indicating a shift in the primary login mechanism for this page.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\components\core\sidebar.tsx`**
    *   **Timestamp Highlights:** Changes observed between 11:33 AM and 4:58 PM.
    *   This component represents the application's main navigation sidebar.
    *   **Key Changes:**
        *   Initial setup included fetching the user role from `localStorage` to conditionally disable certain menu items (e.g., "Preferences" for "ADMIN_V2" roles) and display a `SelectCustomerPanel` (11:33 AM).
        *   The `SelectCustomerPanel`'s visibility was expanded to include both "ADMIN_V2" and "ADMIN" roles (3:41 PM).
        *   A subsequent change corrected the logical grouping of the conditional expression for `SelectCustomerPanel`'s visibility (3:47 PM).
        *   Later, the `SelectCustomerPanel`'s visibility was reverted, making it accessible only to "ADMIN_V2" roles again (4:58 PM). This indicates some indecision or iterative changes regarding role-based access for this feature.
        *   `console.log` for `localUserRole` was added for debugging.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\components\core\usercard.tsx`**
    *   **Timestamp Highlight:** Only one entry at 1:21 PM.
    *   This component displays user information in the sidebar and provides logout functionality.
    *   **Key Changes:**
        *   Implements a `handleLogout` function that differentiates between "auth0" and "normal" authentication types.
        *   Both logout paths clear `token` and `user` from `localStorage` and dispatch a Redux `auth/logout` action.
        *   Auth0 logout redirects to a specific `/login` page on the `VITE_UI_V1_BASE_URL` using `window.location.href`.
        *   Normal logout navigates to the application's root (`/`) using `react-router-dom`'s `useNavigate`.
        *   Commented-out code suggests previous alternative logout logic for `localStorage.removeItem('authtype')` and redirection behavior.

**Patterns and Recurring Elements:**

*   **Authentication as a Central Theme:** A significant portion of the changes revolves around user authentication, including token verification, traditional login, session management using `localStorage`, and distinct logout flows for different authentication providers (e.g., Auth0 vs. normal).
*   **`localStorage` for Session Management:** `localStorage` is extensively used across multiple files (`connector-page.tsx`, `login-page.tsx`, `sidebar.tsx`, `usercard.tsx`) to store critical user session information like `token`, `user` object, and `authtype`.
*   **Redux Integration:** The use of `useDispatch` for `auth/logout` actions in `connector-page.tsx` and `usercard.tsx`, and `useSelector` in `sidebar.tsx`, indicates the presence and active use of Redux for global state management related to authentication and user context.
*   **Debugging via `console.log`:** Numerous `console.log` statements were added, removed, or repositioned throughout the development process, particularly for tracking authentication parameters (`token`, `authtype`) and redirection paths, suggesting active debugging efforts.
*   **Conditional Rendering/Logic Based on User Roles/Auth Type:** Logic frequently checks the `authtype` (for redirection on logout) and `user.role` (for sidebar item disabling or component visibility) to tailor the user experience.
*   **Dual Navigation Strategies:** Both `react-router-dom`'s `useNavigate` and direct `window.location.href` assignments are utilized for navigation, often conditionally based on the authentication context.
*   **Iterative Development & Refinement:** The frequent, small changes, including additions and removals of `console.log`s, and the back-and-forth adjustments in the `sidebar.tsx` component's conditional logic, suggest an iterative development process with continuous testing and refinement.

## 6:58:52 PM
The code changes primarily focus on refining user authentication and implementing conditional redirection to a "V2 UI" based on user roles. All modifications occurred on 11/20/2025, within a span of approximately 20 minutes, indicating a concentrated effort on these features.

**File-Specific Updates:**

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\pages\LoginScreen.jsx`**
    *   **Initial Update (11/20/2025, 6:06:35 PM):** Introduced a conditional redirect within the `handleSubmit` function. If a user's role is `CUSTOMER` and `v2_flag` is true, the user is redirected to a V2 UI URL derived from `process.env.REACT_APP_V2_UI_BASE_URL`, including their token and `authtype=normal`. Otherwise, the user's details are dispatched to Redux, and they are navigated to `/app` or a specified `redirectUrl`.
    *   **Refinement (11/20/2025, 6:07:02 PM):** The conditional redirect logic was expanded to include users with the `ADMIN_V2` role in addition to `CUSTOMER` role, meaning `(res.user.role === UserRoleEnum.CUSTOMER || res.user.role === UserRoleEnum.ADMIN_V2) && res.user.v2_flag` triggers the V2 UI redirection.
    *   **Cleanup (11/20/2025, 6:25:53 PM):** Removed debug `console.log` statements related to `res.user.role` and `redirectUrl` from the `handleSubmit` function.

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\HandleAuthCallback.js`**
    *   **New/Significant Update (11/20/2025, 6:07:47 PM):** This file was updated to handle Auth0 authentication callbacks. It integrates `useAuth0` to verify authenticated users. Similar to the `LoginScreen`, it implements a conditional redirect to the V2 UI if the user's role is `CUSTOMER` or `ADMIN_V2` and `v2_flag` is true, using `process.env.REACT_APP_V2_UI_BASE_URL` with the Auth0 token and `authtype=auth0`. For other users, it dispatches user details to Redux and navigates based on a `redirect_url` stored in `localStorage` or defaults to `/app`. It also includes logic to navigate to a registration page if the user is not found. The component displays "Please wait while we verify your information..." with a `CircularProgress` during processing.

**Patterns and Recurring Elements:**

*   **V2 UI Redirection Logic:** A consistent pattern across `LoginScreen.jsx` and `HandleAuthCallback.js` is the implementation of a conditional redirect to a V2 UI. This redirect is triggered when a user, either a `CUSTOMER` or an `ADMIN_V2`, has a `v2_flag` set to true.
*   **Environment Variable Usage:** The V2 UI base URL is consistently retrieved from `process.env.REACT_APP_V2_UI_BASE_URL`, highlighting reliance on environment-specific configurations.
*   **Auth0 Integration:** While `LoginScreen.jsx` has commented-out Auth0 login functionality, `HandleAuthCallback.js` fully implements Auth0 callback processing, indicating an active integration of Auth0 for user authentication.
*   **Redux State Management:** Both files utilize `useDispatch` and the `login` action from the `authSlice` to manage the authenticated user's state.
*   **User Role Enum:** The `UserRoleEnum` (imported from `../data/enums`) is consistently used to check and compare user roles.
*   **Navigation:** `useNavigate` from `react-router-dom` is used for client-side routing, while `window.location.href` is used for hard redirects to the V2 UI.

## 7:00:59 PM
**File: `c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\components\core\usercard.tsx`**
**Timestamp: 11/20/2025, 6:35:28 PM**
The `UserCard` component, responsible for displaying user information and providing a sign-out option, underwent a significant refactor in its `handleLogout` function. The core change involves the order of operations during logout, particularly for Auth0 authentication. Previously, `localStorage` items (`token`, `user`) and the Redux `auth/logout` dispatch were handled *after* initiating the `window.location.href` redirect for Auth0, and *after* `nav("/")` for normal logout. The updated logic now ensures that these client-side cleanup actions (removing items from `localStorage` and dispatching the logout action) are performed *before* the redirection for Auth0 or navigation for other authentication types. The `VITE_UI_V1_BASE_URL` environment variable is used to construct the Auth0 logout URL. The component also imports various UI components (e.g., `Dropdown`, `Avatar`) and utilizes `react-icons` for logout and dropdown arrow icons. It fetches user preferences using `useFetchUserPreferenceQuery` and falls back to `localStorage` for user details if the preference data is not available.

**Patterns/Recurring Elements:**
*   **Logout Mechanism Refinement:** A recurring theme is the careful handling of the logout process, specifically ensuring client-side state cleanup (removing `localStorage` items, dispatching Redux actions) occurs reliably and promptly, even when external redirects (like Auth0) are involved.
*   **Authentication Type Differentiation:** The code consistently differentiates between "auth0" and other authentication types, suggesting a system that supports multiple authentication providers.
*   **Environment Variable Usage:** The use of `import.meta.env.VITE_UI_V1_BASE_URL` indicates a pattern of using environment variables to configure URLs or other dynamic settings, making the application more flexible and configurable across different deployment environments.
*   **UI Component Reusability:** The component extensively uses reusable UI primitives like `Dropdown`, `Avatar`, and `SidebarItem` from a local `../kit` directory, pointing to a structured approach to UI development.