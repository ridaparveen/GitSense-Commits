# Activity Summary for 9/17/2025

## 11:14:47 AM
The primary file modified, `c:\Users\ridap\OneDrive\Documents\Envosyes\envosys-frontend\src\store\fretures\lineBookingSlice.ts`, on 9/17/2025 at 11:14:15 AM, is a Redux slice managing line bookings.  It defines reducers for various actions: `addList` (adds a new line booking, generating a unique serial ID if not in edit mode), `updateList` (updates an existing line booking), `removeList` (removes a line booking), `resetLineBooking` (resets the entire state), `clearBookings` (clears the line bookings array), `setLineBookings` (sets the line bookings and vessel voyage ID), `setVesselVoyageId` (sets the vessel voyage ID), and `initializeNewBookingSession` (initializes a new booking session).  The code uses a unique identifier, often `serial_id`, to manage and update items in the `line_bookings` array.  A significant portion of the code is focused on managing and updating the `serial_id` field for UI consistency across add, update, and delete operations.  The `idField` parameter provides flexibility in specifying the ID field if it's not `serial_id`.


## 12:14:29 PM
The `linebookingService.ts` file, updated on September 17, 2025, at 11:40:59 AM,  defines services for managing line bookings.  Key functionalities include creating, retrieving, and updating line bookings, along with their associated equipment.

The `create` function inserts new line bookings into the `line_booking_master` and `line_booking_equipments` tables. It uses transactions (`BEGIN` and `COMMIT`) to ensure data consistency and checks for existing bookings with the same `line_booking_no`.

The `getAll` function retrieves all line bookings, applying pagination and filtering based on various parameters (page number, status, dates, location codes, line name, and order).  It dynamically constructs SQL queries using a `QueryBuilder` class, efficiently fetching data and including related equipment details.  The query is logged using a logger.

The `getByVesselVoyageId` function retrieves line bookings associated with a specific vessel voyage ID, including equipment information.

The `update` function handles both updates and insertions of line bookings. If a `serial_id` is provided in the request body, it updates the existing record in `line_booking_master` and replaces the associated equipment in `line_booking_equipments`. Otherwise, it creates a new line booking. Transaction management ensures data integrity during updates.  A commented-out section suggests previous logic for mandatory `serial_id` in update requests, which was possibly removed or altered in this commit.

Throughout the code,  `query` and `insertQuery` functions are used extensively for database interactions.  Error handling is implemented using `try...catch` blocks, returning appropriate HTTP status codes.  The code uses `moment.js` for date manipulation. A common pattern is the retrieval of line booking equipment details via separate queries after fetching main booking details.
