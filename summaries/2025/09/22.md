# Activity Summary for 9/22/2025

## 11:35:34 AM
On September 22nd, 2025, significant changes were made to the `envosys-backend` application.

At 10:35:41 AM, the `index.ts` file within the `src/routes` directory was updated. This file acts as a routing hub, registering various API endpoints.  The update involved registering new routes for authentication (`AuthRoutes`), master data (`MasterRoutes`), line bookings (`LineBookingRoutes`), customer bookings (`CustomerBookingRoutes`), document uploads (`DocumentRoutes`), vessels (`VesselRoutes`), vessel and voyages (`VesselAndVoyageRoutes`), and vendors (`VendorRoutes`).  An autocomplete endpoint using the `getAll` service function was also added.  The code uses the `express` router to define and organize these routes.

Later, at 11:25:33 AM, the `vendorServices.ts` file (located in `src/services`) was modified. This file contains functions for managing vendor data.  The update introduced three key functions: `getAll`, `addVendor`, and `updateVendor`.  `getAll` retrieves vendor data with pagination, sorting, and filtering capabilities. `addVendor` creates new vendor entries, and `updateVendor` updates existing ones.  All three functions include robust error handling, logging errors using a logger, and returning appropriate HTTP status codes.  The code uses a custom `QueryBuilder` class for database interactions and leverages parameterized queries for security.  Input validation is performed to prevent invalid data from being accepted.


## 11:35:58 AM
The log shows modifications to components related to a vessel voyage dashboard in a React application.  The `OverviewContainer.tsx` component underwent significant changes between 11:15 AM and 11:29 AM.  Initially, it displayed static data (`vesselVoyogeData`).  Subsequent updates integrated Redux using `useSelector` and `useDispatch` to fetch and display dynamic voyage data from the `voyageDashboardSlice` and `vesselAndVoyageDataApi`.  The data displayed was modified from displaying counts of vessels to counts of voyages.  A `DatePeriodSelector` component was added to allow filtering of data based on a date range and period.

The `voyageDashboardSlice.ts` file (modified at 11:20:07 AM) defines Redux slices for managing pagination, filters (date range, status, vessel name, line name, serial ID), and sorting of vessel voyage data.  The `setDateRange` and `setPeriod` actions are used by `OverviewContainer.tsx` to update date range and period selection respectively.

The `store.ts` file (modified at 11:20:48 AM) configures the Redux store, including the `voyageDashboardSlice` and several other reducers and API middleware.

Finally, the `VesselVoyageDashboard.tsx` component (modified between 11:33 AM and 11:35 AM) displays a table of vessel voyage data using `AppGrid`. The initial version used static data from `vesselData`, but this was later replaced by fetching data dynamically from `useFetchVoyageDashboardDataQuery` with filters and pagination from Redux's `voyageDashboardSlice`. The component includes search, filtering, sorting, and data export functionalities.  A key change here was the replacement of  the data source for the `AppGrid` from local state to the fetched `vesselVoyageDashboardData`.  Initially, the commented out code for the filter parameter showed it was intended to use the state from the redux store.


## 12:35:35 PM
The log shows multiple revisions of the `vesselAndVoyageService.ts` file between 11:53 AM and 11:59 AM on September 22, 2025.  The changes primarily focus on the `getAll` function, specifically its pagination logic.

Initially, the offset calculation in `getAll` was incorrect: `offset = (Number(page) - 1) * Number(perPage);`.  This was changed to `offset = Number(page) * Number(perPage);` at 11:55:19 AM, then reverted back to the original correct calculation at 11:59:08 AM.  A `console.log` statement was added to debug the offset value at 11:56:14 AM.

Between 11:53:33 AM and 11:54:34 AM, a minor correction was made in the `getAll` function's response.  The `total` count in pagination was updated to include a fallback value of 0 using the nullish coalescing operator (`|| 0`).

No other significant functional changes were made to the other functions (`CreateVesselAndVoyage`, `fetchVesselAndVoyageData`, `getVesselAndVoyageDashboardCardInfo`, `UpdateVesselAndVoyage`) across the revisions.  These functions consistently use database interaction functions (`insertQuery`, `query`, `updateQuery`) and handle transactions using `BEGIN` and `COMMIT` or `ROLLBACK` blocks.  They also consistently return JSON responses with status indicators ("success" or "error").  The code shows consistent use of asynchronous functions and error handling.


## 12:36:08 PM
The log shows a series of modifications to the `VesselVoyageDashboard.tsx` component and a related `common.ts` file between 11:36 AM and 12:34 PM on September 22, 2025.  The primary focus of the changes is enhancing the functionality and user interface of a vessel voyage dashboard.


**`c:\Users\ridap\OneDrive\Documents\Envosyes\envosys-frontend\src\components\screen\vessel-voyage\VesselVoyageDashboard.tsx` Changes:**

* **Initial Commit (11:36:02 AM):** This commit established the basic structure of the component, including search, filtering, sorting, pagination, and data export functionality.  It utilized dummy data and  local state management.

* **Redux Integration (11:39:49 AM):**  `useDispatch` was added, shifting from local state to Redux for pagination management using the `voyageDashboardSetPagination` action.

* **API Data Fetching (11:39:49 AM - 11:47:48 AM):** Several commits involved refining how data is fetched from the API (`useFetchVoyageDashboardDataQuery`). Initially, all filter parameters were passed, but this was later commented out. The final version uses a subset of the Redux state for filtering and pagination.  The `AppGrid` component was updated to use the API's pagination data (`vesselVoyageDashboardData?.pagination?.total`).


* **Sorting Enhancement (11:43:54 AM - 11:47:48 AM):** The `handleSortChange` function was modified to dispatch Redux actions (`setVoyageDashboardSortBy` and `voyageDashboardSetPagination`) to update the sort order and reset pagination on sort changes. A `selectedValue` prop was added to the `SortDropdown` component to reflect the current sort selection.

* **Search Input Name Change (12:25:29 PM):** The `name` attribute of the search `InputBox` was changed from `"search_booking_no"` to `"vessel_name"`.

* **Filter Integration (12:29:38 PM - 12:34:13 PM):**  Significant changes focused on integrating the filter sidebar, replacing `handleFilterUpdate` with `handleFilterChange` and `handleClearFilters` to manage filters via Redux using  `voyageDashboardSetFilters` action.  The filter's `key` for date range was changed from `"dateRange"` to `"created_at"`. The FilterSidebar now correctly uses the Redux store's filters. Pagination is reset to the first page upon applying or clearing filters. The page number is updated in `handleFilterChange` from 0 to 1 to reflect the correct page after filter application.


**`c:\Users\ridap\OneDrive\Documents\Envosyes\envosys-frontend\src\data\options\common.ts` Changes:**

* **One commit (11:45:05 AM):** This commit added or modified sort options (`sortOptions`) within the `common.ts` file to provide ascending and descending options for sorting by Vessel Name.  There were commented-out lines, which suggests additional sorting options might have been considered before being removed.

**Recurring Patterns:**

* Consistent use of React, Redux, and TypeScript.
* Frequent updates to pagination handling to ensure the correct page is displayed after user interactions.
* The overall development pattern suggests an iterative process, where features are gradually added and improved.


The final version of `VesselVoyageDashboard.tsx` uses Redux to manage state and fetching data from an API. The data is displayed in an `AppGrid` component with robust search, filtering, sorting, and pagination capabilities.  Date formatting is added to several columns within `VESSEL_VOYAGE_COLUMNS`.


## 3:13:15 PM
The log shows multiple revisions of the `vesselAndVoyageService.ts` file between 12:54 PM and 3:07 PM on September 22, 2025.  The primary focus of the changes appears to be debugging and logging within the `CreateVesselAndVoyage` function.

Initially, the code lacked sufficient logging to track the `vesselVoyage` object being passed into the `CreateVesselAndVoyage` function.  This was addressed by adding `console.log("===vesselvoayge", vesselVoyage);` and later improved to  `console.log("===vesselvoayge", req.body);` to show the entire request body at 2:59 PM and 3:07 PM, respectively.  This suggests an issue with the data being received or processed in that function.

Between the first and second revision (12:54 PM and 1:13 PM), a minor change was made to the `getAll` function's response, simplifying the `pagination` object's structure by removing unnecessary type casting for `page` and `perPage` properties.  The other commits between 1:13PM and 3:07PM mostly involved debugging and adding logging, with no significant functional changes beyond the logging adjustments already mentioned. The 2:56 PM and onwards commits show commented-out lines in the `voyagePayload`  within the `CreateVesselAndVoyage` function suggesting further investigation or modification of the data being processed. There were no changes to the database queries themselves. All functions consistently handle errors by returning a 500 Internal Server Error response.


## 3:13:28 PM
The log shows a series of edits to `VesselVoyageDashboard.tsx` and related files between 12:41 PM and 2:52 PM on September 22, 2025.  The primary focus of the changes is on the `VesselVoyageDashboard` component, which displays and allows filtering, sorting, and exporting of vessel voyage data.  Several iterations refine the filtering options and data handling.

**`c:\Users\ridap\OneDrive\Documents\Envosyes\envosys-frontend\src\components\screen\vessel-voyage\VesselVoyageDashboard.tsx`**: This file underwent extensive revision.  Early changes (12:41 PM - 12:45 PM) focused on adding functionality to dynamically generate filter options ("POL" and "Vessel Name") based on fetched data.  Later changes (12:53 PM - 1:17 PM) adjusted filter clearing logic, changed the "Vessel Name" filter key to "voyage," and updated the Excel export data source. Further changes (2:20 PM - 2:37 PM) involved refining access control (`access` prop) and updating the navigation paths in the actions. Finally (2:37 PM - 2:52 PM), these changes remove unneeded state variables (`data`, `filteredData`) and simplifies the component.

**`c:\Users\ridap\OneDrive\Documents\Envosyes\envosys-frontend\src\components\screen\vessel-voyage\action.tsx`**: This file, handling actions for the vessel voyage dashboard, was modified to adjust the navigation path for editing vessel voyages and change access control from `vesselMenu` to `vesselVoyageMenu`.

**`c:\Users\ridap\OneDrive\Documents\Envosyes\envosys-frontend\src\data\coulms\vessel-voyage-columns.tsx`**: This file, defining columns for the data grid, was updated to reflect the changes in action handling.  It uses the updated `action.tsx` file for actions.

**`c:\Users\ridap\OneDrive\Documents\Envosyes\envosys-frontend\src\store\fretures\voyageDashboardSlice.ts`**:  A change at 1:14 PM updated the initial page number in the Redux slice from 0 to 1. No other significant changes.


**`c:\Users\ridap\OneDrive\Documents\Envosyes\envosys-frontend\src\pages\vessel-voyage\VesselVoyageDetailsPage.tsx`**: This page handling details of a vessel voyage was updated at the end to pass only `vesselVoyage` data to the form.

**`c:\Users\ridap\OneDrive\Documents\Envosyes\envosys-frontend\src\types\vessel-voyage.types.ts`**: This type definition file was modified to include a `vesselAndVoyage` interface, which contains the  `VesselVoyageFormValue`, reflecting structural changes in data handling.


**`c:\Users\ridap\OneDrive\Documents\Envosyes\envosys-frontend\src\components\screen\vessel-voyage\VesselVoyageDetailsForm.tsx`**: This form component for vessel voyage details was significantly revised multiple times (2:42 PM - 3:11 PM). The major changes include correcting the `initialvalues` prop type, removing unnecessary state and useEffect hook, removing the `InputGroupedButton` component, and changing the submit button text based on mode ("add" or "edit").  Finally the form is updated to accept `vesselAndVoyage` type.


**Recurring elements and patterns:**  The consistent modifications across these files indicate a focused effort to improve the data fetching, filtering, and display within the vessel voyage dashboard, enhancing the user experience and improving data integrity.  The use of Redux for state management is evident throughout the code.  The repeated updates to the navigation paths and access control within action files show refinement and consistency of the application flow.


## 4:13:15 PM
The log shows iterative development of a React component for managing vessel voyage details.  The primary files involved are `VesselVoyageDetailsPage.tsx` and `VesselVoyageDetailsForm.tsx`.

`VesselVoyageDetailsForm.tsx` underwent significant changes between 3:14:26 PM and 3:23:21 PM.  Initially, the form lacked the "Vessel Name" input field and  the field names within `formik` were not fully qualified (e.g., `pol` instead of `vesselVoyage.pol`).  Subsequent commits corrected this, adding the "Vessel Name" input and correctly referencing all form fields under the `vesselVoyage` nested object.  The final commit at 3:23:21 PM  completed this refactoring.

`VesselVoyageDetailsPage.tsx` was also modified extensively.  Changes focused on data fetching and handling using `useFetchVoyageDetailsQuery`,  `useCreateVoygeMutation`, and later `useUpdateVoyageMutation`. There's a clear evolution in how API responses are handled. Initially, the component directly used the API response data. It then progressed to mapping the API response into a more structured form suitable for the `VesselVoyageDetailsForm` and, finally to using separate create and update mutations based on the `formAction` prop.  A notable change at 3:53:00 PM introduced `useUpdateVoyageMutation` for handling updates, and the logic was refined to clearly separate create and update operations at 3:55:34 PM. The initial state for `vessalData` also changed to include `serial_id` at 4:00:25 PM reflecting changes in the `vesselAndVoyage` type definition.  Finally, there's a correction in how `payload` is constructed at 4:08:24 PM ensuring `serial_id` is correctly nested within `vesselVoyage`.  The `useEffect` hook handling the API response was improved at 3:35:30 PM to handle potential null values and format date strings appropriately. The title of the page also changed to reflect the edit/add mode at the same timestamp.


The overall pattern is a gradual refinement of the component, addressing initial omissions, improving data handling, separating API calls for create and update operations, and enhancing error handling.  The time period between 3:35:30 PM and 4:08:24 PM shows major improvements in data handling and form submission logic.


## 5:25:42 PM
The codebase underwent several updates on September 22nd, 2025, primarily focusing on the `voyage` data model and its associated services within the `envosys-backend` application.

The most significant changes involved the `vesselAndVoyageService.ts` file.  Multiple functions were defined for CRUD (Create, Read, Update, Delete) operations related to vessels and voyages.  These functions interact with a database (`query`, `insertQuery`, `updateQuery`), handling pagination, filtering (by `status`, `fromDate`, `toDate`, `pol`, `voyage`, `vessel_name`), sorting (`orderBy`), and error handling.  The service extensively uses a `QueryBuilder` class to construct and execute SQL queries.  Transactions (`BEGIN`, `COMMIT`, `ROLLBACK`) ensure data integrity. Notably, the `CreateVesselAndVoyage` and `UpdateVesselAndVoyage` functions manage nested data, including `routingList` information, which involves separate inserts and deletes within the database's `routing` table.

Two nearly identical updates occurred to `voyage.type.ts` within a short timeframe (4:32 PM and 4:33 PM).  The only difference is that the `RoutingList` interface's `pol` field's type changed from `number` to `string`.  This suggests a quick correction in data typing. The file defines interfaces (`GetVoyageParams`, `RoutingList`, `GetVoyagePayload`, `GetVesselAndVoyagePayload`) that specify the structure of data used by the `vesselAndVoyageService.ts` functions, detailing voyage parameters, routing lists, and the structure of payload for handling voyage data.  These type definitions ensure type safety and clarity.


## 5:25:49 PM
The log shows multiple revisions to the `envosys-frontend` application, primarily focused on the `vessel-voyage` feature.  The core changes revolve around the creation and editing of vessel voyage details, including a form for input and API interactions.

**File: `VesselVoyageDetailsPage.tsx`**

This file underwent several revisions between 4:14 PM and 4:33 PM on September 22, 2025. The major changes were related to the handling of data from the API response (`useFetchVoyageDetailsQuery`).  Initially, the code directly assigned date values from the API response, and later it was updated to handle potential `null` values using the nullish coalescing operator (`??`) and to split date strings to extract only the date part.  A minor change at 4:29 PM removed a `slno` field from the `routingList` in the default state.  Finally at 4:33 PM  the `RoutingDeatils` interface in `vessel-voyage.types.ts` was updated and this file was updated to reflect the changes in the `RoutingList` interface which changed the structure of `routingList`.


**File: `VesselVoyageDetailsForm.tsx`**

Significant changes occurred in this file between 4:18 PM and 5:02 PM on September 22, 2025.  The initial version used `useFormik` for form handling and included input fields for various voyage details. A `DynamicEditableTable` was implemented for managing the routing list. A crucial update at 4:43 PM introduced a state variable `open` to control a modal, likely for adding vessel details.  Further modification at 4:49 PM incorporated a `BaseModal` component to display the `VesselDetailsForm` and at 5:02 PM, the `onSubmit` handler in the `VesselDetailsForm` was updated to set the vessel name from the modal into the main form.


**File: `vessel-voyage.types.ts`**

This file was updated twice on September 22, 2025 at 4:29 PM and 4:33 PM.  The changes involved modifications to the `RoutingDeatils` interface to adjust the data structure used for the routing list. The 4:33 PM update replaced `RoutingDeatils` with `RoutingList` and adjusted the data types of the fields from strings to more appropriate types (string or number).

**File: `data\coulms\vessel-voyage-columns.tsx`**

This file was updated once on September 22, 2025 at 4:34 PM, defining columns for data grids used in the Vessel Voyage details form which reflects the change made in `vessel-voyage.types.ts`.


**File: `components\screen\vessel\VesselDetailsForm.tsx`**

This file, representing a form for vessel details, received updates between 4:50 PM and 4:57 PM on September 22, 2025. The primary change involved adding `onClose` prop to handle closing the modal and enhance the functionality.


**Recurring Elements and Patterns:**

* Extensive use of React hooks (`useEffect`, `useState`, `useFormik`, custom hooks like `useCreateVoygeMutation`).
* Consistent use of TypeScript for type safety.
* Reliance on a UI framework with Tailwind CSS styling (e.g., `className="grid grid-cols-4 gap-6 my-6"`).
* A pattern of fetching data from an API (`useFetchVoyageDetailsQuery`), processing it, and populating form fields.
* Use of Formik for managing form state and submission.
* The addition of a modal for adding vessel details, showing a clear evolution of the feature's design.

The overall evolution shows a progressive enhancement of the vessel voyage details feature, from initial implementation to refinements in data handling, UI, and integration of a vessel details modal.


## 6:25:44 PM
The `vesselAndVoyageService.ts` file contains five functions related to managing vessel and voyage data.  All functions interact with a database using custom query functions (`query`, `insertQuery`, `updateQuery`).  Significant updates occurred on September 22nd, 2025, at 5:48:22 PM.

`getAll`: This function retrieves all voyages based on various filter parameters (page, perPage, status, dates, location, voyage number, vessel name, and ordering). It fetches voyage data and associated routing information in separate queries, then combines them.  It uses a `QueryBuilder` class for constructing the SQL queries and handles pagination.  Logging is implemented using a `logger` utility.

`CreateVesselAndVoyage`: This function creates a new voyage entry and associated routing information. It uses transactions (`BEGIN`, `COMMIT`, `ROLLBACK`) to ensure data consistency.  It inserts the voyage data into the `voyage` table and then iterates through the `routingList` (if provided) to insert each routing entry into the `routing` table.

`fetchVesselAndVoyageData`: This function fetches details for a specific voyage based on its `serial_id`.  Similar to `getAll`, it retrieves both voyage and routing data.

`getVesselAndVoyageDashboardCardInfo`: This function retrieves dashboard card information (active, inactive, and total voyages) based on optional date ranges ("weekly," "monthly," or a custom range) and a filter.

`UpdateVesselAndVoyage`: This function updates an existing voyage entry.  It uses transactions.  It updates the voyage information and then deletes and re-inserts the associated routing data.  It handles the case where a voyage is not found.

Recurring patterns include:

*   Extensive use of asynchronous operations (`async`/`await`).
*   Error handling using `try...catch` blocks and consistent error responses.
*   Reliance on custom database utility functions (`query`, `insertQuery`, `updateQuery`).
*   Consistent use of `moment.js` for date manipulation.
*   Frequent use of logging for debugging.
*   Data is fetched in multiple queries (one for voyage data and another for routing data).  A more efficient approach could combine these.
*   Heavy use of `req.body` and `req.query` for request data.


The code demonstrates a RESTful API design pattern for managing vessel and voyage information.  The functions show good separation of concerns with respect to database interaction and business logic.


## 6:25:56 PM
The log shows multiple revisions to the `VesselVoyageDetailsForm` component and related files between 5:31 PM and 6:22 PM on September 22, 2025.  The main focus of the changes is on the `VesselVoyageDetailsForm` component, which is used to manage vessel and voyage details.

**`input-grouped-button.tsx` (5:31 PM):** This file defines a reusable component `InputGroupedButton` with two variants: one with a plus icon (for adding) and another with a search icon.  It accepts properties for name, label, value, change handlers, click handler, and an API endpoint key.

**`VesselVoyageDetailsForm.tsx` (5:34 PM - 6:22 PM):** This component underwent extensive revision.  Key changes include:

* **Initial commits (5:34 PM - 5:36 PM):**  The initial version uses Formik for form handling and Redux for state management.  It includes input fields for vessel name, voyage number, POL (Port of Loading), various cut-off dates, a checkbox, and a dynamic editable table for routing details. A modal (`BaseModal`) is implemented to add vessel information, using the `VesselDetailsForm` component. The `endpointKey` prop in `InputGroupedButton` was initially set to "port" and later changed to "vessel-voyage."

* **Date Normalization (5:41 PM - 6:22 PM):** Several commits focused on normalizing date formats.  Dates received from the backend (containing "T") are consistently split to remove the time portion, ensuring only the date is displayed and processed.  This normalization was added to the `pol_eta`, `pol_etd`, `pol_atd`, `port_cuttoff`, `stuffing_cuttoff`, and `vgm_cuttoff` fields, as well as the `eta_pod`, `ata_pod`, `etd_pod`, and `atd_pod` fields within the routing list.

* **`onObjectChange` Enhancement (5:41 PM - 6:22 PM):** The `onObjectChange` handler in `InputGroupedButton` evolved from simply setting a field value to directly setting multiple formik values based on the selected object's properties (specifically the `raw` property of the selected object). This improved the handling of selected vessel data.

* **Routing Table Data Handling (6:20 PM - 6:22 PM):** The way the routing table data is handled changes. Previously, the Redux store managed the data; now the component directly manages it with an internal `tableData` variable derived from `formik.values.vesselVoyage.routingList`, simplifying the process.  The `onChange` handler for the dynamic table was updated to correctly map the fields.

* **Typo Correction (6:00 PM - 6:17 PM):** There was a correction of the typo in the Redux slice name (`vessalVoyageDetailsForm` changed to `VesselVoyageDetailsForm`).  The `port_cuttoff`, `stuffing_cuttoff`, and `vgm_cuttoff` field names were also consistently changed to `port_cuttoff`, `stuffing_cuttoff`, and `vgm_cuttoff` across all files.


**`VesselVoyageDetailsPage.tsx` (5:54 PM - 6:13 PM):** This page manages the form state and handles API calls using RTK Query. Significant changes in this file involve:


* **Date Handling (5:54 PM - 6:13 PM):** Similar to `VesselVoyageDetailsForm.tsx`, the date normalization from the API response was implemented to ensure consistency in date formats. The `routingList` is also explicitly checked for being an array before processing. This improves the robustness of date handling throughout the app.


* **Initial values** The initial values are set from an API call that fetches data from a backend based on the `serial_id`, handling the case of the `serial_id` being null or undefined using `skipToken`.



**`vessel-voyage.types.ts` (5:54 PM):** This file defines TypeScript interfaces for vessel voyage data, including structures for detailed information, vessel rows in a table, filter configurations, pagination, and the `vesselAndVoyage` data structure.


**`store/fretures/vessalVoyageDetailsSlice.ts` (6:15 PM):** This Redux slice manages the routing list within the VesselVoyageDetailsForm.  It provides actions to add, update, and remove items in the list.  The typo in the slice name was also fixed here.

In summary, the code modifications primarily concentrate on improving date handling, streamlining data flow between the form, the Redux store, and the API response, and correcting typos. The majority of changes were made to  `VesselVoyageDetailsForm.tsx` and `VesselVoyageDetailsPage.tsx`.  The changes reflect a focus on data consistency,  application robustness, and a move towards more direct management of the routing table data.


## 7:25:45 PM
The file `vesselAndVoyageService.ts` contains several functions for managing vessel and voyage data.  Key functionalities include:

* **`getAll`:** Retrieves a paginated list of voyages based on various filters (status, dates, location, vessel name, voyage number) and sorting options.  It then performs a secondary query to fetch associated routing information for each voyage and includes this in the response. This function uses a `QueryBuilder` class for constructing the SQL query.  The timestamp for this change is 9/22/2025, 7:23:23 PM.

* **`CreateVesselAndVoyage`:** Creates a new voyage entry and its associated routing information. It uses a transaction (`BEGIN`, `COMMIT`, `ROLLBACK`) to ensure data consistency.

* **`fetchVesselAndVoyageData`:** Retrieves detailed information for a single voyage, including associated routing details.  Similar to `getAll`, it performs a secondary query to fetch routing data.

* **`getVesselAndVoyageDashboardCardInfo`:** Fetches aggregated data for a dashboard, providing counts of active, inactive, and total voyages based on optional date ranges ("weekly", "monthly", or a custom range) and filters.

* **`UpdateVesselAndVoyage`:** Updates an existing voyage entry and its routing information.  It deletes the existing routing records before inserting the updated ones as part of a transaction. This function requires the `serial_id` for the voyage to be updated.

Recurring patterns include:

* Extensive use of asynchronous operations (`async/await`).
* Consistent error handling with HTTP status codes and logging.
* Frequent use of SQL queries, including parameterized queries for security.
* Transaction management for crucial operations (`CreateVesselAndVoyage`, `UpdateVesselAndVoyage`).
* Retrieval of related data through secondary queries (routing information).  The structure of the response often includes both the main voyage data and the associated routing data, improving data access.
* Repetitive use of `query` function for database interactions.


The code shows a well-structured approach to database interaction, error handling, and data retrieval.  The use of transactions and parameterized queries enhances security and data integrity. The `QueryBuilder` class suggests an effort towards code maintainability and organization.


## 7:25:48 PM
The log shows multiple revisions to `VesselVoyageDetailsForm.tsx` and `VesselVoyageDetailsPage.tsx` between 6:26 PM and 7:18 PM on September 22, 2025.  The primary focus of the changes is on the `VesselVoyageDetailsForm` component, specifically refining how the routing list is handled.

Initially,  a `useEffect` hook in `VesselVoyageDetailsForm.tsx` was unconditionally setting the `routingList` from Redux, overriding data fetched from the API. This was causing issues, so it was removed or modified in subsequent commits.  The problematic `useEffect` was replaced with a conditional one that only initializes the routing list from Redux if the form is in "add" mode and the routing list is empty.  Later commits further refine this logic for both "add" and "edit" modes, ensuring that the correct data source (Redux or initialValues) is used to populate the form. A `key` prop was added to the `DynamicEditableTable` to force re-renders based on changes in the routing list.  The `AutocompleteBox` component for POL selection was also replaced with `AutocompleteSearch` to enhance functionality.

The `VesselVoyageDetailsPage.tsx` file also underwent changes, primarily to improve the handling of Redux state and to ensure the component properly interacts with the API calls for creating and updating voyage data. An effect was added to reset the Redux state when creating a new voyage.  The `refetch` function is also used to update the data after an edit.  The `updateList` action from the Redux store was removed from `VesselVoyageDetailsPage.tsx` as it was no longer needed because the `resetState` action and the form's internal state management now handle data updates efficiently.

The `data/coulms/vessel-voyage-columns.tsx` file defines columns for data grids, and it remains largely unchanged throughout the log.  It defines the columns for both the main vessel voyage details and the routing details table within the form.

In summary, the major changes revolve around improving data synchronization and the form's behavior in different modes ("add" and "edit").  The initial problem stemmed from an improperly implemented `useEffect` hook in the form component, leading to data inconsistencies.  The subsequent commits address this issue through better conditional logic and improved state management, resulting in a more robust and reliable component.
