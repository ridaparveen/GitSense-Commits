# Activity Summary for 9/22/2025

## 11:35:34 AM
On September 22nd, 2025, significant changes were made to the `envosys-backend` application.

At 10:35:41 AM, the `index.ts` file within the `src/routes` directory was updated. This file acts as a routing hub, registering various API endpoints.  The update involved registering new routes for authentication (`AuthRoutes`), master data (`MasterRoutes`), line bookings (`LineBookingRoutes`), customer bookings (`CustomerBookingRoutes`), document uploads (`DocumentRoutes`), vessels (`VesselRoutes`), vessel and voyages (`VesselAndVoyageRoutes`), and vendors (`VendorRoutes`).  An autocomplete endpoint using the `getAll` service function was also added.  The code uses the `express` router to define and organize these routes.

Later, at 11:25:33 AM, the `vendorServices.ts` file (located in `src/services`) was modified. This file contains functions for managing vendor data.  The update introduced three key functions: `getAll`, `addVendor`, and `updateVendor`.  `getAll` retrieves vendor data with pagination, sorting, and filtering capabilities. `addVendor` creates new vendor entries, and `updateVendor` updates existing ones.  All three functions include robust error handling, logging errors using a logger, and returning appropriate HTTP status codes.  The code uses a custom `QueryBuilder` class for database interactions and leverages parameterized queries for security.  Input validation is performed to prevent invalid data from being accepted.


## 11:35:58 AM
The log shows modifications to components related to a vessel voyage dashboard in a React application.  The `OverviewContainer.tsx` component underwent significant changes between 11:15 AM and 11:29 AM.  Initially, it displayed static data (`vesselVoyogeData`).  Subsequent updates integrated Redux using `useSelector` and `useDispatch` to fetch and display dynamic voyage data from the `voyageDashboardSlice` and `vesselAndVoyageDataApi`.  The data displayed was modified from displaying counts of vessels to counts of voyages.  A `DatePeriodSelector` component was added to allow filtering of data based on a date range and period.

The `voyageDashboardSlice.ts` file (modified at 11:20:07 AM) defines Redux slices for managing pagination, filters (date range, status, vessel name, line name, serial ID), and sorting of vessel voyage data.  The `setDateRange` and `setPeriod` actions are used by `OverviewContainer.tsx` to update date range and period selection respectively.

The `store.ts` file (modified at 11:20:48 AM) configures the Redux store, including the `voyageDashboardSlice` and several other reducers and API middleware.

Finally, the `VesselVoyageDashboard.tsx` component (modified between 11:33 AM and 11:35 AM) displays a table of vessel voyage data using `AppGrid`. The initial version used static data from `vesselData`, but this was later replaced by fetching data dynamically from `useFetchVoyageDashboardDataQuery` with filters and pagination from Redux's `voyageDashboardSlice`. The component includes search, filtering, sorting, and data export functionalities.  A key change here was the replacement of  the data source for the `AppGrid` from local state to the fetched `vesselVoyageDashboardData`.  Initially, the commented out code for the filter parameter showed it was intended to use the state from the redux store.


## 12:35:35 PM
The log shows multiple revisions of the `vesselAndVoyageService.ts` file between 11:53 AM and 11:59 AM on September 22, 2025.  The changes primarily focus on the `getAll` function, specifically its pagination logic.

Initially, the offset calculation in `getAll` was incorrect: `offset = (Number(page) - 1) * Number(perPage);`.  This was changed to `offset = Number(page) * Number(perPage);` at 11:55:19 AM, then reverted back to the original correct calculation at 11:59:08 AM.  A `console.log` statement was added to debug the offset value at 11:56:14 AM.

Between 11:53:33 AM and 11:54:34 AM, a minor correction was made in the `getAll` function's response.  The `total` count in pagination was updated to include a fallback value of 0 using the nullish coalescing operator (`|| 0`).

No other significant functional changes were made to the other functions (`CreateVesselAndVoyage`, `fetchVesselAndVoyageData`, `getVesselAndVoyageDashboardCardInfo`, `UpdateVesselAndVoyage`) across the revisions.  These functions consistently use database interaction functions (`insertQuery`, `query`, `updateQuery`) and handle transactions using `BEGIN` and `COMMIT` or `ROLLBACK` blocks.  They also consistently return JSON responses with status indicators ("success" or "error").  The code shows consistent use of asynchronous functions and error handling.


## 12:36:08 PM
The log shows a series of modifications to the `VesselVoyageDashboard.tsx` component and a related `common.ts` file between 11:36 AM and 12:34 PM on September 22, 2025.  The primary focus of the changes is enhancing the functionality and user interface of a vessel voyage dashboard.


**`c:\Users\ridap\OneDrive\Documents\Envosyes\envosys-frontend\src\components\screen\vessel-voyage\VesselVoyageDashboard.tsx` Changes:**

* **Initial Commit (11:36:02 AM):** This commit established the basic structure of the component, including search, filtering, sorting, pagination, and data export functionality.  It utilized dummy data and  local state management.

* **Redux Integration (11:39:49 AM):**  `useDispatch` was added, shifting from local state to Redux for pagination management using the `voyageDashboardSetPagination` action.

* **API Data Fetching (11:39:49 AM - 11:47:48 AM):** Several commits involved refining how data is fetched from the API (`useFetchVoyageDashboardDataQuery`). Initially, all filter parameters were passed, but this was later commented out. The final version uses a subset of the Redux state for filtering and pagination.  The `AppGrid` component was updated to use the API's pagination data (`vesselVoyageDashboardData?.pagination?.total`).


* **Sorting Enhancement (11:43:54 AM - 11:47:48 AM):** The `handleSortChange` function was modified to dispatch Redux actions (`setVoyageDashboardSortBy` and `voyageDashboardSetPagination`) to update the sort order and reset pagination on sort changes. A `selectedValue` prop was added to the `SortDropdown` component to reflect the current sort selection.

* **Search Input Name Change (12:25:29 PM):** The `name` attribute of the search `InputBox` was changed from `"search_booking_no"` to `"vessel_name"`.

* **Filter Integration (12:29:38 PM - 12:34:13 PM):**  Significant changes focused on integrating the filter sidebar, replacing `handleFilterUpdate` with `handleFilterChange` and `handleClearFilters` to manage filters via Redux using  `voyageDashboardSetFilters` action.  The filter's `key` for date range was changed from `"dateRange"` to `"created_at"`. The FilterSidebar now correctly uses the Redux store's filters. Pagination is reset to the first page upon applying or clearing filters. The page number is updated in `handleFilterChange` from 0 to 1 to reflect the correct page after filter application.


**`c:\Users\ridap\OneDrive\Documents\Envosyes\envosys-frontend\src\data\options\common.ts` Changes:**

* **One commit (11:45:05 AM):** This commit added or modified sort options (`sortOptions`) within the `common.ts` file to provide ascending and descending options for sorting by Vessel Name.  There were commented-out lines, which suggests additional sorting options might have been considered before being removed.

**Recurring Patterns:**

* Consistent use of React, Redux, and TypeScript.
* Frequent updates to pagination handling to ensure the correct page is displayed after user interactions.
* The overall development pattern suggests an iterative process, where features are gradually added and improved.


The final version of `VesselVoyageDashboard.tsx` uses Redux to manage state and fetching data from an API. The data is displayed in an `AppGrid` component with robust search, filtering, sorting, and pagination capabilities.  Date formatting is added to several columns within `VESSEL_VOYAGE_COLUMNS`.
