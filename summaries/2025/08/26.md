# Activity Summary for 8/26/2025

## 10:41:48 AM
The log shows modifications to three files between 6:13 PM and 6:37 PM on August 25th, 2025, and a further update at 10:34 AM on August 26th, 2025.

The primary focus of the changes is on the `dashboard-page.tsx` file, which contains the main dashboard UI.  Several updates were made to the data fetching and filtering logic within this component.  The most significant change in this file involves refining the filtering logic for `deliveryData` based on `deliveryMode` in the `useMemo` hook responsible for preparing calendar data. This improved the filtering of vessel data based on delivery mode (Door Delivery, Port Delivery, Rail Delivery, All).  An additional condition `delivery.pod` was also added in the filtering logic for Port Delivery.

The `Calender.tsx` component underwent minor updates.  A key change between the first two entries (6:13 PM and 6:13 PM)  was the addition of an "All" option to the delivery mode select element, allowing for the display of all delivery types. The component consistently uses the `moment` library for date formatting and manipulation.

The `delivery.type.ts` file shows the addition of the `eta_pod` field to the `DeliveryType` interface, reflecting a change in the data structure between 6:34 PM and 6:35 PM and remains the same until 6:37 PM. This addition likely corresponds to the changes in `dashboard-page.tsx` for handling Port Delivery filtering.


The `shipment-coulmns.tsx` file was updated on August 26th.  The changes involve minor adjustments to the column definitions for the shipment data grid, primarily focused on styling and link paths. No significant logic changes are present in this update.  The most noticeable change is the updates to the link paths within the `renderCell` functions, ensuring correct navigation to shipment details.


## 10:41:49 AM
The log shows multiple revisions of the `dashboardService.ts` file, focusing on the `getDashboardCardInfo` and `getDeliveryData` functions.  The primary changes revolve around refining the SQL queries within these functions.

The `getDashboardCardInfo` function consistently uses a complex SQL query to retrieve dashboard information categorized into "Pending Departure," "In Transit," "ETA within 1 week," and "Out for Delivery."  The query includes calculations for both count and TEU (Twenty-foot Equivalent Unit).  Minor revisions involved changes to how the `fromDate` and `toDate` query parameters are handled in the `WHERE` clause, specifically addressing potential "null" values.  These changes occurred between 6:08 PM and 6:31 PM, with no significant structural alterations to the SQL query itself.

The `getDeliveryData` function retrieves delivery data based on the 'type' (delivery or vessel) and optionally 'mode' (Door Delivery, Port Delivery, Rail Delivery, or ALL) parameters. The core SQL queries for both 'delivery' and 'vessel' types remain largely unchanged, but the logic for applying filters based on the `mode` parameter has been subject to several revisions throughout the 6:08 PM to 6:31 PM period. The changes aim at more precisely defining filtering conditions within the vessel query, especially for the "Rail Delivery" and "ALL" modes, ensuring `eta_pod` and `pod` are consistently checked for non-null values.  The `ALL` mode was added in later revisions to handle a broader selection criteria.


## 11:41:48 AM
The log shows multiple revisions to the `dashboard-page.tsx` component and the `Calender.tsx` component between 11:05 AM and 11:36 AM on August 26, 2025.  `dashboard-page.tsx` underwent several minor revisions, primarily focused on refining the display of data fetching states (adding loading indicators) and possibly correcting a bug in the `filteredVessels` logic within the `useMemo` hook.  The changes in `dashboard-page.tsx` involved primarily adding conditional rendering for loading states within the DatePeriodSelector component. The core functionality and data fetching remained largely consistent.

The `Calender.tsx` component saw more substantial modifications across several commits.  The changes focused primarily on styling and conditional rendering based on the `deliveryMode` prop.  Specifically, the background color of delivery items in the calendar was adjusted to reflect different delivery modes ("Door Delivery," "Port Delivery," "Rail Delivery," and "All").  The style was initially implemented using the `cn` utility and a ternary operator but later refactored into a cleaner `style` attribute for better readability,  using a more straightforward conditional statement to determine the background color based on the delivery mode.  These changes improve the visual presentation of the calendar data by providing better visual distinction based on delivery type.  Finally, a minor improvement was made in the `Link` component to make the `to` prop clearer.


## 11:41:51 AM
The log shows multiple revisions to two files: `shipmentService.ts` and `dashboardService.ts`.  Both files are related to shipment tracking and dashboard information retrieval.

**`shipmentService.ts` (8/26/2025, 10:42:58 AM and 10:43:35 AM):**  These two entries appear to be near-identical, suggesting a minor, insignificant change between them that isn't reflected in the provided code snippets. The file contains a service for retrieving shipment information.  Significant changes include the addition of multiple filters (`pol`, `pod`, `shipment_id`, `status`, `fromDate`, `toDate`, `orderBy`, `cardFilter`, `contno`, `viewType`) to the `getAll` function.  The code also implements logic to determine shipment status based on data from an MTR (likely Master Tracking Record) system, updating the shipment object with `eta`, `etd`, `ata`, and `atd` fields.  A section of code related to `shipmentScope` has been commented out, possibly indicating a change in how delivery status is determined.


**`dashboardService.ts` (8/26/2025, 10:53:13 AM, 10:58:19 AM, 11:11:52 AM, 11:16:40 AM, 11:17:13 AM, 11:26:35 AM, 11:39:04 AM, 11:39:49 AM):** This file contains services for retrieving dashboard card information and delivery data.  Multiple revisions indicate iterative development and refinement of the `getDeliveryData` function's filtering logic.  The `getDashboardCardInfo` function remains largely unchanged, consistently using SQL queries with `FILTER` clauses to count shipments based on different criteria (pending departure, in transit, ETA within one week, out for delivery).  The most significant changes in `getDeliveryData` concern enhancing the filtering for "Door Delivery" and "Port Delivery" modes within the "vessel" type, refining the conditions to better identify these delivery types based on various data fields (`place_of_delivery`, `rail_destination`, `delivery_customer_location`).  The change from `rail_ata` to `rail_loaded_date` in the `SqlQueryVesselArrival` query in one revision (11:26:35 AM) also stands out.


In summary, the code changes primarily focus on enhancing data filtering and improving the accuracy of shipment status determination and delivery type identification in the backend services for shipment tracking and dashboard reporting.  The `dashboardService.ts` file underwent significant iterative refinement, while `shipmentService.ts` appears to have undergone minor, inconsequential changes between the two snapshots.


## 12:41:45 PM
The log shows three revisions of `shipment-details-page.tsx` on August 26th, 2025.  All changes are minor and focus on styling and presentation within the component.  The core functionality remains consistent across all revisions.

The first two revisions (12:14:06 PM and 12:14:39 PM) are nearly identical.  The only visible difference is a minor formatting change within the status display in the third revision.

The final revision (12:15:29 PM) changes the `text-sm` class to `text-md` within the Status Badge section of the UI, increasing the font size of the status display.  The rest of the code remains functionally unchanged throughout the three commits.  There's no significant addition or removal of functionality; the modifications solely address cosmetic aspects.  The timestamps indicate these changes were made within a short timeframe, suggesting a rapid iterative design process.


## 12:41:53 PM
The log shows multiple revisions to `dashboardService.ts` and `shipmentService.ts` on August 26, 2025.

**`dashboardService.ts` Changes:**

The modifications to `dashboardService.ts`  focus on the `getDeliveryData` function.  Several edits refine the filtering logic within this function, specifically the `extraFilter` variable used to apply different conditions based on the `type` and `mode` query parameters.  The changes mainly involve adding `TRIM()` functions around certain column names in the SQL queries to handle potential whitespace issues and ensuring consistent handling of empty or null values.  The timestamps indicate rapid iteration and refinement of the filtering mechanism (11:42:23 AM, 11:45:54 AM, 11:48:38 AM, 11:49:04 AM, 11:53:51 AM).  The `getDashboardCardInfo` function remains largely unchanged throughout these revisions.


**`shipmentService.ts` Changes:**

The `shipmentService.ts` file undergoes more substantial changes, primarily within the `getAll` function.  The core change involves enhancing shipment status determination by incorporating data from the `mtr` table.  The original code relied on a `shipmentScope` query, which was removed in subsequent revisions.  Instead,  the code now directly uses fields like `departure_date`, `t49_eta`, `t49_vessel_actualdeparted_date`, `t49_vessel_actualarrived_date`, and `t49_holdspodterminal_name` from the `mtrData` object to determine the shipment status.  Multiple versions demonstrate a refinement process to accurately capture various shipment stages (e.g., Pending, Loading, Departed, In Transit, Custom_Hold, Arrived, Delivered). These modifications are spread across several commits (11:56:40 AM, 11:57:03 AM, 11:57:29 AM, 12:02:25 PM, 12:03:10 PM, 12:05:52 PM, 12:06:50 PM, 12:07:20 PM, 12:10:27 PM, 12:10:41 PM). The `SqlQueryBuilder` class within `shipmentService.ts`  shows the addition of a `buildCardFilterCondition` method and refinement of the `buildUserCondition` method to handle various user roles and account affiliations, reflecting improved access control.  There are no functional changes in these methods across multiple commits.


## 1:41:49 PM
The log shows multiple updates to `global.ts` between 1:11 PM and 1:30 PM on August 26, 2025.  These updates did not change the code; the file content remained identical across these revisions. The file defines various constants, including `SHIPMENT_STATUS`, `REPORTS_STATUS`, `TEAM_MENBER_STATUS`, `TEAM_MENBER_ROLE`, `BOOKING_STATUS`, `BOOKING_DASHBOARD_STATUS`, `SHIPMENT_SCOPE`, `BOOKING_SORT_OPTIONS`, and `SHIPMENT_STATUS_FILTERS`. These constants map status types or options to color codes or labels for use in the UI.

At 1:35 PM, `Calender.tsx` was updated. This component renders a calendar displaying delivery or vessel information.  It fetches data, allows for navigation between weeks, and includes filtering by delivery mode (Door, Port, Rail).  The component uses `moment.js` for date formatting and React Icons for visual elements. A tooltip is implemented to display full location details.

Simultaneously at 1:35 PM, `shipment-coulmns.tsx` was updated. This file defines column configurations for data grids, specifically for shipments and containers.  It leverages `@mui/x-data-grid`, custom components (Badge, Button), and React Icons. The `SHIPMENT_STATUS` constant from `global.ts` is used to color-code shipment statuses.  Progress bars are displayed to represent shipment progress.  The component also supports sorting and includes action buttons for navigating to shipment details. Three separate functions (`useShipmentCoulmns`, `useShipmentContainersCoulmns`, `useOverviewDashboardColumns`) define column configurations for different data grid views.


At 1:36 PM, `dashboard-page.tsx` was updated. This component is the main dashboard, fetching data from multiple API calls (`useFetchShipmentDataQuery`, `useFetchCartDataQuery`, `useFetchDeliveryDataQuery`).  It uses a reducer for state management and interacts with Redux for filtering and pagination. The component renders a calendar (`Calendar`), data grids (`AppGrid`), and cards displaying summarized data.  It also includes a filter sidebar (`FilterSidebar`), a global search (`GlobalSearch`), and recent updates (`RecentUpdate`). The component uses numerous React Icons and conditional rendering based on loading states and data availability. It uses the column configurations defined in `shipment-coulmns.tsx`.

Finally, at 1:36 PM, `shipment-details-page.tsx` was updated. This component displays detailed information for a specific shipment, fetching data using `useFetchShipmentDetailsQuery`. It uses tabs (`Tabs`) for different sections (messages and documents), a stepper (`Stepper`) to show the shipment progress, and a map (`MapContainer`). The component also includes functionality for document upload via a modal.  It utilizes React Icons, `moment.js` for date formatting, and the `SHIPMENT_STATUS` and `SHIPMENT_SCOPE` constants from `global.ts`.


## 1:41:51 PM
The provided log shows multiple revisions to `shipmentService.ts` and one revision to `dashboardService.ts` on August 26, 2025.  The changes primarily focus on enhancing data retrieval and filtering capabilities for shipment information.

**`shipmentService.ts` Updates:**

The `getAll` function in `shipmentService.ts` underwent several iterative changes between 12:56 PM and 1:32 PM.  These revisions consistently involved refining the query logic, particularly within the `SqlQueryBuilder` class.  The key improvements include:

* **Enhanced Filtering:** The initial version added multiple filters to the `getAll` function. Subsequent commits further refined these filters (pol, pod, shipment_id, status, fromDate, toDate, orderBy, cardFilter, contno).  The `SqlQueryBuilder` class now includes a `buildCardFilterCondition` method to handle specific card filter types ('pending_departure', 'in_transit', 'eta_within_1_week', 'out_for_delivery').
* **Improved Shipment Status Determination:** The code for determining shipment status was significantly reworked. The logic now uses a more detailed process based on various date fields (etd, eta, atd, ata) from `mtrData`  to assign a `ShipmentStatus` (Pending, Loading, Departed, In_Transit, Custom_Hold, Arrived, Delivered).  A section of code related to `shipmentScope` was commented out, suggesting a simplification or refactoring of the status determination.
* **Data Augmentation:**  The `getAll` function now adds `eta`, `etd`, `ata`, and `atd` fields to the `bookedItem` objects using data from `mtrData`, enriching the returned shipment information.

**`dashboardService.ts` Updates:**

The `getDashboardCardInfo` function in `dashboardService.ts` was updated at 1:31 PM.  The main change involved improving the SQL query for dashboard card information. It now includes TEU (Twenty-foot Equivalent Unit) calculations for each card type ('pending_departure', 'in_transit', 'eta_within_1_week', 'out_for_delivery').  The query was also improved by adding a condition for `mtr.departure_date` to filter out data before a specific cutoff date (`MTR.DepartureDateCutoff`).  A small correction was made in the `getDeliveryData` function regarding conditional logic using a ternary operator for improved readability.

**Recurring Elements:**

The consistent use of the `mtr` alias (presumably for `mtr_tracking_data` table) and the frequent appearance of `t49_` prefixed columns  indicate reliance on a specific data source or table structure (`mtr_tracking_data`). The repeated use of `console.log` for debugging purposes is also notable, indicating the iterative development process.  The error handling remains consistent across both services, using `HttpStatusCodes` and standard error response JSON.


## 3:41:49 PM
The log shows multiple revisions of `dashboard-page.tsx` on August 26th, 2025, between 3:22 PM and 3:30 PM.  The changes appear to be minor adjustments and likely involve refinements to the UI and data fetching logic.  There are no substantial structural changes to the component. The code consistently uses React hooks (`useEffect`, `useMemo`, `useState`), Redux (`useDispatch`, `useSelector`), and API calls (`useFetchShipmentDataQuery`, `useFetchDeliveryDataQuery`, `useFetchCartDataQuery`) to manage state, fetch data, and update the UI.  The component fetches and displays shipment and delivery data, allowing filtering by date and shipment status.  The use of `moment.js` for date manipulation is prominent.  Several updates seem focused on handling loading states and improving the user interface with loading indicators (`Spinner`, `animate-pulse`). There's also logic for smooth scrolling to the datagrid after a card click.  The code's overall functionality remains consistent across all revisions; the primary changes seem related to UI polish and possibly bug fixes.


## 4:41:47 PM
The `dashboardService.ts` file was updated on 8/26/2025, 4:32:34 PM.  The update primarily involves two functions: `getDashboardCardInfo` and `getDeliveryData`.

`getDashboardCardInfo` retrieves dashboard card information by executing a complex SQL query against the `mtr_tracking_data` table. This query calculates counts and TEU sums for four shipment statuses: Pending Departure, In Transit, ETA within 1 week, and Out for Delivery.  The query uses several `FILTER` clauses and `CASE` statements for conditional aggregation, handling `NULL` values and extracting numeric data from string fields.  Date filtering is implemented using `fromDate` and `toDate` query parameters.  The function uses the `buildMtrUserCondition` utility to apply user-specific filters.  Logging is extensively used throughout the function.

`getDeliveryData` fetches delivery data based on the `type` ("delivery" or "vessel") and optional `mode` query parameters.  It constructs different SQL queries depending on the request type. For "delivery" type, it selects distinct delivery information. For "vessel" type,  it handles different modes (ALL, Door Delivery, Port Delivery, Rail Delivery) with specific filtering conditions applied to the query. The function uses the `buildMtrUserCondition` for user-specific filtering and handles potential errors with appropriate logging and error responses.  The primary table queried is again `mtr_tracking_data`.  The function uses `ROW_NUMBER()` to select the most recent entry for each `mblno`.

Both functions heavily rely on the `mtr_tracking_data` table and utilize the `query` function for database interactions.  A common pattern is the use of extensive conditional logic within SQL queries to handle various scenarios and data variations.  Error handling is consistent across both functions, returning a 500 status code with an error message.  The `buildMtrUserCondition` function (defined elsewhere) plays a crucial role in filtering data based on user permissions or preferences.


## 4:41:58 PM
The log shows a series of modifications to the `Calender.tsx` component and a related type definition file (`delivery.type.ts`).  The changes primarily focus on enhancing the calendar's visual presentation and functionality, specifically regarding delivery mode display and filtering.

**`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\components\common\Calender.tsx`**:

* **Initial Version (8/26/2025, 3:43:55 PM):** This version establishes the basic structure of the calendar component, including its props, interfaces (`DeliveryItem`, `CalendarDay`), and rendering logic using React components like `Card`, `Button`, `SelectOptions`, and icons from `react-icons`.  It displays deliveries based on `deliveryMode`.

* **Subsequent Updates (8/26/2025, 3:48:01 PM - 8/26/2025, 4:02:52 PM):**  Several commits refine the tooltip functionality. Initially, a `deliveryModesLegend` array is added to provide color-coded labels for delivery modes within the tooltip.  The tooltip's content is dynamically switched between displaying the full location and a legend, based on the `hoveredText` state variable.  The commits then simplified the tooltip display to only show the `hoveredText`.  Further changes involved moving the delivery mode select element and the tooltip trigger (three dots icon) to improve the layout of the component's header.  The tooltip was eventually completely removed and the tooltip component was replaced by the info icon.

* **Legend Implementation (8/26/2025, 4:06:35 PM - 8/26/2025, 4:18:24 PM):**  A dedicated legend tooltip is implemented using a `ref` to control visibility and display delivery mode colors/labels. The legend appears only when the info icon is hovered.

* **Filtering Enhancement (8/26/2025, 4:18:00 PM):** The `map` function iterating through deliveries now includes a `.filter` method allowing to filter deliveries according to the selected `deliveryMode`.  Color-coding for deliveries is adjusted accordingly. Background color for delivery items is applied based on `delivery.delivery_customer_location`, and the color logic is updated.

* **Final Version (8/26/2025, 4:37:33 PM):** The `DeliveryItem` interface gets updated to include a `mode` property. This property holds the delivery mode which is used for applying background colors and color coded dots in the final version.


**`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\types\delivery.type.ts`**:

* **Updates (8/26/2025, 4:30:52 PM - 8/26/2025, 4:31:58 PM):** A `rail_destination` field is added to the `DeliveryType` interface.


**`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\pages\dashboard\dashboard-page.tsx`**:

* **Updates (8/26/2025, 4:32:50 PM - 8/26/2025, 4:36:40 PM):** These updates are related to the `DashboardPage` component which uses the `Calendar` component.  The primary change within this file involves adding a `mode` property to deliveries fetched within the `useFetchDeliveryDataQuery` and used in the `Calendar` component.  The rendering of the DatePeriodSelector is also updated to handle loading states.

In summary, the code changes reflect an iterative development process, focusing on improving the user experience of the calendar component by adding a more refined visual presentation (color-coded deliveries and legend) and enhancing functionality through the addition of delivery mode based filtering.  The updates to `delivery.type.ts` suggest a parallel evolution of the data model used by the calendar.


## 5:41:48 PM
The log shows multiple queries and updates to the `mtr_tracking_data` table, focusing on shipment tracking information.  The `dashboardService.ts` file was updated twice within a short timeframe (4:44:33 PM and 5:12:09 PM on August 26th, 2025).  These updates involved modifications to the `getDashboardCardInfo` and `getDeliveryData` functions.  Both functions heavily utilize SQL queries against the `mtr_tracking_data` table to retrieve shipment status information, including counts and details categorized by various stages (Pending Departure, In Transit, ETA within 1 week, Out for Delivery).  The queries employ complex filtering conditions using `FILTER`, `CASE WHEN`, `REGEXP_REPLACE`, and date comparisons.  The `getDeliveryData` function includes additional filtering based on query parameters (`type` and `mode`) to support different delivery views ("delivery" or "vessel" types, with various delivery modes like "Door Delivery," "Port Delivery," or "Rail Delivery").

The second update to `dashboardService.ts` appears to be a minor change in the `getDeliveryData` function, specifically within the `SqlQueryVesselArrival` query, where the `rail_loaded_date` field was added to the SELECT statement. No other significant changes are apparent between the two versions of `dashboardService.ts`.

The separate `.sql` file contains a series of independent SQL queries against the `mtr_tracking_data` table and other related tables (`v2_user_details`, `mtr_user_master`). These queries range from simple data selections to more complex aggregations and filtering, mirroring the complexity seen in the `dashboardService.ts` file, suggesting these queries may be for data analysis or testing purposes. There's also an UPDATE query modifying the `inland_rail_move` field for a specific `mblno`.  Many queries use similar date ranges and conditions focusing on specific columns (`vessel_actualarrived_date`, `t49_vessel_actualarrived_date`, `shipment_completed`, `departure_date`, `account_name`, `mblno`, etc.). The recurring theme is retrieving and manipulating shipment tracking data based on various criteria.


## 5:41:54 PM
The log shows frequent modifications to `Calender.tsx` between 4:43 PM and 5:38 PM on August 26, 2025, focusing on visual improvements and refining the display of delivery information.  The changes primarily involve styling adjustments using Tailwind CSS classes to improve the layout and appearance of the calendar component.  The color scheme for delivery modes (Door Delivery, Port Delivery, Rail Delivery) is consistently adjusted throughout the edits, eventually settling on specific hex color codes (`#15803D`, `#1D4ED8`, `#A21CAF`) for the dot badges.  There is a consistent use of inline styling for background colors of delivery items and dot badges. Initially, background colors changed based on the selected delivery mode and the delivery's mode. Eventually, a constant light gray background (`#F4F4F5`) was used for delivery items with colored dots always displayed. The vertical positioning of the dot badges is also refined.


`dashboard-page.tsx` was modified twice, at 4:43 PM and 5:07 PM on August 26, 2025. The later edit significantly alters how delivery modes are determined within the `determineDeliveryMode` function.  This function now uses more detailed logic to differentiate between "Door Delivery," "Rail Delivery," and "Port Delivery" based on various properties in the `delivery` object from the API response.  This suggests a refinement in the handling of different delivery methods and their respective data structures.
