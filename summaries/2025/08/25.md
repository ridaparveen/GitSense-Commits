# Activity Summary for 8/25/2025

## 12:33:26 PM
The file `dashboardService.ts` contains two main functions: `getDashboardCardInfo` and `getDeliveryData`.  Both functions interact with a database (`mtr_tracking_data`) using custom SQL queries.

`getDashboardCardInfo` (updated 8/25/2025, 11:41:34 AM) retrieves dashboard card information by constructing a SQL query that counts shipments based on several conditions related to departure and arrival dates, using filtering to categorize them into "pending departure," "in transit," "ETA within 1 week," and "out for delivery." The query dynamically includes date range filters (`fromDate`, `toDate`) from the request.  It uses `buildMtrUserCondition` to incorporate user-specific conditions. The function logs various stages of processing using a logger.

`getDeliveryData` retrieves delivery data based on a type parameter ('delivery' or 'vessel').  It executes different SQL queries depending on this type.  For 'delivery', it selects distinct MBL numbers along with delivery information, while for 'vessel', it selects vessel arrival information. Both queries include a condition to exclude shipments marked as 'shipment_completed = Yes' and use `buildMtrUserCondition` for user-specific filtering. This function also logs query execution and results.  Both functions utilize the `query` function from `@src/common/util/database` for database interaction and return results with appropriate HTTP status codes.  A recurring element is the use of `buildMtrUserCondition` and error handling with HTTP status codes.  The queries heavily rely on  `mtr_tracking_data` table and columns related to shipment tracking, including various dates and statuses (e.g., `departure_date`, `vessel_actualdeparted_date`, `t49_vessel_actualarrived_date`, `shipment_completed`).


## 12:33:29 PM
The log shows multiple revisions to `shipment-coulmns.tsx` between 11:54 AM and 12:10 PM on August 25, 2025, focusing on adjustments to column definitions for shipment data grids.  These adjustments primarily involved minor tweaks to header names, `minWidth` properties, and  link paths within the `renderCell` functions.  There's no significant change in the overall structure or functionality of the code during this period.  The most noticeable pattern is the iterative refinement of column widths and  route links in different parts of the code.


Between 12:18 PM and 12:25 PM on August 25, 2025, there were several revisions to `shipment-details-page.tsx`.  These changes involved primarily cosmetic and presentational updates.  The main changes were to the styling and layout of information displayed on the page  and several minor text changes, like correcting the label "Arrived1" to "Arrived" in `getPriorityDateLabel`.  A new `info-container` was added and some information was moved around.  The final revision at 12:25 PM added a new console log for debugging.


## 2:07:48 PM
The `shipment-details-page.tsx` file was updated on August 25, 2025, at 1:31:30 PM.  This update significantly enhances the component's functionality and presentation.  The changes involve:

* **Data Fetching and Display:** The component now fetches shipment details using `useFetchShipmentDetailsQuery` and displays them conditionally based on loading and success states.  It leverages data from the `shipmentDeatils` object to populate various UI elements.  Specific data points displayed include shipment scope, status (with color-coded badges), container type, consignee and delivery information, POL, POD, and estimated arrival/departure dates.

* **UI Improvements:**  The UI is significantly restructured using a combination of components from `@components` (e.g., `PageWrapper`, `Tabs`, `Stepper`, `Loader`, `IconButton`, `BaseModal`, `Badge`). The layout incorporates a map (`MapContainer`), tabs for messages and documents, a milestone container, and a document upload modal.  React icons are used extensively for visual appeal.

* **Interactive Elements:**  Users can navigate back using a back button, upload documents via a modal, and view shipment details broken down into different sections.  Conditional rendering based on data availability is implemented (e.g., showing place of delivery information based on if they are different).


* **Error Handling:**  Loading and error states are handled with a `Loader` component, preventing UI breakage while data is being fetched.

* **Helper Functions:**  A `getPriorityDateLabel` function is introduced to prioritize and format dates based on a predefined order ('ata', 'atd', 'etd', 'eta').  The `makeCapitalized` function is used for consistent capitalization of names.

* **Component Integration:**  Several components are integrated, including a stepper component to show the shipment progress, MessageTab, DocumentTab, and MilestoneContainer, which appear to handle different aspects of shipment information.


In essence, this commit represents a substantial overhaul of the shipment details page, providing a more comprehensive and user-friendly interface for displaying and interacting with shipment data.


## 3:07:47 PM
The log shows multiple revisions of the `shipmentService.ts` file on August 25th, 2025.  The changes primarily focus on the `getAll` function, which retrieves and processes shipment data.  The core functionality remains consistent across all revisions: retrieving shipment data based on various query parameters, then enhancing this data with information from an MTR (likely a Master Tracking Record) system.

Specific updates across the revisions include refinements to how shipment statuses are determined and handled. Initially, the code included a commented-out section relying on `shipmentScope` data. This was subsequently removed,  and the logic for determining shipment status was rewritten to rely more directly on MTR data fields like `departure_date`, `t49_eta`, `t49_vessel_actualdeparted_date`, `vessel_actualdeparted_date`, `t49_vessel_actualarrived_date`, and `vessel_actualarrived_date`. This new logic uses a series of `if` statements to assign a `ShipmentStatus` based on the presence or absence of these dates and their relative timing.  The `t49_holdspodterminal_name` field is also used to detect Custom Hold status.  The `getAll` function now explicitly handles cases where the `status` query parameter is either a string (representing a comma-separated list) or an array of `ShipmentStatus` values.  The time stamps show a series of quick edits.  The `SqlQueryBuilder` class, used for constructing database queries, remains largely unchanged across revisions; however its use within `getAll` is modified to incorporate these status changes and improved filtering.


## 3:07:48 PM
The log shows numerous modifications to `Calender.tsx` on August 25th, 2025, between 2:39 PM and 2:52 PM.  The core functionality of the calendar component remains consistent throughout these changes, displaying a calendar view with delivery or vessel arrival information.

The primary changes involve the addition and modification of a "Service Level" select element within the calendar's header. Initially, a `SelectBox` component is briefly introduced and then removed.  A standard HTML `<select>` element is then added, initially with `Standard` and `Expedited` options (around 2:48 PM), later replaced with `Door Delivery`, `Port Delivery`, and `Rail Delivery` options (around 2:52 PM).  The visibility of this `<select>` element is conditional, only appearing when `calenderType` is "vessel".  Minor adjustments to the spacing and padding within the header (`gap-5` vs `gap-2` and  `py-1.5` vs `py-1` in the select styling) are also observed across several commits.  There are no significant changes to the calendar's data rendering or other elements.  The frequent commits suggest iterative development and UI refinement of the service level selection feature.


## 4:07:47 PM
The log shows two nearly identical revisions of `dashboard-page.tsx`  on August 25th, 2025,  differing only in a single line within a `console.log` statement.  The first revision (3:58:29 PM) logs `ShipmentData`, while the second (3:59:31 PM) logs `dashboardCartData`.  This suggests a minor debugging step where the developer changed the variable being logged to examine different aspects of the fetched data.

The file `dashboard-page.tsx` is a React component responsible for rendering a dashboard page.  The code extensively uses React hooks (`useEffect`, `useMemo`, `useState`), Redux (`useDispatch`, `useSelector`), and several custom components for rendering various UI elements such as cards, date selectors, data grids, and a filter sidebar.  It also interacts with multiple API endpoints (`useFetchShipmentDataQuery`, `useFetchDeliveryDataQuery`, `useFetchCartDataQuery`) to fetch data for the dashboard.  The component manages state for calendar data, notifications, filters, pagination, and the data displayed on the dashboard.  The primary functionality involves fetching and displaying shipment and delivery data, allowing users to filter and paginate the data and using a date period selector. The use of `moment.js` for date manipulation is also apparent.


## 4:07:48 PM
The log shows multiple revisions to the `dashboardService.ts` file between 3:57 PM and 4:05 PM on August 25, 2025.  The primary changes center around the `getDashboardCardInfo` function, which retrieves dashboard data.

Initially, the `getDashboardCardInfo` function contained a single SQL query to fetch various shipment counts (pending departure, in transit, ETA within 1 week, out for delivery).  Subsequent revisions focused on enhancing this query by:

* **Adding TEU calculations:** The most significant change involves adding calculations for Twenty-foot Equivalent Units (TEU) for each shipment category.  This required adding more complex SQL expressions using `SUM`, `CAST`, `NULLIF`, and `REGEXP_REPLACE` to extract and sum container type data, then dividing by 20 to get the TEU count.  This modification happened between the first and second log entries and was refined in later commits.

* **Clarifying comments:**  A comment block was added to explain the meaning of each shipment status category in the context of T49 data (around 4:03 PM).

* **Minor syntax adjustments:** There were minor adjustments to the syntax, particularly around the type definitions in function parameters and date comparison logic within the `if` statement.

* **Redundant code removal:** A commented-out section of the `cardQuery` was removed at 4:05 PM, suggesting a cleanup of an earlier attempt at the TEU calculations.

The `getDeliveryData` function, which retrieves delivery and vessel arrival data, remained largely unchanged throughout the log entries.  This function uses two distinct SQL queries, one for delivery data and one for vessel arrival data, selected based on a query parameter.  Both queries incorporate a `buildMtrUserCondition` function for user-based filtering.

In summary, the major update involved adding TEU calculations to the SQL query within the `getDashboardCardInfo` function, improving the data's comprehensiveness.  The modifications occurred in rapid succession, suggesting an iterative refinement process. The underlying structure and functionality of both functions remained consistent across all revisions.


## 5:07:47 PM
The log shows modifications to `dashboardService.ts` on August 25th, 2025.  The primary changes center around the `getDashboardCardInfo` function.

The first update (4:13:42 PM) included the initial implementation of `getDashboardCardInfo` and `getDeliveryData`.  `getDashboardCardInfo` queried the `mtr_tracking_data` table for shipment information, categorizing it into 'Pending Departure', 'In Transit', 'ETA within 1 week', and 'Out for delivery'. `getDeliveryData` fetched delivery and vessel arrival data based on the query parameter 'type'.


A significant modification occurred at 4:17:09 PM.  The `cardQuery` within `getDashboardCardInfo` was heavily revised.  The original query simply counted shipments in each category.  The updated query added calculations for TEU (Twenty-foot Equivalent Unit)  for each category, using complex logic to extract and process container type information (`mtr.t49_cont_type` or `mtr.cont_type`) from the database.  This involved using `REGEXP_REPLACE` to remove non-numeric characters, `NULLIF` to handle null values, and `ROUND` to format the results. The commented-out original `cardQuery` suggests a refactoring from a simpler count to a more detailed calculation including TEU.


The final update (4:24:15 PM) shows no further changes to the code; the version is identical to the one at 4:17:09 PM.

Throughout the modifications, the `getDeliveryData` function remained unchanged.  The code consistently uses the `query` function from `@src/common/util/database` to interact with the database and utilizes logging extensively via the `logger` object. The code also makes use of user authentication information (`req.user`) for filtering results based on user roles or permissions via the `buildMtrUserCondition` function.


## 5:08:08 PM
The provided log shows multiple revisions of the `dashboard-page.tsx` file, all on August 25th, 2025.  The changes primarily involve refinements and additions to the React component responsible for rendering the dashboard.  No significant structural changes are observed across the revisions.  The timestamps indicate a period of active development, with minor adjustments happening within a short timeframe (4:10 PM to 4:21 PM) and then a more substantial change at 5:03 PM.


The core functionality of the DashboardPage component remains consistent throughout the log: fetching data using `useFetchShipmentDataQuery`, `useFetchDeliveryDataQuery`, and `useFetchCartDataQuery`, and managing UI elements (DatePeriodSelector, GlobalSearch).


The most significant change at 5:03:30 PM is the addition of a new state variable `deliveryMode` (of type `"door" | "port" | "rail" | null`) and the inclusion of this variable in the `useFetchDeliveryDataQuery` call.  This suggests the introduction of filtering or selection based on delivery method ("door", "port", or "rail") for the delivery data displayed on the dashboard.  All other revisions before this time show minor formatting or seemingly inconsequential modifications.  The overall pattern of the edits shows iterative improvements and debugging.
