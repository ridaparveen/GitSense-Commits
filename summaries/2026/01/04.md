# Activity Summary for 1/4/2026

## 2:59:57 PM
The provided log details a series of code changes, all occurring on January 2, 2026, primarily focusing on customer management, data fetching, and analytics queries within a T360 API backend.

**File-Specific Updates:**

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-backend\src\controllers\analytics\query\booking.query.ts` (Timestamp: 1/2/2026, 2:35:49 PM)**
    *   This file defines the `bookingQueryBuilder` function, responsible for generating complex SQL queries for analytics reports.
    *   It imports utilities for dynamic column selection and filter query generation.
    *   The function dynamically sets `customizer` properties (e.g., `selectedColumns`, `dateRange`, `calType`, `chartType`) based on the `type` of booking query requested.
    *   It supports various report types, including calculating average day differences between booking and actual departure dates (both container-wise and MBL-wise) and generating stacked bar charts to categorize these differences into time ranges (e.g., "Less than 1 week", "1 - 2 weeks").
    *   Queries use `mtr_tracking_data` and `agent_booking_entry` tables, applying filters for `CompanyName` and date ranges.

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-backend\src\controllers\getCustomerOptions.ts` (Multiple timestamps between 1/2/2026, 3:58:49 PM and 4:31:23 PM)**
    *   This controller manages customer options, primarily for fetching and deleting.
    *   **`getAllCustomerOptions`:** Fetches a distinct list of `account_name` from `mtr_tracking_data`, allowing for partial string searches and limiting results to 10. Earlier, commented-out code suggests more elaborate customer role-based and paginated fetching was considered or previously implemented.
    *   **`deleteCustomerOption`:** This function underwent several rapid iterations:
        *   Initially, it deleted records from `mtr_tracking_data` based on `account_name` provided in the request body.
        *   It then shifted to accepting a `customer_id` from `req.params`, first attempting to delete from `mtr_tracking_data` using a `customer_id` column, then an `id` column.
        *   The final change redirects the deletion to the `Account_Master_Customer_MAP` table, using the `id` column, indicating a focus on deleting specific customer mappings rather than general tracking data entries.
    *   Debugging `console.log` statements were temporarily added for `customer_id` and `req.params` during this iterative development.

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-backend\src\routes\getCustomerOptionsRoute.ts` (Multiple timestamps between 1/2/2026, 3:59:33 PM and 4:28:07 PM)**
    *   This file defines API routes for the `getCustomerOptions` controller.
    *   It exposes a `GET /` endpoint for `getAllCustomerOptions`.
    *   The `DELETE` route evolved from `DELETE /` to `DELETE /delete`, and finally to `DELETE /delete/:customer_id`. This evolution directly mirrors the changes in how `deleteCustomerOption` in its controller expects parameters.

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-backend\src\controllers\code.controller.ts` (Multiple timestamps between 1/2/2026, 4:12:38 PM and 4:14:13 PM)**
    *   This controller handles more comprehensive customer (Account Master) functionalities.
    *   **`getAllCustomer`:** Retrieves detailed customer information from `PO_AccountMaster_Customer_Master`, supporting pagination, sorting, and search filters. It also fetches associated shipper mappings (`account_master_shipper_MAP`), document uploads (`document_upload_details`), and customer mappings (`Account_Master_Customer_MAP`). A minor update added `customer_id` to the `customerMapData` output.
    *   **`createCustomer`:** A robust function for creating or modifying customer records.
        *   It supports file uploads and handles various customer attributes.
        *   Uses a database transaction.
        *   Determines if it's a 'NEW' or 'Modify' operation based on existing `acode`. For modifications, it deletes existing related records across multiple tables (`PO_AccountMaster_Customer_Master`, `agent_po_account_master_type`, `Account_Master_Shipper_MAP`, `account_master_pic`) before re-inserting.
        *   Generates new `acode` or `subcode` for new entries or specific customer types.
        *   Processes `ctypelist` to insert into `agent_po_account_master_type`.
        *   Parses `mapping` data (likely for shippers) to populate `Account_Master_Shipper_MAP`, resolving related codes from other master tables.
        *   The code for this function is truncated, indicating further logic beyond the provided snippet.

**Patterns and Recurring Elements:**

*   **Customer-Centric Development:** A strong focus on customer-related operations, including analytics, fetching options, detailed profile management, and deletion.
*   **Rapid Iteration on Deletion Logic:** The `deleteCustomerOption` function and its corresponding route changed multiple times within a short period, refining how customer deletion is performed and which data `id` is used (from `account_name` to `customer_id` to `id`, and from `mtr_tracking_data` to `Account_Master_Customer_MAP`).
*   **Database Interaction:** Extensive use of PostgreSQL-like SQL queries (`SELECT`, `INSERT`, `DELETE`, `TRIM`, `ILIKE`, `EXTRACT(DAY FROM...)`) with parameterized values ($1, $2) for security.
*   **Dynamic Query Generation:** The `bookingQueryBuilder` and `getAllCustomer` functions demonstrate building SQL queries dynamically based on input parameters.
*   **Utility Functions:** Reliance on imported helper functions like `getColumnsByCategory`, `getFilterQueryByDisplayValue`, `chkStr`, `getAccountCode`, `getAccountSubCode` for modularity and data handling.
*   **Logging and Debugging:** Frequent `console.log` and `logger.info` statements suggest an active debugging and monitoring process.
*   **Truncation:** Several code snippets are truncated, implying larger functions and more extensive changes were made than fully captured in the log.