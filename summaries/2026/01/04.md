# Activity Summary for 1/4/2026

## 2:59:57 PM
The provided log details a series of code changes, all occurring on January 2, 2026, primarily focusing on customer management, data fetching, and analytics queries within a T360 API backend.

**File-Specific Updates:**

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-backend\src\controllers\analytics\query\booking.query.ts` (Timestamp: 1/2/2026, 2:35:49 PM)**
    *   This file defines the `bookingQueryBuilder` function, responsible for generating complex SQL queries for analytics reports.
    *   It imports utilities for dynamic column selection and filter query generation.
    *   The function dynamically sets `customizer` properties (e.g., `selectedColumns`, `dateRange`, `calType`, `chartType`) based on the `type` of booking query requested.
    *   It supports various report types, including calculating average day differences between booking and actual departure dates (both container-wise and MBL-wise) and generating stacked bar charts to categorize these differences into time ranges (e.g., "Less than 1 week", "1 - 2 weeks").
    *   Queries use `mtr_tracking_data` and `agent_booking_entry` tables, applying filters for `CompanyName` and date ranges.

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-backend\src\controllers\getCustomerOptions.ts` (Multiple timestamps between 1/2/2026, 3:58:49 PM and 4:31:23 PM)**
    *   This controller manages customer options, primarily for fetching and deleting.
    *   **`getAllCustomerOptions`:** Fetches a distinct list of `account_name` from `mtr_tracking_data`, allowing for partial string searches and limiting results to 10. Earlier, commented-out code suggests more elaborate customer role-based and paginated fetching was considered or previously implemented.
    *   **`deleteCustomerOption`:** This function underwent several rapid iterations:
        *   Initially, it deleted records from `mtr_tracking_data` based on `account_name` provided in the request body.
        *   It then shifted to accepting a `customer_id` from `req.params`, first attempting to delete from `mtr_tracking_data` using a `customer_id` column, then an `id` column.
        *   The final change redirects the deletion to the `Account_Master_Customer_MAP` table, using the `id` column, indicating a focus on deleting specific customer mappings rather than general tracking data entries.
    *   Debugging `console.log` statements were temporarily added for `customer_id` and `req.params` during this iterative development.

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-backend\src\routes\getCustomerOptionsRoute.ts` (Multiple timestamps between 1/2/2026, 3:59:33 PM and 4:28:07 PM)**
    *   This file defines API routes for the `getCustomerOptions` controller.
    *   It exposes a `GET /` endpoint for `getAllCustomerOptions`.
    *   The `DELETE` route evolved from `DELETE /` to `DELETE /delete`, and finally to `DELETE /delete/:customer_id`. This evolution directly mirrors the changes in how `deleteCustomerOption` in its controller expects parameters.

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-backend\src\controllers\code.controller.ts` (Multiple timestamps between 1/2/2026, 4:12:38 PM and 4:14:13 PM)**
    *   This controller handles more comprehensive customer (Account Master) functionalities.
    *   **`getAllCustomer`:** Retrieves detailed customer information from `PO_AccountMaster_Customer_Master`, supporting pagination, sorting, and search filters. It also fetches associated shipper mappings (`account_master_shipper_MAP`), document uploads (`document_upload_details`), and customer mappings (`Account_Master_Customer_MAP`). A minor update added `customer_id` to the `customerMapData` output.
    *   **`createCustomer`:** A robust function for creating or modifying customer records.
        *   It supports file uploads and handles various customer attributes.
        *   Uses a database transaction.
        *   Determines if it's a 'NEW' or 'Modify' operation based on existing `acode`. For modifications, it deletes existing related records across multiple tables (`PO_AccountMaster_Customer_Master`, `agent_po_account_master_type`, `Account_Master_Shipper_MAP`, `account_master_pic`) before re-inserting.
        *   Generates new `acode` or `subcode` for new entries or specific customer types.
        *   Processes `ctypelist` to insert into `agent_po_account_master_type`.
        *   Parses `mapping` data (likely for shippers) to populate `Account_Master_Shipper_MAP`, resolving related codes from other master tables.
        *   The code for this function is truncated, indicating further logic beyond the provided snippet.

**Patterns and Recurring Elements:**

*   **Customer-Centric Development:** A strong focus on customer-related operations, including analytics, fetching options, detailed profile management, and deletion.
*   **Rapid Iteration on Deletion Logic:** The `deleteCustomerOption` function and its corresponding route changed multiple times within a short period, refining how customer deletion is performed and which data `id` is used (from `account_name` to `customer_id` to `id`, and from `mtr_tracking_data` to `Account_Master_Customer_MAP`).
*   **Database Interaction:** Extensive use of PostgreSQL-like SQL queries (`SELECT`, `INSERT`, `DELETE`, `TRIM`, `ILIKE`, `EXTRACT(DAY FROM...)`) with parameterized values ($1, $2) for security.
*   **Dynamic Query Generation:** The `bookingQueryBuilder` and `getAllCustomer` functions demonstrate building SQL queries dynamically based on input parameters.
*   **Utility Functions:** Reliance on imported helper functions like `getColumnsByCategory`, `getFilterQueryByDisplayValue`, `chkStr`, `getAccountCode`, `getAccountSubCode` for modularity and data handling.
*   **Logging and Debugging:** Frequent `console.log` and `logger.info` statements suggest an active debugging and monitoring process.
*   **Truncation:** Several code snippets are truncated, implying larger functions and more extensive changes were made than fully captured in the log.

## 3:00:09 PM
The changes primarily involve enhancements and additions to analytics query builders, focusing on transit, TEU, departure, general shipment, container, and booking-related reports. All modifications occurred on 1/2/2026.

**File-Specific Updates:**

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-backend-v2\src\common\util\transit.query.ts` (Timestamp: 1/2/2026, 4:59:40 PM)**
    *   Introduced `transitQueryBuilder` for generating complex SQL queries related to transit times.
    *   Supports analytics for "country_of_origin" and "port_pair" comparisons of actual, estimated, and estimated vs. actual transit times.
    *   Added dedicated logic for "ScheduledTransitVsActualTransit" (container-wise) and "ScheduledTransitVsActualTransitMblWise" (MBL-wise) reports, calculating average day differences between live actual arrived/departed dates and inland ETA/departure dates.
    *   The queries include `DISTINCT ON` clauses to handle data uniqueness based on voyage, container number, and container type.
    *   Customizer configurations for chart types, calculation types, and selected columns are dynamically set.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-backend-v2\src\services\analytics\teuService.ts` (Timestamp: 1/2/2026, 5:00:42 PM and 1/2/2026, 5:00:53 PM)**
    *   The `getTEUReports` service was updated to provide TEU (Twenty-foot Equivalent Unit) analytics.
    *   Calculates TEU based on `country_of_origin`, `country_of_discharge`, or other generic `group_by_column`.
    *   Includes logic to extract numeric container types (`t49_cont_type` or `cont_type`) for `total_volume` calculation and then converts to TEU (dividing by 20).
    *   Standardizes port names (e.g., 'LONG BEACH' becomes 'LOS ANGELES') for specific columns.
    *   Default `fromDate` and `toDate` are set if not provided in the request.
    *   The two entries for this file are functionally identical, indicating a minor save or reformat without code changes.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-backend-v2\src\common\util\departure.query.ts` (Timestamp: 1/2/2026, 5:01:49 PM)**
    *   Introduced `departureQueryBuilder` for departure-related KPIs.
    *   Supports "BLReleaseKPI" as a stacked bar chart, categorizing the difference between vessel actual departure and batch run date into "Equal/Less than 3 days" and "More than 3 days".
    *   Added "DelayedPOLDepartures" (container-wise) and "DelayedPOLDeparturesMblWise" (MBL-wise) reports, calculating the sum of day differences between live actual departed date and departure date.
    *   Implemented "OriginalETAvsActualETA" (container-wise) and "OriginalETAvsActualETAMblWise" (MBL-wise) reports, calculating the sum of day differences between updated ETA port date and original ETA POD.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-backend-v2\src\common\util\general.query.ts` (Timestamp: 1/2/2026, 5:03:05 PM)**
    *   Added `generalQueryBuilder` for basic shipment and MBL/container counts.
    *   Introduced "TotalShipments" which provides a count of distinct `fileno` (shipments) and distinct `voyage` (containers).
    *   Added "TotalShipmentsMblWise" which provides a count of distinct `fileno` (shipments) and distinct `mblno` (Master Bill of Lading).
    *   Calculates percentages for these counts relative to the maximum value observed.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-backend-v2\src\common\util\container.query.ts` (Timestamp: 1/2/2026, 5:03:44 PM)**
    *   Introduced `containerQueryBuilder` for container-specific analytics.
    *   Supports "ContainerDischargevsContainerAvailable" (difference between container available date and discharge date).
    *   Added "ContainerDischargeVsFinalDeliveryDate" (difference between delivery customer date and container discharge date, filtered by `type_of_move`).
    *   Implemented "ContainerGateOutVsGateIn" (difference between empty return date and container outgate date, adding 1 day).
    *   Added "ContainerOrVesselDischargeVsGateOut" (difference between container outgate and discharge date).
    *   Prioritizes `t49_` prefixed date columns where available, indicating "live" data.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-backend-v2\src\common\util\booking.query.ts` (Timestamp: 1/2/2026, 5:09:05 PM, 5:09:30 PM, 5:11:03 PM, 5:46:22 PM, 5:47:08 PM)**
    *   The `bookingQueryBuilder` was updated to include various booking-to-departure time analyses.
    *   Features "BookingDatetoActualDeparture" (container-wise) and "BookingDatetoActualDepartureMblWise" (MBL-wise) reports, calculating the average day difference between actual vessel departure and booking date.
    *   Introduced stacked bar chart variants: "BookingDatetoActualDepartureStackedBar" and "BookingDatetoActualDepartureMblWiseStackedBar", which categorize the day difference into weekly intervals (e.g., "Less than 1 week", "1 - 2 weeks").
    *   All five entries for this file at different timestamps are identical, indicating no functional code changes between these saves.

**Patterns and Recurring Elements:**

*   **Dynamic Query Generation:** A consistent pattern of constructing SQL queries based on `type`, `columnName`, `viewBy`, and `displayBy` parameters, using helper functions like `getFilterQueryByDisplayValue` and `getFilterQueryByTransitView`.
*   **Customizer Object:** The `customizer` object is universally used to configure report metadata such as `dateRange`, `calType`, `chartType`, `dateColumns`, and `calColumnConfig` for the frontend to interpret the analytics data.
*   **Column Selection:** The `getColumnsByCategory` utility is frequently called to define which columns are relevant for a given report, often ignoring common metadata columns and explicitly requiring key analytical columns.
*   **Date Handling and Validation:** All queries include robust date validation, checking for `IS NOT NULL` and `!= '0001-01-01 00:00:00 BC'` to ensure accurate calculations and prevent errors from invalid default dates. Date range filtering `departure_date >= '${fromDate}'::timestamp AND departure_date < '${toDate}'::timestamp + INTERVAL '1 day'` is also standard.
*   **Company-Specific Filtering:** Data is consistently filtered by `account_name` using `LOWER(account_name) = ANY ( regexp_split_to_array(LOWER('${CompanyName}'), '\s*,\s*') )`, allowing multiple company names to be passed.
*   **`DISTINCT ON` for Uniqueness:** Many queries use `DISTINCT ON (voyage,contno, CASE WHEN t49_cont_type IS NOT NULL AND TRIM(t49_cont_type) <> '' AND TRIM(t49_cont_type) != '0' THEN t49_cont_type ELSE cont_type END )` to ensure unique records, particularly for container-level analysis.
*   **`t49_` Data Prioritization:** There's a recurring logic to use `t49_` prefixed columns (e.g., `t49_vessel_actualdeparted_date`) over their standard counterparts if they contain valid data, suggesting `t49_` fields represent more current or accurate tracking information.
*   **Percentage Calculation Logic:** Most analytical queries include a `WITH max_value AS (...)` common table expression to determine the maximum value and then calculate each entity's `percentage` relative to this maximum, handling division by zero and negative values.
*   **MBL-Wise and Container-Wise Variants:** Several reports offer both container-level (`fileno || ',' || contno` for grouping) and MBL-level (`fileno || ',' || mblno` for grouping) aggregation, reflecting different granularities of tracking.
*   **PostgreSQL Features:** Extensive use of PostgreSQL-specific functions like `EXTRACT(DAY FROM interval)`, `DATE_TRUNC`, `regexp_split_to_array`, `CAST`, `NULLIF`, and `REGEXP_REPLACE` for data manipulation and aggregation.

## 4:03:59 PM
**File: `src\controllers\analytics\query\booking.query.ts` (Timestamp: 1/2/2026, 2:35:49 PM)**
This file defines the `bookingQueryBuilder` function, responsible for generating complex SQL queries for analytics reports related to booking and actual departure dates. It imports utilities for column selection and filter query generation. The function customizes report parameters like date ranges, calculation types (average), and date columns based on the `type` of the report.
Key updates include:
*   Ignored columns like `country_name`, `networkdays`, `bl_release_date` for column selection, while ensuring `bookingdate`, `booking_status_action_date`, `est_cargo_ready_date`, and `departure_date` are always included.
*   Introduced new report types:
    *   `BookingDatetoActualDeparture`: Calculates the average day difference between booking and actual departure dates per `fileno` and `contno`, providing a value and a percentage relative to the maximum value.
    *   `BookingDatetoActualDepartureMblWise`: Similar to the above, but aggregates per `fileno` and `mblno`.
    *   `BookingDatetoActualDepartureStackedBar`: Categorizes day differences into predefined ranges ("Less than 1 week", "1 - 2 weeks", etc.) and aggregates counts by date intervals, suitable for stacked bar charts.
    *   `BookingDatetoActualDepartureMblWiseStackedBar`: An incomplete block, presumably for a similar stacked bar chart aggregation per MBL.
Each query includes filtering by `CompanyName` and a date range (`fromDate`, `toDate`).

**File: `src\controllers\getCustomerOptions.ts`**
This controller manages customer options and deletion functionality.
*   **Initial Update (1/2/2026, 3:58:49 PM):**
    *   The `getAllCustomerOptions` function was completely refactored. Previously it had extensive commented-out logic for handling different roles (`AGENT`, `CUSTOMER`) and pagination, fetching from `agent_po_account_master` or `mtr_tracking_data`. The new version is streamlined to fetch `DISTINCT TRIM(account_name)` from `mtr_tracking_data` with a search capability (`ILIKE`) and a limit of 10 results.
    *   A new `deleteCustomerOption` function was introduced, initially designed to delete records from `mtr_tracking_data` based on `account_name` received in `req.body`.
*   **Subsequent Updates (1/2/2026, 4:17:54 PM - 4:31:23 PM):**
    *   **4:17:54 PM:** The `deleteCustomerOption` function was modified to accept `customer_id` from `req.params` instead of `account_name` from `req.body`, and the SQL query changed to `DELETE FROM mtr_tracking_data WHERE customer_id = $1`.
    *   **4:22:36 PM:** The SQL query in `deleteCustomerOption` was refined to use `id` as the column for deletion: `DELETE FROM mtr_tracking_data WHERE id = $1`.
    *   **4:28:41 PM, 4:28:50 PM, 4:29:40 PM:** Minor debugging `console.log` statements were added to `deleteCustomerOption` to inspect `customer_id` and `req.params`. The core delete logic remained unchanged.
    *   **4:31:23 PM:** The target table for deletion in `deleteCustomerOption` was changed from `mtr_tracking_data` to `Account_Master_Customer_MAP`, making the SQL `DELETE FROM Account_Master_Customer_MAP WHERE id = $1`.

**File: `src\routes\getCustomerOptionsRoute.ts`**
This file defines the API routes for customer options.
*   **Initial Update (1/2/2026, 3:59:33 PM):**
    *   Defined a `GET /` route for `getAllCustomerOptions` and a `DELETE /` route for `deleteCustomerOption`.
*   **Subsequent Updates (1/2/2026, 3:59:43 PM - 4:28:07 PM):**
    *   **3:59:43 PM:** The `DELETE` route was changed from `/` to `/delete`.
    *   **4:18:20 PM & 4:28:07 PM:** The `DELETE` route was further refined to include a dynamic `customer_id` parameter: `/delete/:customer_id`. This change directly corresponds to the `deleteCustomerOption` controller's expectation of `customer_id` from `req.params`.

**File: `src\controllers\code.controller.ts`**
This controller handles comprehensive customer management, including fetching, creating, and modifying customer records.
*   **Initial Update (1/2/2026, 4:12:38 PM):**
    *   `getAllCustomer`: This function retrieves customer details from `PO_AccountMaster_Customer_Master` with support for pagination, sorting (`orderBy`), and dynamic column-based searching. It also fetches and integrates related data, specifically shipper mappings from `account_master_shipper_MAP`, document upload details from `document_upload_details`, and customer mappings from `Account_Master_Customer_MAP`.
    *   `createCustomer`: This function manages the creation or modification of customer records, supporting file uploads.
        *   It sanitizes the `cname` field.
        *   It operates within a database transaction.
        *   It checks for existing customers by `acode`; if found, it's treated as a modification, leading to deletion of existing associated records across multiple tables (customer master, type, shipper map, account master pic) before re-insertion. If new, it generates a unique `acode`.
        *   Inserts into `PO_AccountMaster_Customer_Master`.
        *   Handles `ctypelist` specifically for 'CUSTOMER' type, inserting into `agent_po_account_master_type`.
        *   Processes `mapping` data (likely shipper-related), resolving `polcode`, `shippercode`, and `agentcode` by querying respective master tables, and then inserting into `Account_Master_Shipper_MAP`. The provided log for this function ends abruptly.
*   **Subsequent Update (1/2/2026, 4:14:13 PM):**
    *   `getAllCustomer`: The `customerMapData` object, returned as part of the customer details, was enhanced to include the `id` from `Account_Master_Customer_MAP`, now exposed as `customer_id`. The `createCustomer` function's code content was identical to the previous log entry, indicating no functional change to it in this specific timestamp, or that the snippet was truncated in the same manner.

**Patterns and Recurring Elements:**
*   **Rapid Iteration on Customer Deletion:** The `deleteCustomerOption` function and its corresponding route changed multiple times in a short span, moving from `req.body` to `req.params` for ID, refining the ID column name, and finally changing the target table for deletion.
*   **Focus on Customer Data:** A consistent theme is the management and retrieval of customer-related information across various tables (`PO_AccountMaster_Customer_Master`, `mtr_tracking_data`, `Account_Master_Shipper_MAP`, `Account_Master_Customer_MAP`).
*   **Complex SQL Queries:** Several functions utilize intricate SQL queries involving joins, subqueries, aggregations, date/time manipulations, and conditional logic (`CASE WHEN`).
*   **Database Transaction Management:** The `createCustomer` function explicitly uses `BEGIN` for a database transaction, indicating multi-step operations requiring atomicity.
*   **Data Sanitization:** Use of `TRIM()` in SQL and `chkStr()` in controllers, along with string replacements for `cname`, suggests an emphasis on clean data handling.
*   **Timestamp Proximity:** All logged changes occurred on the same day, indicating active development on these specific features.
*   **Incomplete Log Entries:** Several code blocks provided in the log end abruptly, suggesting the log might be capturing snapshots rather than full diffs for longer functions.

## 4:04:04 PM
The provided log details changes across several files, primarily focusing on frontend routing, a booking confirmation component, and customer management forms and API interactions.

### File-Specific Updates:

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\App.js`**
    *   **Timestamps:** 1/2/2026, 2:26:45 PM and 1/2/2026, 2:26:51 PM.
    *   **Key Changes:** These two commits are nearly identical, primarily involving extensive additions of `import` statements and new `Route` definitions within the React `Routes` component.
        *   **Imports:** A large number of new screen components were imported, covering various functionalities like `ShippingOrdersScreen`, `ContainerReportScreen`, `Auth0Login`, `ReportSchedulerScreen`, `NewReportScreen`, `EditReportScreen`, `SprAlcScreen`, `PdfParserScreen`, `AlcExceptionDashboard`, `AlcDestinationCostRecord`, `FCLScreen`, `SprInvoiceScreen`, `ISFDashboardScreen`, `BackOfficeAdminTerminal`, `LCLScreen`, `ShipmentTrackingScreen`, `AddMtrForm`, `GetTruckingDetails`, `RailScreen`, `AgentBookingFormScreenExtend`, `AgentPoFormExtend`, `Dashboard7501Screen`, `ShipmentsScreen`, `CngBookingScreen`, `BookingDashbaordScreenExtend`, `CngBookingFormScreen`, `CngBookingScreenExtend`, `CityMaster`, `UploadOTMBOL`, `PortmasterScreen`, `AirTrackingScreen`, `Auth0LogoutHandler`, and `HblListDetails`.
        *   **Routes:** Corresponding `Route` paths were added for these new components, often nested under `/app` and protected by `ProtectedRoute` based on `UserRoleEnum`.
        *   **Specific Route Modifications:**
            *   The root path (`/`) was uncommented and changed to render `LoginScreen` within `AuthGuard`.
            *   A `/logout` path was added for `Auth0LogoutHandler`.
            *   The `booking` route was updated to use `BookingDashbaordScreenExtend` instead of `BookingDashbaordScreen`.
            *   The `booking/form` route was updated to use `AgentBookingFormScreenExtend` instead of `AgentBookingFormScreen`.
            *   A new route `booking/form/po_form` was added, rendering `AgentPoFormExtend`.
            *   New `isf_dashboard` routes were introduced for `ISFDashboardScreen` and its form.
            *   New `spr` related routes for `spr_dashboard`, `portmaster`, and `city_master` were added.
            *   OTM BOL routes for `upload`, `add`, and `edit` were added.
            *   Detention routes for `linewise` and `customerwise` were added.
            *   Commercial Invoice routes (`commercial_invoice`, `commercial_invoice/form`) were added.
            *   The file shows a partial `agent_po/form` route at the end, suggesting further additions or truncation.

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\pages\booking\AgentBookingConfirmation.jsx`**
    *   **Timestamp:** 1/2/2026, 2:59:06 PM.
    *   **Key Changes:** This component handles agent booking confirmation.
        *   **New Imports:** `ThemedModalExtend` and `AddVesselForm` (from `packing-list`) were imported, suggesting new modal functionality for adding vessels. `ScacCodeForm` and `UploadFile` were also imported. `FiDownload` and `FaHourglass` icons were added.
        *   **State Additions:** `openVesselModal` and `openScacModal` states were introduced, confirming the addition of modals for vessel and SCAC code management.
        *   **`useGetBookingConfirmQuery`:** The query for booking confirmation data now uses `initialValues?.agent_booking_id || ""` as a parameter, ensuring it fetches data only when an ID is available.
        *   **`useFetchBookingPlListQuery`:** The PL list fetching logic was updated to use `page: pagination.page + 1` and `perPage: pagination.pageSize` (though `page: 1` is fixed in the current query, with a large `perPage` implied for client-side filtering). It also includes `pl_status: "SUBMIT"` for empty keywords and `serial_id` for selected/deselected PLs. It now `skip`s fetching if `confirmData` is not yet loaded.
        *   **`useEffect` for selected PLs:** New `useEffect` hooks were added to load and initialize `selectedPl` from `confirmData` when it becomes available, ensuring existing selections are pre-filled.
        *   **Form Submission (`onSubmit`):**
            *   Includes a check for `initialValues?.agent_booking_id` to prevent submission if missing.
            *   Handles `do_document` file uploads using `FormData`.
            *   Sends `selectedPl` and `deselectedPl` arrays to the `updateDo` mutation.
            *   Implements conditional logic for `userAction` (`save_and_next`, `send-to-otm`).
            *   The "send-to-otm" action now triggers `generateXML` and `uploadXML` mutations, with success/error toasts and loaders.
            *   Improved error handling, specifically catching custom warning errors thrown for API warnings and displaying them in a `PopupAlert`.

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\components\screen\code\customer\CustomerForm.jsx`**
    *   **Timestamps:** 1/2/2026, 3:46:26 PM, 1/2/2026, 3:48:00 PM, 1/2/2026, 3:48:14 PM, 1/2/2026, 3:54:30 PM, and 1/2/2026, 4:36:47 PM.
    *   **Key Changes:** This component handles the form for adding/editing customer details.
        *   **Initial `3:46:26 PM`:**
            *   Introduced `CustomerMapping` component, which manages customer-to-customer mappings.
            *   The `formik` initial values were updated to include `customer_mapping` and initialize it if empty.
            *   `formData` submission logic was updated to stringify and append `customer_mapping` along with `mapping` and `files`.
            *   Added `handleIsfPartyOptionChange` to fetch "IMPORTER" options for "ISF Party Mapping" autocomplete.
        *   **`3:48:00 PM`:** Reverted the `customer_mapping` initialization logic within `formik`'s `initialValues` back to simply `initialValues`, removing the conditional check for `length`.
        *   **`3:48:14 PM`:** Reverted the `customer_mapping` initialization again, adding back the conditional `initialValues.customer_mapping?.length ? initialValues.customer_mapping : []`. This implies a back-and-forth on how `customer_mapping` should be initialized.
        *   **`3:54:30 PM`:** Added a `console.log("initialValues123456", initialValues);` for debugging purposes. No functional change.
        *   **`4:36:47 PM`:** No functional changes observed compared to the `3:54:30 PM` version. The `console.log` remains.

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\components\screen\code\customer\CustomerMapping.jsx`**
    *   **Timestamps:** 1/2/2026, 3:47:04 PM, 1/2/2026, 4:03:31 PM, 1/2/2026, 4:04:17 PM, 1/2/2026, 4:09:07 PM, 1/2/2026, 4:21:23 PM, 1/2/2026, 4:21:38 PM, 1/2/2026, 4:34:47 PM, 1/2/2026, 4:35:01 PM, and 1/2/2026, 4:35:58 PM.
    *   **Key Changes:** This component manages a list of customer mappings using `AppAutocomplete` and allows adding/deleting rows.
        *   **Initial `3:47:04 PM`:** Implements basic add/delete row functionality for `customer_mapping` within `formik`. Fetches customer options using `ApiManager.getCustomerOptions`.
        *   **`4:03:31 PM`:** Introduced logic in `deleteRow` to call `ApiManager.deleteCustomerOption` **only if** `rowToDelete.customer` has a value. If the API call fails, the UI deletion is prevented.
        *   **`4:04:17 PM`:** Changed `ApiManager.deleteCustomerOption` to `ApiManager.deleteCustomerOptions`. This suggests a renaming of the API method.
        *   **`4:09:07 PM`:** **Reverted** the `deleteRow` logic to no longer call a backend API. It now only filters the `mapping` array to remove the row from the UI. This undoes the backend deletion capability introduced at `4:03:31 PM`.
        *   **`4:21:23 PM`:** Reinstated backend deletion logic in `deleteRow`, but now specifically checks for `row.customer_id` and calls `ApiManager.deleteCustomerOption(row.customer_id)`.
        *   **`4:21:38 PM`:** Added a `console.log(row, "rowdata====");` for debugging.
        *   **`4:34:47 PM`:** Enhanced `deleteRow` with `toast.success` for successful deletion and `toast.info` for local row removal (if `customer_id` is missing). Also added `toast.error` for API failures.
        *   **`4:35:01 PM`:** Imported `toast` from `react-hot-toast`.
        *   **`4:35:58 PM`:** Removed comment lines (`/* --- */`). No functional change.

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\services\Endpoints.js`**
    *   **Timestamps:** 1/2/2026, 4:01:34 PM, 1/2/2026, 4:08:51 PM, 1/2/2026, 4:20:10 PM, 1/2/2026, 4:20:25 PM, 1/2/2026, 4:25:35 PM, 1/2/2026, 4:32:00 PM, and 1/2/2026, 4:36:10 PM.
    *   **Key Changes:** This file defines API endpoints.
        *   **Initial `4:01:34 PM`:** `DELETE_CUSTOMER_OPTION` was defined as `(accountName) => `/deleteCustomerOption?account_name=${encodeURIComponent(accountName)}``.
        *   **`4:08:51 PM`:** Removed `DELETE_CUSTOMER_OPTION` entirely. This explains why `CustomerMapping.jsx` had a temporary removal of API calls for deletion.
        *   **`4:20:10 PM`:** `DELETE_CUSTOMER_OPTION` was re-added but incorrectly pointed to `getCustomerOptions` with a search parameter, which is a GET endpoint. This was likely a mistake.
        *   **`4:20:25 PM`:** `DELETE_CUSTOMER_OPTION` was corrected to `(customerId) => `/deleteCustomerOption/${customerId}``, implying a DELETE request to a specific ID.
        *   **`4:25:35 PM`:** `DELETE_CUSTOMER_OPTION` was changed to `(customerId) => `/delete/${customerId}``, making the path more generic.
        *   **`4:32:00 PM`:** `DELETE_CUSTOMER_OPTION` was changed again to `(customerId) => `/getCustomerOptions/delete/${customerId}``, making the path specific to customer options and deletion.
        *   **`4:36:10 PM`:** No functional change compared to the `4:32:00 PM` version.

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\services\ApiManager.js`**
    *   **Timestamps:** 1/2/2026, 4:01:42 PM, 1/2/2026, 4:01:51 PM, 1/2/2026, 4:06:54 PM, 1/2/2026, 4:08:09 PM, 1/2/2026, 4:19:58 PM, and 1/2/2026, 4:36:34 PM.
    *   **Key Changes:** This file manages API calls using the defined endpoints.
        *   **Initial `4:01:42 PM`:** Had a duplicate `getCustomerOptions` definition. The second one incorrectly used `DELETE_CUSTOMER_OPTION` endpoint with `ApiMethods.get`.
        *   **`4:01:51 PM`:** Corrected the duplicate, renaming the second one to `deleteCustomerOptions` and still incorrectly using `ApiMethods.get` with the `DELETE_CUSTOMER_OPTION` endpoint.
        *   **`4:06:54 PM`:** `deleteCustomerOptions` was correctly changed to use `ApiMethods.delete` and the `DELETE_CUSTOMER_OPTION` endpoint. The parameter name was also made `accountName`.
        *   **`4:08:09 PM`:** `deleteCustomerOptions` was entirely removed, reflecting the change in `Endpoints.js`.
        *   **`4:19:58 PM`:** `deleteCustomerOption` (singular, with `customerId` parameter) was re-added, correctly using `ApiMethods.delete` and passing `customerId` to the endpoint.
        *   **`4:36:34 PM`:** No functional change compared to the `4:19:58 PM` version.

### Timestamps of Significant Changes:

*   **1/2/2026, 2:26:45 PM - 1/2/2026, 2:26:51 PM:** Major frontend routing expansion in `App.js` with many new screens and protected routes.
*   **1/2/2026, 2:59:06 PM:** Significant refactoring and feature addition in `AgentBookingConfirmation.jsx`, including XML generation/upload, improved PL data fetching, and robust error handling.
*   **1/2/2026, 3:46:26 PM:** Introduction of `CustomerMapping.jsx` and its integration into `CustomerForm.jsx`, enabling dynamic customer mapping functionality.
*   **1/2/2026, 4:03:31 PM - 1/2/2026, 4:21:23 PM:** Back-and-forth changes in `CustomerMapping.jsx` and related API definitions in `Endpoints.js` and `ApiManager.js` concerning the implementation of backend deletion for customer mappings, eventually settling on a `DELETE` request with `customer_id`.
*   **1/2/2026, 4:34:47 PM:** Final refinement of `deleteRow` in `CustomerMapping.jsx` to include user feedback (toasts) for deletion actions.

### Patterns and Recurring Elements:

*   **Modular Component Development:** The project heavily uses React components (e.g., `Screen` components, `Form` components, `Providers`, `common` UI elements) indicating a modular and reusable architecture.
*   **Role-Based Access Control:** `ProtectedRoute` and `UserRoleEnum` are consistently used across `App.js` to enforce role-based access to various routes and features (ADMIN, CUSTOMER, AGENT, CSF, FRONTOFFICE, BACKOFFICE, SPR_CUSTOMER, ADMIN_V2). This is a strong recurring pattern.
*   **Formik for Form Management:** `useFormik` is extensively used in form components (`AgentBookingConfirmation.jsx`, `CustomerForm.jsx`) for handling form state, validation, and submission, suggesting a standardized approach to forms.
*   **Redux Toolkit Query (RTK Query):** The presence of `useAddCustomerMutation`, `useCreateBookingXmlMutation`, `useUploadBookingXmlMutation`, `useFetchBookingPlListQuery`, `useGetBookingConfirmQuery`, and `useUpdateDoMutation` indicates a strong reliance on RTK Query for data fetching and mutation, promoting a consistent data layer.
*   **Centralized API Management:** `ApiManager.js` and `Endpoints.js` work together to define and manage all API interactions, providing a single source of truth for API endpoints and methods.
*   **Toast Notifications:** `react-hot-toast` is consistently used across different components for providing user feedback (success, error, warning, loading messages).
*   **Autocomplete for Search/Selection:** `AppAutocomplete` is used in multiple forms for searching and selecting options (e.g., Sales Rep, City, Descartes Customer Mapping, ISF Party Mapping, Customer Mapping).
*   **Responsive Design:** `useMediaQuery` from `@mui/material` is used in `AgentBookingConfirmation.jsx` to adjust UI elements (like `pageSize`) based on screen size.
*   **Debugging Statements:** Repeated `console.log` statements (e.g., "TEST on Flow", "initialValues : ", "initialValues123456", "rowdata====") appear across changes, indicating active development and debugging.
*   **Iterative API Endpoint Refinement:** The `DELETE_CUSTOMER_OPTION` endpoint and its corresponding `ApiManager` method underwent several changes in URL structure and method type (from GET to DELETE, and path variations), suggesting an iterative process to finalize the API design or correct earlier misconfigurations.

## 4:04:08 PM
Across the `t360-backend-v2` repository, a series of updates were made to several query builder files (`transit.query.ts`, `teuService.ts`, `departure.query.ts`, `general.query.ts`, `container.query.ts`, `booking.query.ts`) around **January 2nd, 2026**, primarily between 4:59 PM and 5:47 PM. These changes are focused on refining the data retrieval logic and customization options for various analytics reports.

**File-Specific Updates:**

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-backend-v2\src\common\util\transit.query.ts` (Timestamp: 1/2/2026, 4:59:40 PM):**
    *   The `transitQueryBuilder` function was enhanced to handle different transit report types.
    *   For "country\_of\_origin" reports, it now customizes chart type, selected columns (prioritizing `eta_pod`, `country_name`, `departure_date`, `t49_vessel_actualarrived_date`, `t49_vessel_actualdeparted_date`), and defines calculation configurations for actual, estimated, and estimated-actual transit times. It executes separate queries for each, storing results in `customizer.additionalData`.
    *   For "ScheduledTransitVsActualTransit" and "ScheduledTransitVsActualTransitMblWise" types, new SQL queries were introduced. These queries calculate the difference between actual and estimated transit durations (`t49_vessel_actualarrived_date - t49_vessel_actualdeparted_date` vs `inland_eta - departure_date`), grouped by `fileno || ',' || contno` or `fileno || ',' || mblno` respectively, and provide a percentage relative to the maximum difference.
    *   The `queryGenerator` function was detailed for "country\_of\_origin" reports, involving a join with `portmaster` and including logic to handle negative values and division by zero in percentage calculations.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-backend-v2\src\services\analytics\teuService.ts` (Timestamps: 1/2/2026, 5:00:42 PM and 5:00:53 PM):**
    *   The `getTEUReports` function was updated to dynamically construct TEU calculation queries.
    *   It now supports grouping by "country\_of\_origin" or "country\_of\_discharge", joining `mtr_tracking_data` with `portmaster` and calculating TEU based on container types (`t49_cont_type` or `cont_type`).
    *   For other grouping columns, the query calculates TEU, mapping "LONG BEACH" to "LOS ANGELES" for certain `pod` columns and assigning 'OTHERS' for null/empty values.
    *   The `mblwiseCondition` object defines a `DISTINCT ON` clause for ensuring unique container entries per voyage.
    *   The two commits for this file show identical content, indicating a minor, non-functional save or re-save.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-backend-v2\src\common\util\departure.query.ts` (Timestamp: 1/2/2026, 5:01:49 PM):**
    *   The `departureQueryBuilder` function was expanded to manage several departure-related reports.
    *   "BLReleaseKPI" now generates a stacked bar chart, categorizing the day difference between "Vessel Actual Departure Date" and "Batch Run Date" into "Equal/Less than 3 days" and "More than 3 days".
    *   "DelayedPOLDepartures" and "DelayedPOLDeparturesMblWise" calculate the sum of day differences when `t49_vessel_actualdeparted_date` is later than `departure_date`, grouped by `fileno || ',' || contno` or `fileno || ',' || mblno` respectively.
    *   "OriginalETAvsActualETA" and "OriginalETAvsActualETAMblWise" (partially shown) calculate the day difference between "Updated ETA Port Date" and "ETA POD", also grouped by `fileno || ',' || contno` or `fileno || ',' || mblno`.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-backend-v2\src\common\util\general.query.ts` (Timestamp: 1/2/2026, 5:03:05 PM):**
    *   The `generalQueryBuilder` now handles "TotalShipments" and "TotalShipmentsMblWise" reports.
    *   These reports use `UNION` queries to count distinct `fileno` (Shipment Count) and `voyage` (Container Count) or `mblno` (Mbl Count).
    *   Notably, the percentage calculation for these general reports is performed in JavaScript *after* the database query, rather than directly within the SQL.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-backend-v2\src\common\util\container.query.ts` (Timestamp: 1/2/2026, 5:03:44 PM):**
    *   The `containerQueryBuilder` was updated to support various container-related analytics.
    *   This includes "ContainerDischargevsContainerAvailable" (difference between `t49_cont_available_date`/`cont_available_date` and `cont_discharge_date`), "ContainerDischargeVsFinalDeliveryDate" (difference between `delivery_customer_date` and `cont_discharge_date`, filtered by `type_of_move`), "ContainerGateOutVsGateIn" (difference between `t49_empty_return_date`/`empty_return_date` and `t49_contno_out_gated`/`contno_out_gated`), and "ContainerOrVesselDischargeVsGateOut" (difference between `t49_contno_out_gated`/`contno_out_gated` and `cont_discharge_date`).

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-backend-v2\src\common\util\booking.query.ts` (Timestamps: 1/2/2026, 5:09:05 PM, 5:09:30 PM, 5:11:03 PM, 5:46:22 PM, 5:47:08 PM):**
    *   The `bookingQueryBuilder` handles "BookingDatetoActualDeparture" reports (both container and MBL-wise) which calculate the average day difference between "Live Actual Departed Date" and "Booking Date" by joining `mtr_tracking_data` with `agent_booking_entry`.
    *   Stacked bar chart versions ("BookingDatetoActualDepartureStackedBar", "BookingDatetoActualDepartureMblWiseStackedBar") categorize these day differences into predefined time bins (e.g., "Less than 1 week", "1 - 2 weeks").
    *   Multiple commits for this file show identical code, suggesting repeated saves without material changes.

**Patterns and Recurring Elements:**

*   **Consistent Date and Company Filtering:** All queries uniformly filter data by `departure_date` within a `fromDate` and `toDate` range and by `LOWER(account_name) = ANY (regexp_split_to_array(LOWER('${CompanyName}'), '\s*,\s*'))`, allowing multiple company names.
*   **Robust Date Validation:** Many queries include explicit checks for valid dates (`IS NOT NULL` and `!= '0001-01-01 00:00:00 BC'`) to prevent calculations with placeholder or invalid date entries.
*   **Prioritization of `t49_` Data:** A recurring `CASE WHEN t49_... IS NOT NULL THEN t49_... ELSE ... END` pattern is used, indicating that `t49_` prefixed columns (e.g., `t49_cont_type`, `t49_vessel_actualdeparted_date`) are considered more authoritative or up-to-date.
*   **`DISTINCT ON` for Uniqueness:** The `DISTINCT ON (voyage,contno, CASE WHEN t49_cont_type IS NOT NULL ... END)` clause is widely used in subqueries to ensure unique records for aggregation, particularly when calculating differences involving containers.
*   **Percentage Calculations:** Most analytical reports calculate a `percentage` based on a value relative to a maximum value, often with specific handling for division by zero or negative values.
*   **Modular Query Building:** The codebase is structured with separate query builder files for different analytics categories (transit, departure, container, booking, general), each dynamically generating SQL based on the report `type` and user `customizer` settings.
*   **Customizer Object for Report Configuration:** The `customizer` object is central to configuring report behavior, including `chartType`, `calType`, `dateRange`, `dateColumns`, `calColumnConfig`, and `selectedColumns` (often populated via `getColumnsByCategory`).
*   **Clustered Timestamps:** The concentration of changes within a ~45-minute window on January 2nd, 2026, suggests a focused development or deployment activity for these analytics modules.

## 4:16:50 PM
The provided log details changes across two files within a JavaScript learning environment, primarily focusing on basic HTML structure and JavaScript variable declarations.

**File: `c:\Users\ridap\OneDrive\Documents\javascript-learning\index.html`**
This file, updated between 1/4/2026, 3:18:32 PM and 3:18:41 PM, represents a simple HTML document.
Initially, it contained a basic `<h1>Hello world!</h1>` heading and an empty `<button>` element with an `onclick` attribute triggering an alert.
A subsequent change, occurring just seconds later, added the text "Click me" inside the button, making it visible and interactive.

**File: `c:\Users\ridap\OneDrive\Documents\javascript-learning\0_variables.js`**
This JavaScript file underwent several iterations between 1/4/2026, 3:36:06 PM and 3:45:41 PM, demonstrating a clear progression in learning JavaScript variables.
*   It began with a simple `console.log("Hello my first js code!";)` statement (initial commit at 3:36:06 PM), which was quickly corrected for a syntax error (extra semicolon inside the string literal) by 3:36:47 PM.
*   Further updates (3:38:49 PM - 3:38:57 PM) introduced the declaration and logging of a `myAge` variable using `var`, alongside a comment referencing "camel case" variable naming convention.
*   A significant expansion at 3:45:07 PM added more variable declarations (`my_firtsName`, `_lastName`, `$myAge`), showcasing different valid naming styles. This update also included examples of *invalid* variable names (`123data`, `my@email`) which would cause syntax errors.
*   By 3:45:32 PM, the invalid variable examples (`123data` and `my@email`) were commented out, indicating an understanding of JavaScript's variable naming rules. The final entry for this file at 3:45:41 PM shows no functional change from the previous state.

**Patterns and Recurring Elements:**
The log demonstrates a typical learning process:
*   **Incremental Development:** Code is built up in small, manageable steps, adding new features or concepts one at a time.
*   **Error Correction:** Initial syntax errors (e.g., in `console.log` and invalid variable names) are identified and corrected or commented out, reflecting an active debugging and learning cycle.
*   **Concept Exploration:** The `0_variables.js` file specifically explores different aspects of variable declaration and naming conventions in JavaScript.
*   **Timestamps:** The close proximity of timestamps for changes within the same file (e.g., multiple changes to `0_variables.js` within minutes) suggests active, focused work sessions.