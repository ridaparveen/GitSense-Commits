# Activity Summary for 1/6/2026

## 8:43:41 AM
The development log primarily details changes across two files within a `javascript-learning` directory.

**File: `c:\Users\ridap\OneDrive\Documents\javascript-learning\index.html`**
*   **Initial Setup (1/4/2026, 3:18:32 PM):** An HTML document was created with a basic structure, including a `<h1>` tag displaying "Hello world!" and an empty `<button>` element configured to show an alert "welcome to my js tutorials" when clicked.
*   **Button Text Added (1/4/2026, 3:18:41 PM):** Shortly after creation, the button's visible text was updated to "Click me".

**File: `c:\Users\ridap\OneDrive\Documents\javascript-learning\0_variables.js`**
*   **Initial Code and Correction (1/4/2026, 3:36:06 PM - 1/4/2026, 3:36:47 PM):** The file was first created with a `console.log("Hello my first js code!";)` statement containing a syntax error (extra semicolon). This error was corrected within a minute to `console.log("Hello my first js code!");`.
*   **Variable Introduction (1/4/2026, 3:38:49 PM - 1/4/2026, 3:38:57 PM):** The code was expanded to include a `var` declaration for `myAge = 25;` and its subsequent `console.log()`. A comment `// camel` was added and then refined to `// camel case`.
*   **Exploring Variable Naming (1/4/2026, 3:45:07 PM):** Significant additions demonstrated various variable naming conventions using `var`:
    *   `my_firtsName = "Rida";`
    *   `_lastName = "Parveen";`
    *   `$myAge = 25;`
    *   Attempts were made to declare invalid variables like `123data` (starting with a number) and `my@email` (containing a special character), followed by `console.log()` for each.
*   **Invalid Variable Declarations Commented Out (1/4/2026, 3:45:32 PM - 1/4/2026, 3:45:41 PM):** The previously added invalid variable declarations (`123data` and `my@email`) were commented out, indicating a learning or debugging step to understand valid JavaScript variable names. The final entry at 3:45:41 PM shows no functional change.

**Patterns and Recurring Elements:**
*   **Learning Progression:** The changes reflect a clear learning path for JavaScript, starting with basic HTML interaction, then moving to fundamental JavaScript concepts like `console.log` and variable declarations.
*   **Iterative Development and Refinement:** There are multiple small, incremental changes, including syntax corrections, comment refinements, and the process of attempting invalid code and then commenting it out, suggesting an iterative approach to understanding and writing code.
*   **Focus on Fundamentals:** The `0_variables.js` file specifically explores `var` declarations and variable naming rules, a core concept for beginners.
*   **Use of `console.log()`:** `console.log()` is used extensively throughout the JavaScript file to output and presumably test the values of declared variables.
*   **Consistent File Naming Convention:** The JavaScript file `0_variables.js` suggests a structured learning sequence (e.g., "0_" for the first topic).

## 1:46:47 PM
The changes log details development activities primarily within a `javascript-learning` directory, focusing on basic HTML structure and JavaScript variable concepts. All significant modifications occurred on **1/4/2026**.

**File-Specific Updates:**

*   **`c:\Users\ridap\OneDrive\Documents\javascript-learning\index.html`**:
    *   Initiated on **1/4/2026, 3:18:32 PM**, with a basic HTML5 page containing an `<h1>Hello world!</h1>` and an empty `<button>` that triggers an `alert('welcome to my js tutorials')` on click.
    *   Shortly after, on **1/4/2026, 3:18:41 PM**, the button was updated to display "Click me" as its text content.

*   **`c:\Users\ridap\OneDrive\Documents\javascript-learning\0_variables.js`**:
    *   Started on **1/4/2026, 3:36:06 PM**, with a `console.log` statement that initially contained a syntax error (an extra semicolon inside the string).
    *   The syntax error was corrected by **1/4/2026, 3:36:47 PM**.
    *   By **1/4/2026, 3:38:49 PM**, the file began exploring JavaScript variables, introducing a `var myAge = 25;` and a comment `// camel`. The comment was slightly refined to `// camel case` by **1/4/2026, 3:38:57 PM**.
    *   A significant expansion occurred at **1/4/2026, 3:45:07 PM**, where multiple `var` declarations were added to demonstrate various naming conventions (e.g., `my_firtsName`, `_lastName`, `$myAge`). This also included attempts to declare invalid variable names like `123data` (starting with a number) and `my@email` (containing a special character).
    *   These invalid variable declarations were subsequently commented out by **1/4/2026, 3:45:32 PM**, indicating an understanding or demonstration of JavaScript variable naming rules.
    *   The final entry at **1/4/2026, 3:45:41 PM** shows no functional change, retaining the previously commented-out lines.

**Patterns and Recurring Elements:**

*   The file names (`0_variables.js`) and content suggest a structured learning process for JavaScript fundamentals, starting with basic output and progressing to variable declaration rules.
*   Frequent use of `console.log()` is observed across the `0_variables.js` file, indicating a common method for output and debugging during learning.
*   The progression in `0_variables.js` from basic `console.log` to exploring valid and invalid variable naming conventions highlights a focus on core language syntax.
*   All activities recorded occurred within a short timeframe on the same day, `1/4/2026`, suggesting an active learning or development session.

## 1:47:03 PM
The provided log details significant updates across multiple files related to data querying and analytics in a backend system. The changes primarily focus on how company names are handled in SQL queries, transitioning from a single company name string to a list of company names, likely to support multi-company filtering.

### File-Specific Updates:

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-backend-v2\src\common\util\transit.query.ts`**
    *   **Timestamp: 1/2/2026, 4:59:40 PM**: Initial comprehensive update of the `transitQueryBuilder` function. It now constructs queries for various transit-related reports (e.g., "country\_of\_origin", "ScheduledTransitVsActualTransit") based on `columnName` and `type` parameters. The function dynamically sets `customizer` properties (like `calType`, `chartType`, `selectedColumns`, `calColumnConfig`, `additionalData`) and generates complex SQL queries involving `mtr_tracking_data` and `portmaster` tables. It includes logic to handle `mblwiseCondition` and date filtering.
    *   **Timestamp: 1/5/2026, 8:32:12 PM & 1/5/2026, 8:34:19 PM & 1/5/2026, 8:42:52 PM**: Introduced `companyList` generation from `CompanyName` by splitting it by comma, trimming, lowercasing, and joining with commas for use in SQL's `IN` clause. This change was applied to the `LOWER(account_name) = ANY (regexp_split_to_array(LOWER('${CompanyName}'), '\\s*,\\s*'))` condition, changing it to `LOWER(account_name) IN (${companyList})`.
    *   **Timestamp: 1/6/2026, 10:33:35 AM & 1/6/2026, 10:33:41 AM**: The `companyList` generation logic was modified to split `CompanyName` by `"||"` instead of `","`.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-backend-v2\src\services\analytics\teuService.ts`**
    *   **Timestamp: 1/2/2026, 5:00:42 PM & 1/2/2026, 5:00:53 PM**: These entries show the `getTEUReports` service function. It fetches TEU (Twenty-foot Equivalent Unit) reports, grouping data by `columnName` (e.g., `country_of_origin`, `country_of_discharge`, or other columns). It dynamically builds SQL queries to calculate TEU values and percentages, handling different grouping criteria and date ranges. It also includes logic for container type parsing (`t49_cont_type`, `cont_type`) and port name normalization (e.g., "LONG BEACH" to "LOS ANGELES"). The service also initializes a `customizer` object for report display settings.
    *   **Timestamp: 1/5/2026, 8:41:46 PM & 1/5/2026, 8:42:05 PM**: Introduced `companyList` generation from `CompanyName` using comma splitting, trimming, lowercasing, and joining for use in SQL's `IN` clause, replacing `LOWER(account_name) = ANY (...)`.
    *   **Timestamp: 1/6/2026, 10:34:11 AM**: The `companyList` generation logic was modified to split `CompanyName` by `"||"` instead of `","`.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-backend-v2\src\common\util\departure.query.ts`**
    *   **Timestamp: 1/2/2026, 5:01:49 PM**: This file defines `departureQueryBuilder` for generating queries related to departure analytics. It supports multiple report types such as "BLReleaseKPI" (Stacked Bar Chart for BL Release), "DelayedPOLDepartures" (Delayed Departures at Port of Loading, container-wise and MBL-wise), and "OriginalETAvsActualETA" (Original vs Actual ETA, container-wise and MBL-wise). Each type has specific date columns, calculation types, and `getColumnsByCategory` configurations, generating complex SQL queries with date difference calculations and percentage reporting.
    *   **Timestamp: 1/5/2026, 2:45:27 PM & 1/5/2026, 3:11:08 PM**: Implemented `companyList` from `CompanyName` using comma splitting, trimming, lowercasing, and joining for use in SQL `IN` clause, replacing `LOWER(account_name) = ANY (...)`.
    *   **Timestamp: 1/6/2026, 10:32:55 AM**: The `companyList` generation logic was modified to split `CompanyName` by `"||"` instead of `","`.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-backend-v2\src\common\util\general.query.ts`**
    *   **Timestamp: 1/2/2026, 5:03:05 PM**: The `generalQueryBuilder` function was updated to handle "TotalShipments" and "TotalShipmentsMblWise" reports. It counts distinct `fileno` and `mblno`/`voyage` respectively. Queries include date range filtering and account name filtering using `regexp_split_to_array`. The results are processed to calculate percentages relative to a maximum value.
    *   **Timestamp: 1/5/2026, 1:56:51 PM & 1/5/2026, 1:58:41 PM & 1/5/2026, 2:13:45 PM & 1/5/2026, 2:16:07 PM & 1/5/2026, 2:17:37 PM & 1/5/2026, 2:18:01 PM & 1/5/2026, 2:18:07 PM & 1/5/2026, 3:13:21 PM**: Introduction of `companyList` construction for dynamically generating SQL `IN` clauses for `LOWER(account_name)`. This replaces the `regexp_split_to_array` approach.
    *   **Timestamp: 1/6/2026, 10:33:28 AM**: The `companyList` generation logic was modified to split `CompanyName` by `"||"` instead of `","`.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-backend-v2\src\common\util\container.query.ts`**
    *   **Timestamp: 1/2/2026, 5:03:44 PM**: This file defines `containerQueryBuilder` for generating queries related to container lifecycle events. It handles reports like "ContainerDischargevsContainerAvailable", "ContainerDischargeVsFinalDeliveryDate", "ContainerGateOutVsGateIn", and "ContainerOrVesselDischargeVsGateOut". Each report type sets specific `customizer` properties, including date columns, calculation types (`avg`), and uses `getColumnsByCategory` to define required columns. Complex SQL queries calculate time differences (e.g., `EXTRACT(DAY FROM date1 - date2)`) and percentages.
    *   **Timestamp: 1/5/2026, 2:42:51 PM**: Introduced `companyList` generation from `CompanyName` using comma splitting, trimming, lowercasing, and joining for use in SQL's `IN` clause, replacing `LOWER(account_name) = ANY (...)`.
    *   **Timestamp: 1/6/2026, 10:32:49 AM**: The `companyList` generation logic was modified to split `CompanyName` by `"||"` instead of `","`.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-backend-v2\src\common\util\booking.query.ts`**
    *   **Timestamp: 1/2/2026, 5:09:05 PM & 1/2/2026, 5:09:30 PM & 1/2/2026, 5:11:03 PM & 1/2/2026, 5:46:22 PM & 1/2/2026, 5:47:08 PM**: This file defines `bookingQueryBuilder` for generating queries related to booking analytics. It supports multiple report types including "BookingDatetoActualDeparture" (container and MBL-wise, as well as stacked bar versions). These queries involve joining `mtr_tracking_data` and `agent_booking_entry` tables to calculate time differences between booking dates and actual departure dates, then computing percentages. `customizer` properties like `dateRange`, `calType`, `dateColumns`, `booking`, `mblwise`, and `chartType` are dynamically set.
    *   **Timestamp: 1/5/2026, 2:11:12 PM & 1/5/2026, 2:35:38 PM & 1/5/2026, 2:36:53 PM & 1/5/2026, 3:15:46 PM & 1/5/2026, 3:16:18 PM & 1/5/2026, 3:18:06 PM & 1/5/2026, 3:33:22 PM & 1/5/2026, 8:36:00 PM**: Introduction of `companyList` construction for dynamically generating SQL `IN` clauses for `LOWER(account_name)`. This replaces the `regexp_split_to_array` approach. A `console.log` for "company90877" is present in most of these logs.
    *   **Timestamp: 1/6/2026, 10:27:27 AM**: The `companyList` generation logic was modified to split `CompanyName` by `"||"` instead of `","`.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-backend-v2\src\services\analytics\customerAutosearchOptions.ts`**
    *   **Timestamp: 1/5/2026, 10:14:20 AM - 1/5/2026, 12:43:34 PM (multiple logs)**: This file `getAllCustomerOptions` handles fetching customer and agent options for autosearch.
        *   Initially, it retrieves distinct `cname` for `AGENT` role and distinct `account_name` for `CUSTOMER` role, with pagination and search capabilities being progressively commented out and re-implemented.
        *   Between **10:14:20 AM** and **11:27:01 AM**, the `CUSTOMER` role query was commented out and then re-enabled, transitioning from `COUNT(DISTINCT account_name)` to `COUNT(*) FROM (SELECT 1 FROM ... GROUP BY account_name)` for total count, and using `GROUP BY account_name` for data fetching.
        *   At **11:32:39 AM**, the `CUSTOMER` role query changed to use `Account_Master_Customer_MAP` to fetch `customer_name` and an aggregated `customer_map` array for search.
        *   At **11:35:07 AM & 11:35:15 AM**, the `CUSTOMER` role logic was again commented out, then an alternative query using `PO_AccountMaster_Customer_Master` and `unnest(customer_map)` was implemented to search both `cname` and `mapped` customers.
        *   At **11:59:52 AM**, this `PO_AccountMaster_Customer_Master` query was refined to select `cname AS main_customer` and `COALESCE(customer_map, '{}') AS mapped_customers`, with client-side logic to flatten and deduplicate the results (main customer + mapped customers).
        *   At **12:10:43 PM**, the `PO_AccountMaster_Customer_Master` query was further modified to separate `cname` and `customer_map` columns explicitly for mapping, and a parsing logic for `{A,B}` string arrays was added.
        *   At **12:13:07 PM**, the `PO_AccountMaster_Customer_Master` query was changed to use `UNION` to search both `cname` directly and within the `customer_map` array, ensuring results include both primary and mapped names.
        *   At **12:15:06 PM & 12:21:35 PM & 12:23:52 PM**, the `CUSTOMER` role logic was reverted to the `Account_Master_Customer_MAP` table query, using `ARRAY[cname] || COALESCE(ARRAY(SELECT DISTINCT mapped ...)) AS customer_array` to combine the main customer name with its mapped names, and a mapping function to format the output.
        *   At **12:42:32 PM & 12:43:34 PM**: The `CUSTOMER` role query reverted to the `mtr_tracking_data` table, querying `account_name` with `DISTINCT` and pagination, commenting out the complex `Account_Master_Customer_MAP` logic again.
    *   **Timestamp: 1/5/2026, 5:24:26 PM & 1/5/2026, 5:30:33 PM**: The `CUSTOMER` role logic was updated to use the `PO_AccountMaster_Customer_Master` table, creating an array (`customer_array`) containing the main customer name and its distinct mapped customer names, ordered by `cname`. It includes handling for `customer_array` being a string or an array in the mapping logic. The previous `mtr_tracking_data` logic for CUSTOMER was commented out.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-backend-v2\src\common\util\chasis.query.ts`**
    *   **Timestamp: 1/5/2026, 2:38:19 PM & 1/5/2026, 2:38:29 PM & 1/5/2026, 2:39:36 PM**: Introduced `companyList` generation from `CompanyName` using comma splitting, trimming, lowercasing, and joining for use in SQL's `IN` clause, replacing `LOWER(account_name) = ANY (...)`. Added `console.log` with `company90877@@`.
    *   **Timestamp: 1/6/2026, 10:32:32 AM & 1/6/2026, 10:32:38 AM**: The `companyList` generation logic was modified to split `CompanyName` by `"||"` instead of `","`.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-backend-v2\src\common\util\export.query.ts`**
    *   **Timestamp: 1/5/2026, 3:20:59 PM - 1/5/2026, 4:24:15 PM (multiple logs)**: Modified multiple SQL queries within the `bookingQuery` function to use `LOWER(account_name) IN (${companyList})` instead of `LOWER(account_name) = '${CompanyName}'`. This applies to various "Booking Date" reports (Actual/Estimated Departure, POD Arrival, and Stacked Bar variations).
    *   **Timestamp: 1/6/2026, 10:33:04 AM & 1/6/2026, 10:33:16 AM**: The `companyList` generation logic was modified to split `CompanyName` by `"||"` instead of `","`.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-backend-v2\src\services\analytics\cbmService.ts`**
    *   **Timestamp: 1/5/2026, 8:38:09 PM**: Introduced `companyList` generation from `CompanyName` using comma splitting, trimming, lowercasing, and joining for use in SQL's `IN` clause, replacing `LOWER(mtd.account_name) = ANY (...)`. Also, adjusted the `mblwiseCondition`'s `select` and `condition` properties to explicitly reference `mblno` with a table alias (`mtd.mblno`).
    *   **Timestamp: 1/6/2026, 10:33:48 AM**: The `companyList` generation logic was modified to split `CompanyName` by `"||"` instead of `","`.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-backend-v2\src\services\analytics\containerService.ts`**
    *   **Timestamp: 1/5/2026, 8:38:59 PM**: Introduced `companyList` generation from `CompanyName` using comma splitting, trimming, lowercasing, and joining for use in SQL's `IN` clause, replacing `LOWER(account_name) = ANY (...)`.
    *   **Timestamp: 1/6/2026, 10:33:57 AM**: The `companyList` generation logic was modified to split `CompanyName` by `"||"` instead of `","`.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-backend-v2\src\services\analytics\kgsService.ts`**
    *   **Timestamp: 1/5/2026, 8:40:08 PM**: Introduced `companyList` generation from `CompanyName` using comma splitting, trimming, lowercasing, and joining for use in SQL's `IN` clause, replacing `LOWER(mtd.account_name) = ANY (...)`. Also, adjusted the `mblwiseCondition`'s `select`, `condition`, and `groupBy` properties to explicitly reference `mblno` with a table alias (`mtd.mblno`).
    *   **Timestamp: 1/6/2026, 10:34:04 AM**: The `companyList` generation logic was modified to split `CompanyName` by `"||"` instead of `","`.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-backend-v2\src\services\shipmentService.ts`**
    *   **Timestamp: 1/6/2026, 10:59:39 AM**: In the `SqlQueryBuilder` class, the `buildFilterConditions` method for `CompanyName` in `oceanFilters` and `airFilters` was modified. It now handles `CompanyName` as a potentially comma-separated string, converting it into a `companyList` for an `IN` clause, replacing the single value comparison.
    *   **Timestamp: 1/6/2026, 11:00:59 AM & 1/6/2026, 11:03:31 AM & 1/6/2026, 11:03:49 AM & 1/6/2026, 11:07:01 AM & 1/6/2026, 11:07:22 AM & 1/6/2026, 1:28:48 PM**: The company list generation in `buildFilterConditions` was updated to split `CompanyName` by `"||"` and apply `REGEXP_REPLACE` to remove commas from `account_name` in the database before comparison. This specifically targets the `LOWER(REGEXP_REPLACE(TRIM(mtr.account_name), '[,]', '', 'g')) IN ($$)` and `LOWER(TRIM(air.customer_name)) = $$` conditions.

### Patterns and Recurring Elements:

1.  **Transition to Multi-Company Filtering**: A significant and recurring pattern is the change in how `CompanyName` is handled in SQL queries across multiple utility and service files.
    *   Initially, many queries used `LOWER(account_name) = ANY (regexp_split_to_array(LOWER('${CompanyName}'), '\\s*,\\s*'))` or `LOWER(account_name) = '${CompanyName}'`.
    *   This was consistently replaced with a pattern of constructing a `companyList` array: `CompanyName.split(",").map(v => `'${v.trim().toLowerCase()}'`).join(",")` and then using `LOWER(account_name) IN (${companyList})`.
    *   **Latest Change (1/6/2026)**: A further refinement was introduced where `CompanyName` is split by `"||"` instead of `","`. This suggests a change in the expected delimiter for multiple company names. In some cases, `REGEXP_REPLACE(TRIM(mtr.account_name), '[,]', '', 'g')` was added to handle commas within the stored company names in the database for ocean shipments in `shipmentService.ts`.
2.  **Date Range Filtering**: All query builders (`transit`, `departure`, `general`, `container`, `booking`) consistently apply date range filters using `departure_date BETWEEN '${fromDate}'::timestamp AND '${toDate}'::timestamp + INTERVAL '1 day'`.
3.  **Dynamic Column Selection**: Most query builders use `getColumnsByCategory` to dynamically select columns for reporting, often ignoring common fields like `bookingdate`, `est_cargo_ready_date`, `country_name`, `networkdays`, `bl_release_date`, and requiring specific `must` columns relevant to the report type.
4.  **Customizer Object Usage**: A `customizer` object is universally used to store and pass configuration details for how data should be presented (e.g., `chartType`, `calType`, `dateColumns`, `calColumnConfig`, `selectedColumns`).
5.  **Percentage Calculation**: Reports often calculate a `percentage` by dividing a `value` by a `max_total` (or `max_value`) and rounding to two decimal places.
6.  **`DISTINCT ON` Clause**: Many queries, particularly in `container.query.ts` and `departure.query.ts`, use `DISTINCT ON (voyage, contno, CASE WHEN t49_cont_type IS NOT NULL ... ELSE cont_type END)` to ensure uniqueness at a container or voyage level, often considering container type variations.
7.  **Null/Empty Date Handling**: There's a repetitive pattern of checking for `IS NOT NULL` and `!= '0001-01-01 00:00:00 BC'` for date columns in SQL queries to filter out invalid or unset dates.
8.  **Error Handling**: All service and utility functions include basic error handling with `try...catch` blocks and logging errors using `logger.error`, returning a 500 status code on failure.