# Activity Summary for 1/5/2026

## 1:43:10 PM
Changes occurred across two files within a `javascript-learning` directory.

**File: `c:\Users\ridap\OneDrive\Documents\javascript-learning\index.html`**
*   **Initial setup (1/4/2026, 3:18:32 PM):** An basic HTML document was created, including a `<h1>Hello world!</h1>` and an empty `<button>` element with an `onclick` event that displays "welcome to my js tutorials".
*   **Minor UI refinement (1/4/2026, 3:18:41 PM):** The previously empty `<button>` element was given the visible text "Click me".

**File: `c:\Users\ridap\OneDrive\Documents\javascript-learning\0_variables.js`**
*   **Initial JavaScript code (1/4/2026, 3:36:06 PM):** A `console.log` statement was added with the text "Hello my first js code!". It initially contained a syntax error (semicolon inside the string).
*   **Syntax correction (1/4/2026, 3:36:47 PM):** The syntax error in the `console.log` statement was fixed by moving the semicolon outside the string.
*   **Introduction of variables (1/4/2026, 3:38:49 PM):** A comment `// camel` was added, and a `var` variable `myAge` was declared with a value of 25, followed by its `console.log`.
*   **Comment refinement (1/4/2026, 3:38:57 PM):** The comment was slightly expanded from `// camel` to `// camel case`.
*   **Variable naming examples (1/4/2026, 3:45:07 PM):** The file was significantly updated to include more examples of variable declarations using `var`, such as `my_firtsName`, `_lastName`, and `$myAge`, all followed by `console.log`. Additionally, examples of *invalid* variable names (`123data`, `my@email`) were included, also with `console.log` statements.
*   **Commenting out invalid code (1/4/2026, 3:45:32 PM):** The lines demonstrating invalid variable declarations (`123data`, `my@email`) and their `console.log` calls were commented out, likely to prevent errors or indicate they are illustrative examples of what *not* to do.
*   **No functional change (1/4/2026, 3:45:41 PM):** The last entry for this file shows no change in content from the previous timestamp.

**Patterns and Recurring Elements:**
*   **Educational Context:** The file names (`javascript-learning`, `0_variables.js`) and the content (basic HTML elements, `onclick` alerts, `console.log`, variable declarations, variable naming conventions) strongly suggest these changes are part of a learning or tutorial process for JavaScript.
*   **Incremental Development:** Changes progress from basic setup to introducing core concepts, fixing syntax errors, and demonstrating valid/invalid practices.
*   **Focus on Fundamentals:** The JavaScript file specifically delves into variable declaration and naming conventions, indicating a focus on foundational JS concepts.

## 1:43:26 PM
The provided code changes primarily focus on refining and expanding the query generation logic for various analytics reports and enhancing the customer autosearch functionality.

### File-Specific Updates:

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-backend-v2\src\common\util\transit.query.ts`** (Timestamp: 1/2/2026, 4:59:40 PM):
    *   Introduced a new `transitQueryI` interface for better type safety in query parameters.
    *   Expanded `transitQueryBuilder` to handle `country_of_origin` as a `columnName` with specific `getColumnsByCategory` and `calColumnConfig` settings. This path also performs multiple sub-queries for `estimated`, `actual`, and `estimated_actual` transit times and stores them in `customizer.additionalData`.
    *   Added two new `type` conditions: `"ScheduledTransitVsActualTransit"` and `"ScheduledTransitVsActualTransitMblWise"`. Both generate complex `WITH` clause SQL queries to calculate the difference between actual and scheduled transit times, grouped by `fileno` and `contno` (or `mblno` for `MblWise`), and calculate percentages relative to the maximum value.
    *   The `else` block (default) now specifically handles `port_pair` reports, fetching `estimated`, `actual`, and `estimated_actual` data similarly to `country_of_origin`.
    *   The `queryGenerator` function was updated to support `country_of_origin` reports, including `mblwiseCondition` for dynamic `SELECT` and `GROUP BY` clauses, and a new `WHERE` clause `AND foo.value >= -60`. A `CASE` statement was added to `percentage` calculation to handle `max_value.max_total = 0` and negative `t.value`.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-backend-v2\src\services\analytics\teuService.ts`** (Timestamp: 1/2/2026, 5:00:42 PM and 1/2/2026, 5:00:53 PM):
    *   Refined the `getTEUReports` function.
    *   Added `mblwiseCondition` object to dynamically modify `SELECT`, `CONDITION`, and `GROUP BY` clauses in SQL queries.
    *   Improved the logic for handling `country_of_origin` or `country_of_discharge` as `columnName`, specifically joining with `portmaster` and calculating `total_volume` based on `t49_cont_type` or `cont_type`.
    *   The general `else` block for other `columnName` values now includes a `CASE` statement to map 'LONG BEACH' to 'LOS ANGELES' for 'pod' or 'place_of_delivery' columns and to replace `NULL` or empty strings with 'OTHERS'.
    *   The SQL queries use `LOWER(account_name) = ANY ( regexp_split_to_array(LOWER('${CompanyName}'), '\s*,\s*') )` for multi-company filtering, replacing the previous single-company `account_name = '${CompanyName}'`.
    *   The repeated timestamp indicates no functional change between these two commits, likely a minor save or formatting change.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-backend-v2\src\common\util\departure.query.ts`** (Timestamp: 1/2/2026, 5:01:49 PM):
    *   Expanded `departureQueryBuilder` to support new report types.
    *   **`BLReleaseKPI`**: Implemented for stacked bar charts, calculating `day_diff` between "Vessel Actual Departure Date" and "Batch Run Date", categorizing into "Equal/Less than 3 days" and "More than 3 days". Uses `DISTINCT ON` for `voyage`, `contno`, and container type to avoid duplicate entries.
    *   **`DelayedPOLDepartures`**: Calculates `day_diff` between "Live Actual Departed Date" and "Departure Date" per `fileno` and `contno`, filtering for positive delays and values within a reasonable range (>= -60 days).
    *   **`DelayedPOLDeparturesMblWise`**: Similar to `DelayedPOLDepartures` but aggregates by `fileno` and `mblno`.
    *   **`OriginalETAvsActualETA`**: Calculates `day_diff` between "Updated ETA Port Date" and "ETA POD" per `fileno` and `contno`. Includes handling for division by zero and negative `value` in percentage calculation.
    *   **`OriginalETAvsActualETAMblWise`**: Declared but the code block is truncated. It likely mirrors `OriginalETAvsActualETA` but aggregates by `fileno` and `mblno`.
    *   All new queries incorporate `DISTINCT ON (m.voyage,m.contno, CASE WHEN m.t49_cont_type IS NOT NULL AND TRIM(m.t49_cont_type) <> '' AND TRIM(m.t49_cont_type) != '0' THEN m.t49_cont_type ELSE m.cont_type END )` to handle unique container tracking records.
    *   Date checks (`is not null` and `!= '0001-01-01 00:00:00 BC'`) are consistently applied.
    *   Company filtering uses `LOWER(account_name) = ANY ( regexp_split_to_array(LOWER('${CompanyName}'), '\s*,\s*') )`.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-backend-v2\src\common\util\general.query.ts`** (Timestamp: 1/2/2026, 5:03:05 PM):
    *   Updated `generalQueryBuilder` for "Total Shipments" and "Total Shipments Mbl Wise".
    *   Both now consistently use `LOWER(account_name) = ANY ( regexp_split_to_array(LOWER('${CompanyName}'), '\s*,\s*') )` for `CompanyName` filtering.
    *   The `TotalShipments` query counts `fileno` and `voyage` (aliased as "Container Count").
    *   The `TotalShipmentsMblWise` query counts `fileno` and `mblno` (aliased as "Mbl Count").
    *   Both reports now process query results to calculate `percentage` based on the maximum value found.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-backend-v2\src\common\util\container.query.ts`** (Timestamp: 1/2/2026, 5:03:44 PM):
    *   Expanded `containerQueryBuilder` with new report types, all using `LOWER(account_name) = ANY ( regexp_split_to_array(LOWER('${CompanyName}'), '\s*,\s*') )` for filtering.
    *   **`ContainerDischargevsContainerAvailable`**: Calculates `day_diff` between `available_date` (prioritizing `t49_cont_available_date`) and `cont_discharge_date`.
    *   **`ContainerDischargeVsFinalDeliveryDate`**: Calculates `day_diff` between `delivery_customer_date` and `cont_discharge_date`, specifically for `type_of_move` in ('FDC','FDN').
    *   **`ContainerGateOutVsGateIn`**: Calculates `day_diff` between `final_empty_return_date` (prioritizing `t49_empty_return_date`) and `final_contno_out_gated` (prioritizing `t49_contno_out_gated`), adding 1 day to the difference.
    *   **`ContainerOrVesselDischargeVsGateOut`**: Calculates `day_diff` between `final_contno_out_gated` (prioritizing `t49_contno_out_gated`) and `cont_discharge_date`.
    *   All these queries also apply `DISTINCT ON` for unique container tracking, similar to `departure.query.ts`, and filter out invalid date values. Percentage calculations include safeguards for division by zero and negative values.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-backend-v2\src\common\util\booking.query.ts`** (Timestamps: 1/2/2026, 5:09:05 PM, 5:09:30 PM, 5:11:03 PM, 5:46:22 PM, 5:47:08 PM):
    *   Introduced new report types to `bookingQueryBuilder`.
    *   **`BookingDatetoActualDeparture`**: Calculates average `day_diff` between "Live Actual Departed Date" (`t49_vessel_actualdeparted_date`) and "Booking Date" per `fileno` and `contno`. Joins `mtr_tracking_data` with `agent_booking_entry` on `mblno`.
    *   **`BookingDatetoActualDepartureMblWise`**: Similar to the above, but aggregates by `fileno` and `mblno`.
    *   **`BookingDatetoActualDepartureStackedBar`**: Implements a stacked bar chart view, categorizing `day_diff` (Booking Date to Actual Departure) into "Less than 1 week", "1 - 2 weeks", "2 - 3 weeks", "3 - 5 weeks", and "Above 5 weeks".
    *   **`BookingDatetoActualDepartureMblWiseStackedBar`**: Similar stacked bar chart, but aggregated by `mblno`.
    *   All these booking queries consistently use `LOWER(account_name) = ANY ( regexp_split_to_array(LOWER('${CompanyName}'), '\s*,\s*') )` for company filtering, join `mtr_tracking_data` with `agent_booking_entry`, and filter for valid non-null dates.
    *   The repeated timestamps (5:09:05 PM to 5:47:08 PM) indicate no functional change across these entries for this file, suggesting minor saves or reformatting.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-backend-v2\src\services\analytics\customerAutosearchOptions.ts`** (Timestamps: 1/5/2026, 10:14:20 AM to 1/5/2026, 12:43:34 PM):
    *   This file undergoes significant refactoring for customer search functionality.
    *   **Initial change (10:14:20 AM)**: The previous commented-out logic for `CUSTOMER` role that used `mtr_tracking_data` is replaced. A new approach uses `Account_Master_Customer_MAP` to find `customer_name` and `customer_map` (an array of mapped customers). It uses `array_cat` and `array_agg` to combine the main customer name and its mapped aliases for search results.
    *   **Intermediate changes (10:38:03 AM, 11:27:01 AM)**: No functional changes, likely minor saves.
    *   **Shift in logic (11:32:39 AM, 11:35:07 AM, 11:35:15 AM, 11:37:50 AM, 11:38:56 AM)**: The `CUSTOMER` role search logic is commented out and replaced with an attempt to use `PO_AccountMaster_Customer_Master`. This new query tries to find `cname` or any `unnest(customer_map)` entry that matches the search term. The client-side post-processing attempts to flatten these into unique `label`/`value` pairs.
    *   **Refinement of `PO_AccountMaster_Customer_Master` query (11:59:52 AM, 12:10:43 PM, 12:13:07 PM)**: The SQL query for `CUSTOMER` role using `PO_AccountMaster_Customer_Master` is further modified to select `cname` as `main_customer` and `customer_map` as `mapped_customers`. The client-side logic is expanded to handle `customer_map` being an array or a PostgreSQL array string (e.g., `"{A,B}"`), extract individual customers, and then consolidate them into unique `label:value` pairs. The queries attempt to `UNION` results where the main customer matches OR a mapped customer matches.
    *   **Reversion (12:42:32 PM, 12:43:34 PM)**: The `CUSTOMER` role search logic reverts to an earlier implementation that queries `mtr_tracking_data` for `account_name` (with pagination support) and the original `Account_Master_Customer_MAP` search logic. The complex `PO_AccountMaster_Customer_Master` logic is commented out again. This suggests a re-evaluation or temporary rollback of the `PO_AccountMaster_Customer_Master` based search.

### Patterns and Recurring Elements:

*   **Date Filtering**: All analytical queries consistently filter data by `departure_date` within a `fromDate` and `toDate` range using `'${fromDate}'::timestamp` and `'${toDate}'::timestamp + INTERVAL '1 day'`.
*   **Invalid Date Handling**: There's a strong pattern of explicitly checking for `IS NOT NULL` and `!= '0001-01-01 00:00:00 BC'` for relevant date columns (e.g., `t49_vessel_actualdeparted_date`, `bookingdate`, `eta_pod`, `batch_run_date`, etc.) to ensure data quality in calculations.
*   **Company Filtering**: All queries use a robust method for filtering by `CompanyName`: `LOWER(account_name) = ANY ( regexp_split_to_array(LOWER('${CompanyName}'), '\s*,\s*') )`. This allows for searching by multiple company names if provided as a comma-separated string.
*   **`DISTINCT ON` Clause**: Many queries, especially in `transit.query.ts`, `departure.query.ts`, and `container.query.ts`, utilize `DISTINCT ON (voyage, contno, CASE WHEN t49_cont_type IS NOT NULL AND TRIM(t49_cont_type) <> '' AND TRIM(t49_cont_type) != '0' THEN t49_cont_type ELSE cont_type END )` to ensure uniqueness per container tracking record, preventing duplicate calculations for the same container within a voyage or based on container type.
*   **Customizer Object**: A `customizer` object is universally used across query builders to configure chart types, calculation types (`avg`, `total`), date columns, and `selectedColumns` for UI rendering and data processing. `getColumnsByCategory` is frequently called to populate `selectedColumns` based on ignored and required columns.
*   **Percentage Calculation**: Many report types calculate a `percentage` based on a value relative to the `MAX(ABS(value))` or `MAX(value)` within the result set. There are also safeguards against division by zero and negative values in percentage calculations.
*   **`mblwiseCondition`**: This object is used to dynamically adjust `SELECT`, `WHERE`, and `GROUP BY` clauses for queries that need to differentiate between container-level (`contno`) and master bill of lading-level (`mblno`) aggregation.
*   **Autosearch Query Evolution**: The `customerAutosearchOptions.ts` file shows a clear evolution of the customer search logic, moving from simple `DISTINCT` queries on `mtr_tracking_data` or `agent_po_account_master` to more complex scenarios involving `Account_Master_Customer_MAP` and `PO_AccountMaster_Customer_Master` to include mapped customer names in search results, often involving PostgreSQL array functions like `unnest` and `array_cat`. The frequent commenting and re-implementing of logic suggest an iterative development process or difficulty in finding the optimal query for mapped customer search.

## 1:43:32 PM
**`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-backend\src\controllers\analytics\query\booking.query.ts`**
- **Timestamp**: 1/2/2026, 2:35:49 PM
- This file defines `bookingQueryBuilder`, an asynchronous function that constructs SQL queries for booking analytics based on various input parameters like `type`, `customizer`, `CompanyName`, `fromDate`, `toDate`, `displayBy`, `user_id`, and `reportName`.
- It dynamically configures `customizer` properties (`selectedColumns`, `dateRange`, `calType`, `dateColumns`, `booking`, `mblwise`, `calColumnConfig`, `chartType`) based on the `type` of booking query requested.
- Four main query types are handled: `BookingDatetoActualDeparture`, `BookingDatetoActualDepartureMblWise`, `BookingDatetoActualDepartureStackedBar`, and `BookingDatetoActualDepartureMblWiseStackedBar`.
- Queries involve calculating the average day difference between `t49_vessel_actualdeparted_date` and `bookingdate` from `mtr_tracking_data` and `agent_booking_entry` tables.
- Stacked bar chart queries (`BookingDatetoActualDepartureStackedBar`, `BookingDatetoActualDepartureMblWiseStackedBar`) categorize day differences into time ranges (e.g., 'Less than 1 week', '1 - 2 weeks') and aggregate counts.
- The `getColumnsByCategory` and `getFilterQueryByDisplayValue` utility functions are used to assist in query construction.

**`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-backend\src\controllers\getCustomerOptions.ts`**
- **Timestamp Changes**:
    - **1/2/2026, 3:58:49 PM**: Initial implementation of `getAllCustomerOptions` and `deleteCustomerOption`. `getAllCustomerOptions` fetches distinct customer names from `mtr_tracking_data` with search functionality and a limit of 10. `deleteCustomerOption` was initially designed to delete based on `account_name` from `mtr_tracking_data`.
    - **1/2/2026, 4:17:54 PM**: The `deleteCustomerOption` function was modified to delete by `customer_id` from `mtr_tracking_data`, taking the `customer_id` from `req.params`. The validation was updated to check for `customer_id` instead of `account_name`.
    - **1/2/2026, 4:22:36 PM**: No significant functional change, but `deleteCustomerOption` SQL was updated to `WHERE id = $1` instead of `WHERE customer_id = $1`, implying `id` is the correct column name for `customer_id`.
    - **1/2/2026, 4:28:41 PM, 4:28:50 PM, 4:29:40 PM**: Minor logging additions (`console.log`) to `deleteCustomerOption` to output `customer_id` and `req.params`, primarily for debugging. No functional changes.
    - **1/2/2026, 4:31:23 PM**: The `deleteCustomerOption` SQL query was changed to `DELETE FROM Account_Master_Customer_MAP WHERE id = $1`, indicating that the deletion target for customer options shifted from `mtr_tracking_data` to `Account_Master_Customer_MAP`.
- This file manages API endpoints for fetching and deleting customer options.
- `getAllCustomerOptions` retrieves a distinct list of trimmed `account_name` from `mtr_tracking_data`, allowing for optional search queries and limiting results to 10.
- `deleteCustomerOption` deletes a customer record from `Account_Master_Customer_MAP` based on `customer_id` provided in the request parameters. It includes validation to ensure `customer_id` is present.

**`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-backend\src\routes\getCustomerOptionsRoute.ts`**
- **Timestamp Changes**:
    - **1/2/2026, 3:59:33 PM**: Defines routes for `/` (GET, `getAllCustomerOptions`) and `/` (DELETE, `deleteCustomerOption`).
    - **1/2/2026, 3:59:43 PM**: The DELETE route was updated from `/` to `/delete`, providing a more specific endpoint for customer deletion.
    - **1/2/2026, 4:18:20 PM**: The DELETE route was further refined to `/delete/:customer_id`, changing it to accept `customer_id` as a URL parameter, aligning with the controller changes.
    - **1/2/2026, 4:28:07 PM**: No functional change, simply re-saving the same code.
- This file defines the API routes for customer options.
- It exposes a GET endpoint (`/`) to retrieve all customer options and a DELETE endpoint (`/delete/:customer_id`) to delete a specific customer option by its ID.

**`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-backend\src\controllers\code.controller.ts`**
- **Timestamp Changes**:
    - **1/2/2026, 4:12:38 PM**: Introduces `getAllCustomer` and `createCustomer` functions.
        - `getAllCustomer`: Fetches customer details (pagination, searching, sorting) from `PO_AccountMaster_Customer_Master`, `account_master_shipper_MAP`, `document_upload_details`, and `Account_Master_Customer_MAP`. It includes `customer_map` in the `customerMapData` for `customer_mapping` field.
        - `createCustomer`: Handles creation/modification of customer data, including transactional logic. It checks for existing customers, generates new account codes if necessary, inserts/updates `PO_AccountMaster_Customer_Master`, `agent_po_account_master_type`, and `Account_Master_Shipper_MAP`. `customer_mapping` is handled as a simple string value in the `INSERT` query.
    - **1/2/2026, 4:14:13 PM**: Minor change in `getAllCustomer` - added `customer_id` to the `customerMapData` object fetched from `Account_Master_Customer_MAP`.
    - **1/5/2026, 10:23:34 AM**: The `getAllCustomer` function was updated to include `customer_map` in the main `dataQuery` from `PO_AccountMaster_Customer_Master`. In `createCustomer`, the `insertCustomerQuery` was modified to include `customer_map` as a field and `customer_mapping` as a direct value (unparsed) in the `insertCustomerValues` array.
    - **1/5/2026, 10:47:37 AM**: No functional changes, identical to the previous timestamp.
    - **1/5/2026, 11:06:52 AM**: Adds a `console.log` for `customer_mapping` in `createCustomer` for debugging purposes. No functional changes to the logic.
    - **1/5/2026, 11:15:27 AM**: `createCustomer` introduces `customerArray = JSON.parse(customer_mapping || '[]')` for `customer_mapping`, indicating an attempt to parse it as a JSON array. However, `customerArray` is then passed directly as the 23rd value in `insertCustomerValues`, suggesting it's intended to be stored as a string or array type directly in the database, potentially leading to errors if the column isn't `JSONB` or text.
    - **1/5/2026, 11:17:44 AM**: A new utility function `parseCustomerMapping` is introduced in `createCustomer` to robustly handle the `customer_mapping` input, allowing for both single string JSON or an array of string JSONs, parsing it into a string array. The `customerArray` variable is now assigned the result of this new parsing function.
    - **1/5/2026, 11:18:45 AM**: No functional changes, identical to the previous timestamp.
    - **1/5/2026, 11:21:00 AM**: The `parseCustomerMapping` function was significantly refined to handle cases where `customer_mapping` might be an array of values (due to duplicate keys in form data), ensuring that only a valid JSON array string is parsed. It also now handles `null` or non-string inputs gracefully.
    - **1/5/2026, 11:22:13 AM**: The `customerArray` in `createCustomer` is now explicitly parsed from `req.body.customer_mapping` instead of `customer_mapping` directly, ensuring it uses the raw request body value.
    - **1/5/2026, 12:41:04 PM**: `getAllCustomer` query now explicitly selects `customer_map` from `PO_AccountMaster_Customer_Master`. Otherwise, the changes are largely identical to the previous timestamp.
- This file contains customer-related controller logic.
- `getAllCustomer`: Retrieves a paginated and sortable list of customer master data, including associated shipper mappings, document uploads, and customer mappings. It supports searching by various columns.
- `createCustomer`: Handles the creation or modification of customer records. It uses a database transaction, generates unique codes, sanitizes customer names, processes file uploads, and inserts data into multiple related tables (`PO_AccountMaster_Customer_Master`, `agent_po_account_master_type`, `Account_Master_Shipper_MAP`). It includes complex logic for parsing `customer_mapping` data, which is an array of strings.

**Patterns and Recurring Elements:**
- **Database Interaction**: All files extensively interact with a PostgreSQL database using a `query` function. SQL queries are frequently constructed using template literals and parameterized values (`$1`, `$2`, etc.) for security.
- **Timestamp Increments**: Changes occurred primarily on 1/2/2026 and 1/5/2026. Within these days, multiple minor iterations were committed to specific files, suggesting active development, debugging, and refinement.
- **Error Handling**: `try-catch` blocks are consistently used for database operations and file uploads, returning 500 status codes for internal server errors.
- **Customer Data Management**: A significant focus across `getCustomerOptions.ts` and `code.controller.ts` is on fetching, creating, and deleting customer-related data, including various mapping tables (`Account_Master_Customer_MAP`, `Account_Master_Shipper_MAP`).
- **Data Transformation/Sanitization**: `chkStr` utility function is frequently used to convert potentially null or undefined values to empty strings. `cname` undergoes sanitization (`replace(/\s+/g, ' ').replace(/'/g, '`')`).
- **Debugging Logs**: `console.log` and `logger.info` statements are interspersed throughout the code, indicating a practice of logging request details and data for debugging.
- **`customer_mapping` Field**: This field shows a clear evolution, initially treated as a simple value, then attempted as a direct JSON parse, and finally getting a dedicated, robust parsing utility function (`parseCustomerMapping`) to handle diverse input formats. This suggests a challenge in how this specific data was being received from the frontend or an external source.
- **Route Refinement**: The DELETE route for customer options (`getCustomerOptionsRoute.ts`) evolved from a generic `/` to a more specific `/delete` and then to `/delete/:customer_id` for better RESTful design and parameter handling.

## 1:43:37 PM
The provided code change log details a series of updates across a React frontend application, `t360-frontend`, focusing on route management, booking confirmation, customer form handling, and API endpoint definitions.

### File-Specific Updates:

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\App.js`**
    *   **Timestamp: 1/2/2026, 2:26:45 PM and 1/2/2026, 2:26:51 PM**
        *   These two entries are almost identical, indicating a minor or no functional change between them, possibly just a re-save.
        *   The primary content is a comprehensive list of React component imports for various pages (e.g., `CodeScreen`, `LoginScreen`, `UserManagementScreen`, `PackingListScreen`, `ServiceInvoiceScreen`, `DashboardScreen`, `BookingPlanBoardScreen`, `SPRPlanBoardScreen`, `AnalyticsScreen`, `ISFDashboardScreen`, `FCLScreen`, `LCLScreen`, `AirTrackingScreen`, `ReportSchedulerScreen`, `CityMaster`, `PortmasterScreen`, `CngBookingScreen`, `ShipmentsScreen`).
        *   It defines the application's routing structure using `react-router-dom`'s `Routes` and `Route` components.
        *   Extensive `ProtectedRoute` wrappers are used, enforcing `UserRoleEnum` based access control for most routes (e.g., `ADMIN`, `CUSTOMER`, `AGENT`, `CSF`, `FRONTOFFICE`, `BACKOFFICE`, `SPR_CUSTOMER`, `ADMIN_V2`).
        *   Key routes include `/login`, `/logout`, `/callback`, `/register_user`, `/app` (which contains nested routes for various features like `shipment_tracking`, `booking`, `isf_dashboard`, `analytics`, `admin_master`, `spr`, `settings`, `code`, `planboard`, `detention`, `commercial_invoice`, `agent_po`, `cng_invoice`, `alc`, `shipping_orders`, `container_report`, `report`, `pdf_parser`, `alc_dashboard`, `tracking`, `dashboard_7501`, `shipments`, `cng-booking`, `city-master`, `portmaster`, `air-tracking`).
        *   Several booking-related forms and dashboards have "Extend" suffixes (`BookingDashbaordScreenExtend`, `AgentBookingFormScreenExtend`, `AgentPoFormExtend`, `CngBookingScreenExtend`), suggesting a refactoring or enhancement of these features.
        *   A `console.log("ðŸš€ ~ file: App.js:2 ~ TEST on Flow");` is present.

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\pages\booking\AgentBookingConfirmation.jsx`**
    *   **Timestamp: 1/2/2026, 2:59:06 PM**
        *   This file defines the `AgentBookingConfirmation` component, responsible for handling booking confirmations.
        *   It utilizes `Formik` for form management and `Yup` (via `bookingConfirmationValidation`) for validation.
        *   State management includes `useState` for file selection, selected/deselected packing lists (`selectedPl`, `deselectedPl`), pagination, sort model, and alert configurations.
        *   Redux Toolkit Query mutations (`useCreateBookingXmlMutation`, `useUploadBookingXmlMutation`, `useUpdateDoMutation`) and queries (`useFetchBookingPlListQuery`, `useGetBookingConfirmQuery`) are used for API interactions (creating/uploading XML, fetching PLs, updating DO).
        *   The component handles responsive page sizing based on screen breakpoints.
        *   A `useEffect` hook initializes `selectedPl` based on `confirmData` from the API.
        *   The `onSubmit` logic handles saving booking data, including file uploads (`FormData`), generating and uploading XML, and displaying toast notifications for success, error, and warnings.
        *   It includes components like `AppDatePickerExtend`, `SingleFileDropzone`, `ThemedGrid`, `KeywordSearchForLinkedPo`, `PopupAlert`, `WarningToast`, `ThemedModalExtend`, `AddVesselForm`, `ScacCodeForm`, and `UploadFile`.

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\components\screen\code\customer\CustomerForm.jsx`**
    *   **Timestamps: 1/2/2026, 3:46:26 PM, 1/2/2026, 3:48:00 PM, 1/2/2026, 3:48:14 PM, 1/2/2026, 3:54:30 PM, 1/5/2026, 10:24:58 AM, 1/5/2026, 10:44:05 AM, 1/5/2026, 10:45:28 AM, 1/5/2026, 11:13:26 AM**
        *   These entries show continuous development and refinement of the `CustomerForm` component.
        *   **Key features:** Uses `Formik` for form handling, `CustomerValidationSchema` for validation, `useAddCustomerMutation` for API calls, and `useNavigate` for navigation.
        *   Handles various input fields for customer details (IES client code, name, email, contact person, front office person, URL, phone, fax, sales rep, address lines, city, state, postal code, country, status, Descartes customer mapping, ISF party mapping).
        *   `AppAutocomplete` is used for dynamic search/selection of sales reps, Descartes customers, ISF parties, and cities, interacting with `ApiManager` for options.
        *   A `handleCitySelect` function automatically populates state, zipcode, and country based on selected city.
        *   **Changes over time:**
            *   Initial commits (3:46 PM - 3:54 PM) show the form structure and initial setup for handling customer data, including `customer_mapping`.
            *   A `console.log("initialValues123456", initialValues);` was added around 3:54 PM for debugging.
            *   Later changes (1/5/2026) modify how `mapping` and `customer_mapping` data are appended to `FormData` during submission:
                *   Initially, both `mapping` and `customer_mapping` were stringified `values.mapping` and `values.customer_mapping` respectively.
                *   At 10:44:05 AM, `mapping` was changed to `JSON.stringify(customerArray)`, where `customerArray` is derived from `values.customer_mapping` by extracting only the `customer` property and filtering out empty values. This suggests a change in how the `mapping` data structure is expected by the backend or how it's represented internally.
                *   At 10:45:28 AM, this was reverted, and `customer_mapping` was changed to `JSON.stringify(customerArray)`, while `mapping` reverted to `JSON.stringify(values.mapping)`. This indicates a clear distinction between `mapping` and `customer_mapping` payloads, with `customer_mapping` specifically targeting an array of customer names/IDs.

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\components\screen\code\customer\CustomerMapping.jsx`**
    *   **Timestamps: 1/2/2026, 3:47:04 PM, 1/2/2026, 4:03:31 PM, 1/2/2026, 4:04:17 PM, 1/2/2026, 4:09:07 PM, 1/2/2026, 4:21:23 PM, 1/2/2026, 4:21:38 PM, 1/2/2026, 4:34:47 PM, 1/2/2026, 4:35:01 PM, 1/2/2026, 4:35:58 PM, 1/5/2026, 10:42:52 AM**
        *   This component (`CustomerMapping`) manages a dynamic list of customer mappings within a form, allowing users to add/delete rows.
        *   It fetches customer options using `ApiManager.getCustomerOptions` and updates `formik` values.
        *   **Key changes revolve around the `deleteRow` function and error handling:**
            *   Initially (3:47:04 PM), `deleteRow` only updated the `formik` state.
            *   At 4:03:31 PM, logic was added to call `ApiManager.deleteCustomerOption(rowToDelete.customer)` *only if* `rowToDelete.customer` exists, with basic error logging. This indicates an attempt to integrate backend deletion with UI updates.
            *   At 4:04:17 PM, `deleteCustomerOption` was mistakenly called with `search` instead of `accountName` (from `ApiManager.deleteCustomerOptions` with a wrong function name/signature).
            *   At 4:09:07 PM, the API call for deletion was **removed**, reverting to purely client-side state management for deletion. This might suggest issues with the backend endpoint or a decision to handle deletion differently (e.g., as part of the main form submission).
            *   Later changes (4:21:23 PM onwards) reintroduce backend deletion, but now correctly check for `row.customer_id` and call `ApiManager.deleteCustomerOption(row.customer_id)`.
            *   Toast notifications were added for success and failure of the delete operation (4:34:47 PM).
            *   The `toast` import was added at 4:35:01 PM to support the toast notifications.
            *   Small refactor at 4:35:58 PM, moving comments from inside `fetchCustomers` to above it.
            *   The 1/5/2026 entry is identical to the 1/2/2026, 4:35:58 PM entry, possibly a re-save or part of a larger commit that didn't change this specific file further.

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\services\Endpoints.js`**
    *   **Timestamps: 1/2/2026, 4:01:34 PM, 1/2/2026, 4:08:51 PM, 1/2/2026, 4:20:10 PM, 1/2/2026, 4:20:25 PM, 1/2/2026, 4:25:35 PM, 1/2/2026, 4:32:00 PM, 1/2/2026, 4:36:10 PM**
        *   This file defines API endpoints used throughout the application.
        *   **Key changes focus on `DELETE_CUSTOMER_OPTION`:**
            *   Initially (4:01:34 PM), `DELETE_CUSTOMER_OPTION` was defined as `(accountName) => `/deleteCustomerOption?account_name=${encodeURIComponent(accountName)}` (using query parameter).
            *   At 4:08:51 PM, this endpoint definition was removed.
            *   At 4:20:10 PM, `DELETE_CUSTOMER_OPTION` was re-added but mistakenly pointed to `getCustomerOptions` URL: `(search = "") => `/getCustomerOptions${search ? `?search=${encodeURIComponent(search)}` : ""}`. This was an error, essentially trying to delete using a GET endpoint for fetching.
            *   At 4:20:25 PM, it was corrected to a more standard DELETE path: `(customerId) => `/deleteCustomerOption/${customerId}`.
            *   At 4:25:35 PM, it was simplified to `(customerId) => `/delete/${customerId}`.
            *   At 4:32:00 PM, it was changed again to `(customerId) => `/getCustomerOptions/delete/${customerId}`. This suggests a specific nested structure for customer deletion.
            *   The last entry (4:36:10 PM) confirms the endpoint as `(customerId) =>`/getCustomerOptions/delete/${customerId}`.
        *   Other endpoints remain largely stable.

*   **`c:\Users\ridap\OneDrive\Documents\T360_Api\t360-frontend\src\services\ApiManager.js`**
    *   **Timestamps: 1/2/2026, 4:01:42 PM, 1/2/2026, 4:01:51 PM, 1/2/2026, 4:06:54 PM, 1/2/2026, 4:08:09 PM, 1/2/2026, 4:19:58 PM, 1/2/2026, 4:36:34 PM**
        *   This file provides a static class `ApiManager` with methods to interact with the defined API `ENDPOINTS`.
        *   **Key changes revolve around `deleteCustomerOptions`:**
            *   Initially (4:01:42 PM), `ApiManager.getCustomerOptions` was accidentally duplicated, with the second one calling `DELETE_CUSTOMER_OPTION` (which itself was still a GET endpoint).
            *   At 4:01:51 PM, the duplicated `getCustomerOptions` was renamed to `deleteCustomerOptions`.
            *   At 4:06:54 PM, `deleteCustomerOptions` was correctly changed to use `ApiMethods.delete(url)` and accepted `accountName`.
            *   At 4:08:09 PM, `deleteCustomerOptions` was **removed**, aligning with the temporary removal of the delete endpoint from `Endpoints.js`.
            *   At 4:19:58 PM, `deleteCustomerOption` (singular, possibly a renaming) was re-added, taking `customerId` and correctly using `ApiMethods.delete`.
            *   The final entry (4:36:34 PM) maintains the `deleteCustomerOption` function, taking `customerId` and calling the corresponding endpoint using `ApiMethods.delete`.
        *   The rest of the `ApiManager` methods (e.g., `login`, `addUser`, `getUsers`, `getMenu`, various `getOptions`, `addMaster`, `addSCACCode`, `download*PDF`, `download*XML`) remain consistent across these changes.

### Timestamps of Significant Changes:

*   **1/2/2026, 2:26 PM:** General application routing setup and extensive import list in `App.js`.
*   **1/2/2026, 2:59 PM:** `AgentBookingConfirmation.jsx` developed, integrating form validation, state management, Redux Toolkit Query, file uploads, and XML generation/upload logic.
*   **1/2/2026, 3:46 PM - 1/2/2026, 3:54 PM:** Initial development of `CustomerForm.jsx` and `CustomerMapping.jsx`, establishing customer data entry and dynamic mapping capabilities. Debugging `console.log` added.
*   **1/2/2026, 4:01 PM - 1/2/2026, 4:36 PM:** **Intense iteration on customer deletion functionality.** This period saw changes in `Endpoints.js` and `ApiManager.js` to correctly define and implement a DELETE API call for customer mapping, including several attempts to get the URL path and HTTP method right, as well as temporary removals and re-introductions of the deletion logic. Toast notifications were also added for user feedback.
*   **1/5/2026, 10:24 AM - 1/5/2026, 11:13 AM:** Refinements in `CustomerForm.jsx` regarding how `customer_mapping` data is processed for submission to the backend, specifically converting it to an array of customer names/IDs, indicating a specific backend payload requirement.

### Patterns and Recurring Elements:

*   **Consistent Date: All changes occurred on January 2nd, 2026, and January 5th, 2026.** This suggests focused development sprints within these two days.
*   **Frontend Technologies:** The project heavily uses React, `@mui/material` for UI components, `react-router-dom` for routing, `formik` for form management, `react-hot-toast` for notifications, and `redux-toolkit` for state and API management (`use*Mutation`, `use*Query`).
*   **API Management:** A custom `ApiManager` class wraps `ApiMethods` and uses an `ENDPOINTS` object for centralized API endpoint definitions. This pattern promotes maintainability and reusability of API calls.
*   **Form Handling Pattern:** `useFormik` is a recurring pattern for form state, validation (`validationSchema`), and submission logic across `AgentBookingConfirmation.jsx` and `CustomerForm.jsx`.
*   **Dynamic Data Fetching:** `AppAutocomplete` components frequently rely on `ApiManager` methods to fetch dynamic options (e.g., sales reps, cities, customers, ISF parties) as users type.
*   **Customer Mapping Complexity:** The `CustomerMapping.jsx`, `CustomerForm.jsx`, `Endpoints.js`, and `ApiManager.js` files show significant churn around the "customer mapping" feature, particularly regarding the client-side vs. server-side deletion of these mappings and the exact data structure required for submission. This suggests a complex requirement or an evolving understanding of the backend API for this specific feature.
*   **Error Handling and User Feedback:** `toast` notifications and `PopupAlert` components are consistently used for providing feedback on API operations (success, error, warning).
*   **Role-Based Access Control:** `ProtectedRoute` is a fundamental pattern in `App.js`, ensuring that specific routes are only accessible to users with predefined `UserRoleEnum` roles.
*   **Debugging Statements:** The presence of `console.log` statements in multiple files (e.g., `App.js`, `AgentBookingConfirmation.jsx`, `CustomerForm.jsx`, `CustomerMapping.jsx`) indicates active development and debugging during these changes.

## 2:43:10 PM
The development log details changes across two files, primarily focusing on JavaScript learning. All activities took place on January 4, 2026.

**File: `c:\Users\ridap\OneDrive\Documents\javascript-learning\index.html`**
This file, representing a basic HTML document, underwent a minor update.
*   **1/4/2026, 3:18:32 PM:** An initial structure was created, including an `h1` tag displaying "Hello world!" and an empty button configured to show an alert "welcome to my js tutorials" when clicked.
*   **1/4/2026, 3:18:41 PM:** The button was updated to include the visible text "Click me", improving user interaction.

**File: `c:\Users\ridap\OneDrive\Documents\javascript-learning\0_variables.js`**
This JavaScript file shows a progression of learning basic JavaScript syntax and variable declaration.
*   **1/4/2026, 3:36:06 PM:** The file was initialized with a `console.log` statement containing a syntax error (semicolon inside the string literal).
*   **1/4/2026, 3:36:47 PM:** The syntax error in the `console.log` statement was corrected.
*   **1/4/2026, 3:38:49 PM:** A comment `// camel` was added, followed by the declaration and logging of a variable `myAge = 25`.
*   **1/4/2026, 3:38:57 PM:** The comment was refined to `// camel case`.
*   **1/4/2026, 3:45:07 PM:** The file expanded significantly to demonstrate various variable naming conventions, including valid ones like `my_firtsName`, `_lastName`, and `$myAge`, as well as examples of invalid variable names (`123data`, `my@email`) which were also included with their respective `console.log` statements.
*   **1/4/2026, 3:45:32 PM:** The lines containing the invalid variable declarations (`123data` and `my@email`) were commented out, likely to prevent errors during execution while still preserving the examples of incorrect syntax for educational purposes.
*   **1/4/2026, 3:45:41 PM:** No functional changes were made; this appears to be a save operation after the previous update.

**Patterns and Recurring Elements:**
The changes clearly indicate an individual learning JavaScript fundamentals. The `index.html` file serves as a simple host for potential JavaScript interactions, while `0_variables.js` meticulously explores core concepts:
*   Initial setup and correction of basic syntax errors.
*   Introduction of variable declarations.
*   Demonstration of different variable naming conventions (camel case, underscore prefix, dollar sign prefix).
*   Illustrating and then commenting out invalid variable naming examples, suggesting an iterative learning process where concepts are tested and corrected.
The timestamps indicate a focused period of activity on JavaScript basics within a short timeframe.

## 2:43:12 PM
The provided log details changes exclusively within the file `c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\SelectCustomer.tsx`. This file appears to implement a React component named `SelectCustomerPanel` responsible for selecting a customer, storing the selection in local storage, and providing a search feature.

**File-Specific Updates (`src\SelectCustomer.tsx`):**

*   **1/5/2026, 10:34:14 AM**: The most significant update in this log occurs here. The `handleAdd` function was refactored. Previously, it would store `selectedCustomer.value` directly and pass it to the `onSelect` callback. The updated logic now ensures that:
    *   The `selectedCustomer.value` is consistently treated as an array (`values`), even if it was originally a single string.
    *   The `selection` object stored in `localStorage` explicitly saves the `customer.value` as an array.
    *   The `onSelect` callback receives a comma-separated string of these `values`.
    *   A comment `// array stays` was added in the `options.map` loop to indicate the intention of handling `opt.value` as an array internally.

*   **1/5/2026, 10:35:58 AM**: This timestamp indicates minor, cosmetic changes to comments within the `handleAdd` function and the `options.map` loop. For instance, `// âœ… ARRAY STORED` was changed to `//ARRAY STORED`, and `// ðŸ”¥ send comma-separated values to parent / redux` became `// comma-separated values for onSelect callback`. The `// array stays` comment was also slightly rephrased to `// array as a value`. No functional changes were introduced in this commit.

*   **1/5/2026, 2:08:15 PM**: Further refinement of the `handleAdd` function. The `values` array, after being ensured as an array, now undergoes additional processing:
    *   `.filter(Boolean)` is applied to remove any falsy values (e.g., empty strings, null) from the array.
    *   `.map(v => v.trim())` is used to remove leading/trailing whitespace from each string value in the array.
    *   The comment associated with the `onSelect` callback was updated to `// CLEAN STRING` to reflect this cleaning process.

**Patterns and Recurring Elements:**

*   **Consistent `STORAGE_KEY`**: The `STORAGE_KEY` constant (`"selectedCustomer"`) is used uniformly across all changes for managing the selected customer in `localStorage`.
*   **Focus on `handleAdd` Logic**: The `handleAdd` function is the central point of modification across all timestamps, continually being refined to correctly handle and format the `selectedCustomer.value` for both persistent storage and the `onSelect` callback.
*   **Array Handling for Customer Value**: A strong pattern is the consistent effort to ensure `selectedCustomer.value` is treated as an array (even if it's a single item initially) for internal consistency and then converted to a comma-separated string for external communication via `onSelect`. This suggests a requirement to support either single or multiple customer values.
*   **Refinement over Reinvention**: The changes are iterative refinements to existing logic, particularly around data formatting and storage, rather than new feature introductions. This indicates a focus on robustness and correctness for an existing feature.
*   **Timestamp Proximity**: The changes occur within a single day, suggesting active development and immediate iterations to perfect the customer selection and storage logic.