# Activity Summary for 1/23/2026

## 1:44:42 PM
The code change log reveals active development and debugging across analytics-related components and their Redux state management.

**File-Specific Updates:**

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\components\screen\analytics\MetricToolbar.tsx`**
    *   **Timestamp:** Most changes occurred between 1/23/2026, 11:25 AM and 12:06 PM.
    *   This file, responsible for a metric toolbar, underwent numerous small adjustments, often related to debugging.
    *   Initially, temporary text (`kk`, `kkkkk`) was added and removed near `SelectBoxLight` components (1/23/2026, 11:25-11:26 AM).
    *   The "View By" label was temporarily changed to "View By123" and then reverted (1/23/2026, 11:26 AM - 11:44 AM).
    *   `console.log` statements were frequently added and modified to inspect `chartType`, `toolState`, and `toolState?.viewBy` at various points in the component's lifecycle (e.g., 1/23/2026, 11:27 AM, 11:29 AM, 11:31 AM, 11:36 AM, 11:38 AM).
    *   A significant, but quickly reverted, change modified the `onChange` handler for the "View By" selector to use a specific key (`transit_air`) instead of a dynamic index when dispatching the `setViewFilter` action (1/23/2026, 11:52 AM, reverted by 1/23/2026, 11:53 AM).
    *   Later, new `useEffect` hooks were introduced to log the current `index` and `toolState?.viewBy` state for debugging purposes (1/23/2026, 12:02 PM, 12:06 PM).

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\store\fretures\analytics-slice.ts`**
    *   **Timestamp:** Key changes occurred between 1/23/2026, 11:51 AM and 12:05 PM.
    *   The `viewBy` property in the Redux `initialState` was initially an object mapping chart types to their view values (e.g., `{ transit_air: "actual" }`) (1/23/2026, 11:51 AM).
    *   The `setViewFilter` reducer was designed to update this object using a `key`.
    *   Crucially, the `viewBy` state was later refactored from an object to an array (`Array(9).fill("actual")`), and the `setViewFilter` reducer was updated to use an array `index` for updates (1/23/2026, 11:53 AM).
    *   Subsequently, the `setViewFilter` reducer was refined to ensure immutability by creating a new array when updating `viewBy` elements (`state.viewBy = state.viewBy.map(...)`) (1/23/2026, 12:01 PM).
    *   Debugging `console.log` statements were added within the `setViewFilter` reducer to trace its execution and state changes (1/23/2026, 12:05 PM).
    *   Minor stylistic changes (single vs. double quotes) were made and reverted around 11:51 AM.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\components\screen\analytics\metricBox.tsx`**
    *   **Timestamp:** Changes spanned from 1/23/2026, 12:13 PM to 1:40 PM.
    *   The `getChartComponent` function, responsible for rendering different chart types, was modified to include a dynamic `key` for `BarChart` components when `chartType` is `Transit`. This key (`transit-{index}-{mainState?.viewBy?.[index]}-{data.data.length}`) aims to force re-rendering of the chart when relevant state changes (1/23/2026, 12:13 PM).
    *   A temporary bug was introduced where `chartKey` tried to access `mainState?.toolState?.viewBy?.[index]` instead of `mainState?.viewBy?.[index]`, which was then corrected (1/23/2026, 12:16 PM).
    *   An attempt at performance optimization using `useMemo` for `chartData` (to control data slicing based on `enlarge.open`) was introduced and then reverted (1/23/2026, 1:34 PM - 1:35 PM).
    *   There was a brief change to remove `.slice(0, 9)` from chart data (allowing all data to render by default), which was then reverted, restoring the initial data slicing for non-enlarged charts (1/23/2026, 1:39 PM - 1:40 PM).

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\components\screen\analytics\Charts\BarChart.tsx`**
    *   **Timestamp:** Changes occurred between 1/23/2026, 12:20 PM and 1:36 PM.
    *   Initially, the `useEffect` hook's dependencies were adjusted, with `data` being removed and then a refactor attempt added more specific dependencies (1/23/2026, 12:20 PM - 12:22 PM).
    *   A major refactoring attempt (1/23/2026, 1:33 PM) introduced `useMemo` for `categories` and `seriesData` to optimize calculations and refined the `useEffect` dependencies for better reactivity. It also dynamically enabled chart animations and data labels based on data length and added a `key` to `ReactApexChart` for forced re-rendering.
    *   This significant refactoring was then completely reverted (1/23/2026, 1:35 PM), returning to the previous less optimized implementation.
    *   Following the revert, a `console.log("data===pppp",data);` was added inside the `useEffect` (1/23/2026, 1:36 PM), indicating further debugging.

**Patterns and Recurring Elements:**

*   **Debugging:** A prominent pattern is the frequent insertion and removal of `console.log` statements across multiple files (`MetricToolbar.tsx`, `analytics-slice.ts`, `BarChart.tsx`). This suggests developers were actively troubleshooting and inspecting state and data flow.
*   **Redux State Refinement:** The `analytics-slice.ts` shows an ongoing effort to manage the `viewBy` filter, evolving its data structure from an object to an array and addressing immutability concerns in the reducer.
*   **Chart Rendering Logic & Performance:** Both `metricBox.tsx` and `BarChart.tsx` reveal adjustments to how charts are rendered and updated. There was a notable, but ultimately rolled back, attempt to optimize chart rendering using `useMemo` and dynamic keys to prevent unnecessary re-renders. The quick revert indicates potential issues with the implementation or a change in development direction.
*   **Temporary Code/Tests:** The presence of placeholder text and immediate reverts of more substantial changes points to rapid iteration and testing during development.

## 1:44:47 PM
The code changes log highlights development focused on analytics and reporting query builders within a backend application. All modifications occurred on January 23, 2026.

**File: `c:\Users\ridap\OneDrive\Documents\T360-V2\t360-backend-v2\src\common\util\air.query.ts`**
*   **Initial State (1/23/2026, 10:12:43 AM):** This file defines the `airQueryBuilder` function, responsible for generating SQL queries for various air cargo analytics reports. These reports include "TotalShipmentAirWise" (counting distinct AWB numbers), "TotalKgsByLaneAirWise" (summing gross weight by origin-destination lanes), "TotalCbmByLaneAirWise" (summing total CBM by origin-destination lanes), and "AverageTransitByLaneAirWise" (calculating average transit times based on actual, estimated, or a combination of dates). Each report type specifies a comprehensive list of columns to "ignore" and "must" include via `getColumnsByCategory`, indicating a detailed data selection mechanism. Queries consistently filter data by `customer_name` and a `departure_date` range, handling invalid date entries ('0001-01-01 00:00:00 BC') and nulls. The code initially used `console.log` extensively for debugging.
*   **Logging Refinement (1/23/2026, 10:49:23 AM):** Most `console.log` statements were replaced with `logger.info` calls, suggesting an upgrade to a more structured logging system. Some redundant `console.log`s were also removed.
*   **Minor Adjustments (1/23/2026, 11:47:40 AM):** A `console.log` statement displaying the "Analytics type" was entirely removed. A very minor, non-functional formatting change was applied to an SQL string concatenation (`pol ||'-'|| pod` to `pol || '-' || pod`) within the "TotalKgsByLaneAirWise" query.
*   **Recurring Activity:** Multiple subsequent timestamps (10:18:20 AM, 10:39:50 AM, 10:41:26 AM, 10:42:46 AM, 10:43:46 AM, 10:50:12 AM, 10:50:31 AM, 10:52:11 AM, 10:54:26 AM, 11:04:13 AM, 11:06:38 AM, 11:06:48 AM, 11:06:54 AM, 11:07:31 AM, 11:07:58 AM, 11:17:29 AM, 11:42:54 AM, 12:24:15 PM, 12:24:21 PM, 12:24:42 PM, 1:42:35 PM) show no functional changes in the provided code snippets. These are likely save operations or automated formatting runs without substantial code modifications.

**File: `c:\Users\ridap\OneDrive\Documents\T360-V2\t360-backend-v2\src\common\util\export.query.ts`**
*   **Initial State (1/23/2026, 10:13:27 AM):** This file introduces a `getMonthValue` helper function for mapping abbreviated month names to numerical values. The `bookingQuery` function dynamically constructs SQL queries for various booking-related reports. These reports include variations of "Booking Date to Actual Departure," "Booking Date to Estimated Departure," and "Booking Date to POD Arrival." They include "MBL Wise" versions (filtering by master bill of lading number) and "Stacked Bar" versions. The stacked bar queries contain complex conditional logic to categorize transit times into weekly bins ('Less than 1 week', '1 - 2 weeks', etc.) based on `stackedExport`, `displayBy` (month, week, quarter), and `stackedGroup` parameters. Queries join `mtr_tracking_data` and `agent_booking_entry` tables, applying filters for `account_name` and valid date entries.
*   **Recurring Activity (1/23/2026, 10:57:53 AM, 11:00:34 AM):** These timestamps show identical code to the initial entry, indicating no functional changes.

**Patterns and Recurring Elements:**
*   **Single Day Development:** All changes occurred on 1/23/2026, indicating focused development on these utility files.
*   **Dynamic SQL Generation:** Both `air.query.ts` and `export.query.ts` are designed for building dynamic SQL queries based on multiple input parameters, which is central to a flexible reporting system.
*   **Consistent Data Filtering:** Queries across both files consistently filter by `customer_name` or `account_name` and specific date ranges, employing `LOWER()` for case-insensitive matching and explicit checks for `NULL` or '0001-01-01 00:00:00 BC' dates.
*   **Transition to Structured Logging:** The shift from `console.log` to `logger.info` in `air.query.ts` suggests an improvement in the application's logging practices.
*   **Analytics and Reporting Focus:** The reports generated involve common analytical metrics like counts, sums (kgs, cbm), and time differences (transit times), often categorized by lanes or time buckets.
*   **Frequent Saves:** The numerous identical timestamps for `air.query.ts` indicate frequent saving of the file, possibly due to incremental development, testing, or automatic save features in the development environment.

## 2:44:42 PM
The provided log details changes primarily within the backend's analytics and reporting functionalities, specifically concerning SQL query generation. All recorded modifications occurred on January 23, 2026.

**File-Specific Updates:**

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-backend-v2\src\common\util\air.query.ts`**
    *   **Initial State (1/23/2026, 10:12:43 AM):** This file contains the `airQueryBuilder` function responsible for generating PostgreSQL queries for air freight analytics reports. It supports reports like "Total Shipment Air Wise," "Total Kgs By Lane Air Wise," "Total Cbm By Lane Air Wise," and "Average Transit By Lane Air Wise."
        *   Queries dynamically select columns using `getColumnsByCategory` based on an extensive ignore list and specific "must-have" columns (e.g., `departure_date`, `awb_number`).
        *   Initial debugging utilized `console.log` statements throughout the function.
        *   Early versions of "Total Kgs By Lane Air Wise" and "Total Cbm By Lane Air Wise" had a hardcoded `customer_name IN ('sp richards company')` filter.
    *   **Logging Refinement (1/23/2026, 11:42:54 AM onwards):** A significant set of changes involved replacing many `console.log` statements within the `if/else if` blocks (where specific report queries are built and executed) with `logger.info` calls. This indicates a shift towards a more formal logging mechanism, though initial parameter logs outside these blocks remained `console.log`. This change was iteratively applied across multiple timestamps (e.g., 10:49:23 AM to 11:42:54 AM).
    *   **Query Logic Refinements for KGS/CBM by Lane (1/23/2026, 2:27:59 PM - 2:37:38 PM):**
        *   The "Total Cbm By Lane Air Wise" report's `must` columns were updated to include `"awb_number"`. The associated SQL query changed its `base` subquery to select `air.awb_number as shipment` and its `t` subquery's `GROUP BY` clause to include `shipment,pol, pod`.
        *   Similar changes were applied to "Total Kgs By Lane Air Wise," adding `air_shipment` to the `base` subquery and `GROUP BY air_shipment, pol, pod`, and adding a `WHERE` clause check for `air_shipment IS NOT NULL AND air_shipment <> ''`. These changes aimed to refine the grouping for weight/volume calculations by including individual air waybill numbers.
        *   However, these `GROUP BY shipment` additions were then reverted for "Total Kgs By Lane Air Wise" at 2:36:56 PM, and column `awb_number` was removed from the `ignore` list for `TotalKgsByLaneAirWise` and `TotalCbmByLaneAirWise` at 2:37:38 PM, simplifying the grouping back to `pol, pod`.
    *   **Major Refactor of "Total Kgs By Lane Air Wise" (1/23/2026, 2:40:12 PM):** This report's query underwent a significant restructuring. It introduced a nested `awb_totals` subquery to first aggregate `kgs` by individual `awb_number` and `lane` (`pol || '-' || pod`). The final `SELECT` then retrieves `awb_number`, `lane`, total `value` (KGS), and calculates `percentage` based on the maximum total KGS. This indicates a shift from reporting aggregated KGS per lane to detailing KGS per AWB number within each lane.
    *   **Final Logging Consistency (1/23/2026, 2:42:50 PM):** The `console.log` statements that briefly reappeared in the "Total Kgs By Lane Air Wise" block were again replaced with `logger.info`, restoring logging consistency.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-backend-v2\src\common\util\export.query.ts`**
    *   **Initial Implementation (1/23/2026, 10:13:27 AM):** This file defines the `bookingQuery` function, which generates SQL snippets for various booking-related reports. It includes:
        *   A `getMonthValue` helper function to convert month names (e.g., "Jan") to numerical values.
        *   Queries to calculate day differences for events like "Booking Date to Actual Departure" and "Booking Date to POD Arrival."
        *   Specific logic for "Stacked Bar" reports, categorizing transit times into buckets (e.g., 'Less than 1 week', '1 - 2 weeks') and allowing filtering by month, week, or quarter.
        *   It consistently filters data by `LOWER(account_name) IN (${companyList})` and handles invalid date values by excluding `'0001-01-01 00:00:00 BC'`.
    *   **No Subsequent Changes:** No further visible code changes were recorded for this file within the provided log entries after its initial commit.

**Patterns and Recurring Elements:**

*   **SQL Query Generation:** Both files are dedicated to programmatically constructing SQL queries based on various parameters (report type, company name, date ranges).
*   **Dynamic Company Filtering:** A consistent pattern is observed where the `CompanyName` parameter (expected to be a `||`-separated string) is processed into a formatted SQL `IN` clause to filter data by customer.
*   **Robust Date Handling:** Queries frequently include checks for `IS NOT NULL` and `!= '0001-01-01 00:00:00 BC'` to ensure valid date comparisons, and use explicit `::timestamp` casting for date range filters.
*   **Logging Evolution:** There was a clear, consistent effort in `air.query.ts` to migrate from basic `console.log` statements to more structured `logger.info` calls for internal state and query debugging, indicating a move towards a more robust logging infrastructure.
*   **Iterative Refinement:** `air.query.ts` demonstrates an iterative development process, particularly in refining the aggregation and grouping logic for analytics reports, ultimately leading to more specific data presentation (e.g., by AWB number in addition to lanes).
*   **Modularity:** Both files define builder functions (`airQueryBuilder`, `bookingQuery`) that encapsulate the logic for generating specific types of reports, contributing to a modular backend structure for analytics.

## 2:45:06 PM
**File Path: `c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\components\screen\analytics\MetricToolbar.tsx`**

*   **1/23/2026, 11:25:18 AM - 11:44:33 AM:** This period involved extensive debugging and testing within the component. Temporary strings like "kk", "<h2>kkkkk</h2>", and "View By123" were added to select box labels and then mostly removed, indicating UI testing. Multiple `console.log` statements were introduced and modified to inspect `chartType`, `toolState`, and `index`.
*   **1/23/2026, 11:44:48 AM - 11:53:15 AM:** There was an attempt to change how the `viewBy` filter was handled for a "View By" select box. Initially, it was modified to access a specific key (`transit_air`) from an object-like `toolState.viewBy`, but this was quickly reverted to use an array-like index (`toolState?.viewBy[index]`).
*   **1/23/2026, 12:02:08 PM - 12:06:11 PM:** Further debugging efforts were added, including commenting out and re-adding entire `SelectBoxLight` components with verbose `console.log` statements in their `onChange` handlers, and introducing `useEffect` hooks to monitor the `index` and the `viewBy` array's length and state updates.
*   **1/23/2026, 2:06:23 PM - 2:06:52 PM:** A temporary change was made to render an enlarged version of the chart data in the main chart area (instead of the default sliced data), which was immediately reverted.

**File Path: `c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\store\fretures\analytics-slice.ts`**

*   **1/23/2026, 11:51:18 AM - 11:51:32 AM:** Minor formatting changes occurred, toggling between single and double quotes for string literals.
*   **1/23/2026, 11:53:23 AM:** The `initialState` for `viewBy` was fundamentally changed from an object (with specific transit and country keys) to an array initialized with `Array(9).fill("actual")`. Correspondingly, the `setViewFilter` reducer was updated to modify this array by `index`.
*   **1/23/2026, 12:01:46 PM:** The `setViewFilter` reducer was refined to ensure immutability by using the `map` method to update the `viewBy` array.
*   **1/23/2026, 12:05:57 PM:** Debugging `console.log` statements were added to the `setViewFilter` reducer to track its input and output state.

**File Path: `c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\components\screen\analytics\metricBox.tsx`**

*   **1/23/2026, 12:13:06 PM - 12:16:40 PM:** A `chartKey` variable was introduced for `Transit` chart types to assist React in identifying unique components for re-rendering, though its usage and pathing (`mainState?.viewBy?.[index]` vs `mainState?.toolState?.viewBy?.[index]`) saw some inconsistency.
*   **1/23/2026, 1:34:55 PM - 1:52:55 PM:** The component experimented with and ultimately re-implemented a `useMemo` hook to optimize data loading, allowing charts to display a sliced subset of data (first 9 items) by default and the full dataset when "enlarged". This logic was briefly removed at 1:35:19 PM and then restored.
*   **1/23/2026, 1:58:09 PM - 2:03:07 PM:** Several changes related to UI structure, TypeScript typing, and Redux selector paths were introduced and then largely reverted in quick succession. This included temporary removal/re-addition of a `Tooltip` component and explicit type annotations.

**File Path: `c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\components\screen\analytics\Charts\BarChart.tsx`**

*   **1/23/2026, 1:33:06 PM:** A significant refactor was introduced, leveraging `useMemo` for data processing, adding conditional animations and data labels, and using `ApexCharts.exec` for chart resizing. This version also removed specific chart colors and border radius.
*   **1/23/2026, 1:35:26 PM:** This refactor was entirely reverted, returning the component to an earlier state with a less optimized `useEffect` dependency (`[item]`), reintroducing specific chart colors, and removing the force-re-render `key`.
*   **1/23/2026, 1:51:46 PM - 1:52:06 PM:** Another partial refactor occurred, correcting the `useEffect` dependency to `[data]` for better reactivity and re-adding a dynamic `key` to `ReactApexChart` for forced re-rendering.
*   **1/23/2026, 1:58:54 PM - 2:03:36 PM:** This sequence involved back-and-forth changes regarding `plotOptions.bar.borderRadius` (from `0` to `4` and back), `colors` (removed, then re-added `#09090B`), and the presence of a `Tooltip` component around the chart.
*   **1/23/2026, 2:15:36 PM:** A second major refactor was implemented, very similar to the one at 1:33:06 PM, aiming for robust state management and chart updates using `useMemo` and two distinct `useEffect` hooks for data and resizing, and adding an explicit `chartId`. This also removed specific chart colors and the `Tooltip`.
*   **1/23/2026, 2:29:13 PM:** This second major refactor was also completely reverted, returning the component once again to a simpler, less optimized state, reintroducing specific chart colors and the commented-out `Tooltip`.

**Overall Patterns:**

*   **High Iteration and Reversion:** There's a strong pattern of rapid changes, including significant refactoring attempts in `BarChart.tsx` that are frequently reverted. This suggests an iterative development process, possibly involving experimentation, debugging, or a lack of consensus on the optimal solution.
*   **Debugging Focus:** Numerous `console.log` statements are used across `MetricToolbar.tsx` and `analytics-slice.ts`, indicating active debugging of state, component props, and Redux reducer logic.
*   **Redux State Refinement:** The `analytics-slice.ts` shows a clear evolution in how the `viewBy` state is structured and updated, moving from a static object to a dynamic array and adopting immutable update practices.
*   **Chart Rendering Optimization:** `MetricBox.tsx` and `BarChart.tsx` demonstrate efforts to optimize chart rendering, including conditional data slicing and using `useMemo` and React keys for efficient re-renders, although these optimizations were often unstable or reverted.
*   **Timestamp Concentration:** All changes occurred within a single day (January 23, 2026), indicating focused development on the analytics frontend features.

## 3:44:45 PM
The provided log details changes to two core utility files, `air.query.ts` and `export.query.ts`, all occurring on January 23, 2026, indicating active development on analytical query generation.

### File-Specific Updates:

#### `c:\Users\ridap\OneDrive\Documents\T360-V2\t360-backend-v2\src\common\util\air.query.ts`
This file, responsible for constructing air cargo-related analytical queries, underwent numerous modifications throughout the day:

*   **Initial Setup (1/23/2026, 10:12:43 AM)**: The `airQueryBuilder` function was established, supporting reports like "TotalShipmentAirWise" (counting unique AWB numbers), "TotalKgsByLaneAirWise" (summing gross weight by origin-destination lane), "TotalCbmByLaneAirWise" (summing cubic meters by lane), and "AverageTransitByLaneAirWise" (setting up transit time calculations). Each report type involved dynamic SQL generation, filtering by customer name and date range, and a comprehensive list of ignored columns when retrieving analytics categories.
*   **Logging Standardization (1/23/2026, 10:49:23 AM)**: All `console.log` statements used for debugging and status updates were replaced with `logger.info`, indicating a move towards a more structured logging approach across the application.
*   **KGS Query Refinement (1/23/2026, 1:42:35 PM to 2:36:56 PM)**:
    *   An initial attempt was made to group "TotalKgsByLaneAirWise" calculations by individual `awb_number` (aliased as `shipment` or `air_shipment`) in addition to origin-destination lanes, with corresponding `GROUP BY` clause updates.
    *   This change was partially reverted, keeping an `air_shipment IS NOT NULL AND air_shipment <> ''` filter but removing `air_shipment` from the `GROUP BY` clause, which might suggest an interim state or a reconsideration of the grouping granularity.
*   **CBM Query Refinement (1/23/2026, 2:27:59 PM)**: Similar to the KGS updates, `awb_number` was added to the required columns (`must` list) for `getColumnsByCategory`, and the SQL query for "TotalCbmByLaneAirWise" was updated to include `air.awb_number as shipment` in the `base` CTE and `GROUP BY shipment` in the `t` CTE.
*   **Temporary KGS Query Restructuring (1/23/2026, 2:40:12 PM)**: A significant, albeit brief, refactoring of the "TotalKgsByLaneAirWise" SQL query occurred. It introduced a nested CTE (`awb_totals`) to first aggregate KGS by AWB number and lane, then calculate percentages based on these per-AWB totals. This complex logic was almost immediately reverted in the subsequent commit.
*   **Final Query Adjustments (1/23/2026, 2:48:54 PM to 2:51:01 PM)**: Minor cleanups were performed, including removing a duplicated `customer_name` filter in the KGS query and adding more explicit `NULL` and empty string checks for `awb_number` and `customer_name` in both KGS and CBM queries, as well as adding `awb_number IS NOT NULL` to the CBM query's `WHERE` clause.

#### `c:\Users\ridap\OneDrive\Documents\T360-V2\t360-backend-v2\src\common\util\export.query.ts`
This file, handling export-related query generation, received its primary set of changes early in the day and remained stable thereafter.

*   **Initial Functionality (1/23/2026, 10:13:27 AM)**: The `bookingQuery` function was introduced, designed to build SQL queries for various booking and departure reports (e.g., "Booking Date to Actual Departure", "Booking Date to POD Arrival"). It included a `getMonthValue` helper for date parsing. Queries consistently join tracking data with booking entries, filter by account name, and perform robust date validation. Special provisions for "Stacked Bar" reports allowed data aggregation and filtering by month, week, or quarter, and categorized time differences into predefined ranges like 'Less than 1 week' or '1 - 2 weeks'.
*   **Stability**: No further functional changes were observed in this file after its initial implementation.

### Timestamps of Significant Changes:

*   **1/23/2026, 10:12:43 AM**: Initial implementation of `air.query.ts`
*   **1/23/2026, 10:13:27 AM**: Initial implementation of `export.query.ts`
*   **1/23/2026, 10:49:23 AM**: Logging refactoring in `air.query.ts` (from `console.log` to `logger.info`).
*   **1/23/2026, 1:42:35 PM**: First attempt to modify KGS grouping in `air.query.ts` to include `awb_number`.
*   **1/23/2026, 2:27:59 PM**: CBM query modified in `air.query.ts` to include `awb_number` in grouping logic.
*   **1/23/2026, 2:28:51 PM**: KGS query further modified with alias change and new `IS NOT NULL` condition.
*   **1/23/2026, 2:36:56 PM**: Partial reversion of KGS grouping logic in `air.query.ts`.
*   **1/23/2026, 2:37:38 PM**: Adjustment of `ignore`/`must` columns for `awb_number` in `air.query.ts`.
*   **1/23/2026, 2:40:12 PM**: Major but temporary SQL query refactoring for KGS in `air.query.ts`.
*   **1/23/2026, 2:46:08 PM**: Reversion of the KGS query refactoring in `air.query.ts`.
*   **1/23/2026, 2:48:54 PM**: Correction of duplicated WHERE clause condition in KGS query in `air.query.ts`.
*   **1/23/2026, 2:49:11 PM**: Final adjustments to WHERE clauses in KGS and CBM queries in `air.query.ts`.

### Patterns and Recurring Elements:

*   **Customer-Centric Filtering**: Both files consistently filter data based on `customer_name` or `account_name`, converting input company names into a formatted SQL list.
*   **Date Range Queries**: All analytical queries in both files are constrained by `fromDate` and `toDate` parameters, often including an `INTERVAL '1 day'` adjustment for inclusive date ranges and checks against invalid date `0001-01-01 00:00:00 BC`.
*   **Dynamic Column Selection**: The `getColumnsByCategory` utility is frequently called within `air.query.ts` to customize the columns considered for analytics, using extensive `ignore` lists and specific `must` columns for each report type.
*   **SQL Query String Concatenation**: SQL queries are constructed dynamically using template literals, embedding user-provided or computed variables directly into the query strings.
*   **Error Handling**: Basic validation for required input (`type` in `airQueryBuilder`) is present, throwing errors if conditions are not met.
*   **Result Processing**: After querying the database, results are consistently processed to extract `entity`, `value`, and `percentage` for display in analytics.
*   **Frequent Iteration**: The high number of log entries for `air.query.ts` with identical or very minor changes suggests a rapid iteration or auto-saving during development, especially for the SQL query logic and column management.