# Activity Summary for 1/21/2026

## 1:30:58 PM
In `c:\Users\ridap\OneDrive\Documents\T360-V2\t360-backend-v2\src\common\util\booking.query.ts`:
- **Timestamp: 1/19/2026, 6:44:58 PM and 1/19/2026, 7:29:32 PM**
- This file defines the `bookingQueryBuilder` function, which generates SQL queries for various booking-related analytics reports.
- It includes several interfaces (`CalColumn`, `CalColumnConfig`, `Customizer`, `QueryBuilderI`) to define the structure of configuration and query parameters.
- The function supports different `type` parameters for generating queries, including:
    - `"BookingDatetoActualDeparture"`: Calculates average day difference between booking date and actual departure.
    - `"BookingDatetoActualDepartureMblWise"`: Similar to the above, but grouped by MBL (Master Bill of Lading) number.
    - `"BookingDatetoActualDepartureStackedBar"`: Generates data for a stacked bar chart, categorizing day differences into 'Less than 1 week', '1 - 2 weeks', etc., grouped by `displayBy` (e.g., month, week).
    - `"BookingDatetoActualDepartureMblWiseStackedBar"`: Similar to the stacked bar chart, but MBL wise.
- **Key Logic**: All queries join `mtr_tracking_data` and `agent_booking_entry` tables on `mblno`. They filter by `account_name` (derived from `CompanyName`), `departure_date` range, and ensure non-null/non-default date values.
- **Pattern**: Repeated use of `customizer` object to configure report display properties (e.g., `dateRange`, `calType`, `dateColumns`, `booking`, `mblwise`, `chartType`).
- **Pattern**: Queries frequently calculate day differences between various date columns (e.g., `t49_vessel_actualdeparted_date - bookingdate`).
- **Pattern**: The code snippets for 6:44:58 PM and 7:29:32 PM appear identical, suggesting no functional change was committed between these two timestamps, perhaps a save operation without modification or an incomplete log.

In `c:\Users\ridap\OneDrive\Documents\T360-V2\t360-backend-v2\src\services\analytics\cbmService.ts`:
- **Timestamp: 1/20/2026, 5:28:09 PM and 1/20/2026, 5:28:35 PM**
- This file contains the `getCBMReports` asynchronous function for fetching CBM (Cubic Meter) related analytics reports.
- It retrieves `columnName`, `fromDate`, `toDate`, and `mblwise` from request queries. If dates are missing, it applies a `defaultDateRange`.
- It dynamically constructs SQL queries based on the `columnName` (e.g., `country_of_origin`, `country_of_discharge`, or other columns).
- It determines `mblwiseCondition` to group data by `mblno` or by `voyage`, `contno`, and `t49_cont_type`.
- **Key Logic**: When `columnName` is 'country_of_origin' or 'country_of_discharge', it joins `mtr_tracking_data` with `portmaster` to get `country_name` and sums `cbm` values, calculating percentages against the max value.
- For other `columnName` values, it queries `mtr_tracking_data` directly, aggregates `cbm` by the specified `columnName`, and calculates percentages.
- It uses `getColumnsByCategory` to set `customizer.selectedColumns`, ignoring many date/status/charge-related columns and `must`-including `cbm` and `departure_date`.
- **Pattern**: Both logs for this file appear identical, suggesting no functional change was committed between these timestamps. The `console.log(mainQuery,"test==========");` line was present in the 5:28:35 PM timestamp but not fully in the 5:28:09 PM snippet. This indicates a minor debug `console.log` addition.
- **Pattern**: Extensive list of columns to ignore when fetching selected columns, indicating a focused set of data for CBM reports.

In `c:\Users\ridap\OneDrive\Documents\T360-V2\t360-backend-v2\src\common\util\export.query.ts`:
- **Timestamp: 1/21/2026, 11:16:16 AM, 1/21/2026, 11:22:42 AM, and 1/21/2026, 1:01:30 PM**
- This file defines the `bookingQuery` function which returns SQL query fragments based on `reportName` for export purposes.
- It includes a `getMonthValue` helper function to convert month names (e.g., 'Jan') or numeric months into integer values.
- **Key Logic**: The `query` object maps report names (e.g., "Booking Date to Actual Departure", "Booking Date to Actual Departure (Stacked Bar)") to specific SQL WHERE clause conditions and `EXTRACT(DAY FROM ...)` calculations.
- For "Stacked Bar" reports, it dynamically adds filtering conditions based on `displayBy` (month, week, quarter) and `stackedGroup` (e.g., 'Less than 1 week').
- All queries join `mtr_tracking_data` and `agent_booking_entry` and filter by `account_name` and non-null/non-default date values.
- **New Condition**: For "Booking Date to POD Arrival (Stacked Bar)", a new filter `AND m.t49_vessel_actualdeparted_date IS NOT NULL` was introduced across all three timestamps. This suggests this addition was made prior to the earliest logged timestamp for this file.
- **Pattern**: Consistent handling of `CompanyName` by splitting and lowercasing for SQL `IN` clause.
- **Pattern**: All three logs for this file appear identical, suggesting no functional change was committed between these timestamps, perhaps a series of saves without modification.

In `c:\Users\ridap\OneDrive\Documents\T360-V2\t360-backend-v2\src\models\User.ts`:
- **Timestamp: 1/21/2026, 1:02:38 PM**
- This file defines the `UserType` interface and `UserRole` enum.
- The `UserType` interface includes `CompanyName`, `usercode`, `firstname`, `lastname`, `role`, `userid`, `emailid`, `companyname`, and an optional `location`.
- The `UserRole` enum lists various roles: `ADMIN`, `AGENT`, `BACKOFFICE`, `CUSTOMER`, `FRONTOFFICE`, `SALES`, `ADMIN_V2`.
- It uses `jet-validators` for runtime type checking with `parseObject` for `UserType`.
- **Key Changes**: The `CompanyName` property was added to the `UserType` interface. This is a significant addition, suggesting that user objects now explicitly carry information about the company they belong to. `userid` and `emailid` were also added, and `companyname` became explicit.
- The previous comments related to `DEFAULT_USER_VALS` and `IModel` are commented out, suggesting a refactoring or simplification of user object creation/validation.

In `c:\Users\ridap\.dbclient\storage\1747201553765@@127.0.0.1@5432@Rida_Database@public\public.sql`:
- **Timestamp: 1/21/2026, 1:14:04 PM**
- This file contains a log of SQL queries executed, primarily for analytics and database introspection.
- **Key Operations**:
    - `SELECT * FROM dashboards;` and `SELECT * FROM metrics WHERE filter_by = 'Air_Wise';` for database schema exploration.
    - `INSERT INTO metrics ...` to add a new metric "Total Shipments Air Wise" with endpoint `/analytics/Tables/tableData?type=TotalShipmentAirWise`.
    - Various `SELECT` statements for `mtr_tracking_data` and `agent_booking_entry` tables to inspect data for specific companies ('prodoh, llc', 'Prodoh, LLC').
    - Queries for `metrics` table with `name = 'Total Shipments Mbl Wise'` and `batch_data`.
    - Several `WITH t AS (...)` CTE-based queries for calculating average day differences (e.g., `t49_vessel_actualarrived_date - t49_vessel_actualdeparted_date`, `eta_pod - departure_date`) and expressing them as percentages.
    - **Pattern**: Many analytical queries calculate "value" and "percentage" based on aggregated day differences, often applying `DISTINCT ON (m.voyage)` or similar to avoid duplicates within a voyage.
    - **Pattern**: Queries include `WHERE` clauses for `account_name` (e.g., 'twelve inc', 'project footwear', 'sp richards company') and date ranges (e.g., `departure_date >= '2026-01-01'::timestamp`).
    - **Pattern**: Handling for `NULL` and `'0001-01-01 00:00:00 BC'` values in date columns is consistent across many queries.
    - **Pattern**: Queries often filter for `foo.value IS NOT NULL AND foo.value >= -60` and include logic to handle division by zero or negative values in percentage calculation. This suggests robust handling of potential data anomalies.

In `c:\Users\ridap\OneDrive\Documents\T360-V2\t360-backend-v2\src\services\analytics\coreMetricService.ts`:
- **Timestamp: 1/21/2026, 1:16:07 PM**
- This file provides API endpoints for managing dashboard metrics, including `dashboardEndPointList`, `getMetricList`, `saveSequence`, and `saveSize`.
- `dashboardEndPointList`: Fetches a list of dashboard metrics (report name, URL, row/column span) for a specific user and `menuTitle`, sorted by user-defined sequence. It now explicitly casts `menuTitle` to `null` if undefined and validates `user.usercode`.
- `getMetricList`: Retrieves a categorized list of available metrics ("Container_Wise", "MBL_Wise", "Air_Wise") from the `metrics` table.
- **Key Logic**: `getMetricList` now supports `Air_Wise` metrics, adding a new categorization dimension alongside "Container_Wise" and "MBL_Wise".
- **New Feature**: `preload` functionality allows pre-checking metrics if they are part of an existing dashboard, explicitly casting `dashboard_name` to string.
- `saveSequence`: Saves the order of metrics for a given `menu_title` and `user_id`. It handles a special case for a "Default" dashboard if it doesn't exist.
- `saveSize`: Updates the `rowSpan` and `columnSpan` for a specific metric on a dashboard. It includes validation for required fields and handles `null` existing size data gracefully.
- **Pattern**: All functions interact with `dashboards` and `metrics` tables to manage user-specific dashboard configurations.
- **Pattern**: Consistent use of `logger.info` and `logger.error` for logging.
- **Pattern**: Robust error handling with `try-catch` blocks and 500 status responses for internal server errors.

**Overall Patterns and Key Themes**:

1.  **Analytics and Reporting Focus**: The changes heavily revolve around building and managing analytics reports related to shipping logistics, particularly "Booking Date to Actual Departure" and "CBM" metrics.
2.  **Dynamic SQL Query Generation**: A significant portion of the code is dedicated to dynamically constructing SQL queries based on user selections (e.g., report type, date range, company, group-by columns, MBL-wise vs. container-wise).
3.  **Date-Based Calculations**: A recurring theme is the calculation of day differences between various date fields (`bookingdate`, `departure_date`, `eta_pod`, `t49_vessel_actualdeparted_date`, `t49_vessel_actualarrived_date`).
4.  **Company-Specific Data**: All queries consistently filter data based on `account_name` derived from `CompanyName`, indicating a multi-tenant or client-specific data access model.
5.  **Dashboard Customization**: The `coreMetricService.ts` file shows strong patterns for user customization of dashboards, including ordering of metrics (`saveSequence`) and layout (grid spans via `saveSize`).
6.  **"Air_Wise" Analytics**: A new dimension for analytics, "Air_Wise", was introduced, suggesting an expansion of tracking capabilities beyond sea freight.
7.  **Data Validation and Robustness**: Checks for `NULL` values, `'0001-01-01 00:00:00 BC'` (a common sentinel value for invalid dates), and handling of division by zero or negative values in percentage calculations are present, indicating a focus on data quality and query reliability.
8.  **Minor Debugging/Save Operations**: Several consecutive timestamps for the same file showing identical or nearly identical content (e.g., `booking.query.ts` and `export.query.ts`) suggest frequent save operations or minor local changes that didn't alter the core logic, or incomplete log captures. The addition of `console.log(mainQuery,"test==========");` in `cbmService.ts` is a clear example of a temporary debug line.

## 1:31:03 PM
The recent code changes span across several core areas of the `t360-frontend-v2` project, primarily focusing on analytics features and internal state management.

### File-Specific Updates:

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\components\screen\analytics\custom-view\ViewContainer.tsx`**
    *   **1/20/2026, 1:49:22 PM**: This component, responsible for managing custom analytics views, initially supported "Container Wise" and "MBL Wise" tabs for displaying metric options.
    *   **1/21/2026, 12:55:46 PM - 1:18:10 PM**: Throughout these timestamps, the component was updated to include support for an `"airWise"` view. This involved modifying the `selectedTab` state type to include `"airWise"` and updating the `initializeCheckedMetrics` function to iterate over `"airWise"` options in addition to "containerWise" and "mblWise". Conditional rendering logic was also expanded to display a `TreeViewContainer` for the `"airWise"` tab.
    *   **1/21/2026, 1:21:49 PM**: The UI integration was completed by adding `{ label: "AIR Wise", value: "airWise" }` to the `tabData` array, making the new "AIR Wise" tab visible and selectable.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\components\screen\analytics\AnalyticsToolbar.tsx`**
    *   **1/20/2026, 1:50:39 PM**: This component provides the toolbar for analytics dashboards, including date filters, dashboard selection, and PDF export functionality. It initially handled `"_Default_"` for dashboard names.
    *   **1/20/2026, 6:38:27 PM**: A change was introduced to standardize the display of the default dashboard from `"_Default_"` to `"Default"` in the `ChipsTabView` options mapping and the "Manage View" tooltip condition.
    *   **1/20/2026, 6:38:07 PM & 1/21/2026, 1:19:45 PM**: These entries show no functional changes, indicating minor saves or reformatting.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\store\fretures\analytics-slice.ts`**
    *   **1/20/2026, 1:56:23 PM**: The initial state of `selectedDashobard` was `"_Default_"`. The `setDashboard` reducer had logic to handle `"_Default_"` specifically for filtering and setting the selected dashboard.
    *   **1/20/2026, 1:57:02 PM**: The `initialState` for `selectedDashobard` was updated from `"_Default_"` to `"Default"`, beginning the standardization.
    *   **1/20/2026, 6:35:22 PM**: The `setDashboard` reducer's logic for the `insert` type was updated to set `state.selectedDashobard` to `"Default"` when `"_Default_"` was included in the value, further solidifying the "Default" string.
    *   **1/20/2026, 6:36:16 PM - 6:37:08 PM**: A brief revert occurred where `state.selectedDashobard` was set back to `"_Default_"` in the `setDashboard` reducer, followed by entries with no functional changes.
    *   **1/20/2026, 6:39:02 PM**: The `setDashboard` reducer was fully updated to consistently use `"Default"` instead of `"_Default_"`. This change affected both the condition for filtering/inserting the default dashboard and the value assigned to `selectedDashobard`.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\data\options\global.ts`**
    *   **1/20/2026, 6:41:28 PM**: A new constant `AIR_SHIPMENT_STATUS` was added, defining various statuses and their associated colors for air cargo, such as "New", "In Progress", "Booked", "EnRoute", "Landed", "Delivered", and "Untracked".

### Patterns and Recurring Elements:

*   **Standardization of "Default" Dashboard Name**: There's a clear pattern across `AnalyticsToolbar.tsx` and `analytics-slice.ts` to transition the internal and display name of the default dashboard from `"_Default_"` to simply `"Default"`. This ensures consistency in both state management and user interface.
*   **Integration of "Air Wise" Analytics**: Multiple changes in `ViewContainer.tsx` and the addition of `AIR_SHIPMENT_STATUS` in `global.ts` highlight the ongoing development and integration of new "Air Wise" functionalities within the analytics module. This suggests an expansion of the application's capabilities to include air cargo tracking and analysis.
*   **Focused Development Sprints**: The timestamps indicate concentrated efforts on these features, particularly on 1/20/2026 and 1/21/2026, suggesting specific development tasks were addressed within these periods.
*   **Debugging Artifacts**: Frequent `console.log` statements (`console.log("===view,",viewTitle);`, `console.log(selectedTab,"selectedTab=====");`) suggest an active development phase where debugging aids are still present in the code.

## 2:31:10 PM
The code changes primarily focus on the development and integration of an "AIR Wise" analytics view, alongside refactoring the naming convention for the default dashboard.

**File-Specific Updates:**

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\components\screen\analytics\custom-view\ViewContainer.tsx`**
    *   **Timestamp of significant changes:** Initial setup for dashboard view management at **1/20/2026, 1:49:22 PM**. Subsequent changes on **1/21/2026 between 12:55:46 PM and 1:21:49 PM** progressively added support for an "AIR Wise" view.
    *   **Updates:** This file, responsible for creating and managing custom analytics views, underwent significant modifications to introduce an "AIR Wise" tab. Initially, it supported "Container Wise" and "MBL Wise" views. The updates included:
        *   Modifying the `selectedTab` state type to accommodate `"airWise"`.
        *   Introducing new conditional rendering logic to display a `TreeViewContainer` specifically for `viewOptions?.airWise`.
        *   Updating the `initializeCheckedMetrics` function to correctly process metrics for the "airWise" category.
        *   Finally, adding `"AIR Wise"` as an option to the `tabData` array, making it visible in the UI. Minor console logs were also added for debugging.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\components\screen\analytics\AnalyticsToolbar.tsx`**
    *   **Timestamp of significant changes:** Initial structure at **1/20/2026, 1:50:39 PM**. Refinements at **1/20/2026, 6:38:07 PM** and **1/20/2026, 6:38:27 PM**.
    *   **Updates:** This toolbar component, which handles global filters, dashboard selection, and PDF export, saw minor adjustments.
        *   The mapping for dashboard labels in `ChipsTabView` was updated to consistently display `_Default_` as `"Default"`.
        *   The condition for showing the "Manage View" tooltip was simplified, likely to align with the normalized "Default" dashboard naming. A console log was also added on **1/21/2026, 1:19:45 PM**.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\store\fretures\analytics-slice.ts`**
    *   **Timestamp of significant changes:** Initial state definition at **1/20/2026, 1:56:23 PM**. Key changes occurred on **1/20/2026, 1:57:02 PM**, **1/20/2026, 6:35:22 PM**, and **1/20/2026, 6:39:02 PM**.
    *   **Updates:** This Redux slice underwent a refactoring to standardize the naming of the default dashboard.
        *   The `selectedDashobard` in the `initialState` was changed from `"_Default_"` to `"Default"`.
        *   The `setDashboard` reducer's logic for "insert" actions was updated to filter and select `"Default"` instead of `"_Default_"` when handling dashboard lists, ensuring consistent naming throughout the application state. Multiple saves without functional changes indicate frequent commit/save actions during this period.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\data\options\global.ts`**
    *   **Timestamp of significant changes:** Single entry at **1/20/2026, 6:41:28 PM**.
    *   **Updates:** This file defines various global constants including shipment statuses (`SHIPMENT_STATUS`, `AIR_SHIPMENT_STATUS`), booking statuses, team member roles, and filter options. The presence of `AIR_SHIPMENT_STATUS` aligns with the "AIR Wise" feature being implemented in other components, suggesting pre-existing data readiness or parallel development.

**Patterns and Recurring Elements:**

*   **"AIR Wise" Feature Implementation:** There's a clear, progressive implementation of an "AIR Wise" analytics view, starting with state type updates and rendering logic, and culminating in the UI option being made available. This indicates a new feature development cycle.
*   **Default Dashboard Naming Standardization:** A consistent effort to refactor and standardize the "Default" dashboard identifier from `_Default_` to `Default` across Redux state and UI logic.
*   **Frequent Saving/Minor Edits:** The timestamps show several consecutive saves for `analytics-slice.ts` and minor console log additions, suggesting active and iterative development or debugging.
*   **Interconnected Changes:** The changes in `ViewContainer.tsx` (adding "AIR Wise" tab) are supported by the `AIR_SHIPMENT_STATUS` in `global.ts` and the `analytics-slice.ts` and `AnalyticsToolbar.tsx` changes show a consistent effort to refine dashboard handling and display.

## 2:31:17 PM
In `c:\Users\ridap\OneDrive\Documents\T360-V2\t360-backend-v2\src\common\util\booking.query.ts`:
*   **1/19/2026, 6:44:58 PM** and **1/19/2026, 7:29:32 PM**: This file defines the `bookingQueryBuilder` function, responsible for constructing complex SQL queries for various booking-related analytics reports. It sets up `customizer` configurations (e.g., `dateRange`, `calType`, `dateColumns`, `chartType`) and dynamically generates SQL based on the `type` of report requested (e.g., "BookingDatetoActualDeparture", "BookingDatetoActualDepartureMblWise", "BookingDatetoActualDepartureStackedBar"). The SQL queries frequently use Common Table Expressions (CTEs), join `mtr_tracking_data` and `agent_booking_entry` tables, filter by company name and date ranges, and calculate day differences and percentages. The "Stacked Bar" report types categorize day differences into time ranges (e.g., "Less than 1 week", "1 - 2 weeks"). The two timestamps show identical code snippets, suggesting a save without visible changes in this segment.

In `c:\Users\ridap\OneDrive\Documents\T360-V2\t360-backend-v2\src\services\analytics\cbmService.ts`:
*   **1/20/2026, 5:28:09 PM**: The `getCBMReports` function is introduced or significantly updated. It retrieves analytics related to Cubic Meter (CBM) data. It initializes a `customizer` object by ignoring a long list of columns and requiring 'cbm' and 'departure_date'. It dynamically builds SQL queries based on whether the report is grouped by `country_of_origin`/`country_of_discharge` (joining with `portmaster`) or a general column (using `replaceValueInQuery` to handle specific port name replacements). The SQL queries calculate the sum of CBM values and their percentage relative to the maximum, using CTEs for aggregation.
*   **1/20/2026, 5:28:35 PM**: A minor change was made to add a `console.log(mainQuery, "test==========");` statement for debugging purposes.

In `c:\Users\ridap\OneDrive\Documents\T360-V2\t360-backend-v2\src\common\util\export.query.ts`:
*   **1/21/2026, 11:16:16 AM**, **1/21/2026, 11:22:42 AM**, and **1/21/2026, 1:01:30 PM**: This file provides the `bookingQuery` function, which generates SQL query fragments for various booking reports suitable for data export. It includes a `getMonthValue` helper for month name to number conversion. The queries support "Booking Date to Actual Departure", "Booking Date to Estimated Departure", and "Booking Date to POD Arrival" reports, including "Stacked Bar" and "MBL Wise" variations. Conditional logic is present to filter by month, week, or quarter and by day difference categories when `stackedExport` is true. A filter `AND m.t49_vessel_actualdeparted_date IS NOT NULL` was added to the "Booking Date to POD Arrival (Stacked Bar)" query. All three timestamps show identical code snippets, suggesting no functional changes in the visible part.

In `c:\Users\ridap\OneDrive\Documents\T360-V2\t360-backend-v2\src\models\User.ts`:
*   **1/21/2026, 1:02:38 PM**: The `UserType` interface was updated to include a `CompanyName: any;` field and an optional `location?: string;`. The `UserRole` enum gained a new member `ADMIN_V2`. The `parseUser` validation function was also updated to reflect the new `location` field.

In `c:\Users\ridap\.dbclient\storage\1747201553765@@127.0.0.1@5432@Rida_Database@public\public.sql`:
*   **1/21/2026, 1:14:04 PM**: This log contains a series of SQL commands, primarily `SELECT` queries for `dashboards`, `metrics`, `mtr_tracking_data`, and `agent_booking_entry` tables. A notable `INSERT` statement `INSERT INTO metrics (name, end_point,"group",filter_by) VALUES('Total Shipments Air Wise','/analytics/Tables/tableData?type=TotalShipmentAirWise','Air Metrics','Air_Wise');` indicates the addition of a new "Air Wise" metric. Several complex `WITH` queries are present, calculating average date differences and percentages for various `account_name` and date conditions, often involving `portmaster` table joins.

In `c:\Users\ridap\OneDrive\Documents\T360-V2\t360-backend-v2\src\services\analytics\coreMetricService.ts`:
*   **1/21/2026, 1:16:07 PM**: This file manages dashboard metrics. The `getMetricList` function was updated to categorize metrics into `containerWiseGroups`, `mblWiseGroups`, and a newly added `airWiseGroups` based on the `filter_by` property, and the response now includes `airWise` metrics. This change reflects the system's expansion to include air freight analytics. Functions for `dashboardEndPointList`, `saveSequence`, and `saveSize` (for metric display properties) are also defined.

In `c:\Users\ridap\OneDrive\Documents\T360-V2\t360-backend-v2\src\common\constants\Paths.ts`:
*   **1/21/2026, 1:33:09 PM**: New API endpoints were added under the `Analytics.Base` route: `GetCbm: "/cbm"` and `GetKgs: "/kgs"`.

In `c:\Users\ridap\OneDrive\Documents\T360-V2\t360-backend-v2\src\common\util\air.query.ts`:
*   **1/21/2026, 1:33:53 PM**: This is a new file introducing `airQueryBuilder` for "air" related queries. It initially contained SQL queries for "Averagechassisuseddays" and "ChassisPUdateVsFinalDeliveryDate" (and MBL wise variations), configuring `customizer` and `selectedColumns` for these reports. These queries largely interact with `mtr_tracking_data`, calculating day differences between chassis-related dates.
*   **1/21/2026, 2:15:39 PM**: The exported function was temporarily renamed to `airmainQueryBuilder`. A significant new report type, `TotalShipmentAirWise`, was added. This includes a new SQL query specifically for `mtr_air_data` to count distinct `awb_number`s, reflecting a clear move towards dedicated air freight analytics. The `customizer` is set for this `count` type.
*   **1/21/2026, 2:16:49 PM**: The exported function was renamed back to `airQueryBuilder`. For `TotalShipmentAirWise`, `customizer.booking = false;` and `customizer.mblwise = false;` were explicitly added.
*   **1/21/2026, 2:16:57 PM** and **1/21/2026, 2:21:05 PM**: No functional changes compared to the previous timestamp.
*   **1/21/2026, 2:24:32 PM**: A `console.log(mainQuery, "mainQuery0000")` was added for debugging the `TotalShipmentAirWise` query.

In `c:\Users\ridap\OneDrive\Documents\T360-V2\t360-backend-v2\src\services\analytics\tableService.ts`:
*   **1/21/2026, 1:35:42 PM**: The `getTableDataReports` function uses a large `if-else if` structure to dispatch report requests to different query builder utilities (`chassisQueryBuilder`, `bookingQueryBuilder`, `containerQueryBuilder`, `departureQueryBuilder`, `generalQueryBuilder`) based on the `type` parameter.
*   **1/21/2026, 1:38:12 PM**: The `airQueryBuilder` was imported, and a new `else if` block was added to use `airQueryBuilder` for `type === "TotalShipmentsMblWise"`. This was an initial, potentially problematic, attempt as `TotalShipmentsMblWise` was already handled by `generalQueryBuilder`.
*   **1/21/2026, 2:07:22 PM**: The condition in the `else if` block was corrected from `type === "TotalShipmentsMblWise"` to `type === "TotalShipmentAirWise"`, ensuring that the `airQueryBuilder` is correctly called for air freight reports, while other shipment reports remain handled by `generalQueryBuilder`.

**Patterns and Recurring Elements:**
*   **Modularity in Query Generation:** The system uses dedicated query builder files (e.g., `booking.query.ts`, `chassis.query.ts`, `air.query.ts`) for different categories of analytics reports, which are then orchestrated by `tableService.ts`.
*   **Dynamic SQL Construction:** SQL queries are dynamically built based on user parameters like `type`, `CompanyName`, and date ranges, often incorporating complex logic for date differences, percentages, and aggregation.
*   **`customizer` Object for Report Configuration:** A `customizer` object is consistently passed and modified to configure various display and calculation properties for reports.
*   **`getColumnsByCategory` Utility:** This function is widely used across query builders to manage the selection and exclusion of columns, ensuring report-specific data relevance.
*   **Standardized Date Handling in SQL:** Queries frequently include checks for `IS NOT NULL` and `!= '0001-01-01 00:00:00 BC'` for date fields to ensure data quality.
*   **Company-Specific Data Filtering:** Almost all queries incorporate a `LOWER(account_name) IN (${companyList})` clause for multi-company data filtering.
*   **Introduction of Air Freight Analytics:** A significant new pattern is the addition of specific reports, query builders, and metric categorization for "Air Wise" analytics, indicating an expansion of the platform's capabilities to cover air freight data in addition to existing container and booking data.
*   **Debugging Practices:** Frequent use of `console.log` and `logger.info` for monitoring query construction and intermediate results.