# Activity Summary for 1/14/2026

## 2:30:23 PM
The code changes log reveals recent updates focused on frontend functionality, particularly around user authentication, dashboard features, and a new UI component. All modifications occurred on January 14, 2026.

**File-Specific Updates:**

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\services\ApiService.ts` (Timestamp: 1/14/2026, 9:49:53 AM)**
    *   An interception logic was added to the global `window.fetch` mechanism. This logic now detects `401 Unauthorized` responses for requests targeting the application's API base URL. Upon detecting a 401, it logs a message to the console, clears `localStorage`, and redirects the user. The redirection path depends on the `authtype` stored in `localStorage`: "auth0" users are sent to `VITE_UI_V1_BASE_URL`, while others are redirected to `/login`.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\pages\dashboard\dashboard-page.tsx` (Multiple Timestamps)**
    *   **Initial Major Update (1/14/2026, 10:47:02 AM):** This file received extensive updates, significantly enhancing the dashboard page.
        *   **Imports:** Numerous UI components (e.g., `PageWrapper`, `Card`, `AppGrid`, `Calendar`, `Dialog`, `FilterSidebar`), React icons, and utility libraries (`moment`) were imported.
        *   **State Management:** New `useState` hooks were introduced to manage UI elements like calendar date, notification dialog visibility, sidebar state, calendar type (vessel/delivery), dialog content, and selected notifications. A `deliveryMode` state was also added.
        *   **Data Fetching:** The page now uses Redux Toolkit Query (`useFetchShipmentDataQuery`, `useFetchDeliveryDataQuery`, `useFetchCartDataQuery`) to fetch various dashboard data. These queries incorporate complex filtering logic based on user roles (`ADMIN_V2`), selected customers, date ranges, and card filters.
        *   **Calendar Logic:** A `useMemo` hook, `weekData`, was implemented to process delivery and vessel data, preparing it for display in a calendar. This includes a `determineDeliveryMode` function to categorize deliveries (Rail, Door, Port).
        *   **Filter & Pagination Handlers:** Functions like `handlePage`, `handlePageSizeChange`, `handleFilterChange`, `handleClearFilters`, and `handleTransportModeChange` were added to manage the dashboard's interactive data grid and filters. `handleClearFilters` now specifically clears `airstatus` and `transpot_mode` filters.
    *   **Minor Adjustment (1/14/2026, 10:48:27 AM):** The `CompanyName` parameter in the `useFetchCartDataQuery` for non-"ADMIN_V2" users was changed from `localUser?.companyname` to an empty string.
    *   **Cosmetic Change & Revert (1/14/2026, 10:48:39 AM & 1/14/2026, 11:04:54 AM):** A duplicate `console.log` statement was temporarily added and then removed, indicating a small, non-functional change that was quickly reverted.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\components\common\chip-tabs-view.tsx` (Timestamp: 1/14/2026, 11:10:44 AM)**
    *   A new reusable React component, `ChipsTabView`, was created. This component displays a horizontally scrollable row of customizable chip-style tabs, optionally including a "New" button. It handles scrolling with `ChevronLeft` and `ChevronRight` icons and applies conditional styling based on the currently selected tab.

**Patterns and Recurring Elements:**

*   **Focused Development:** All changes occurred on the same day, 1/14/2026, suggesting a concentrated effort on these frontend areas.
*   **Redux/RTK Query Integration:** The dashboard (`dashboard-page.tsx`) heavily leverages Redux for global state management and Redux Toolkit Query for efficient data fetching, demonstrating a consistent architectural pattern.
*   **Component-Driven UI:** The creation of `ChipsTabView` and the extensive use of existing common UI components (e.g., `PageWrapper`, `Card`) in the dashboard indicate a strong component-driven approach to frontend development.
*   **Debugging Practices:** Several `console.log` statements are present across the dashboard code, indicating active debugging during its development.
*   **Comprehensive Filtering:** The dashboard features robust filtering capabilities, including date ranges, card filters, and status filters, with special handling for admin users and different transport modes.
*   **Moment.js for Date Handling:** The `moment` library is consistently used for date and time manipulations, particularly within the calendar display logic.

## 2:30:31 PM
The changes log primarily details development and refactoring within a batch processing system, focusing on a customer master data migration script and its associated configurations.

### File-Specific Updates:

*   **`c:\Users\ridap\Documents\Office\cng-batches\cng-batches\customer_master\customerMaster.js`**
    *   **1/13/2026, 11:26:49 AM - 11:30:03 AM**: The file initially implemented an asynchronous `migrate` method within a `MigrateAccountNames` class. This method fetches distinct `account_name` data from `mtr_tracking_data` and inserts it into `po_accountmaster_customer_master`'s `cname` column, avoiding duplicates based on `cname` and utilizing a transaction (BEGIN/COMMIT/ROLLBACK). It used CommonJS `require` and a custom `logger`.
    *   **1/13/2026, 11:31:49 AM - 11:34:14 AM**: The module system was refactored to use ES Modules (`import`/`export`), and the logger was updated to use named imports (`info`, `error`). The import path for `db.js` was also adjusted.
    *   **1/13/2026, 11:49:49 AM**: Custom logger imports were removed, and logging reverted to direct `console.log` and `console.error`.
    *   **1/13/2026, 11:58:19 AM - 12:09:11 PM**: The core SQL migration logic underwent significant evolution:
        *   Initially, it started inserting `customer_code` into an `acode` column alongside `cname`.
        *   The duplicate checking mechanism (`NOT EXISTS` clause) was refined multiple times, moving from checking `cname` only, to `cname` and `acode`, then to `acode` only.
        *   A more efficient `ON CONFLICT (acode) DO NOTHING;` clause was introduced to handle unique constraint violations for `acode`.
    *   **1/13/2026, 12:37:15 PM**: The target table name in the SQL query was updated to `PO_AccountMaster_Customer_Master` (case change).
    *   **1/13/2026, 2:24:55 PM - 5:15:02 PM**: The duplicate handling logic was further altered. It first reverted to a `NOT EXISTS` clause checking only `cname` and then combined it with `ON CONFLICT (acode) DO NOTHING;`, implying a dual-level uniqueness requirement. Minor adjustments were made to logging the inserted row count.
    *   **1/13/2026, 6:32:33 PM - 6:32:52 PM**: The module system was switched back to CommonJS (`require`/`module.exports`), and the export method was corrected.

*   **`c:\Users\ridap\Documents\Office\cng-batches\cng-batches\scripts\run.customerMaster.js`**
    *   **1/13/2026, 11:30:29 AM**: An initial script was created to execute the `customerMaster.migrate()` function. It included batch start/end logging and execution time tracking. The batch was initially described as "Exception Date Validation Batch Started".
    *   **1/13/2026, 5:15:45 PM**: The import statement for `customerMaster` was updated to `require(...).default` to match the `export default` syntax previously used in `customerMaster.js`. The batch start message was updated to "Customer Master Batch Started".
    *   **1/13/2026, 6:35:19 PM**: The import statement reverted to a direct `require(...)` after `customerMaster.js` switched back to CommonJS `module.exports`.

*   **`c:\Users\ridap\Documents\Office\cng-batches\cng-batches\config\config.js`**
    *   **1/13/2026, 11:32:56 AM**: This configuration file defines settings for development and production environments, including database connection parameters, file system paths for various batch processes (XML, Excel, CSV), API credentials (CNG Integration), email distribution lists for reports and notifications, SFTP connection details, and other application-specific settings like T360 URLs and validation flags.
    *   **1/14/2026, 10:09:10 AM**: Significant expansion of configurations:
        *   Several new email distribution lists were added for specific reports (e.g., `isfNotAcceptedReport`, `co2EmissionEmail`, `shipmentAddedT49Check`, `sprBokingReport`, `bookingStatusReport`).
        *   New top-level configuration objects were introduced for `co2_emission_config`, `t49` (with an authentication token), `geolocation` (with URL and API key), and Lune API settings (`lune_client_account_ids`, `lune_api_key`) for both development and production.
        *   The `anchorSftpConfigJSON` now includes a `passphrase` for SFTP connections.
        *   A minor path update for `cngInvExcel` in the development environment.

### Patterns and Recurring Elements:

*   **Module System Instability**: The `customerMaster.js` file and its corresponding `run.customerMaster.js` script frequently switched between ES Modules (`import`/`export`) and CommonJS (`require`/`module.exports`) syntax. This suggests an ongoing effort to standardize or test module loading.
*   **Evolving SQL Logic**: The SQL query within `customerMaster.js` for inserting and handling duplicate `customer_master` entries underwent continuous refinement throughout the day, indicating active development and tuning of data migration rules, particularly around what constitutes a unique customer record.
*   **Configuration Growth**: The `config.js` file consistently expanded, especially with new email notification categories and new external API integrations (T49, Geolocation, Lune API). This reflects an expanding feature set or reporting requirements for the batch system.
*   **Transactional Integrity**: All database migration operations consistently wrap in `BEGIN`, `COMMIT`, and `ROLLBACK` to ensure data consistency in case of errors.
*   **Batch Automation**: The `run.customerMaster.js` script exemplifies a pattern for running batch jobs, including logging start/end times, execution duration, and graceful exit handling.