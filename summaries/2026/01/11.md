# Activity Summary for 1/11/2026

## 4:34:46 PM
The provided log details changes exclusively within the `c:\Users\ridap\OneDrive\Documents\T360_Api\t360-backend\src\modules\JwtToken.ts` file, which is responsible for creating and verifying JSON Web Tokens (JWTs).

**File-Specific Updates (`JwtToken.ts`):**
The core functionality of this file, including the import of `jsonwebtoken` and `TokenPayload` type, the retrieval of `JWT_SECRET` from environment variables, and the structure of `createToken` and `VerifyToken` functions, remained consistent throughout the logs. Both functions include a critical check to ensure `JWT_SECRET` is defined before proceeding. The `VerifyToken` function, in particular, shows no changes across any of the entries.

The sole area of modification was the `expiresIn` option within the `jwt.sign` method used by the `createToken` function.

**Timestamps of Significant Changes and `expiresIn` Evolution:**

*   **1/9/2026, 12:52:28 PM**: Initial state recorded with `expiresIn: '20s'`.
*   **1/9/2026, 12:56:06 PM**: Changed `expiresIn` to `20` (numeric value).
*   **1/9/2026, 12:56:22 PM**: Further reduced `expiresIn` to `10` (numeric value).
*   **1/9/2026, 1:03:55 PM**: Reverted `expiresIn` back to `'20s'` (string value).
*   **1/9/2026, 1:40:27 PM**: Significantly increased `expiresIn` to `'7d'` (7 days).
*   **1/9/2026, 3:36:25 PM**: Changed `expiresIn` back to `'20s'`.
*   **1/9/2026, 3:40:25 PM**: Changed `expiresIn` back to `'7d'`.

**Patterns and Recurring Elements:**

*   **Consistent JWT Module Structure**: The fundamental design of `JwtToken.ts` for handling token creation and verification, including error handling for an undefined `JWT_SECRET`, remained constant.
*   **`expiresIn` Fluctuation**: There's a clear pattern of frequently adjusting the token expiration time. This repeatedly oscillated between very short durations (e.g., `'20s'`, `20`, `10`) suitable for rapid testing or very short-lived tokens, and a much longer duration (`'7d'`) typically used for session tokens. This suggests active experimentation or refinement of token lifespan settings.
*   **No other functional changes**: Apart from the `expiresIn` parameter, no other part of the `createToken` or `VerifyToken` functions, nor any other line of code in the file, was modified.

## 4:35:13 PM
The code changes primarily revolve around user authentication, token management, and data access functionalities within the `t360-backend-v2` project.

**File-Specific Updates:**

*   **`src\common\util\jwtToken.ts`**: This file, responsible for JWT token creation and verification, saw frequent and iterative changes.
    *   **Timestamp Pattern (e.g., 1/9/2026, 11:03:22 AM to 1:40:42 PM):** The `createToken` function was repeatedly modified to change the token's expiration time (`expiresIn`). Values fluctuated between "20s", "50s", "10s", and a more extended "7d" (7 days), with the "7d" duration appearing to be the last set value.
    *   The structure of the `createToken` function's return value was also toggled. It moved between a simpler version returning just the token `string` and a more complex one returning an object `{ token, exp }` that includes the token and its expiration timestamp. The version returning `{ token, exp }` was the predominant active implementation by the later timestamps.
    *   **1/9/2026, 3:47:26 PM:** `console.log` statements within the `createToken` function were removed, indicating a cleanup of debugging output.

*   **`src\services\UserService.ts`**: This service handles user-related operations like login, preferences, and invitations.
    *   **Timestamp Pattern (e.g., 1/9/2026, 11:07:11 AM to 1:13:01 PM):** The `login` function was repeatedly adjusted to align with the changing return structure of `createToken` in `jwtToken.ts`. It toggled between receiving just the token string and de-structuring `{ token, exp }`, and accordingly, the login response included or excluded the `exp` field within the user data.
    *   **1/9/2026, 11:14:58 AM & 1:13:01 PM:** The `catch` block for `login` was updated to provide more robust error handling, specifically using `error.status || 500`.
    *   **1/9/2026, 11:32:52 AM:** A `console.log` was temporarily added at the start of the `login` function for debugging purposes, then removed by 11:41:05 AM.
    *   Other functions like `saveUserPreferences`, `fetchUserPreferences`, `saveInviteLog`, `fetchAllCompanyUser`, and `userSettings` remained largely stable, consistently using parameterized SQL queries and `logger` for information and error handling. The `logoutUser` function appears to be partially implemented across all logs.

*   **`src\middleware\authMiddleware.ts`**: This middleware is responsible for authenticating requests.
    *   **1/9/2026, 11:26:04 AM:** Introduced a dual authentication mechanism supporting both custom JWT (via `VerifyToken`) and Auth0 (using JWKS). It also includes logic to enrich the `req.user` object with `location` based on `UserRole`. Debugging `console.log` and `logger.error` statements were present within the Auth0 verification callback.
    *   **1/9/2026, 3:47:49 PM:** A `console.log` statement for `Decoded Token` within the Auth0 verification callback was removed, alongside a `console.error` in the main `catch` block, streamlining error reporting to use `next(error);`.

*   **`src\services\globalSearch.ts`**: This file provides a global search functionality.
    *   **1/9/2026, 3:48:13 PM:** The `getGlobalOptions` function was present, implementing a search across `mtr_tracking_data` based on user-specific conditions derived from `buildMtrUserCondition`. A `console.log('User in getGlobalOptions:', user);` was added and persisted in subsequent identical commits.
    *   **Timestamp Pattern (e.g., 1/9/2026, 6:31:48 PM to 6:35:49 PM):** Multiple log entries show no functional changes, indicating repeated saves of the same content.

*   **`src\utils\common.ts`**: This file serves as a utility collection.
    *   **1/9/2026, 3:49:42 PM:** Contains helper functions for building dynamic SQL `WHERE` clauses based on user roles (`buildHBLUserCondition`, `buildMtrUserCondition`), generating unique agent booking codes (`getAgentBookingCode`), sanitizing strings, and various date formatting utilities (`AppDateFormate`, `formatDate`, `timeAgo`). This file was stable with no observed changes within the log period.

**Patterns and Recurring Elements:**

*   **JWT Expiry Fluctuation and Consistency:** The `expiresIn` property for JWT tokens in `jwtToken.ts` was a recurring point of modification, suggesting fine-tuning or testing of session lengths.
*   **Debugging with `console.log`:** `console.log` statements were frequently added and subsequently removed in `jwtToken.ts`, `UserService.ts`, and `authMiddleware.ts`, indicating active debugging cycles.
*   **Robust Logging:** The use of `logger.info` and `logger.error` is consistent across all major service and middleware files, showing a strong emphasis on operational logging.
*   **Database Interaction:** All services (e.g., `UserService.ts`, `globalSearch.ts`) frequently interact with the database using a common `query` utility, with SQL queries often constructed dynamically or using parameterized inputs.
*   **Role-Based Access Logic:** User roles (ADMIN, CUSTOMER, AGENT) are central to constructing dynamic SQL conditions in `common.ts` and `globalSearch.ts`, and for applying specific logic in `authMiddleware.ts` to enrich user objects.
*   **Error Handling Consistency:** The use of `HttpError` and `HttpStatusCodes` for standardized error responses is prevalent across `UserService.ts` and `authMiddleware.ts`.

## 4:35:33 PM
The provided log details a series of code changes primarily focused on frontend components and utility functions. Key updates include:

**File-Specific Updates:**

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\components\core\layout.tsx`**
    *   (Timestamp range: 1/9/2026, 1:34:54 PM - 3:42:53 PM)
    *   The token expiration `useEffect` hook saw frequent modifications, alternating between dynamically calculating `remainingTime` (`exp - now`) and temporarily hardcoding it (e.g., to `10` or `20` seconds), likely for testing purposes.
    *   Several commented-out helper functions (`getTokenExp`, `isTokenExpired`) were removed, and the import for `isTokenExpired` was also removed as it was no longer used in this file.
    *   Minor `console.log` statements were added and removed for debugging token expiration values.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\components\common\dynamicEditable.tsx`**
    *   (Timestamp: 1/9/2026, 2:33:07 PM)
    *   Introduced an `editable` prop (defaulting to `true`) to control the edit mode of the table, affecting cell inputs, add row functionality, and delete buttons.
    *   Added a new column type `text-field` utilizing a `Textarea` component.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\components\screen\planboard\PlanboardCardView.tsx`**
    *   (Timestamp range: 1/9/2026, 2:33:59 PM - 2:34:06 PM)
    *   A minor textual correction was made in the `NoDataAvailable` component, changing "No Data Available@@" to "No Data Available".

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\components\screen\analytics\Charts\BarChart.tsx`**
    *   (Timestamp range: 1/9/2026, 2:35:40 PM - 2:44:45 PM)
    *   The chart title was initially rendered with a "kk" suffix, which was subsequently removed.
    *   Debugging `console.log` statements were added and modified.
    *   Ultimately, the entire `Tooltip` component displaying the `reportName` was commented out, indicating a shift in how chart titles are handled (likely delegated to a parent component).

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\components\screen\analytics\metricBox.tsx`**
    *   (Timestamp range: 1/9/2026, 2:40:42 PM - 3:44:24 PM)
    *   An initial hardcoded `<h1>kkkk</h1>` was removed.
    *   The `Tooltip` for the `item.reportName` was moved into a `chart-wrapper` div, making it the responsibility of `MetricBox` to display the chart title consistently. The title text was also briefly modified with a "kkk" suffix before being reverted.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\components\screen\analytics\Charts\PieChart.tsx`, `LineChart.tsx`, `StackedBarChart.tsx`**
    *   (Timestamp: 1/9/2026, 2:45:20 PM - 2:45:46 PM)
    *   These chart components were introduced, each including a commented-out `Tooltip` for the `reportName`, similar to the `BarChart`'s later removal of its internal title display.
    *   `PieChart` and `LineChart` use a black and gray color palette. `StackedBarChart` specifically uses `#09090B` and `#71717A`.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\components\common\chip-tabs-view.tsx`**
    *   (Timestamp range: 1/9/2026, 2:49:03 PM - 3:03:56 PM)
    *   This component underwent significant and repeated refactoring and reverts concerning its layout, styling (e.g., button appearance, scroll behavior), and handling of left/right scroll chevrons. The changes involved adjustments to `ml-[-6px]`, `mx-auto`, and detailed CSS classes for buttons and containers, indicating an iterative design process for this interactive tab view.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\components\screen\analytics\AnalyticsToolbar.tsx`**
    *   (Timestamp range: 1/9/2026, 3:00:55 PM - 3:43:32 PM)
    *   The `RadioNav` for `operationType` (move/resize) was temporarily removed and then restored.
    *   The custom date range functionality, which utilizes `DateRange` within a `PopoverPanel`, was refined. This included commenting out/reverting the `PopoverPanel` at one point and then wrapping it with `ClickAwayListener` to improve user experience by closing the popover when clicking outside.
    *   Minor styling adjustments were made to the filter dropdown area.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\components\common\popover-pannel.tsx`**
    *   (Timestamp range: 1/9/2026, 3:11:57 PM - 5:04:12 PM)
    *   Experienced multiple rapid changes to its styling, including temporarily removing all CSS properties, converting from MUI `Box` to a plain `div`, and toggling specific CSS properties like `borderRadius` and `padding`.
    *   Final adjustments set `top` to `calc(100% + 4px)`, `zIndex` to `1000`, and added `minWidth`.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\components\screen\analytics\DateRange.tsx`**
    *   (Timestamp range: 1/9/2026, 3:23:25 PM - 3:37:57 PM)
    *   Refinements were made to the `DatePicker` components, including adding `Moment` generic type, explicitly setting picker button icon colors to black (`#000`), and introducing "safe parsing" for date values using `moment(..., true).isValid()` to prevent UI errors (though this safe parsing was later reverted). `error: false` was also briefly added to `slotProps.textField`.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\App.tsx` and `src\main.tsx`**
    *   (Timestamp: 1/9/2026, 3:42:02 PM & 3:42:13 PM)
    *   These files show standard React application setup, defining routes and rendering the main application structure. No significant functional changes were observed within the provided logs for these files.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\utils\utils.ts`**
    *   (Timestamp: 1/9/2026, 3:45:52 PM)
    *   Contains utility functions for date formatting (`appDateFormat`, `useDateFormate`), parsing raw strings, and extracting token payload/expiration (`getTokenPayload`, `getTokenExp`).

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\components\screen\analytics\MetricToolbar.tsx`**
    *   (Timestamp range: 1/9/2026, 5:01:02 PM - 5:12:10 PM)
    *   The `zIndex` for the custom date range popover was increased.
    *   There were attempts to adjust the display and positioning of the date filter `SelectBox` and its `DateRange` popover, fluctuating between `position: "relative", display: "inline-block"` and fixed width/flex layout. Ultimately reverted to the former.
    *   The `DateRange` component was consistently wrapped in `PopoverPanel` after 5:01:59 PM.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\components\screen\analytics\Charts\GaugeChart.tsx`**
    *   (Timestamp range: 1/9/2026, 5:35:10 PM - 5:36:09 PM)
    *   The `title` option within the `ApexOptions` was toggled between commented-out and active states multiple times. The chart's `fill` colors are conditionally set based on a `value < 3` check.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\pages\dashboard\dashboard-page.tsx`**
    *   (Timestamp: 1/9/2026, 6:20:13 PM)
    *   Manages dashboard state, filters, and data fetching for shipments, deliveries, and dashboard cards.
    *   Includes logic for filtering calendar data by "vessel" or "delivery" type and determining delivery modes (Rail, Door, Port).
    *   Utilizes Redux for state management across filters, pagination, and sorting.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\components\screen\misc\GlobalSearch.tsx`**
    *   (Timestamp range: 1/9/2026, 6:25:54 PM - 6:30:14 PM)
    *   The `handleOptionsSearch` function was modified to correctly pass the `CompanyName` as an object `{CompanyName: selectedCustomer || ""}` to the `ApiManager.getGlobalOptions` call, ensuring the global search incorporates the selected customer filter. A check was added to handle `selectedCustomer` potentially being an array.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\services\ApiManager.ts`**
    *   (Timestamp range: 1/9/2026, 6:27:27 PM - 6:29:39 PM)
    *   Updated the `getGlobalOptions` method to correctly handle the `CompanyName` parameter. It changed from expecting a string `CompanyName` to an object `{CompanyName:string}` that is then passed as `params` to the `ApiMethods.get` call.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\services\Endpoints.ts`**
    *   (Timestamp range: 1/9/2026, 6:28:28 PM - 6:31:10 PM)
    *   The `GET_GLOBAL_OPTIONS` endpoint definition was updated multiple times to correctly construct the URL with the `companyname` (later `CompanyName`) parameter, reflecting the changes in `ApiManager.ts`.

*   **`c:\Users\ridap\OneDrive\Documents\T360-V2\t360-frontend-v2\src\services\ApiMethods.ts`**
    *   (Timestamp: 1/9/2026, 6:29:26 PM)
    *   This file provides a base for API interaction, including `getAppHeaders` for authorization and content type. No functional changes specific to this log were observed in its content.

**Patterns and Recurring Elements:**

*   **Frequent Debugging/Testing:** Many `console.log` statements were added, removed, or modified across various files, and hardcoded test values (e.g., `remainingTime` in `layout.tsx`) were frequently introduced and reverted. This indicates an active development and debugging phase.
*   **UI/UX Refinement:** Components like `ChipsTabView`, `DateRange`, `PopoverPanel`, and chart titles saw iterative changes in styling, positioning, and behavior. This suggests an ongoing effort to improve the user interface and overall user experience.
*   **API Parameter Consistency:** There was a clear pattern of refining how the `CompanyName` parameter is passed and consumed across the `GlobalSearch` component, `ApiManager`, and `Endpoints` definition, striving for consistency in API calls.
*   **Chart Title Management:** A recurring theme across multiple chart components (`BarChart`, `PieChart`, `LineChart`, `StackedBarChart`, `GaugeChart`) was the placement and rendering of the chart title, often being commented out within individual chart components and centralized in a parent component (`MetricBox`).
*   **Redux Integration:** The `layout.tsx`, `dashboard-page.tsx`, `AnalyticsToolbar.tsx`, and `MetricToolbar.tsx` files consistently use `useSelector` and `useDispatch` for managing global and component-specific state via Redux.