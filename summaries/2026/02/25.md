# Activity Summary for 2/25/2026

## 2:10:40 PM
The changes log shows concentrated activity on February 25, 2026, primarily within the frontend of an application, focusing on employee management and a shared notes system.

### File-Specific Updates:

1.  **`c:\Users\ridap\OneDrive\Documents\Envosyes\frontend\envosys-frontend\src\components\screen\operation\employee\EmployeeOverviewContainer.tsx`**
    *   **Timestamp: 2/25/2026, 10:47:01 AM:** The initial state of the employee overview component, responsible for displaying employee counts (total, active, inactive) using `Card` components and allowing date range selection. It fetches data via `useGetEmployeeCardDataQuery`, initially using `user?.current_location?.location_id` for location filtering.
    *   **Timestamp: 2/25/2026, 10:47:46 AM:** A `console.log(user, "user====")` statement was added for debugging the user object.
    *   **Timestamp: 2/25/2026, 10:59:52 AM:** The location filtering parameter for `useGetEmployeeCardDataQuery` was changed from `location_id` to `loc_code` (`user?.current_location?.loc_code`). This was a functional change in how location data is identified.
    *   **Timestamp: 2/25/2026, 11:14:58 AM:** The location filtering parameter was reverted from `loc_code` back to `location_id` (`user?.current_location?.location_id`), undoing the previous functional change.

2.  **`c:\Users\ridap\OneDrive\Documents\Envosyes\frontend\envosys-frontend\src\pages\operation\employee\EmployeeDetailsPage.tsx`**
    *   **Timestamp: 2/25/2026, 11:15:56 AM:** This entry presents a complete employee details page. It facilitates adding and editing employee information. Key features include:
        *   Fetching employee data using `useFetchEmployeeDetailsQuery` (skipped in add mode).
        *   Saving/updating employee data using `useSaveEmployeeMutation` and `useUpdateEmployeeMutation`.
        *   Handling form submissions with `FormData`, including document uploads and notes.
        *   Managing employee status via a `SelectBox` (Active/Inactive).
        *   Extensive `console.log` statements are present for debugging the form action, fetched data, initial values, and `FormData` contents.

3.  **`c:\Users\ridap\OneDrive\Documents\Envosyes\frontend\envosys-frontend\src\components\screen\operation\employee\EmployeeDashboard.tsx`**
    *   **Timestamp: 2/25/2026, 12:03:42 PM:** This entry shows the full code for an employee dashboard component. It features a data grid with functionalities for:
        *   Searching, filtering (by status, employee type, department), and sorting employees.
        *   Pagination for displaying employee data.
        *   Fetching data from `useFetchEmployeeDashboardDataQuery`, which consumes Redux state for filters, search, and pagination.
        *   Dynamic filter options for status and department, sourced from API data.
        *   Exporting data to Excel.
        *   Filtering by `user?.current_location?.location_id`.

4.  **`c:\Users\ridap\OneDrive\Documents\Envosyes\frontend\envosys-frontend\src\components\common\note\NotesDrawer.tsx`**
    *   **Timestamp: 2/25/2026, 12:56:01 PM:** The initial detailed implementation of a `NotesDrawer` component. It displays notes, supports adding, editing, and deleting, and handles both local (new/edited/deleted) and API-fetched notes with pagination. It sanitizes note descriptions using `DOMPurify`. A minor rendering issue existed with `{note.title}kkk`.
    *   **Timestamp: 2/25/2026, 12:56:19 PM:** The rendering issue was fixed by changing `{note.title}kkk` to `{note.title}`.
    *   **Timestamp: 2/25/2026, 12:56:32 PM:** The "New Notes" button text was temporarily changed to "+ New Notes kk".
    *   **Timestamp: 2/25/2026, 12:56:49 PM:** The "New Notes" button text was reverted back to "+ New Notes".
    *   **Timestamp: 2/25/2026, 12:57:13 PM:** A `console.log("Rendering note:", note);` was added inside the `renderNote` function.
    *   **Timestamp: 2/25/2026, 12:59:10 PM:** A `console.log("üìù [NotesDrawer] Rendered with props:", { ... });` was added at the component's top level.
    *   **Timestamp: 2/25/2026, 12:59:37 PM:** A `console.log("üìù [NotesDrawer] Local notes from Redux:", localNotes);` was added after fetching local notes.

5.  **`c:\Users\ridap\OneDrive\Documents\Envosyes\frontend\envosys-frontend\src\components\common\DocumentAuditNotesTabs.tsx`**
    *   **Timestamp: 2/25/2026, 12:58:31 PM:** The `AuditNotesButtons` component was present, providing "Audit" and "Print HBL" functionality, but the `NotesDrawer` component was commented out, effectively disabling the notes feature from this wrapper.
    *   **Timestamp: 2/25/2026, 12:58:40 PM:** The `NotesDrawer` component was uncommented, re-enabling the notes functionality via a `DrawerPortal`.

### Patterns and Recurring Elements:

*   **Timestamps:** All changes occurred on **2/25/2026**, within a concentrated period from 10:47 AM to 12:59 PM, indicating a dedicated development sprint.
*   **Redux Toolkit (RTK Query) Usage:** There is consistent use of RTK Query for data fetching and mutations (`useGetEmployeeCardDataQuery`, `useFetchEmployeeDashboardDataQuery`, `useSaveEmployeeMutation`, `useUpdateEmployeeMutation`, `useFetchNotesQuery`, `useFetchAuditQuery`). Redux slices are used for managing component-specific state like dashboard filters and pagination (`employeeDashboardSlice`, `notesSlice`, `notesDashboardSlice`).
*   **Debugging via `console.log`:** Extensive `console.log` statements are present across almost all changed files. They are used for monitoring component rendering, user state, API responses, form data, and specific data structures. The `NotesDrawer` component uses a distinct `üìù [NotesDrawer]` prefix for its logs.
*   **Employee Management Focus:** A significant portion of the changes are dedicated to the employee section of the application, covering an overview dashboard, a detailed form for adding/editing employees, and general dashboard functionalities like filtering and sorting.
*   **Location-Based Data:** Data fetches for employee-related features consistently include a `location` parameter, typically tied to `user?.current_location?.location_id`, highlighting multi-location support in the application. The brief change to `loc_code` and subsequent revert indicates an exploration or correction of location identifier usage.
*   **Shared Notes System:** A robust notes system is being integrated, allowing users to add, edit, and delete notes related to different reference types and IDs. It handles both client-side and server-side note management, includes pagination, and uses `DOMPurify` for content security.
*   **Common UI Components:** The application frequently utilizes custom or common UI components such as `Button`, `Card`, `DatePeriodSelector`, `SelectBox`, `InputBox`, `AppGrid`, `FilterSidebar`, `BaseModal`, `NotesDrawer`, and `DrawerPortal`.

## 2:10:48 PM
The code changes primarily revolve around implementing and enhancing employee management functionality, with a strong emphasis on multi-tenancy and the adoption of Prisma ORM for database interactions.

**File-Specific Updates:**

*   **`c:\Users\ridap\OneDrive\Documents\Envosyes\envosys-backend\src\routes\employeeRoutes.ts` (2/24/2026, 3:23:23 PM):** This file defines the API routes for employee management. It includes routes for fetching all employees (`GetAll`), a single employee (`GetOne`), employee card information (`Counts`), and generating new employee IDs (`NewId`). Crucially, it sets up POST (`Create`) and PUT (`Update`) routes to handle employee creation and updates, integrating `uploadMiddleware` for document handling, specifying `employee_doc` as the document type and using `process.env.GLOBAL_DOC_PATH` for storage.

*   **`c:\Users\ridap\OneDrive\Documents\Envosyes\envosys-backend\prisma\models\employee.prisma` (2/24/2026, 4:10:34 PM):** This Prisma schema model defines the `employee` table structure. It includes comprehensive fields for employee details such as `serial_id` (primary key, auto-increment), `employee_code` (unique), `first_name`, `last_name`, `email` (unique), `phone_number`, `designation`, `department`, `joining_date`, `status`, address information, emergency contacts, blood group, and employee type. Significant additions include `tenant_id` (UUID) for multi-tenancy and `loc_code` for company location isolation. It also defines `created_by`, `updated_by`, `created_at`, and `updated_at` audit fields and establishes relations to `tenants` and `company_locations` models, along with performance indexes.

*   **`c:\Users\ridap\OneDrive\Documents\Envosyes\envosys-backend\prisma\models\tanent.prisma` (2/24/2026, 4:15:56 PM):** This Prisma schema model defines the `tenants` table. It includes `id` (UUID, primary key), `name`, `code` (unique), `status`, and standard audit timestamps. The model explicitly lists reverse relations (e.g., `users`, `roles`, `companies`, `employee`, `JobMaster`) to `tenants`, highlighting its central role in the application's multi-tenancy architecture.

*   **`c:\Users\ridap\OneDrive\Documents\Envosyes\envosys-backend\prisma\models\core.prisma` (2/24/2026, 4:21:38 PM):** This core Prisma schema defines foundational models like `users`, `roles`, `companies`, `company_locations`, and various user/menu/permission-related audit and sequence tables. A consistent pattern across these models is the inclusion of `tenant_id` and relations to the `tenants` model, enforcing multi-tenancy throughout the core application. Many models also feature `created_at`/`updated_at` and `created_by`/`updated_by` fields for auditing. The `company_locations` model specifically links to `employee` and `JobMaster` models, demonstrating location-based data partitioning.

*   **`c:\Users\ridap\OneDrive\Documents\Envosyes\envosys-backend\src\services\employeeServices.ts` (Multiple changes from 2/24/2026, 4:10:45 PM to 2/25/2026, 1:09:51 PM):**
    *   **Initial Implementation (2/24, 4:10:45 PM):** The `getAll` function was introduced, supporting pagination, sorting, and filtering for employees based on `search` terms (insensitive `contains` across multiple fields), `status`, `department`, and `employee_type`. It enforced multi-tenancy using `tenant_id` and `loc_code` from the request user. The initial version used Prisma for fetching employees but relied on raw SQL queries (`query` utility) for fetching associated `document_upload` and `notes` data, as well as for retrieving distinct filter options. A commented-out `getAll_OLD` function indicates a migration from a full raw SQL implementation.
    *   **Refactor to Prisma (2/25, 12:06:35 PM):** A significant update refactored the data retrieval for `notes`, `documents`, and filter `options` to exclusively use Prisma ORM instead of raw SQL queries. This involved replacing `query` calls with `prisma.notes.findMany`, `prisma.document_upload.findMany`, and `prisma.employee.findMany` with `distinct` clauses for options. The refactor also simplified error handling by using direct HTTP status codes (401, 200, 500) and removed unused imports like `insertQuery` and `updateQuery`. Minor cosmetic changes and console logs were added/removed in between these major updates.

*   **`c:\Users\ridap\OneDrive\Documents\Envosyes\envosys-backend\prisma\schema.prisma` (Multiple changes from 2/25/2026, 11:56:25 AM to 2/25/2026, 12:39:01 PM):** This main Prisma schema file was updated to include core application tables `notes` and `Sequence`. Both models incorporate `tenant_id` for multi-tenancy, and `serial_id` for `notes` is `BigInt`. A large section of commented-out models indicates ongoing development or previous design considerations. The generation configuration specifies `prisma-client` and `postgresql`.

*   **`c:\Users\ridap\OneDrive\Documents\Envosyes\envosys-backend\generated\prisma\internal\class.ts` (2/25/2026, 11:58:06 AM):** This is an auto-generated Prisma client file, reflecting the `schema.prisma` state at the time. Its `inlineSchema` property confirms the presence and structure of models like `users`, `roles`, `companies`, `company_locations`, RBAC models, `employee`, and `JobMaster`, all containing `tenant_id`.

*   **`c:\Users\ridap\OneDrive\Documents\Envosyes\envosys-backend\src\common\util\globalUpload.ts` (2/25/2026, 12:42:22 PM):** The `saveDoc` utility function was updated to accept `tenant_id` as a parameter. This `tenant_id` is now saved with the document in `prisma.document_upload.create`, ensuring that uploaded files are also tenant-scoped. It also explicitly converts `BigInt` `serial_id` to `string` in its return value for consistent JSON serialization.

*   **`c:\Users\ridap\OneDrive\Documents\Envosyes\envosys-backend\src\services\notesService.ts` (2/25/2026, 2:06:47 PM and 2/25/2026, 2:07:16 PM):** This file provides services for managing notes (getAllNotes, addNote, updateNote, deleteNote). All functions use Prisma ORM for database interactions. They incorporate `tenant_id` for multi-tenancy filtering and creation. HTML sanitization using `DOMPurify.sanitize` is applied to note descriptions to prevent XSS. Similar to `employeeServices`, it includes commented-out `_OLD` functions, indicating a migration from raw SQL. It also handles `BigInt` to string serialization for `serial_id`.

**Patterns and Recurring Elements:**

1.  **Multi-Tenancy:** A pervasive architectural pattern across all relevant files. Database models consistently include a `tenant_id` field (often UUID) and establish relations to a central `tenants` model. Service functions (e.g., `employeeServices.ts`, `notesService.ts`, `globalUpload.ts`) actively filter and create data based on the authenticated user's `tenant_id` and sometimes `current_location_code` (e.g., in `employeeServices.getAll`).
2.  **Prisma ORM Adoption:** There's a clear and ongoing migration from raw SQL queries to Prisma ORM. Initial implementations might mix both, but later commits show a consolidation towards full Prisma usage for data access, evident in `employeeServices.ts` and `notesService.ts` with their commented-out `_OLD` raw SQL functions.
3.  **Audit Fields:** Most database models (`employee`, `tenants`, `users`, `notes`, `JobMaster`, etc.) consistently include `created_at`, `updated_at`, `created_by`, and `updated_by` fields for tracking data provenance and modification history.
4.  **BigInt Serialization:** A recurring technical detail is the explicit conversion of `serial_id` (defined as `BigInt` in Prisma) to `string` before sending it in JSON responses. This addresses potential issues with JavaScript's handling of large integers.
5.  **Modular Service Structure:** Services (e.g., `employeeServices`, `notesService`) are designed to handle specific domain logic, encapsulating database operations and business rules, including pagination, sorting, and filtering.
6.  **File Upload Integration:** The application consistently uses an `uploadMiddleware` and `saveDoc` utility (which also integrates with Prisma) for handling file uploads, ensuring documents are associated with their respective reference IDs and types, and are tenant-scoped.

## 3:10:37 PM
The changes primarily focus on the `envosys-backend` project, with significant updates to Prisma models and `employeeServices.ts` for improved data handling and multi-tenancy.

**File-Specific Updates:**

*   **`c:\Users\ridap\OneDrive\Documents\Envosyes\envosys-backend\src\routes\employeeRoutes.ts` (Timestamp: 2/24/2026, 3:23:23 PM)**:
    *   This file defines the API routes for employee management.
    *   It imports several services (`getAll`, `getOne`, `create`, `update`, `getEmployeeCardInfo`, `getNewEmployeeId`) and `uploadMiddleware`.
    *   Key routes are `GET /employee/all`, `GET /employee/one`, `POST /employee/create`, `PUT /employee/update`, `GET /employee/counts`, and `GET /employee/new-id`.
    *   The `create` and `update` routes explicitly use `uploadMiddleware` for handling document uploads, referencing `process.env.GLOBAL_DOC_PATH`.

*   **`c:\Users\ridap\OneDrive\Documents\Envosyes\envosys-backend\prisma\models\employee.prisma` (Timestamp: 2/24/2026, 4:10:34 PM)**:
    *   Defines the `employee` Prisma model, outlining its structure and fields.
    *   Includes essential employee details like `employee_code` (unique), `first_name`, `last_name`, `email`, `phone_number`, `designation`, `department`, `joining_date`, `status`, and address information.
    *   **Multi-tenancy and Company Isolation**: Explicitly includes `tenant_id` (UUID) and `loc_code` (VarChar) fields, with relations to `tenants` and `company_locations` models, respectively.
    *   **Audit Fields**: Contains `created_by`, `updated_by`, `created_at`, and `updated_at` fields for tracking changes.
    *   Indexes are defined for `tenant_id`, `loc_code`, and `employee_code` to enhance query performance.

*   **`c:\Users\ridap\OneDrive\Documents\Envosyes\envosys-backend\prisma\models\tanent.prisma` (Timestamp: 2/24/2026, 4:15:56 PM)**:
    *   Defines the `tenants` Prisma model.
    *   Includes basic tenant information (`id`, `name`, `code`, `status`, `created_at`, `updated_at`).
    *   **Key Update**: A significant change is the addition of an `employee employee[]` relation, indicating that an employee can belong to a tenant, establishing a one-to-many relationship from tenant to employees.
    *   Also lists other reverse relations for `users`, `roles`, `companies`, `company_locations`, `user_locations`, `user_menu`, `user_sequence`, `user_management_audit`, `role_menu`, `menu_permissions`, `menu_permissions_audit`, `JobMaster`, `VesselMaster`, `VesselVoyageMaster`, and `VesselRouting`.

*   **`c:\Users\ridap\OneDrive\Documents\Envosyes\envosys-backend\prisma\models\core.prisma` (Timestamp: 2/24/2026, 4:21:38 PM)**:
    *   This file defines core models like `users`, `roles`, `companies`, `company_locations`, `user_locations`, `user_menu`, `user_sequence`, `user_management_audit`, `menu_master`, `role_menu`, `permissions`, `menu_permissions`, and `menu_permissions_audit`.
    *   All these models include `tenant_id` for multi-tenancy and establish relations with the `tenants` model.
    *   The `company_locations` model also includes an `employee employee[]` relation, linking employee records to specific company locations.
    *   Several models (`users`, `roles`, `company_locations`, `user_locations`, `user_menu`, `user_sequence`, `user_management_audit`, `role_menu`, `menu_permissions`, `menu_permissions_audit`) have `@@index([tenant_id])` for performance.
    *   `company_locations` has a unique constraint `@@unique([loc_code,tenant_id])`.

*   **`c:\Users\ridap\OneDrive\Documents\Envosyes\envosys-backend\prisma\schema.prisma` (Timestamp: 2/25/2026, 11:56:25 AM - 12:39:01 PM)**:
    *   This is the main Prisma schema file.
    *   It defines `notes` and `Sequence` models.
    *   `notes` now explicitly includes `tenant_id String? @db.Uuid` and an index `@@index([tenant_id])`.
    *   `Sequence` uses `tenant_id` as part of a unique constraint and has an index.
    *   A significant amount of previously commented-out models (`booking_sequence`, `carting`, `consignee_master`, `consigneemaster`, `customer`, `customer_alerts`, `customer_audit`, etc.) remain commented out, indicating they are not yet actively used but represent potential future modules.
    *   This schema likely aggregates models from `employee.prisma`, `tanent.prisma`, and `core.prisma` (as seen in the `internal/class.ts` content, which reflects the full schema).
    *   The `employee` model, as seen in the generated class, includes multi-tenancy (`tenant_id`, `loc_code`) and audit fields.
    *   A `JobMaster` model is also present in the generated schema, showing similar multi-tenancy and audit fields.

*   **`c:\Users\ridap\OneDrive\Documents\Envosyes\envosys-backend\src\services\employeeServices.ts` (Multiple timestamps from 2/24/2026, 4:10:45 PM to 2/25/2026, 2:42:22 PM)**:
    *   This file undergoes the most extensive and frequent changes.
    *   **Migration to Prisma**: The `getAll` function is progressively refactored from raw SQL queries (which are commented out as `getAll_OLD`) to use Prisma Client for database interactions.
        *   Initial versions still used raw SQL for fetching documents and notes.
        *   Later changes (from 2/25/2026, 12:06:35 PM onwards) fully integrate Prisma for fetching `notes` and `document_upload` records by adding `prisma.notes.findMany` and `prisma.document_upload.findMany`.
        *   Filter options (status, department, employee_type, location) are also transitioned to Prisma's `distinct` and `findMany` queries instead of raw SQL `json_agg`.
    *   **Multi-tenancy Enforcement**: `tenant_id` and `loc_code` are consistently extracted from `req.user` and applied to Prisma `where` clauses for all queries (employees, notes, documents) to ensure data isolation.
    *   **Error Handling**: Consistent error logging with `logger.error` and `console.error`, returning `500 Internal Server Error` in catch blocks.
    *   **Query Parameter Handling**: Robust parsing of `page`, `perPage`, `orderBy`, `search`, `status`, `department`, and `employee_type` query parameters.
    *   **Serialization**: `BigInt` serial IDs are consistently converted to `string` before sending as JSON responses to prevent serialization issues.
    *   **New Filters**: On 2/25/2026, 2:42:22 PM, `fromDate` and `toDate` filters are added to the `getAll` function's `where` clause for `created_at` field, enabling date range filtering.
    *   **Removed Imports**: `insertQuery` and `updateQuery` are eventually removed from imports, reflecting the full transition away from raw SQL for these operations in the `getAll` function.

*   **`c:\Users\ridap\OneDrive\Documents\Envosyes\envosys-backend\src\common\util\globalUpload.ts` (Timestamp: 2/25/2026, 12:42:22 PM)**:
    *   The `saveDoc` function, responsible for handling file uploads, is updated to include `tenant_id` in the `SaveDocParams` interface and to store it when creating a new `document_upload` record via Prisma. This ensures that uploaded documents are also associated with a specific tenant.

*   **`c:\Users\ridap\OneDrive\Documents\Envosyes\envosys-backend\src\services\notesService.ts` (Multiple timestamps from 2/25/2026, 2:06:47 PM to 2:07:16 PM)**:
    *   This service manages notes for various reference types (`ref_type`, `ref_id`).
    *   **Prisma Implementation**: The `getAllNotes`, `addNote`, `updateNote`, and `deleteNote` functions are fully implemented using Prisma Client.
    *   **Multi-tenancy**: `tenant_id` is applied to all Prisma queries (`findMany`, `count`, `create`, `findFirst`, `update`, `delete`) to ensure notes are tenant-isolated.
    *   **Data Sanitization**: `DOMPurify.sanitize` is used for `description` fields in `addNote` and `updateNote` to prevent XSS vulnerabilities.
    *   **BigInt Handling**: `BigInt` serial IDs are converted to strings for JSON output.
    *   Old raw SQL implementations are commented out, similar to `employeeServices.ts`.

*   **`c:\Users\ridap\OneDrive\Documents\Envosyes\envosys-backend\generated\prisma\internal\class.ts` (Timestamp: 2/25/2026, 11:58:06 AM)**:
    *   This is a generated Prisma client file, reflecting the current state of the `prisma/schema.prisma` file. It includes the definitions of all models (`users`, `roles`, `companies`, `company_locations`, `user_locations`, `user_menu`, `user_sequence`, `user_management_audit`, `menu_master`, `role_menu`, `permissions`, `menu_permissions`, `menu_permissions_audit`, `employee`, `JobMaster`). This confirms the schema changes were applied and the Prisma client was regenerated.

**Timestamps of Significant Changes:**

*   **February 24, 2026**:
    *   **3:23:23 PM**: Initial setup of `employeeRoutes.ts` with file upload middleware.
    *   **4:10:34 PM**: Introduction/update of `employee.prisma` model, adding detailed employee fields and multi-tenancy (`tenant_id`, `loc_code`).
    *   **4:10:45 PM**: First version of `employeeServices.ts` showing the beginning of the migration to Prisma for `getAll` (mixing Prisma and raw SQL for sub-queries).
    *   **4:15:56 PM**: `tanent.prisma` is updated to include the `employee` relation, strengthening the multi-tenancy structure.
    *   **4:21:38 PM**: `core.prisma` defines several core models, all integrating `tenant_id` and showing relations, including `employee` for `company_locations`.
*   **February 25, 2026**:
    *   **~10:26 AM to 11:59 AM**: Repeated, minor edits to `employeeServices.ts` for `getAll` function, primarily for debugging/logging (`console.log`) or small code refactors. A significant revert occurs around 11:42 AM where filter options fetching was temporarily commented out, then re-enabled.
    *   **12:06:35 PM**: Major refactoring of `employeeServices.ts::getAll` to fully use Prisma for fetching notes and documents, and for generating filter options. Raw SQL for these parts is commented out. Status codes are changed from `HttpStatusCodes` constants to raw numbers (`401`, `200`, `500`).
    *   **12:08:13 PM**: Temporary commenting out of document fetching logic in `employeeServices.ts::getAll`.
    *   **12:13:14 PM**: Restoration of document fetching logic in `employeeServices.ts::getAll`, now using `prisma.document_upload.findMany` with `tenant_id` filter.
    *   **12:16:31 PM**: `prisma/schema.prisma` reflects the changes, especially the `notes` model now having `tenant_id`.
    *   **12:42:22 PM**: `globalUpload.ts` is updated to include `tenant_id` in `SaveDocParams` and pass it to Prisma for `document_upload` creation, reinforcing multi-tenancy for documents.
    *   **12:39:40 PM**: `employeeServices.ts` imports `generateSeqCode`, indicating potential for sequenced IDs.
    *   **2:06:47 PM - 2:07:16 PM**: `notesService.ts` is fully migrated to Prisma, including multi-tenancy for all CRUD operations and HTML sanitization for descriptions.
    *   **2:10:34 PM - 2:19:33 PM**: Minor edits in `employeeServices.ts`, likely further refinement of the Prisma migration.
    *   **2:24:46 PM**: A significant change where `employeeServices.ts::getAll` is reverted back to using raw SQL queries with `query` function (instead of Prisma) for fetching employee data, documents, and notes, but still maintains multi-tenancy filters in SQL. The `getOne`, `create`, `update`, `getEmployeeCardInfo`, `getNewEmployeeId` functions also continue to use raw SQL. `saveNotes` import is re-added, which was removed earlier.
    *   **2:27:33 PM - 2:38:01 PM**: The `getAll` function in `employeeServices.ts` appears to be reverted *back* to a Prisma-based implementation, contradicting the previous entry from 2:24:46 PM, as `prisma.employee.findMany`, `prisma.notes.findMany`, `prisma.document_upload.findMany` are present.
    *   **2:42:22 PM**: Introduction of `fromDate` and `toDate` filters for employee search in `employeeServices.ts::getAll`.

**Patterns and Recurring Elements:**

1.  **Multi-tenancy (Tenant-ID Isolation)**: This is the most dominant pattern. Almost all data models (`employee`, `tenants`, `users`, `roles`, `companies`, `company_locations`, `notes`, `document_upload`, `JobMaster`, `Sequence`) and service functions (`employeeServices.ts::getAll`, `notesService.ts` functions, `globalUpload.ts::saveDoc`) explicitly incorporate `tenant_id` for filtering and data association. This indicates a strong architectural focus on ensuring data separation between different tenants.
2.  **Prisma ORM Adoption**: There's a clear ongoing migration from raw SQL queries to Prisma ORM, particularly evident in `employeeServices.ts` and `notesService.ts`. The `getAll` function in `employeeServices.ts` shows multiple iterations, switching between raw SQL and Prisma, suggesting an active transition or debugging process. The `insertQuery` and `updateQuery` imports were temporarily removed then re-added, indicating a fluctuating approach, though eventually settling on Prisma for fetching.
3.  **Audit Fields**: Models consistently include `created_at`, `updated_at`, `created_by`, and `updated_by` fields for traceability.
4.  **UUIDs and Serial IDs**: UUIDs (`@db.Uuid`) are used for `tenant.id` and `user.id`, while `Int` or `BigInt` with `autoincrement()` are used for `serial_id` in many models.
5.  **Refactoring and Code Cleanup**: Several commits show minor changes like adding console logs for debugging, cleaning up variable declarations, or re-enabling/disabling code sections (e.g., filter options, document fetching).
6.  **Filter and Pagination Logic**: `getAll` functions consistently implement pagination (`page`, `perPage`, `skip`, `take`) and robust filtering based on various fields (`search`, `status`, `department`, `employee_type`, `location`, `fromDate`, `toDate`).
7.  **BigInt Serialization**: A recurring concern is the serialization of BigInt IDs to strings when returning JSON responses, handled explicitly in services.
8.  **Security**: `DOMPurify` is used in `notesService.ts` for sanitizing user-provided descriptions, indicating attention to security (XSS prevention).

## 3:10:39 PM
This log details several code changes, primarily within the frontend application's employee management and common utility components, all occurring on **February 25, 2026**.

**File-Specific Updates:**

*   **`c:\Users\ridap\OneDrive\Documents\Envosyes\frontend\envosys-frontend\src\components\screen\operation\employee\EmployeeOverviewContainer.tsx`**
    *   **10:47:01 AM:** The component was initialized, fetching employee card data based on `location_id` and date filters. It displays total, active, and inactive employees using `Card` components and includes a `DatePeriodSelector` and a "New Employee" button.
    *   **10:47:46 AM:** A `console.log(user, "user====")` statement was added for debugging the user object.
    *   **10:59:52 AM:** The `location` parameter for `useGetEmployeeCardDataQuery` was changed from `user?.current_location?.location_id` to `user?.current_location?.loc_code`.
    *   **11:14:58 AM:** This change was reverted, and the `location` parameter was set back to `user?.current_location?.location_id`.

*   **`c:\Users\ridap\OneDrive\Documents\Envosyes\frontend\envosys-frontend\src\pages\operation\employee\EmployeeDetailsPage.tsx`**
    *   **11:15:56 AM:** This single entry shows a comprehensive page for adding and editing employee details. It utilizes Redux Toolkit Query for data fetching and mutations, manages form data (including document uploads and notes), handles employee status, and includes extensive `console.log` statements for debugging form actions, data fetching, and initial values.

*   **`c:\Users\ridap\OneDrive\Documents\Envosyes\frontend\envosys-frontend\src\components\screen\operation\employee\EmployeeDashboard.tsx`**
    *   **12:03:42 PM:** The initial state of the employee dashboard, featuring search, filter, sort, pagination, and data export to Excel. It uses Redux for managing dashboard state (filters, sort, pagination) and fetches data via `useFetchEmployeeDashboardDataQuery`.
    *   **2:46:56 PM:** No significant functional code changes were introduced, likely a minor save or formatting update.
    *   **3:03:33 PM:** A `DatePeriodSelector` component was integrated into the dashboard header, allowing users to filter employee data by date ranges. The `useFetchEmployeeDashboardDataQuery` was updated to include these new `fromDate` and `toDate` parameters. The UI layout of the header was adjusted to accommodate the date selector.

*   **`c:\Users\ridap\OneDrive\Documents\Envosyes\frontend\envosys-frontend\src\components\common\note\NotesDrawer.tsx`**
    *   **12:56:01 PM:** The component for displaying and managing notes was present, including add, edit, and delete functionalities, Redux integration for local and fetched notes, and basic pagination. A temporary "kkk" suffix was observed in the `note.title` rendering.
    *   **12:56:19 PM:** The "kkk" suffix was removed from the `note.title` display.
    *   **12:56:32 PM:** The "kkk" suffix was temporarily re-added to the "New Notes" button label.
    *   **12:56:49 PM:** The "kkk" suffix was removed from the "New Notes" button label.
    *   **12:57:13 PM - 12:59:37 PM:** Multiple `console.log` statements were added to debug rendering, component props, and the state of local notes from Redux.

*   **`c:\Users\ridap\OneDrive\Documents\Envosyes\frontend\envosys-frontend\src\components\common\DocumentAuditNotesTabs.tsx`**
    *   **12:58:31 PM:** The component was set up to provide Audit, Notes (commented out), and HBL Print buttons. It pre-fetches audit data.
    *   **12:58:40 PM:** The `NotesDrawer` component was uncommented, activating the notes functionality within the application.

*   **`c:\Users\ridap\OneDrive\Documents\Envosyes\frontend\envosys-frontend\src\data\coulms\employee-columns.tsx`**
    *   **2:16:52 PM:** Defined the grid columns for employee data, including custom rendering for status badges and employee types.
    *   **2:17:12 PM:** The `width` of the `employee_code` column was adjusted from `150` to `200`.

**Patterns and Recurring Elements:**

*   **Concentrated Development:** All changes occurred on the same date, indicating a focused development sprint or debugging session.
*   **Debugging Practices:** Numerous `console.log` statements were added across `EmployeeOverviewContainer.tsx`, `EmployeeDetailsPage.tsx`, and `NotesDrawer.tsx`, suggesting active debugging and state inspection was a priority during these changes.
*   **Redux Toolkit Heavy Usage:** The application extensively uses Redux (`useDispatch`, `useSelector`) and Redux Toolkit Query for managing application state, fetching data, and performing mutations across several components.
*   **UI Component Refinement:** Several common UI components like `DatePeriodSelector`, `Card`, `Button`, and `NotesDrawer` were either integrated, refined, or debugged.
*   **Employee Module Focus:** A significant portion of the changes revolves around the employee management features (overview, dashboard, details, and associated data grid columns), indicating active development in this area.
*   **Notes Feature Activation:** The `NotesDrawer` component underwent several rapid debugging and minor UI adjustments, culminating in its uncommenting and activation within `DocumentAuditNotesTabs.tsx`, suggesting the finalization and deployment of this feature.