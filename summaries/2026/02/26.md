# Activity Summary for 2/26/2026

## 1:32:35 PM
The file `c:\Users\ridap\OneDrive\Documents\T360-V2\t360-backend-v2\src\common\util\booking.query.ts` was last updated on 2/26/2026, 12:43:16 PM. This file defines the `bookingQueryBuilder` function, which is responsible for constructing dynamic SQL queries for various booking-related analytics and reports.

The `bookingQueryBuilder` function takes a set of parameters including `type`, `customizer` (which configures reporting options like date ranges, column configurations, and chart types), `CompanyName`, `fromDate`, `toDate`, `displayBy`, `user_id`, and `reportName`.

Key functionalities based on the `type` parameter include:

*   **`BookingDatetoActualDeparture`**: Calculates the average difference in days between `t49_vessel_actualdeparted_date` and `bookingdate` per unique `fileno` and `contno`. It then determines the percentage of each entity's average relative to the maximum average, ordering results in descending order. The `customizer` is configured for date range analysis, average calculation (`avg`), and specific date columns.
*   **`BookingDatetoActualDepartureMblWise`**: Similar to the above, but the calculation and grouping are performed per `fileno` and `mblno`, focusing on Master Bill of Lading (MBL) wise analysis. The `customizer` is also set to `mblwise: true`.
*   **`BookingDatetoActualDepartureStackedBar`**: Categorizes the day difference between `t49_vessel_actualdeparted_date` and `bookingdate` into predefined time buckets (e.g., "Less than 1 week", "1 - 2 weeks", "Above 5 weeks"). It then aggregates these counts, grouping by categories derived from the `displayBy` parameter using the `getFilterQueryByDisplayValue` utility. The `customizer` is set to `chartType: "StackedBar"`.
*   **`BookingDatetoActualDepartureMblWiseStackedBar`**: This type follows the pattern of the `StackedBar` query but applies the difference calculation and categorization on an MBL-wise basis (`fileno` and `mblno`), similar to `BookingDatetoActualDepartureMblWise`. The `customizer` is also set to `mblwise: true` and `chartType: "StackedBar"`.

**Recurring patterns and elements:**

*   All queries involve joining `mtr_tracking_data` with `agent_booking_entry` tables on `LOWER(mblno)`.
*   A consistent filtering mechanism is applied across all queries, using `CompanyName`, `departure_date` within a specified `fromDate` and `toDate` range.
*   Date fields (`t49_vessel_actualdeparted_date`, `bookingdate`) are checked for `IS NOT NULL` and `!= '0001-01-01 00:00:00 BC'` to ensure valid date calculations.
*   The `customizer` object is frequently updated to reflect the analytical and display requirements for each query type, including setting `dateRange`, `calType` (e.g., "avg"), `dateColumns`, `booking`, `mblwise`, and `chartType`.
*   Utility functions like `getColumnsByCategory` and `getFilterQueryByDisplayValue` are used to dynamically determine selected columns and construct filtering/grouping clauses for queries, enhancing flexibility.
*   The core calculation in most queries involves `EXTRACT(DAY FROM t49_vessel_actualdeparted_date - bookingdate)` to find the day difference between actual departure and booking dates.

## 2:23:20 PM
The provided log details several code changes across a frontend application, primarily focusing on employee management features, common UI components, and API integration.

**File-Specific Updates:**

*   **`c:\Users\ridap\OneDrive\Documents\Envosyes\frontend\envosys-frontend\src\components\screen\operation\employee\EmployeeOverviewContainer.tsx`**
    *   **Timestamp (Significant):** 2/25/2026, 10:59:52 AM and 2/25/2026, 11:14:58 AM
    *   Initially, the `location` parameter for fetching employee card data was based on `user?.current_location?.location_id`. It was briefly changed to `user?.current_location?.loc_code` at 10:59:52 AM, indicating an attempt to use a location code instead of an ID. This change was then reverted back to `location_id` at 11:14:58 AM. Minor `console.log` statements were also added.

*   **`c:\Users\ridap\OneDrive\Documents\Envosyes\frontend\envosys-frontend\src\pages\operation\employee\EmployeeDetailsPage.tsx`**
    *   **Timestamp (Significant):** 2/25/2026, 5:47:27 PM to 2/26/2026, 1:18:47 PM
    *   This file saw numerous adjustments related to the "status" field for employee details. Initially, `initialValues.status` defaulted to `"ACTIVE"`, and the `options` for the status dropdown used `"ACTIVE"`/`"INACTIVE"`. There was a temporary change to use `employeeStatus` as the key with various default values (`""`, `"Active"`) and attempts to adjust the casing of the `options` array labels (`"Active"`, `"Inactive"`). Ultimately, the status field in `initialValues` was set to `employeeData.status || "ACTIVE"`, and the dropdown `options` were consistently set to `"ACTIVE"`/`"INACTIVE"` (uppercase) by the final change at 2/26/2026, 1:18:47 PM.

*   **`c:\Users\ridap\OneDrive\Documents\Envosyes\frontend\envosys-frontend\src\components\screen\operation\employee\EmployeeDashboard.tsx`**
    *   **Timestamp (Significant):** 2/25/2026, 3:03:33 PM and 2/25/2026, 10:18:15 PM
    *   At 3:03:33 PM, a `DatePeriodSelector` component was integrated into the dashboard header, allowing users to filter employee data by date range (`fromDate`, `toDate`). This involved importing Redux actions (`setDateRange`, `setPeriod`) and updating the `useFetchEmployeeDashboardDataQuery` to include these date parameters. However, this feature, along with the date selector UI, was subsequently removed at 10:18:15 PM, reverting the dashboard to its state without date filtering.

*   **`c:\Users\ridap\OneDrive\Documents\Envosyes\frontend\envosys-frontend\src\components\common\note\NotesDrawer.tsx`**
    *   **Timestamp (Significant):** 2/25/2026, 12:56:19 PM, and then multiple debugging logs from 2/25/2026, 12:57:13 PM to 2/25/2026, 12:59:37 PM.
    *   Minor textual changes were made, such as removing "kkk" from `note.title` and adding/removing " kk" from the "New Notes" button. The primary pattern in this file was the extensive addition of `console.log` statements for debugging various aspects of the component's rendering and data (`props`, `localNotes`, individual `note` rendering).

*   **`c:\Users\ridap\OneDrive\Documents\Envosyes\frontend\envosys-frontend\src\components\common\DocumentAuditNotesTabs.tsx`**
    *   **Timestamp (Significant):** 2/25/2026, 12:58:40 PM
    *   The `NotesDrawer` component, which was previously commented out (disabling notes functionality), was uncommented and re-enabled at this timestamp, making the notes drawer accessible again.

*   **`c:\Users\ridap\OneDrive\Documents\Envosyes\frontend\envosys-frontend\src\data\coulms\employee-columns.tsx`**
    *   **Timestamp (Significant):** 2/25/2026, 2:17:12 PM
    *   The `width` of the `employee_code` column in the employee data grid was increased from `150` to `200`.

*   **`c:\Users\ridap\OneDrive\Documents\Envosyes\frontend\envosys-frontend\src\store\api\core-api\baseQuery.ts`**
    *   **Timestamp (Significant):** 2/25/2026, 7:09:44 PM
    *   An `x-location-code` header was added to API requests, deriving its value from the user's current location (`state.user.currentUser?.current_location?.loc_code`). The `performLogout` function call was updated to pass `api.dispatch` and a source string. `console.log` statements for debugging the state during header preparation were also added and refined.

*   **`c:\Users\ridap\OneDrive\Documents\Envosyes\frontend\envosys-frontend\src\store\api\operation-api\employeeDataApi.ts`**
    *   **Timestamp (Significant):** 2/25/2026, 7:27:50 PM to 2/26/2026, 12:13:35 PM
    *   This file underwent extensive changes regarding headers for `FormData` mutations (`saveEmployee`, `updateEmployee`). Initially, there was an attempt to dynamically fetch `x-location-code` from `localStorage` within the mutation itself, with several corrections to the key and data source (from `x-loc-code` to `x-location-code`, and various `localStorage` keys). Eventually, at 2/26/2026, 11:52:42 AM, the headers were simplified to use a centralized `getAppHeaders()` function. Crucially, at 2/26/2026, 12:00:54 PM for `saveEmployee` and 2/26/2026, 12:13:35 PM for `updateEmployee`, the `Content-Type` header was explicitly deleted for `FormData` requests to allow the browser to set it correctly.

*   **`c:\Users\ridap\OneDrive\Documents\Envosyes\frontend\envosys-frontend\src\pages\core\login\LoginPage.tsx`**
    *   **Timestamp (Significant):** 2/25/2026, 9:21:23 PM
    *   Upon successful login, the `currentUser` object stored in `localStorage` and Redux was updated to explicitly set `current_location` to `primary_location`, ensuring a consistent default location.

*   **`c:\Users\ridap\OneDrive\Documents\Envosyes\frontend\envosys-frontend\src\store\fretures\core\userSlice.ts`**
    *   **Timestamp (Significant):** 2/25/2026, 9:38:52 PM
    *   A `console.log` statement was added to the `setUser` reducer to log the payload being dispatched.

*   **`c:\Users\ridap\OneDrive\Documents\Envosyes\frontend\envosys-frontend\src\App.tsx`**
    *   **Timestamp (Significant):** 2/25/2026, 9:39:43 PM and 2/25/2026, 9:40:16 PM
    *   A `console.log` statement was temporarily added to an `useEffect` hook to debug user data retrieval from `localStorage` on app load, and then removed shortly after.

*   **`c:\Users\ridap\OneDrive\Documents\Envosyes\frontend\envosys-frontend\src\components\core\usercard.tsx`**
    *   **Timestamp (Significant):** 2/25/2026, 10:06:45 PM and 2/26/2026, 12:30:04 PM
    *   Initially, `currentLocationCode` was explicitly stored in `localStorage`. This separate storage of `currentLocationCode` was later removed at 2/26/2026, 12:30:04 PM, suggesting a centralized approach to managing location codes. Several `console.log` statements were also added and removed for debugging location switching.

**Patterns and Recurring Elements:**

*   **Debugging with `console.log`**: A dominant pattern across almost all modified files is the frequent addition and occasional removal of `console.log` statements, indicating active debugging and development.
*   **Location Context Management**: There's a consistent effort to correctly capture and transmit the user's current operational location (`loc_code` or `location_id`) across the application, especially in API headers. This involved several iterations and corrections in `EmployeeOverviewContainer.tsx`, `baseQuery.ts`, `employeeDataApi.ts`, `LoginPage.tsx`, and `usercard.tsx`.
*   **`FormData` API Handling**: A critical technical pattern emerged in `employeeDataApi.ts` where `Content-Type` header was explicitly removed from `FormData` mutations to ensure proper browser handling of `multipart/form-data`.
*   **Feature Integration & Reversion**: The `EmployeeDashboard.tsx` shows a cycle of integrating a date filtering feature (`DatePeriodSelector`) and then subsequently removing it, possibly indicating a temporary test or a deferred implementation.
*   **Status Field Standardization**: `EmployeeDetailsPage.tsx` highlights ongoing efforts to standardize the values and display of the employee status field, addressing inconsistencies in casing and default values.